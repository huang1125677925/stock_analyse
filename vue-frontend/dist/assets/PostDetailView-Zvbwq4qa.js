import{d as G,j as O,a as _,r as P,y as Q,D as U,G as H,c as p,b as t,f as g,g as y,e as n,w as a,l as x,Q as K,i as l,E as v,k,t as c,aa as W,F as X,A as Y,ac as Z,P as $,u as ee,o as r,_ as te}from"./index-CTG2XoSg.js";import{a as oe,b as se,d as ae}from"./forumApi-WS6XbVkE.js";const ne={class:"post-detail-view","element-loading-text":"正在加载帖子详情..."},le={class:"back-button"},re={class:"post-header"},ce={class:"post-title"},ie={class:"post-meta"},ue={class:"post-time"},de={class:"post-content"},me={key:1,class:"comments-section"},_e={class:"comments-header"},pe={key:0,class:"comments-list"},ve={class:"comment-header"},fe={class:"comment-info"},he={class:"comment-author"},ge={class:"comment-time"},ye={class:"comment-content"},ke={class:"add-comment"},we=G({__name:"PostDetailView",setup(be){const F=O(),D=ee(),f=Number(F.params.id),u=_(!1),w=_(!1),s=_(null),d=_([]),b=_(),m=P({content:""}),z=P({content:[{required:!0,message:"请输入评论内容",trigger:"blur"},{min:2,max:1e3,message:"评论长度应在2到1000个字符之间",trigger:"blur"}]}),C=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",E=o=>{const e=localStorage.getItem("user");return e?JSON.parse(e).username===o:!1},R=()=>{D.push("/forum/posts")},I=async()=>{if(!(u.value||!f)){u.value=!0;try{const o=await oe(f);s.value=o.post,d.value=o.comments}catch(o){console.error("加载帖子详情失败:",o),v.error("加载帖子详情失败，请稍后重试")}finally{u.value=!1}}},M=async()=>{!b.value||!f||await b.value.validate(async o=>{if(o){w.value=!0;try{const e=await se(f,m.content);d.value.push(e.comment),m.content="",v.success("评论发表成功")}catch(e){console.error("发表评论失败:",e),v.error("发表评论失败，请稍后重试")}finally{w.value=!1}}})},S=()=>{s.value&&$.confirm("确定要删除这个帖子吗？此操作不可恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ae(s.value.id),v.success("帖子删除成功"),D.push("/forum/posts")}catch(o){console.error("删除帖子失败:",o),v.error("删除帖子失败，请稍后重试")}}).catch(()=>{})};return Q(()=>{I()}),(o,e)=>{const h=l("el-button"),T=l("el-tag"),V=l("el-card"),A=l("el-avatar"),J=l("el-divider"),B=l("el-empty"),L=l("el-input"),N=l("el-form-item"),j=l("el-form"),q=H("loading");return U((r(),p("div",ne,[t("div",le,[n(h,{onClick:R,icon:x(K),type:"default"},{default:a(()=>[...e[1]||(e[1]=[k("返回帖子列表",-1)])]),_:1},8,["icon"])]),s.value?(r(),g(V,{key:0,shadow:"hover",class:"post-card"},{header:a(()=>[t("div",re,[t("h1",ce,c(s.value.title),1),t("div",ie,[n(T,{size:"small",effect:"plain"},{default:a(()=>[k(c(s.value.author),1)]),_:1}),t("span",ue,"发布于 "+c(C(s.value.created_at)),1),E(s.value.author)?(r(),g(h,{key:0,type:"danger",size:"small",onClick:S,icon:x(W)},{default:a(()=>[...e[2]||(e[2]=[k(" 删除帖子 ",-1)])]),_:1},8,["icon"])):y("",!0)])])]),default:a(()=>[t("div",de,c(s.value.content),1)]),_:1})):y("",!0),s.value?(r(),p("div",me,[n(V,{shadow:"hover"},{header:a(()=>[t("div",_e,[t("h3",null,"评论区 ("+c(d.value.length)+")",1)])]),default:a(()=>[d.value.length>0?(r(),p("div",pe,[(r(!0),p(X,null,Y(d.value,i=>(r(),p("div",{key:i.id,class:"comment-item"},[t("div",ve,[n(A,{size:40,icon:x(Z)},null,8,["icon"]),t("div",fe,[t("div",he,c(i.author),1),t("div",ge,c(C(i.created_at)),1)])]),t("div",ye,c(i.content),1),n(J)]))),128))])):(r(),g(B,{key:1,description:"暂无评论"})),t("div",ke,[e[4]||(e[4]=t("h4",null,"发表评论",-1)),n(j,{model:m,rules:z,ref_key:"commentFormRef",ref:b},{default:a(()=>[n(N,{prop:"content"},{default:a(()=>[n(L,{modelValue:m.content,"onUpdate:modelValue":e[0]||(e[0]=i=>m.content=i),type:"textarea",rows:4,placeholder:"请输入评论内容"},null,8,["modelValue"])]),_:1}),n(N,null,{default:a(()=>[n(h,{type:"primary",onClick:M,loading:w.value},{default:a(()=>[...e[3]||(e[3]=[k("发表评论",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])]),_:1})])):y("",!0),!u.value&&!s.value?(r(),g(B,{key:2,description:"帖子不存在或已被删除"})):y("",!0)])),[[q,u.value]])}}}),Ce=te(we,[["__scopeId","data-v-909a96bf"]]);export{Ce as default};
