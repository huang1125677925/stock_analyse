import{g as ze,a as Pe}from"./industryAnalysisApi-CN80WFiM.js";import{i as ie,r as $e}from"./index-ElshY9iF.js";import{F as k,f as Ue,a as Le}from"./industry-fund-flow-4waet2Y0.js";import{d as de,a as z,x as me,z as oe,A as ve,B as ge,c as H,e as R,i as X,w as V,C as Ve,D as We,b as M,f as j,g as J,t as G,k as Ie,G as ue,E as re,o as U,_ as ce,H as Be,I as Ke,J as Xe,K as Ge,F as pe,y as ye,l as Ce}from"./index-DghMyGCw.js";import{g as Ye}from"./industryApi-CXYyWT5t.js";const qe={class:"industry-fund-flow-heatmap"},ke={class:"header-controls"},He={class:"controls"},Ze={"element-loading-text":"正在加载数据..."},Qe={key:1,class:"stats-container"},Je={class:"card-header"},je={class:"stats-content"},et={class:"stat-item"},tt={class:"stat-value positive"},nt={class:"stat-item"},at={class:"stat-value negative"},rt={class:"stat-item"},ot={class:"stat-value"},st={class:"stat-item"},lt={class:"stat-value positive"},it={class:"stat-item"},ut={class:"stat-value negative"},dt=de({__name:"IndustryFundFlowHeatmap",props:{industry:{},title:{default:"行业资金流热力图"}},setup(Y,{expose:$}){const v=Y,d=z();let n=null;const s=z(!1),S=z(!1),_=z("amount"),A=z("20"),f=z("all"),p=z(null),g=z(null),m=me(()=>_.value==="amount"?[{key:k.TOTAL_NET_INFLOW_AMOUNT,name:"全部净流入"},{key:k.MAIN_NET_INFLOW_AMOUNT,name:"主力净流入"},{key:k.SUPER_LARGE_NET_INFLOW_AMOUNT,name:"超大单净流入"},{key:k.LARGE_NET_INFLOW_AMOUNT,name:"大单净流入"},{key:k.MEDIUM_NET_INFLOW_AMOUNT,name:"中单净流入"},{key:k.SMALL_NET_INFLOW_AMOUNT,name:"小单净流入"}]:[{key:k.TOTAL_NET_INFLOW_RATIO,name:"全部净流入占比"},{key:k.MAIN_NET_INFLOW_RATIO,name:"主力净流入占比"},{key:k.SUPER_LARGE_NET_INFLOW_RATIO,name:"超大单净流入占比"},{key:k.LARGE_NET_INFLOW_RATIO,name:"大单净流入占比"},{key:k.MEDIUM_NET_INFLOW_RATIO,name:"中单净流入占比"},{key:k.SMALL_NET_INFLOW_RATIO,name:"小单净流入占比"}]),e=()=>{if(!p.value){g.value=null;return}const r=p.value,t=r.swCodeNames.find(b=>b.indexName===v.industry);if(!t){g.value=null;return}const c=r.congestions[t.indexCode]||r.congestions[t.indexName];if(!c||c.length===0){g.value=null;return}const i=["main_net_inflow_amount","main_net_inflow_ratio","super_large_net_inflow_amount","super_large_net_inflow_ratio","large_net_inflow_amount","large_net_inflow_ratio","medium_net_inflow_amount","medium_net_inflow_ratio","small_net_inflow_amount","small_net_inflow_ratio"];let u=0,y=0,x=0;c.forEach(b=>{i.forEach(h=>{const E=b[h];if(typeof E=="number"&&!isNaN(E)&&isFinite(E)){let N=!0;(f.value==="positive"&&E<=0||f.value==="negative"&&E>=0)&&(N=!1),N&&(x++,E>0?u++:E<0&&y++)}})});const F=x>0?(u/x*100).toFixed(2):"0.00",O=x>0?(y/x*100).toFixed(2):"0.00";g.value={positiveCount:u,negativeCount:y,totalCount:x,positiveRatio:F,negativeRatio:O}},D=async()=>{s.value=!0;try{const r=new Date,t=r.toISOString().split("T")[0],c=A.value==="all"?30:parseInt(A.value),i=new Date(r);i.setDate(r.getDate()-c);const u=i.toISOString().split("T")[0],y=await Ue(u,t);y?(p.value=y,await ue(),o(),e()):re.error("获取资金流数据失败")}catch(r){console.error("获取资金流数据出错:",r),re.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{s.value=!1}},l=()=>{d.value&&(n=ie(d.value),o())},o=()=>{if(!n||!p.value)return;const r=p.value,t=r.dates,c=r.swCodeNames.find(h=>h.indexName===v.industry);if(!c){re.warning(`未找到行业"${v.industry}"的数据`);return}const i=r.congestions[c.indexCode]||r.congestions[c.indexName];if(!i||i.length===0){re.warning(`行业"${v.industry}"暂无资金流数据`);return}const u=[...m.value].sort((h,E)=>{if(i.length===0)return 0;const N=i[i.length-1];let w,I;return h.key===k.TOTAL_NET_INFLOW_AMOUNT?w=N.super_large_net_inflow_amount+N.large_net_inflow_amount+N.medium_net_inflow_amount+N.small_net_inflow_amount:h.key===k.TOTAL_NET_INFLOW_RATIO?w=N.super_large_net_inflow_ratio+N.large_net_inflow_ratio+N.medium_net_inflow_ratio+N.small_net_inflow_ratio:w=N[h.key],E.key===k.TOTAL_NET_INFLOW_AMOUNT?I=N.super_large_net_inflow_amount+N.large_net_inflow_amount+N.medium_net_inflow_amount+N.small_net_inflow_amount:E.key===k.TOTAL_NET_INFLOW_RATIO?I=N.super_large_net_inflow_ratio+N.large_net_inflow_ratio+N.medium_net_inflow_ratio+N.small_net_inflow_ratio:I=N[E.key],S.value?w-I:I-w}),y=[];let x=1/0,F=-1/0;i.map(h=>{const E=h.main_net_inflow_amount+h.super_large_net_inflow_amount+h.large_net_inflow_amount+h.medium_net_inflow_amount+h.small_net_inflow_amount,N=h.main_net_inflow_ratio+h.super_large_net_inflow_ratio+h.large_net_inflow_ratio+h.medium_net_inflow_ratio+h.small_net_inflow_ratio;return{...h,total_net_inflow_amount:E,total_net_inflow_ratio:N}}).forEach((h,E)=>{u.forEach((N,w)=>{const I=h[N.key];if(typeof I=="number"&&!isNaN(I)&&isFinite(I)){let T=!0;(f.value==="positive"&&I<=0||f.value==="negative"&&I>=0)&&(T=!1),T&&(y.push([E,w,I]),x=Math.min(x,I),F=Math.max(F,I))}})}),(x===1/0||F===-1/0)&&(x=0,F=100),n.clear();const b={tooltip:{position:"top",formatter:function(h){const[E,N,w]=h.data,I=t[E],T=u[N],L=Le[T.key],P=L.formatter?L.formatter(w):w.toFixed(2);return`${T.name}<br/>${I}<br/>数值: ${P}${L.unit}`}},grid:{height:Math.max(300,u.length*40)+"px",top:"2%",left:"5%",right:"10%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:t,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:t,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:u.map(h=>h.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:u.map(h=>h.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"资金类型",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:x,max:F,calculable:!0,orient:"vertical",right:"0%",top:"5%",width:15,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:_.value==="amount"?"资金流入金额":"资金流入占比",type:"heatmap",data:y,label:{show:!0,fontSize:9,formatter:function(h){const[E,N,w]=h.data,I=u[N],T=Le[I.key];return T.formatter?T.formatter(w):w.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};ue(()=>{if(n&&(n.setOption(b),d.value)){const h=Math.max(400,u.length*50+120);d.value.style.height=h+"px",setTimeout(()=>{n&&n.resize()},0)}})},a=()=>{S.value=!S.value,o()};return oe(_,()=>{o()}),oe(()=>v.industry,()=>{o(),e()}),oe([p,()=>v.industry],()=>{e()}),oe(f,()=>{e()}),ve(()=>{l(),D()}),ge(()=>{n&&(n.dispose(),n=null)}),$({refreshData:D}),(r,t)=>{const c=X("el-radio-button"),i=X("el-radio-group"),u=X("el-option"),y=X("el-select"),x=X("el-button"),F=X("el-empty"),O=X("el-card"),b=We("loading");return U(),H("div",qe,[R(O,{shadow:"hover"},{header:V(()=>[M("div",ke,[M("h3",null,G(r.title),1),M("div",He,[R(i,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=h=>_.value=h),onChange:o,size:"small"},{default:V(()=>[R(c,{label:"amount"},{default:V(()=>[...t[3]||(t[3]=[Ie("资金数量",-1)])]),_:1}),R(c,{label:"ratio"},{default:V(()=>[...t[4]||(t[4]=[Ie("资金比率",-1)])]),_:1})]),_:1},8,["modelValue"]),R(y,{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=h=>A.value=h),onChange:D,placeholder:"选择日期范围",style:{width:"150px","margin-left":"10px"}},{default:V(()=>[R(u,{label:"最近10天",value:"10"}),R(u,{label:"最近15天",value:"15"}),R(u,{label:"最近20天",value:"20"}),R(u,{label:"全部29天",value:"all"})]),_:1},8,["modelValue"]),R(y,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=h=>f.value=h),onChange:o,placeholder:"数值过滤",style:{width:"120px","margin-left":"10px"}},{default:V(()=>[R(u,{label:"全部",value:"all"}),R(u,{label:"仅正值",value:"positive"}),R(u,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),R(x,{onClick:a,type:"primary",style:{"margin-left":"10px"}},{default:V(()=>[...t[5]||(t[5]=[Ie(" 按最后一列排序 ",-1)])]),_:1})])])]),default:V(()=>[Ve((U(),H("div",Ze,[M("div",{ref_key:"chartContainer",ref:d,class:"chart-container"},null,512),!s.value&&!p.value?(U(),j(F,{key:0,description:"暂无数据","image-size":200})):J("",!0),!s.value&&p.value&&g.value?(U(),H("div",Qe,[R(O,{class:"stats-card",shadow:"hover"},{header:V(()=>[M("div",Je,[M("span",null,"净流入正负比率统计 ("+G(f.value==="all"?"全部数值":f.value==="positive"?"仅正值":"仅负值")+")",1)])]),default:V(()=>[M("div",je,[M("div",et,[t[6]||(t[6]=M("span",{class:"stat-label"},"正值项数:",-1)),M("span",tt,G(g.value.positiveCount),1)]),M("div",nt,[t[7]||(t[7]=M("span",{class:"stat-label"},"负值项数:",-1)),M("span",at,G(g.value.negativeCount),1)]),M("div",rt,[t[8]||(t[8]=M("span",{class:"stat-label"},"总项数:",-1)),M("span",ot,G(g.value.totalCount),1)]),M("div",st,[t[9]||(t[9]=M("span",{class:"stat-label"},"正值比率:",-1)),M("span",lt,G(g.value.positiveRatio)+"%",1)]),M("div",it,[t[10]||(t[10]=M("span",{class:"stat-label"},"负值比率:",-1)),M("span",ut,G(g.value.negativeRatio)+"%",1)])])]),_:1})])):J("",!0)])),[[b,s.value]])]),_:1})])}}}),vt=ce(dt,[["__scopeId","data-v-10cda965"]]),ct={class:"industry-trend-charts"},ft={class:"chart-header"},mt={class:"chart-info"},ht={class:"info-item"},pt={class:"info-item"},yt={class:"chart-header"},gt={class:"chart-info"},_t={class:"info-item"},xt={class:"info-item"},Et={class:"chart-header"},Dt={class:"chart-info"},Nt={class:"info-item"},At={class:"info-item"},It={key:0,class:"loading-overlay"},bt=de({__name:"IndustryTrendCharts",props:{industry:{default:void 0},quarter:{},industryName:{},quarterName:{}},setup(Y){const $=Y,v=z(!1),d=z(),n=z(),s=z(),S=z(),_=z(),A=z(),f=z([]),p=async()=>{if($.quarter){v.value=!0;try{const o={report_type:$.quarter};$.industry&&$.industry!=="all"&&(o.industry=$.industry);const a=await ze(o);f.value=a.aggregated_reports,await ue(),g()}catch(o){console.error("获取行业数据失败:",o),re.error("获取数据失败，请稍后重试")}finally{v.value=!1}}},g=()=>{m(),e(),D()},m=()=>{if(!d.value||f.value.length===0)return;S.value&&S.value.dispose(),S.value=ie(d.value);const o=f.value.map(c=>c.report_date),a=f.value.map(c=>c.total_operating_revenue||0),r=f.value.map(c=>c.total_net_profit||0),t={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["营业收入","净利润"]},xAxis:{type:"category",data:o},yAxis:[{type:"value",name:"营业收入 (万元)",position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"净利润 (万元)",position:"right",axisLabel:{formatter:"{value}"}}],series:[{name:"营业收入",type:"line",yAxisIndex:0,data:a,smooth:!0,itemStyle:{color:"#1890ff"},lineStyle:{color:"#1890ff"}},{name:"净利润",type:"line",yAxisIndex:1,data:r,smooth:!0,itemStyle:{color:"#52c41a"},lineStyle:{color:"#52c41a"}}]};S.value.setOption(t)},e=()=>{if(!n.value||f.value.length===0)return;_.value&&_.value.dispose(),_.value=ie(n.value);const o=f.value.map(i=>i.report_date),a=f.value.map(i=>i.avg_operating_revenue_growth_rate||0),r=f.value.map(i=>i.avg_net_profit_growth_rate||0),t=f.value.map(i=>i.avg_gross_profit_margin||0),c={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(i){let u=i[0].name+"<br/>";return i.forEach(y=>{u+=y.marker+y.seriesName+": "+y.value.toFixed(2)+"%<br/>"}),u}},legend:{data:["营业收入增长率","净利润增长率","毛利率"]},xAxis:{type:"category",data:o},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"营业收入增长率",type:"line",data:a,smooth:!0,itemStyle:{color:"#faad14"},lineStyle:{color:"#faad14"}},{name:"净利润增长率",type:"line",data:r,smooth:!0,itemStyle:{color:"#f5222d"},lineStyle:{color:"#f5222d"}},{name:"毛利率",type:"line",data:t,smooth:!0,itemStyle:{color:"#722ed1"},lineStyle:{color:"#722ed1"}}]};_.value.setOption(c)},D=()=>{if(!s.value||f.value.length===0)return;A.value&&A.value.dispose(),A.value=ie(s.value);const o=f.value.map(c=>c.report_date),a=f.value.map(c=>c.avg_roe||0),r=f.value.map(c=>(c.avg_roe||0)*.8),t={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(c){let i=c[0].name+"<br/>";return c.forEach(u=>{i+=u.marker+u.seriesName+": "+u.value.toFixed(2)+"%<br/>"}),i}},legend:{data:["ROE","ROA"]},xAxis:{type:"category",data:o},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"ROE",type:"line",data:a,smooth:!0,itemStyle:{color:"#13c2c2"},lineStyle:{color:"#13c2c2"}},{name:"ROA",type:"line",data:r,smooth:!0,itemStyle:{color:"#eb2f96"},lineStyle:{color:"#eb2f96"}}]};A.value.setOption(t)},l=()=>{S.value?.resize(),_.value?.resize(),A.value?.resize()};return oe([()=>$.industry,()=>$.quarter],()=>{p()},{immediate:!1}),ve(()=>{p(),window.addEventListener("resize",l)}),ge(()=>{window.removeEventListener("resize",l),S.value?.dispose(),_.value?.dispose(),A.value?.dispose()}),(o,a)=>{const r=X("el-card"),t=X("el-loading");return U(),H("div",ct,[R(r,{class:"chart-card",shadow:"hover"},{default:V(()=>[M("div",ft,[a[0]||(a[0]=M("h3",null,"收入利润数据",-1)),M("div",mt,[M("span",ht,"行业: "+G(o.industryName),1),M("span",pt,"季度: "+G(o.quarterName),1)])]),M("div",{ref_key:"revenueChartRef",ref:d,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),R(r,{class:"chart-card",shadow:"hover"},{default:V(()=>[M("div",yt,[a[1]||(a[1]=M("h3",null,"增长率毛利率数据",-1)),M("div",gt,[M("span",_t,"行业: "+G(o.industryName),1),M("span",xt,"季度: "+G(o.quarterName),1)])]),M("div",{ref_key:"growthChartRef",ref:n,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),R(r,{class:"chart-card",shadow:"hover"},{default:V(()=>[M("div",Et,[a[2]||(a[2]=M("h3",null,"ROA/ROE数据",-1)),M("div",Dt,[M("span",Nt,"行业: "+G(o.industryName),1),M("span",At,"季度: "+G(o.quarterName),1)])]),M("div",{ref_key:"roeChartRef",ref:s,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),v.value?(U(),H("div",It,[R(t,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):J("",!0)])}}}),Mt=ce(bt,[["__scopeId","data-v-b9e4f51d"]]),wt={class:"industry-kline"},St={class:"chart-header"},Tt={key:0},Lt={key:1,class:"chart-subtitle"},Ct=de({__name:"IndustryKline",props:{industryCode:{},title:{default:"行业K线图"},height:{default:"600px"}},setup(Y){Be(m=>({"0941a1ba":$.height}));const $=Y,v=z();let d=null;const n=z(!1),s=z(""),S=z([]),_=()=>{v.value&&(d&&d.dispose(),d=ie(v.value),A(),window.addEventListener("resize",g))},A=()=>{if(!d)return;const m=S.value;if(!m||m.length===0){d.clear();return}const e=m.map(a=>p(a.date)),D=m.map(a=>[a.open_price,a.close_price,a.low_price,a.high_price]),l=m.map(a=>a.total_volume||0),o={animation:!1,title:{text:$.title,left:"center"},legend:{data:["K线","成交量"],left:"left"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},toolbox:{feature:{brush:{type:["lineX","clear"]},saveAsImage:{},dataZoom:{yAxisIndex:!1}}},axisPointer:{link:[{xAxisIndex:[0,1]}]},grid:[{left:"10%",right:"8%",top:"10%",height:"55%"},{left:"10%",right:"8%",top:"72%",height:"18%"}],xAxis:[{type:"category",data:e,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},{type:"category",gridIndex:1,data:e,boundaryGap:!1,axisLine:{onZero:!1},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},min:"dataMin",max:"dataMax"}],yAxis:[{scale:!0,splitArea:{show:!0}},{gridIndex:1,splitNumber:2,axisLabel:{show:!0},axisLine:{show:!0},axisTick:{show:!0},splitLine:{show:!1}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:0,end:100},{show:!0,xAxisIndex:[0,1],type:"slider",top:"90%",start:0,end:100}],brush:{xAxisIndex:"all",brushLink:"all",outOfBrush:{colorAlpha:.1}},series:[{name:"K线",type:"candlestick",data:D,itemStyle:{color:"#ec0000",color0:"#00da3c",borderColor:"#8A0000",borderColor0:"#008F28"}},{name:"成交量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:l,itemStyle:{color:"#7fbe9e"}}]};d.setOption(o,!0)},f=async()=>{if($.industryCode){n.value=!0;try{const m=await Ye($.industryCode);s.value=m.sector_name,S.value=(m.daily_data||[]).sort((e,D)=>e.date>D.date?1:-1),ue(A)}catch(m){console.error(m),re.error("获取行业K线数据失败")}finally{n.value=!1}}},p=m=>{const e=m.replace(/[^0-9]/g,"");return e.length===8?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:m},g=()=>d?.resize();return oe(()=>$.industryCode,()=>{f()}),ve(()=>{ue(()=>{_(),f()})}),ge(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",g)}),(m,e)=>{const D=X("el-empty");return U(),H("div",wt,[M("div",St,[m.title?(U(),H("h3",Tt,G(m.title),1)):J("",!0),s.value?(U(),H("div",Lt," 行业板块："+G(s.value)+"（代码："+G(m.industryCode)+"） ",1)):J("",!0)]),M("div",{ref_key:"chartRef",ref:v,class:"chart-container"},null,512),!n.value&&S.value.length===0?(U(),j(D,{key:0,description:"暂无数据"})):J("",!0)])}}}),Ft=ce(Ct,[["__scopeId","data-v-2d92cc74"]]);var he={exports:{}},Ot=he.exports,Fe;function Rt(){return Fe||(Fe=1,(function(Y,$){(function(d,n){Y.exports=n()})(Ot,function(){return(function(v){var d={};function n(s){if(d[s])return d[s].exports;var S=d[s]={exports:{},id:s,loaded:!1};return v[s].call(S.exports,S,S.exports,n),S.loaded=!0,S.exports}return n.m=v,n.c=d,n.p="",n(0)})([(function(v,d,n){var s;s=(function(S){return{clustering:n(1),regression:n(5),statistics:n(6),histogram:n(15),transform:{regression:n(18),histogram:n(21),clustering:n(22)}}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(2),A=_.dataPreprocess,f=_.normalizeDimensions,p=n(3),l=n(4),g=p.size,m=p.sumOfColumn,e=p.sum,D=p.zeros,l=n(4),o=l.isNumber,a=Math.pow,r={SINGLE:"single",MULTIPLE:"multiple"};function t(b,h,E){for(var N=D(b.length,2),w=y(h,O(b,E.dimensions)),I=!0,T,L,P,W;I;){I=!1;for(var C=0;C<b.length;C++){T=1/0,L=-1;for(var K=0;K<h;K++)P=x(b[C],w[K],E),P<T&&(T=P,L=K);N[C][0]!==L&&(I=!0),N[C][0]=L,N[C][1]=T}for(var C=0;C<h;C++){W=[];for(var K=0;K<N.length;K++)N[K][0]===C&&W.push(b[K]);w[C]=c(W,E)}}var se={centroids:w,clusterAssigned:N};return se}function c(b,h){for(var E=[],N,w,I=0;I<h.dimensions.length;I++){var T=h.dimensions[I];N=0;for(var L=0;L<b.length;L++)N+=b[L][T];w=N/b.length,E.push(w)}return E}function i(b,h,E){var N=(o(h)?{clusterCount:h,stepByStep:E}:h)||{clusterCount:2},w=N.clusterCount;if(w<2)return;var I=F(b,N),T=I.outputType===r.SINGLE,L=A(b,{dimensions:I.dimensions}),P=D(L.length,2),W,C,K;function se(q,ne){P[q][1]=ne}function Z(q){return P[q][1]}if(T){W=[];var Me=I.outputClusterIndexDimension;C=function(q,ne){W[q][Me]=ne},K=function(q){return W[q][Me]};for(var ee=0;ee<L.length;ee++)W.push(L[ee].slice()),se(ee,0),C(ee,0)}else C=function(q,ne){P[q][0]=ne},K=function(q){return P[q][0]};for(var we=c(L,I),le=[we],ee=0;ee<L.length;ee++){var Re=x(L[ee],we,I);se(ee,Re)}var _e,xe,Ee,fe,De,Ne,Se=1,te={data:W,centroids:le,isEnd:!1};T||(te.clusterAssment=P);function Te(){if(Se<w){_e=1/0;for(var q,ne,ae,Q=0;Q<le.length;Q++){xe=[],Ee=[];for(var B=0;B<L.length;B++)K(B)===Q?xe.push(L[B]):Ee.push(Z(B));fe=t(xe,2,I),De=m(fe.clusterAssigned,1),Ne=e(Ee),De+Ne<_e&&(_e=Ne+De,q=Q,ne=fe.centroids,ae=fe.clusterAssigned)}for(var B=0;B<ae.length;B++)ae[B][0]===0?ae[B][0]=q:ae[B][0]===1&&(ae[B][0]=le.length);le[q]=ne[0],le.push(ne[1]);for(var B=0,Q=0;B<L.length&&Q<ae.length;B++)K(B)===q&&(C(B,ae[Q][0]),se(B,ae[Q++][1]));var Ae=[];if(!T){for(var B=0;B<le.length;B++){Ae[B]=[];for(var Q=0;Q<L.length;Q++)K(Q)===B&&Ae[B].push(L[Q])}te.pointsInCluster=Ae}Se++}else te.isEnd=!0}if(N.stepByStep)te.next=function(){return Te(),u(te,I),te};else for(;Te(),!te.isEnd;);return u(te,I),te}function u(b,h){var E=h.outputCentroidDimensions;if(!(h.outputType!==r.SINGLE||E==null))for(var N=b.data,w=b.centroids,I=0;I<N.length;I++)for(var T=N[I],L=T[h.outputClusterIndexDimension],P=w[L],W=Math.min(P.length,E.length),C=0;C<W;C++)T[E[C]]=P[C]}function y(b,h){for(var E=D(b,h.length),N=0;N<h.length;N++)for(var w=h[N],I=0;I<b;I++)E[I][N]=w.min+w.span*Math.random();return E}function x(b,h,E){for(var N=0,w=E.dimensions,I=E.rawExtents,T=0;T<w.length;T++){var L=I[T].span;if(L){var P=w[T],W=(b[P]-h[T])/L;N+=a(W,2)}}return N}function F(b,h){var E=g(b);if(E.length<1)throw new Error("The input data of clustering should be two-dimension array.");for(var N=E[1],w=[],I=0;I<N;I++)w.push(I);var T=f(h.dimensions,w),L=h.outputType||r.MULTIPLE,P=h.outputClusterIndexDimension;if(L===r.SINGLE&&!l.isNumber(P))throw new Error("outputClusterIndexDimension is required as a number.");var W=O(b,T);return{dimensions:T,rawExtents:W,outputType:L,outputClusterIndexDimension:P,outputCentroidDimensions:h.outputCentroidDimensions}}function O(b,h){for(var E=[],N=h.length,w=0;w<N;w++)E.push({min:1/0,max:-1/0});for(var w=0;w<b.length;w++)for(var I=b[w],T=0;T<N;T++){var L=E[T],P=I[h[T]];L.min>P&&(L.min=P),L.max<P&&(L.max=P)}for(var w=0;w<N;w++)E[w].span=E[w].max-E[w].min;return E}return{OutputType:r,hierarchicalKMeans:i}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(3),A=_.isArray,f=_.size,p=n(4),g=p.isNumber;function m(l,o){return typeof l=="number"?[l]:l??o}function e(l,o){o=o||{};var a=o.dimensions,r={};if(a!=null)for(var t=0;t<a.length;t++)r[a[t]]=!0;var c=o.toOneDimensionArray?a?a[0]:0:null;function i(b){return!a||r.hasOwnProperty(b)}if(!A(l))throw new Error("Invalid data type, you should input an array");var u=[],y=f(l);if(y.length===1)for(var t=0;t<y[0];t++){var x=l[t];g(x)&&u.push(x)}else if(y.length===2)for(var t=0;t<y[0];t++){for(var F=!0,x=l[t],O=0;O<y[1];O++)i(O)&&!g(x[O])&&(F=!1);F&&u.push(c!=null?x[c]:x)}return u}function D(l){var o=l.toString(),a=o.indexOf(".");return a<0?0:o.length-1-a}return{normalizeDimensions:m,dataPreprocess:e,getPrecision:D}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=Object.prototype.toString,A=Array.prototype,f=A.map;function p(r){for(var t=[];g(r);)t.push(r.length),r=r[0];return t}function g(r){return _.call(r)==="[object Array]"}function m(r,t){for(var c=[],i=0;i<r;i++){c[i]=[];for(var u=0;u<t;u++)c[i][u]=0}return c}function e(r){for(var t=0,c=0;c<r.length;c++)t+=r[c];return t}function D(r,t){for(var c=0,i=0;i<r.length;i++)c+=r[i][t];return c}function l(r,t){return r>t?1:r<t?-1:r===t?0:NaN}function o(r,t,c,i){for(c==null&&(c=0),i==null&&(i=r.length);c<i;){var u=Math.floor((c+i)/2),y=l(r[u],t);if(y>0)i=u;else if(y<0)c=u+1;else return u+1}return c}function a(r,t,c){if(r&&t){if(r.map&&r.map===f)return r.map(t,c);for(var i=[],u=0,y=r.length;u<y;u++)i.push(t.call(c,r[u],u,r));return i}}return{size:p,isArray:g,zeros:m,sum:e,sumOfColumn:D,ascending:l,bisect:o,map:a}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){function _(p){return p=p===null?NaN:+p,typeof p=="number"&&!isNaN(p)}function A(p){return isFinite(p)&&p===Math.round(p)}function f(p){if(p===0)return 0;var g=Math.floor(Math.log(p)/Math.LN10);return p/Math.pow(10,g)>=10&&g++,g}return{isNumber:_,isInteger:A,quantityExponent:f}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(2),A=_.dataPreprocess,f=_.normalizeDimensions,p={linear:function(e,D){for(var l=D.dimensions[0],o=D.dimensions[1],a=0,r=0,t=0,c=0,i=e.length,u=0;u<i;u++){var y=e[u];a+=y[l],r+=y[o],t+=y[l]*y[o],c+=y[l]*y[l]}for(var x=(i*t-a*r)/(i*c-a*a),F=r/i-x*a/i,O=[],b=0;b<e.length;b++){var y=e[b],h=y.slice();h[l]=y[l],h[o]=x*y[l]+F,O.push(h)}var E="y = "+Math.round(x*100)/100+"x + "+Math.round(F*100)/100;return{points:O,parameter:{gradient:x,intercept:F},expression:E}},linearThroughOrigin:function(e,D){for(var l=D.dimensions[0],o=D.dimensions[1],a=0,r=0,t=0;t<e.length;t++){var c=e[t];a+=c[l]*c[l],r+=c[l]*c[o]}for(var i=r/a,u=[],y=0;y<e.length;y++){var c=e[y],x=c.slice();x[l]=c[l],x[o]=c[l]*i,u.push(x)}var F="y = "+Math.round(i*100)/100+"x";return{points:u,parameter:{gradient:i},expression:F}},exponential:function(e,D){for(var l=D.dimensions[0],o=D.dimensions[1],a=0,r=0,t=0,c=0,i=0,u=0,y=0;y<e.length;y++){var x=e[y];a+=x[l],r+=x[o],u+=x[l]*x[o],t+=x[l]*x[l]*x[o],c+=x[o]*Math.log(x[o]),i+=x[l]*x[o]*Math.log(x[o])}for(var F=r*t-u*u,O=Math.pow(Math.E,(t*c-u*i)/F),b=(r*i-u*c)/F,h=[],E=0;E<e.length;E++){var x=e[E],N=x.slice();N[l]=x[l],N[o]=O*Math.pow(Math.E,b*x[l]),h.push(N)}var w="y = "+Math.round(O*100)/100+"e^("+Math.round(b*100)/100+"x)";return{points:h,parameter:{coefficient:O,index:b},expression:w}},logarithmic:function(e,D){for(var l=D.dimensions[0],o=D.dimensions[1],a=0,r=0,t=0,c=0,i=0;i<e.length;i++){var u=e[i];a+=Math.log(u[l]),r+=u[o]*Math.log(u[l]),t+=u[o],c+=Math.pow(Math.log(u[l]),2)}for(var y=(i*r-t*a)/(i*c-a*a),x=(t-y*a)/i,F=[],O=0;O<e.length;O++){var u=e[O],b=u.slice();b[l]=u[l],b[o]=y*Math.log(u[l])+x,F.push(b)}var h="y = "+Math.round(x*100)/100+" + "+Math.round(y*100)/100+"ln(x)";return{points:F,parameter:{gradient:y,intercept:x},expression:h}},polynomial:function(e,D){var l=D.dimensions[0],o=D.dimensions[1],a=D.order;a==null&&(a=2);for(var r=[],t=[],c=a+1,i=0;i<c;i++){for(var u=0,y=0;y<e.length;y++){var x=e[y];u+=x[o]*Math.pow(x[l],i)}t.push(u);for(var F=[],O=0;O<c;O++){for(var b=0,h=0;h<e.length;h++)b+=Math.pow(e[h][l],i+O);F.push(b)}r.push(F)}r.push(t);for(var E=g(r,c),N=[],i=0;i<e.length;i++){for(var w=0,x=e[i],y=0;y<E.length;y++)w+=E[y]*Math.pow(x[l],y);var I=x.slice();I[l]=x[l],I[o]=w,N.push(I)}for(var T="y = ",i=E.length-1;i>=0;i--)i>1?T+=Math.round(E[i]*Math.pow(10,i+1))/Math.pow(10,i+1)+"x^"+i+" + ":i===1?T+=Math.round(E[i]*100)/100+"x + ":T+=Math.round(E[i]*100)/100;return{points:N,parameter:E,expression:T}}};function g(e,D){for(var l=0;l<e.length-1;l++){for(var o=l,a=l+1;a<e.length-1;a++)Math.abs(e[l][a])>Math.abs(e[l][o])&&(o=a);for(var r=l;r<e.length;r++){var t=e[r][l];e[r][l]=e[r][o],e[r][o]=t}for(var c=l+1;c<e.length-1;c++)for(var i=e.length-1;i>=l;i--)e[i][c]-=e[i][l]/e[l][l]*e[l][c]}for(var u=new Array(D),y=e.length-1,a=e.length-2;a>=0;a--){for(var t=0,l=a+1;l<e.length-1;l++)t+=e[l][a]*u[l];u[a]=(e[y][a]-t)/e[a][a]}return u}var m=function(e,D,l){var o=typeof l=="number"?{order:l}:l||{},a=f(o.dimensions,[0,1]),r=A(D,{dimensions:a}),t=p[e](r,{order:o.order,dimensions:a}),c=a[0];return t.points.sort(function(i,u){return i[c]-u[c]}),t};return m}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _={};return _.max=n(7),_.deviation=n(8),_.mean=n(10),_.median=n(12),_.min=n(14),_.quantile=n(13),_.sampleVariance=n(9),_.sum=n(11),_}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(4),A=_.isNumber;function f(p){for(var g=-1/0,m=0;m<p.length;m++)A(p[m])&&p[m]>g&&(g=p[m]);return g}return f}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(9);return function(A){var f=_(A);return f&&Math.sqrt(f)}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(4),A=_.isNumber,f=n(10);function p(g){var m=g.length;if(!m||m<2)return 0;if(g.length>=2){for(var e=f(g),D=0,l,o=0;o<g.length;o++)A(g[o])&&(l=g[o]-e,D+=l*l);return D/(g.length-1)}}return p}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(11);function A(f){var p=f.length;return p?_(f)/f.length:0}return A}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(4),A=_.isNumber;function f(p){var g=p.length;if(!g)return 0;for(var m=0,e=0;e<g;e++)A(p[e])&&(m+=p[e]);return m}return f}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(13);function A(f){return _(f,.5)}return A}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){return function(_,A){var f=_.length;if(!f)return 0;if(A<=0||f<2)return _[0];if(A>=1)return _[f-1];var p=(f-1)*A,g=Math.floor(p),m=_[g],e=_[g+1];return m+(e-m)*(p-g)}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(4),A=_.isNumber;function f(p){for(var g=1/0,m=0;m<p.length;m++)A(p[m])&&p[m]<g&&(g=p[m]);return g}return f}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(7),A=n(14),f=n(13),p=n(8),g=n(2),m=g.dataPreprocess,e=g.normalizeDimensions,D=n(3),l=D.ascending,o=D.map,a=n(16),r=D.bisect,t=n(17);function c(K,y){for(var x=typeof y=="string"?{method:y}:y||{},F=x.method==null?i.squareRoot:i[x.method],O=e(x.dimensions),b=m(K,{dimensions:O,toOneDimensionArray:!0}),h=_(b),E=A(b),N=F(b,E,h),w=t(E,h,N),I=w.step,T=w.toFixedPrecision,L=a(+(Math.ceil(E/I)*I).toFixed(T),+(Math.floor(h/I)*I).toFixed(T),I,T),P=L.length,W=new Array(P+1),C=0;C<=P;C++)W[C]={},W[C].sample=[],W[C].x0=C>0?L[C-1]:L[C]-E===I?E:L[C]-I,W[C].x1=C<P?L[C]:h-L[C-1]===I?h:L[C-1]+I;for(var C=0;C<b.length;C++)E<=b[C]&&b[C]<=h&&W[r(L,b[C],0,P)].sample.push(b[C]);var K=o(W,function(Z){return[+((Z.x0+Z.x1)/2).toFixed(T),Z.sample.length,Z.x0,Z.x1,Z.x0+" - "+Z.x1]}),se=o(W,function(Z){return[Z.x0,Z.x1,Z.sample.length]});return{bins:W,data:K,customData:se}}var i={squareRoot:function(u){var y=Math.ceil(Math.sqrt(u.length));return y>50?50:y},scott:function(u,y,x){return Math.ceil((x-y)/(3.5*p(u)*Math.pow(u.length,-1/3)))},freedmanDiaconis:function(u,y,x){return u.sort(l),Math.ceil((x-y)/(2*(f(u,.75)-f(u,.25))*Math.pow(u.length,-1/3)))},sturges:function(u){return Math.ceil(Math.log(u.length)/Math.LN2)+1}};return c}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(2),A=_.getPrecision;return function(f,p,g,m){var e=arguments.length;e<2?(p=f,f=0,g=1):e<3?g=1:e<4?(g=+g,m=A(g)):m=+m;for(var D=Math.ceil(((p-f)/g).toFixed(m)),l=new Array(D+1),o=0;o<D+1;o++)l[o]=+(f+o*g).toFixed(m);return l}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(4);return function(A,f,p){var g=Math.abs(f-A)/p,m=_.quantityExponent(g),e=Math.pow(10,m),D=g/e;D>=Math.sqrt(50)?e*=10:D>=Math.sqrt(10)?e*=5:D>=Math.sqrt(2)&&(e*=2);var l=m<0?-m:0,o=+(f>=A?e:-e).toFixed(l);return{step:o,toFixedPrecision:l}}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(5),A=n(19),f=2;return{type:"ecStat:regression",transform:function(g){var m=g.upstream,e=g.config||{},D=e.method||"linear",l=_(D,m.cloneRawData(),{order:e.order,dimensions:A.normalizeExistingDimensions(g,e.dimensions)}),o=l.points,a=e.formulaOn;a==null&&(a="end");var r;if(a!=="none"){for(var t=0;t<o.length;t++)o[t][f]=a==="start"&&t===0||a==="all"||a==="end"&&t===o.length-1?l.expression:"";r=m.cloneAllDimensionInfo(),r[f]={}}return[{dimensions:r,data:o}]}}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(3),A=n(4),f=n(20);function p(m,e){if(e==null)return;var D=m.upstream;if(_.isArray(e)){for(var l=[],o=0;o<e.length;o++){var a=D.getDimensionInfo(e[o]);r(a,e[o]),l[o]=a.index}return l}else{var a=D.getDimensionInfo(e);return r(a,e),a.index}function r(t,c){if(!t)throw new Error("Can not find dimension by "+c)}}function g(m){if(_.isArray(m)){for(var e=[],D=[],l=0;l<m.length;l++){var o=a(m[l]);e.push(o.name),D.push(o.index)}return{name:e,index:D}}else if(m!=null)return a(m);function a(r){if(A.isNumber(r))return{index:r};if(f.isObject(r)&&A.isNumber(r.index))return r;throw new Error("Illegle new dimensions config. Expect `{ name: string, index: number }`.")}}return{normalizeExistingDimensions:p,normalizeNewDimensions:g}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){function _(f,p){if(Object.assign)Object.assign(f,p);else for(var g in p)p.hasOwnProperty(g)&&(f[g]=p[g]);return f}function A(f){const p=typeof f;return p==="function"||!!f&&p==="object"}return{extend:_,isObject:A}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(15),A=n(19);return{type:"ecStat:histogram",transform:function(p){var g=p.upstream,m=p.config||{},e=_(g.cloneRawData(),{method:m.method,dimensions:A.normalizeExistingDimensions(p,m.dimensions)});return[{dimensions:["MeanOfV0V1","VCount","V0","V1","DisplayableName"],data:e.data},{data:e.customData}]}}}).call(d,n,d,v),s!==void 0&&(v.exports=s)}),(function(v,d,n){var s;s=(function(S){var _=n(1),A=n(4),f=n(19),p=A.isNumber;return{type:"ecStat:clustering",transform:function(m){var e=m.upstream,D=m.config||{},l=D.clusterCount;if(!p(l)||l<=0)throw new Error('config param "clusterCount" need to be specified as an interger greater than 1.');if(l===1)return[{},{data:[]}];var o=f.normalizeNewDimensions(D.outputClusterIndexDimension),a=f.normalizeNewDimensions(D.outputCentroidDimensions);if(o==null)throw new Error("outputClusterIndexDimension is required as a number.");for(var r=_.hierarchicalKMeans(e.cloneRawData(),{clusterCount:l,stepByStep:!1,dimensions:f.normalizeExistingDimensions(m,D.dimensions),outputType:_.OutputType.SINGLE,outputClusterIndexDimension:o.index,outputCentroidDimensions:(a||{}).index}),t=e.cloneAllDimensionInfo(),c=[],i=0;i<t.length;i++){var u=t[i];c.push(u.name)}if(c[o.index]=o.name,a)for(var i=0;i<a.index.length;i++)a.name[i]!=null&&(c[a.index[i]]=a.name[i]);return[{dimensions:c,data:r.data},{data:r.centroids}]}}}).call(d,n,d,v),s!==void 0&&(v.exports=s)})])})})(he)),he.exports}var be,Oe;function zt(){return Oe||(Oe=1,be=Rt()),be}var Pt=zt();const $t=Ke(Pt);async function Ut(Y){return(await Xe.get("/django/api/strategy/industry-fund-flow-correlation/",{params:{sector_code:Y.sector_code,start_date:Y.start_date,end_date:Y.end_date,x_axis:Y.x_axis??"change_percent",y_axis:Y.y_axis??"main",sort_order:Y.sort_order??"desc"}})).data}const Vt=[{value:"change_percent",label:"涨跌幅(%)"},{value:"turnover_rate",label:"换手率(%)"},{value:"amplitude",label:"振幅(%)"}],Wt=[{value:"main",label:"主力净流入"},{value:"super_large",label:"超大单净流入"},{value:"large",label:"大单净流入"},{value:"medium",label:"中单净流入"},{value:"small",label:"小单净流入"},{value:"all",label:"全部净流入"}],Bt={class:"industry-fund-flow-correlation-scatter"},Kt={class:"card-header"},Xt={class:"title-left"},Gt={class:"subtitle"},Yt={class:"controls"},qt={class:"control-group"},kt={class:"control-group"},Ht={class:"control-group"},Zt={class:"control-group"},Qt=de({__name:"IndustryFundFlowCorrelationScatter",props:{sectorCode:{},industryName:{},title:{},height:{default:"480px"}},setup(Y){$e($t.transform.regression);const $=Y,v=z(20),d=z("change_percent"),n=z(["main","all"]),s=z("desc"),S=Vt,_=Wt,A=z();let f=null;const p=z(!1),g=z(0);function m(o){return o.toISOString().split("T")[0]}function e(o){const a=new Date,r=new Date(Date.now()-o*24*60*60*1e3);return[m(r),m(a)]}async function D(){if($.sectorCode){p.value=!0;try{const[o,a]=e(v.value),r=await Promise.all(n.value.map(y=>Ut({sector_code:$.sectorCode,start_date:o,end_date:a,x_axis:d.value,y_axis:y,sort_order:s.value}).catch(x=>(console.error("获取相关性散点失败:",x),null)))),t=[],c=[],i=[];if(r.forEach((y,x)=>{if(!y||!y.points||y.points.length===0)return;const F=n.value[x],O=_.find(E=>E.value===F)?.label||F,b=y.points.map(E=>[E.x,E.y,E.date]),h=t.length;t.push({source:b}),t.push({transform:{type:"ecStat:regression",config:{method:"polynomial",order:3}},fromDatasetIndex:h}),c.push({name:`${O} 散点`,type:"scatter",datasetIndex:h,symbolSize:8,emphasis:{focus:"none",scale:!1,label:{show:!1}},label:{show:!1}}),c.push({name:`${O} 回归`,type:"line",smooth:!0,datasetIndex:h+1,symbolSize:.1,symbol:"circle",emphasis:{focus:"none",scale:!1,label:{show:!1}},label:{show:!1}}),i.push(`${O} 散点`),i.push(`${O} 回归`)}),g.value=c.length,await ue(),!A.value)return;f||(f=ie(A.value));const u={title:{text:$.title||`${$.industryName||""} - 资金流相关性散点图（含多项式回归）`,left:"center",top:10},tooltip:{trigger:"item",formatter:y=>{if(Array.isArray(y.data)){const[x,F,O]=y.data,b=S.find(h=>h.value===d.value)?.label||d.value;return`${O||""}<br/>${b}: ${typeof x=="number"?x.toFixed(2):x}<br/>${y.seriesName}: ${typeof F=="number"?F.toFixed(2):F}`}return`${y.seriesName}`},confine:!0,appendToBody:!0},legend:{top:54,data:i},grid:{left:60,right:30,top:150,bottom:40,containLabel:!0},xAxis:{type:"value",name:S.find(y=>y.value===d.value)?.label},yAxis:{type:"value",name:"净流入(元)"},dataset:t,series:c};f.setOption(u),f.resize()}catch(o){console.error(o),re.error("获取相关性散点数据失败")}finally{p.value=!1}}}oe(()=>$.sectorCode,D),oe([v,d,n,s],D,{deep:!0}),ve(()=>{D(),window.addEventListener("resize",l)}),ge(()=>{f&&(f.dispose(),f=null),window.removeEventListener("resize",l)});function l(){f?.resize()}return(o,a)=>{const r=X("el-option"),t=X("el-select"),c=X("el-empty"),i=X("el-card");return U(),H("div",Bt,[R(i,{class:"control-card",shadow:"hover"},{header:V(()=>[M("div",Kt,[M("div",Xt,[M("h3",null,G(o.title||`${o.industryName} - 行业资金流相关性散点图`),1),M("div",Gt,"行业板块代码："+G(o.sectorCode),1)]),M("div",Yt,[M("div",qt,[a[4]||(a[4]=M("span",{class:"control-label"},"时间范围：",-1)),R(t,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=u=>v.value=u),style:{width:"120px"}},{default:V(()=>[R(r,{value:20,label:"最近20天"}),R(r,{value:40,label:"最近40天"}),R(r,{value:60,label:"最近60天"}),R(r,{value:120,label:"最近120天"})]),_:1},8,["modelValue"])]),M("div",kt,[a[5]||(a[5]=M("span",{class:"control-label"},"X轴：",-1)),R(t,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=u=>d.value=u),style:{width:"160px"}},{default:V(()=>[(U(!0),H(pe,null,ye(Ce(S),u=>(U(),j(r,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),M("div",Ht,[a[6]||(a[6]=M("span",{class:"control-label"},"Y轴（可多选）：",-1)),R(t,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=u=>n.value=u),multiple:"","collapse-tags":"","max-collapse-tags":2,style:{"min-width":"260px"}},{default:V(()=>[(U(!0),H(pe,null,ye(Ce(_),u=>(U(),j(r,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),M("div",Zt,[a[7]||(a[7]=M("span",{class:"control-label"},"排序：",-1)),R(t,{modelValue:s.value,"onUpdate:modelValue":a[3]||(a[3]=u=>s.value=u),style:{width:"120px"}},{default:V(()=>[R(r,{value:"desc",label:"按Y降序"}),R(r,{value:"asc",label:"按Y升序"})]),_:1},8,["modelValue"])])])])]),default:V(()=>[M("div",{ref_key:"chartRef",ref:A,class:"chart-container",style:Ge({height:o.height})},null,4),!p.value&&g.value===0?(U(),j(c,{key:0,description:"暂无数据"})):J("",!0)]),_:1})])}}}),Jt=ce(Qt,[["__scopeId","data-v-002ed94d"]]),jt={class:"industry-analysis"},en={class:"filter-row"},tn={class:"filter-item"},nn={class:"filter-item"},an={key:5,class:"loading-overlay"},rn=de({__name:"IndustryAnalysis",setup(Y){const $=z(!1),v=z(),d=z(""),n=z([]),s=z([{label:"年报",value:"annual"},{label:"中报",value:"semi_annual"},{label:"一季报",value:"q1"},{label:"三季报",value:"q3"},{label:"季报",value:"quarterly"}]),S=me(()=>v.value==="all"?"全部行业":n.value.find(e=>e.name===v.value)?.name||"未知行业"),_=me(()=>s.value.find(e=>e.value===d.value)?.label||"未选择"),A=me(()=>n.value.find(e=>e.name===v.value)?.code||""),f=async()=>{$.value=!0;try{const m=await Pe();console.log("获取行业列表响应:",m),n.value=m.sectors,console.log("行业列表:",n.value),s.value.length>0&&(d.value=s.value[0].value),re.success("页面初始化完成")}catch(m){console.error("初始化数据失败:",m),re.error("初始化数据失败，请刷新页面重试")}finally{$.value=!1}},p=()=>{console.log("行业已变更为:",v.value)},g=()=>{console.log("季度已变更为:",d.value)};return ve(()=>{f()}),(m,e)=>{const D=X("el-option"),l=X("el-select"),o=X("el-card"),a=X("el-empty"),r=X("el-loading");return U(),H("div",jt,[R(o,{class:"filter-panel",shadow:"hover"},{default:V(()=>[M("div",en,[M("div",tn,[e[2]||(e[2]=M("label",{class:"filter-label"},"选择行业：",-1)),R(l,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),placeholder:"请选择行业",style:{width:"200px"},onChange:p},{default:V(()=>[(U(!0),H(pe,null,ye(n.value,t=>(U(),j(D,{key:t.name,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),M("div",nn,[e[3]||(e[3]=M("label",{class:"filter-label"},"选择季度：",-1)),R(l,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),placeholder:"请选择季度",style:{width:"150px"},onChange:g},{default:V(()=>[(U(!0),H(pe,null,ye(s.value,t=>(U(),j(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1}),v.value&&v.value!=="all"&&A.value?(U(),j(o,{key:0,class:"kline-panel",shadow:"hover"},{default:V(()=>[R(Ft,{"industry-code":A.value,title:`${S.value} - 行业K线图`},null,8,["industry-code","title"])]),_:1})):J("",!0),v.value&&d.value?(U(),j(Mt,{key:1,industry:v.value,quarter:d.value,"industry-name":S.value,"quarter-name":_.value},null,8,["industry","quarter","industry-name","quarter-name"])):J("",!0),!v.value||!d.value?(U(),j(a,{key:2,description:"请选择行业和季度查看趋势分析","image-size":200})):J("",!0),v.value&&v.value!=="all"?(U(),j(o,{key:3,class:"fund-flow-panel",shadow:"hover"},{default:V(()=>[R(vt,{industry:S.value,title:`${S.value} - 资金流热力图`},null,8,["industry","title"])]),_:1})):J("",!0),v.value&&v.value!=="all"&&A.value?(U(),j(o,{key:4,class:"fund-flow-panel",shadow:"hover"},{default:V(()=>[R(Jt,{"sector-code":A.value,"industry-name":S.value,title:`${S.value} - 资金流相关性散点图`,height:"500px"},null,8,["sector-code","industry-name","title"])]),_:1})):J("",!0),$.value?(U(),H("div",an,[R(r,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):J("",!0)])}}}),vn=ce(rn,[["__scopeId","data-v-0e21b1ad"]]);export{vn as default};
