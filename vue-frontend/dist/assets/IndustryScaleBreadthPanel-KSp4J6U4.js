import{i as N}from"./index-ElshY9iF.js";import{a as G,b as D}from"./strategyBreadthApi-BXy46mbT.js";import{d as q,a as d,y as J,C as K,B as Q,c as p,e as n,i as k,w as h,l as x,b as F,f as A,o,_ as X}from"./index-hKQdfw1y.js";const Y={class:"industry-scale-breadth-panel"},Z={class:"card-header"},ee={key:0},te={key:1},ae={class:"header-actions"},re={key:0,class:"tips"},se={key:1,class:"tips"},oe=q({__name:"IndustryScaleBreadthPanel",props:{industryWhitelist:{default:()=>[]},panelType:{default:"breadth"}},setup(P){const m=P,i=m.panelType,f=d(),y=d();let l=null,c=null;const C=d([]),w=d([]),V=d(!1),S=d("scale_breadth"),B=d("estimated_industry_output");function W(e,a){return Number(e[a]??0)}function z(e,a){return e?Number(e[a]??0):0}function T(){const e=O(),a=S.value;return[...e].sort((r,s)=>W(s,a)-W(r,a))}function E(){const e=O(),a=new Map(w.value.map(s=>[s.sector_code,s])),r=B.value;return[...e].sort((s,u)=>z(a.get(u.sector_code),r)-z(a.get(s.sector_code),r))}function H(){i==="breadth"?f.value&&(l&&l.dispose(),l=N(f.value)):y.value&&(c&&c.dispose(),c=N(y.value))}function O(){return m.industryWhitelist&&m.industryWhitelist.length>0?C.value.filter(e=>m.industryWhitelist.includes(e.sector_name)):C.value}function R(e){return Math.max(500,e*22+120)}function I(){if(!l)return;const e=T(),a=e.map(t=>t.sector_name),r=e.map(t=>t.market_cap_ratio),s=e.map(t=>t.company_ratio),u=e.map(t=>t.scale_breadth),v=R(e.length);f.value&&(f.value.style.height=`${v}px`);const b={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:t=>{const M=t.map(g=>`${g.seriesName}: ${(g.value*100).toFixed(2)}%`);return`${t[0].name}<br/>${M.join("<br/>")}`}},grid:{left:100,right:10,top:12,bottom:20},xAxis:{type:"value",boundaryGap:[0,.01],axisLabel:{formatter:t=>`${(t*100).toFixed(0)}%`}},yAxis:{type:"category",data:a,inverse:!0},series:[{name:"market_cap_ratio",type:"bar",data:r,barWidth:6},{name:"company_ratio",type:"bar",data:s,barWidth:6},{name:"scale_breadth",type:"bar",data:u,barWidth:6}]};l.setOption(b),l.resize()}function $(){if(!c)return;const e=E(),a=e.map(t=>t.sector_name),r=new Map(w.value.map(t=>[t.sector_code,t])),s=e.map(t=>(r.get(t.sector_code)?.top_n_revenue_sum||0)/1e8),u=e.map(t=>(r.get(t.sector_code)?.estimated_industry_output||0)/1e8),v=R(e.length);y.value&&(y.value.style.height=`${v}px`);const b={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:t=>{const M=t.map(g=>`${g.seriesName}: ${g.value.toFixed(2)} 亿元`);return`${t[0].name}<br/>${M.join("<br/>")}`}},grid:{left:100,right:10,top:12,bottom:40},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:a,inverse:!0},series:[{name:"top_n_revenue_sum",type:"bar",data:s,barWidth:8},{name:"estimated_industry_output",type:"bar",data:u,barWidth:8}]};c.setOption(b),c.resize()}function L(){I(),_()}function U(){$(),_()}function _(){l?.resize(),c?.resize()}async function j(){V.value=!0;try{const[e,a]=await Promise.all([G(),D(void 0,3)]);C.value=e.data||[],w.value=a.data||[],i==="breadth"?I():$(),_()}catch(e){console.error("加载行业规模宽度/实际产出数据失败:",e)}finally{V.value=!1}}return J(()=>{H(),j(),window.addEventListener("resize",_)}),K(()=>{window.removeEventListener("resize",_)}),Q(()=>m.industryWhitelist,()=>{i==="breadth"?I():$(),_()},{deep:!0}),(e,a)=>{const r=k("el-option"),s=k("el-select"),u=k("el-card"),v=k("el-col"),b=k("el-row");return o(),p("div",Y,[n(b,{gutter:16},{default:h(()=>[n(v,{span:24},{default:h(()=>[n(u,{shadow:"hover",class:"chart-card"},{header:h(()=>[F("div",Z,[x(i)==="breadth"?(o(),p("span",ee,"行业规模宽度指标")):(o(),p("span",te,"行业产出与营收（亿元）")),F("div",ae,[x(i)==="breadth"?(o(),p("span",re,"展示：market_cap_ratio、company_ratio、scale_breadth（全行业）")):(o(),p("span",se,"展示：top_n_revenue_sum、estimated_industry_output（全行业）")),x(i)==="breadth"?(o(),A(s,{key:2,modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=t=>S.value=t),size:"small",class:"sort-select",onChange:L},{default:h(()=>[n(r,{label:"按规模宽度",value:"scale_breadth"}),n(r,{label:"按总市值占比",value:"market_cap_ratio"}),n(r,{label:"按公司数量占比",value:"company_ratio"})]),_:1},8,["modelValue"])):(o(),A(s,{key:3,modelValue:B.value,"onUpdate:modelValue":a[1]||(a[1]=t=>B.value=t),size:"small",class:"sort-select",onChange:U},{default:h(()=>[n(r,{label:"按估算行业总产出",value:"estimated_industry_output"}),n(r,{label:"按TopN营收总和",value:"top_n_revenue_sum"})]),_:1},8,["modelValue"]))])])]),default:h(()=>[x(i)==="breadth"?(o(),p("div",{key:0,ref_key:"breadthChartRef",ref:f,class:"chart"},null,512)):(o(),p("div",{key:1,ref_key:"barChartRef",ref:y,class:"chart"},null,512))]),_:1})]),_:1})]),_:1})])}}}),ce=X(oe,[["__scopeId","data-v-184aed4d"]]);export{ce as I};
