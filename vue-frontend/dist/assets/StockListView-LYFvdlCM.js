import{d as ie,a as s,z as ce,B as N,y as ue,j as de,E as o,c as P,e as n,w as l,i as c,b as m,F as pe,A as ge,f as T,l as L,M as me,k as u,N as _e,D as fe,G as he,t as h,L as U,O as ve,$ as D,u as we,o as S,_ as be}from"./index-DkT5_nCy.js";import{g as ye}from"./individualStockApi-ChMi99pJ.js";import{a as ke}from"./industryAnalysisApi-BqF2RKDk.js";import{g as Ce,c as W}from"./personalHoldingsApi-DAWzS203.js";const xe={class:"stock-list-view"},Se={class:"header-content"},Ve={class:"header-actions"},ze={class:"search-section"},Fe={class:"table-container"},Le={class:"pagination-container"},De=ie({__name:"StockListView",setup(He){const b=we(),H=de(),y=s(!1),V=s([]),k=s(""),f=s(""),E=s([]),_=s(!1),z=s(new Set),v=s([]),j=s(""),O=s("asc"),i=s(1),F=s(10),C=s(0),$=ce(()=>V.value);N($,e=>{_.value&&(C.value=e.length)});const q=async()=>{if(_.value){if(!D()){o.error("请先登录后再启用“仅看我的”"),_.value=!1,b.push("/login");return}try{const t=(await Ce()).data?.list||[],g=t.filter(p=>["WATCHED","HELD"].includes(p.relation_type)).map(p=>p.stock_code?.trim()).filter(Boolean);z.value=new Set(g);const w=t.filter(p=>["WATCHED","HELD"].includes(p.relation_type)).map(p=>p.stock_name?.trim()).filter(Boolean);v.value=w,i.value=1,w.length===0?(o.warning("您的持有/关注列表为空，暂无可展示数据"),V.value=[],C.value=0):(o.success(`已启用，仅展示与您相关的股票（${w.length} 条记录）`),d())}catch(e){console.error("获取个人持有/关注列表失败:",e),o.error("获取个人列表失败，请稍后重试"),_.value=!1,z.value=new Set,v.value=[]}}else z.value=new Set,v.value=[],i.value=1,d()},d=async()=>{y.value=!0;try{const e=await ye({page:i.value,page_size:F.value,keyword:k.value,industry:f.value||void 0,stock_names:_.value&&v.value.length>0?v.value.join(","):void 0});V.value=e.data,C.value=e.total,o.success("股票数据加载成功")}catch(e){console.error("获取股票列表失败:",e),o.error("获取股票列表失败，请稍后重试")}finally{y.value=!1}},R=async()=>{try{const e=await ke();E.value=e.sectors}catch(e){console.error("获取行业列表失败:",e),o.error("获取行业列表失败")}},G=()=>{i.value=1,d()},B=()=>{i.value=1,d()},K=()=>{k.value="",f.value="",i.value=1,d()},Q=({prop:e,order:t})=>{j.value=e||"",O.value=t==="ascending"?"asc":"desc"},J=e=>{F.value=e,i.value=1,d()},X=e=>{i.value=e,d()},Y=e=>{b.push(`/stock-history/${e}`)},Z=async e=>{if(!D()){o.error("请先登录后再进行操作"),b.push("/login");return}try{const t=await W({stock_code:e,relation_type:"WATCHED"});o.success(t.message||"已添加关注")}catch(t){o.error(t?.message||"添加关注失败")}},I=async e=>{if(!D()){o.error("请先登录后再进行操作"),b.push("/login");return}try{const t=await W({stock_code:e,relation_type:"HELD"});o.success(t.message||"已添加持有")}catch(t){o.error(t?.message||"添加持有失败")}},M=e=>e==null?"-":e>=1e11?(e/1e11).toFixed(2)+"千亿":e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toString(),ee=e=>e==null?"-":e>=1e8?(e/1e8).toFixed(2)+"亿手":e>=1e4?(e/1e4).toFixed(2)+"万手":e.toString()+"手";return ue(()=>{const e=H.query.industry;e&&(f.value=e,o.success(`已自动筛选行业：${e}`)),d(),R()}),N(()=>H.query.industry,e=>{e&&typeof e=="string"&&(f.value=e,i.value=1,d(),o.success(`已切换到行业：${e}`))},{immediate:!1}),(e,t)=>{const g=c("el-button"),w=c("el-option"),p=c("el-select"),x=c("el-form-item"),te=c("el-input"),ae=c("el-checkbox"),ne=c("el-form"),r=c("el-table-column"),le=c("el-table"),oe=c("el-pagination"),re=c("el-card"),se=he("loading");return S(),P("div",xe,[n(re,{class:"page-header"},{header:l(()=>[m("div",Se,[t[5]||(t[5]=m("h2",null,"股票列表",-1)),m("div",Ve,[n(g,{type:"primary",icon:L(ve),onClick:d,loading:y.value},{default:l(()=>[...t[4]||(t[4]=[u(" 刷新数据 ",-1)])]),_:1},8,["icon","loading"])])])]),default:l(()=>[m("div",ze,[n(ne,{inline:!0,class:"search-form"},{default:l(()=>[n(x,{label:"选择行业"},{default:l(()=>[n(p,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a),placeholder:"请选择行业",style:{width:"200px"},clearable:"",filterable:"",onChange:G},{default:l(()=>[(S(!0),P(pe,null,ge(E.value,a=>(S(),T(w,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(x,{label:"股票代码/名称"},{default:l(()=>[n(te,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=a=>k.value=a),placeholder:"请输入股票代码或名称",clearable:"",onClear:B},null,8,["modelValue"])]),_:1}),n(x,null,{default:l(()=>[n(g,{type:"primary",icon:L(me),onClick:B},{default:l(()=>[...t[6]||(t[6]=[u("搜索",-1)])]),_:1},8,["icon"]),n(g,{icon:L(_e),onClick:K},{default:l(()=>[...t[7]||(t[7]=[u("重置",-1)])]),_:1},8,["icon"])]),_:1}),n(x,{label:"仅看我的"},{default:l(()=>[n(ae,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=a=>_.value=a),onChange:q},{default:l(()=>[...t[8]||(t[8]=[u("仅看我的（持有/关注）",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),m("div",Fe,[fe((S(),T(le,{data:$.value,border:"",stripe:"",style:{width:"100%"},onSortChange:Q,fit:""},{default:l(()=>[n(r,{prop:"code",label:"股票代码","min-width":"100",sortable:"",align:"center","header-align":"center"}),n(r,{prop:"name",label:"股票名称","min-width":"120",sortable:"",align:"center","header-align":"center"}),n(r,{prop:"industry",label:"行业","min-width":"120",align:"center","header-align":"center"}),n(r,{prop:"total_market_cap",label:"总市值","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:l(a=>[u(h(M(a.row.total_market_cap)),1)]),_:1}),n(r,{prop:"pe_ratio",label:"市盈率","min-width":"80",sortable:"",align:"center","header-align":"center"}),n(r,{prop:"pb_ratio",label:"市净率","min-width":"80",sortable:"",align:"center","header-align":"center"}),n(r,{prop:"latest_price",label:"最新价","min-width":"100",sortable:"",align:"center","header-align":"center"}),n(r,{prop:"change_percent",label:"涨跌幅","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:l(a=>[m("span",{class:U(a.row.change_percent>=0?"text-success":"text-danger")},h(a.row.change_percent?a.row.change_percent.toFixed(2)+"%":"-"),3)]),_:1}),n(r,{prop:"change_amount",label:"涨跌额","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:l(a=>[m("span",{class:U(a.row.change_amount>=0?"text-success":"text-danger")},h(a.row.change_amount?a.row.change_amount.toFixed(2):"-"),3)]),_:1}),n(r,{prop:"volume",label:"成交量","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:l(a=>[u(h(ee(a.row.volume)),1)]),_:1}),n(r,{prop:"amount",label:"成交额","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:l(a=>[u(h(M(a.row.amount)),1)]),_:1}),n(r,{prop:"turnover_rate",label:"换手率","min-width":"80",sortable:"",align:"center","header-align":"center"},{default:l(a=>[u(h(a.row.turnover_rate?a.row.turnover_rate.toFixed(2)+"%":"-"),1)]),_:1}),n(r,{label:"操作","min-width":"260",fixed:"right",align:"center","header-align":"center"},{default:l(a=>[n(g,{type:"primary",size:"small",onClick:A=>Y(a.row.code)},{default:l(()=>[...t[9]||(t[9]=[u(" 股票详情 ",-1)])]),_:2},1032,["onClick"]),n(g,{type:"success",size:"small",onClick:A=>Z(a.row.code)},{default:l(()=>[...t[10]||(t[10]=[u(" 添加关注 ",-1)])]),_:2},1032,["onClick"]),n(g,{type:"warning",size:"small",onClick:A=>I(a.row.code)},{default:l(()=>[...t[11]||(t[11]=[u(" 添加持有 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,y.value]])]),m("div",Le,[n(oe,{"current-page":i.value,"onUpdate:currentPage":t[3]||(t[3]=a=>i.value=a),"page-size":F.value,total:C.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Ae=be(De,[["__scopeId","data-v-51fccb21"]]);export{Ae as default};
