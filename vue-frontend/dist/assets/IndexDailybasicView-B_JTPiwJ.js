import{x as $,d as K,a as _,r as Q,B as W,y as X,C as ee,c as B,e as s,b as f,w as r,i as p,E as te,F as P,A as Z,k as D,f as ae,g as le,t as C,o as S,_ as ne}from"./index-DBlIMAuh.js";import{i as oe}from"./index-ElshY9iF.js";async function se(u){return(await $.get("/django/api/index/index-dailybasic/",{params:{ts_code:u.tsCode,start_date:u.startDate,end_date:u.endDate,trade_date:u.tradeDate,fields:u.fields}})).data}async function re(u){return(await $.get("/django/api/index/market-combined-dailybasic/",{params:{start_date:u.startDate,end_date:u.endDate,trade_date:u.tradeDate}})).data}const ie={class:"index-dailybasic-view"},de={class:"header-content"},ue={class:"actions"},ce={class:"search-section"},fe={class:"chart-section"},ve={class:"card-header"},pe={class:"header-title"},_e=K({__name:"IndexDailybasicView",emits:["loaded"],setup(u,{emit:k}){const z=k,F=_(!1),L=[{label:"全市场综指",value:"all_market"},{label:"沪深300",value:"000300.SH"},{label:"中证500",value:"000905.SH"},{label:"深证成指",value:"399001.SZ"},{label:"中小板指",value:"399005.SZ"},{label:"创业板指",value:"399006.SZ"},{label:"深证创新",value:"399016.SZ"},{label:"沪深300(深)",value:"399300.SZ"},{label:"上证综指",value:"000001.SH"}],V=[{label:"PE (市盈率)",value:"pe"},{label:"PE TTM (滚动市盈率)",value:"pe_ttm"},{label:"PB (市净率)",value:"pb"},{label:"总市值",value:"total_mv"},{label:"流通市值",value:"float_mv"},{label:"总股本",value:"total_share"},{label:"流通股本",value:"float_share"},{label:"自由流通股本",value:"free_share"},{label:"换手率",value:"turnover_rate"},{label:"换手率(自由流通)",value:"turnover_rate_f"}],H=[{text:"最近一年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,t]}},{text:"最近三年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-3),[e,t]}},{text:"最近五年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-5),[e,t]}},{text:"最近十年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-10),[e,t]}}],d=Q({tsCode:"all_market",fields:""}),v=_("pe"),m=_(),w=_([]),Y=_(0),A=_(null);let c=null;const h=_(null);function U(t,e){if(t.length===0)return 0;const l=[...t].sort((o,i)=>o-i),n=l.findIndex(o=>o>=e);return n===-1?100:n/l.length*100}function O(t){if(t.length===0){h.value=null;return}const e=t[t.length-1],l=U(t,e);let n="适中",o="info";l>=90?(n="极高",o="danger"):l>=70?(n="较高",o="warning"):l<=10?(n="极低",o="success"):l<=30&&(n="较低",o="primary"),h.value={value:e,percentile:l,status:n,type:o}}function M(t=365){const e=new Date,l=new Date(Date.now()-t*24*60*60*1e3),n=o=>`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}`;return[n(l),n(e)]}async function b(){try{F.value=!0,c&&c.showLoading();const[t,e]=m.value||M();let l;d.tsCode==="all_market"?l=await re({startDate:t,endDate:e}):l=await se({tsCode:d.tsCode,startDate:t,endDate:e,fields:d.fields||void 0}),w.value=(l.records||[]).sort((n,o)=>{const i=String(n.trade_date||""),g=String(o.trade_date||"");return i.localeCompare(g)}),Y.value=l.count||w.value.length,z("loaded",Y.value),I()}catch(t){te.error(t?.message||"数据加载失败")}finally{F.value=!1,c&&c.hideLoading()}}function T(){A.value&&(c=oe(A.value),window.addEventListener("resize",R))}function y(t,e){if(t.length===0)return 0;const l=e/100*(t.length-1),n=Math.floor(l),o=Math.ceil(l),i=l-n;return t[n]*(1-i)+t[o]*i}function I(){if(!c)return;const t=w.value.map(a=>a.trade_date),e=w.value.map(a=>Number(a[v.value])),l=V.find(a=>a.value===v.value)?.label||v.value,n=e.filter(a=>!isNaN(a)).sort((a,J)=>a-J);O(e.filter(a=>!isNaN(a)));const o=y(n,10),i=y(n,30),g=y(n,50),N=y(n,70),x=y(n,90),E={title:{text:`${L.find(a=>a.value===d.tsCode)?.label||d.tsCode} - ${l} 趋势`,left:"center"},tooltip:{trigger:"axis"},grid:{right:"15%"},xAxis:{type:"category",data:t},yAxis:{type:"value",scale:!0},series:[{name:l,type:"line",data:e,smooth:!0,showSymbol:!1,markLine:{symbol:"none",data:[{yAxis:x,name:"90%分位",label:{formatter:"90%: {c}"},lineStyle:{color:"#FF4500",type:"dashed"}},{yAxis:N,name:"70%分位",label:{formatter:"70%: {c}"},lineStyle:{color:"#FFA500",type:"dashed"}},{yAxis:g,name:"50%分位",label:{formatter:"50%: {c}"},lineStyle:{color:"#32CD32",width:2}},{yAxis:i,name:"30%分位",label:{formatter:"30%: {c}"},lineStyle:{color:"#1E90FF",type:"dashed"}},{yAxis:o,name:"10%分位",label:{formatter:"10%: {c}"},lineStyle:{color:"#0000FF",type:"dashed"}}]}}]};c.setOption(E)}function R(){c?.resize()}function j(){b()}function q(){b()}function G(){d.tsCode="000001.SH",d.fields="",v.value="pe",m.value=M(),b()}return W([()=>d.tsCode,m],()=>{b()}),X(()=>{m.value=M(),T(),b()}),ee(()=>{window.removeEventListener("resize",R),c?.dispose()}),(t,e)=>{const l=p("el-button"),n=p("el-option"),o=p("el-select"),i=p("el-form-item"),g=p("el-date-picker"),N=p("el-form"),x=p("el-card"),E=p("el-tag");return S(),B("div",ie,[s(x,{class:"page-header",shadow:"hover"},{header:r(()=>[f("div",de,[e[5]||(e[5]=f("h2",null,"大盘指数估值",-1)),f("div",ue,[s(l,{type:"primary",loading:F.value,onClick:j},{default:r(()=>[...e[3]||(e[3]=[D("查询",-1)])]),_:1},8,["loading"]),s(l,{onClick:G},{default:r(()=>[...e[4]||(e[4]=[D("重置",-1)])]),_:1})])])]),default:r(()=>[f("div",ce,[s(N,{inline:!0,model:d,class:"query-form"},{default:r(()=>[s(i,{label:"指数代码"},{default:r(()=>[s(o,{modelValue:d.tsCode,"onUpdate:modelValue":e[0]||(e[0]=a=>d.tsCode=a),placeholder:"请选择指数代码",style:{width:"200px"}},{default:r(()=>[(S(),B(P,null,Z(L,a=>s(n,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"指标"},{default:r(()=>[s(o,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),placeholder:"请选择展示指标",style:{width:"200px"},onChange:I},{default:r(()=>[(S(),B(P,null,Z(V,a=>s(n,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"日期范围"},{default:r(()=>[s(g,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYYMMDD",shortcuts:H},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1}),f("div",fe,[s(x,null,{header:r(()=>[f("div",ve,[f("div",pe,[f("span",null,"趋势图（"+C(Y.value)+" 条数据）",1),h.value?(S(),ae(E,{key:0,type:h.value.type,effect:"dark",class:"valuation-tag"},{default:r(()=>[D(" 当前"+C(V.find(a=>a.value===v.value)?.label||v.value)+"分位: "+C(h.value.percentile.toFixed(2))+"% - "+C(h.value.status),1)]),_:1},8,["type"])):le("",!0)]),s(l,{link:"",onClick:q},{default:r(()=>[...e[6]||(e[6]=[D("刷新",-1)])]),_:1})])]),default:r(()=>[f("div",{ref_key:"chartRef",ref:A,class:"chart-container",style:{width:"100%",height:"500px"}},null,512)]),_:1})])])}}}),be=ne(_e,[["__scopeId","data-v-1d03c808"]]);export{be as default};
