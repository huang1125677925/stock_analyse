import{d as L,a as c,r as A,c as _,b as r,e as t,g as b,f as D,w as s,i as n,h as P,k as i,t as C,v as K,E as k,u as T,o as g,q as j,p as z,_ as G}from"./index-huyYlGjp.js";const H={class:"register-container"},J={class:"register-card"},O={key:0,class:"step-content"},Q={key:1,class:"step-content"},W={class:"step-buttons"},X={key:2,class:"step-content"},Y={class:"register-summary"},Z={class:"step-buttons"},ee={class:"register-footer"},te=L({__name:"RegisterView",setup(oe){const x=T(),R=c(),U=c(),u=c(0),y=c(!1),w=c(!1),p=c(""),o=A({invitationCode:"",username:"",email:"",password:"",confirmPassword:"",phone:""}),S={invitationCode:[{required:!0,message:"请输入邀请码",trigger:"blur"},{min:6,message:"邀请码长度不能少于6个字符",trigger:"blur"}]},F={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名长度不能少于3个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,message:"密码长度不能少于8个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(a,e,m)=>{e!==o.password?m(new Error("两次输入的密码不一致")):m()},trigger:"blur"}]};async function B(){try{await R.value.validate(),y.value=!0,p.value="";const a=await K(o.invitationCode);console.log("邀请码验证响应:",a),k.success("邀请码验证成功"),u.value=1}catch(a){p.value=a.message||"邀请码验证失败"}finally{y.value=!1}}async function E(){try{await U.value.validate(),u.value=2}catch{}}async function M(){try{w.value=!0,p.value="",await j(o.username,o.email,o.password,o.invitationCode,o.phone),k.success("注册成功，欢迎加入！"),x.push("/")}catch(a){if(console.error("注册过程中发生错误:",a),a.response&&a.response.data&&a.response.data.code===200){k.success("注册成功，但自动登录失败，请手动登录"),x.push("/login");return}p.value=z.value||a.message||"注册失败，请稍后再试"}finally{w.value=!1}}return(a,e)=>{const m=n("el-step"),N=n("el-steps"),v=n("el-input"),d=n("el-form-item"),f=n("el-button"),q=n("el-form"),V=n("el-descriptions-item"),$=n("el-descriptions"),I=n("el-alert"),h=n("router-link");return g(),_("div",H,[r("div",J,[e[17]||(e[17]=r("div",{class:"register-header"},[r("h2",null,"注册账号"),r("p",null,"创建您的股票分析系统账号")],-1)),t(N,{active:u.value,"finish-status":"success",simple:""},{default:s(()=>[t(m,{title:"验证邀请码"}),t(m,{title:"填写账号信息"}),t(m,{title:"完成注册"})]),_:1},8,["active"]),u.value===0?(g(),_("div",O,[t(q,{ref_key:"inviteCodeForm",ref:R,model:o,rules:S,"label-position":"top",onSubmit:P(B,["prevent"])},{default:s(()=>[t(d,{label:"邀请码",prop:"invitationCode"},{default:s(()=>[t(v,{modelValue:o.invitationCode,"onUpdate:modelValue":e[0]||(e[0]=l=>o.invitationCode=l),placeholder:"请输入邀请码","prefix-icon":"Key"},null,8,["modelValue"])]),_:1}),t(d,null,{default:s(()=>[t(f,{type:"primary","native-type":"submit",loading:y.value,class:"step-button"},{default:s(()=>[...e[9]||(e[9]=[i(" 验证邀请码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):b("",!0),u.value===1?(g(),_("div",Q,[t(q,{ref_key:"accountForm",ref:U,model:o,rules:F,"label-position":"top",onSubmit:P(E,["prevent"])},{default:s(()=>[t(d,{label:"用户名",prop:"username"},{default:s(()=>[t(v,{modelValue:o.username,"onUpdate:modelValue":e[1]||(e[1]=l=>o.username=l),placeholder:"请输入用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),t(d,{label:"邮箱",prop:"email"},{default:s(()=>[t(v,{modelValue:o.email,"onUpdate:modelValue":e[2]||(e[2]=l=>o.email=l),placeholder:"请输入邮箱",type:"email","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),t(d,{label:"手机号",prop:"phone"},{default:s(()=>[t(v,{modelValue:o.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>o.phone=l),placeholder:"请输入手机号","prefix-icon":"Phone"},null,8,["modelValue"])]),_:1}),t(d,{label:"密码",prop:"password"},{default:s(()=>[t(v,{modelValue:o.password,"onUpdate:modelValue":e[4]||(e[4]=l=>o.password=l),placeholder:"请输入密码",type:"password","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),t(d,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[t(v,{modelValue:o.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>o.confirmPassword=l),placeholder:"请再次输入密码",type:"password","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),t(d,null,{default:s(()=>[r("div",W,[t(f,{onClick:e[6]||(e[6]=l=>u.value=0)},{default:s(()=>[...e[10]||(e[10]=[i("上一步",-1)])]),_:1}),t(f,{type:"primary","native-type":"submit"},{default:s(()=>[...e[11]||(e[11]=[i("下一步",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])])):b("",!0),u.value===2?(g(),_("div",X,[r("div",Y,[e[12]||(e[12]=r("h3",null,"确认您的注册信息",-1)),t($,{column:1,border:""},{default:s(()=>[t(V,{label:"用户名"},{default:s(()=>[i(C(o.username),1)]),_:1}),t(V,{label:"邮箱"},{default:s(()=>[i(C(o.email),1)]),_:1}),t(V,{label:"邀请码"},{default:s(()=>[i(C(o.invitationCode),1)]),_:1})]),_:1})]),r("div",Z,[t(f,{onClick:e[7]||(e[7]=l=>u.value=1)},{default:s(()=>[...e[13]||(e[13]=[i("上一步",-1)])]),_:1}),t(f,{type:"primary",onClick:M,loading:w.value},{default:s(()=>[...e[14]||(e[14]=[i(" 完成注册 ",-1)])]),_:1},8,["loading"])])])):b("",!0),p.value?(g(),D(I,{key:3,title:p.value,type:"error","show-icon":"",closable:!0,onClose:e[8]||(e[8]=l=>p.value=""),style:{"margin-top":"1rem"}},null,8,["title"])):b("",!0),r("div",ee,[r("p",null,[e[16]||(e[16]=i("已有账号？",-1)),t(h,{to:"/login"},{default:s(()=>[...e[15]||(e[15]=[i("立即登录",-1)])]),_:1})])])])])}}}),le=G(te,[["__scopeId","data-v-b480835a"]]);export{le as default};
