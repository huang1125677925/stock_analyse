import{d as z,a as D,B as k,y as N,H as g,C as A,c as x,b as _,g as B,t as K,I as L,o as $,_ as O}from"./index-B1jknyhk.js";import{i as E}from"./index-ElshY9iF.js";const R={class:"stock-kline-chart-container"},V={class:"chart-header"},W={key:0},I=z({__name:"StockKLineChart",props:{title:{default:""},stockCode:{},stockName:{default:""},klineData:{},tradeSignals:{default:()=>[]},height:{default:"600px"}},setup(C){L(n=>({"337a2644":o.height}));const o=C,u=D();let r=null;const w=()=>{u.value&&(r&&r.dispose(),r=E(u.value),p(),window.addEventListener("resize",b))},p=()=>{if(!r||!o.klineData||o.klineData.length===0)return;const n=o.klineData.map(e=>e.date),h=o.klineData.map(e=>[e.open_price,e.close_price,e.low_price,e.high_price]);console.log("更新图表数据",h);const f=e=>e?e.replace(/[^0-9]/g,""):"",y=new Map;n.forEach((e,l)=>{y.set(f(e),l)});const v=(e,l)=>{if(!e||!Array.isArray(e)||e.length===0)return[];const a=[...e].filter(t=>t.type===l).sort((t,d)=>{const i=f(t.date),s=f(d.date);return i.localeCompare(s)}),c=new Set;return console.log(`生成${l}信号标记，数量:`,a.length),l==="sell"&&console.log("卖出信号原始数据:",JSON.stringify(a)),a.map(t=>{const d=y.get(f(t.date));if(d===void 0)return console.log(`信号日期${t.date}不在K线数据范围内`),null;const i=f(t.date);if(c.has(i))return console.log(`日期${t.date}已有标记，跳过`),null;c.add(i);const s=l==="buy";return{name:s?"买入点":"卖出点",coord:[n[d],t.price],symbol:"arrow",symbolSize:50,symbolRotate:s?0:180,symbolOffset:[0,s?-100:20],value:t.price,itemStyle:{color:s?"#FF0000":"#00FF00",borderColor:"#fff",borderWidth:2},label:{show:!0,color:"#fff",backgroundColor:"rgba(255,0,0,0.7)",padding:[5,10],borderRadius:4,position:s?"top":"bottom",formatter:s?`买入
${t.price.toFixed(2)}元`:`卖出
${t.price.toFixed(2)}元`,fontSize:14,fontWeight:"bold"},tooltip:{formatter:s?`买入
价格: ${t.price.toFixed(2)}
${t.description||""}`:`卖出
价格: ${t.price.toFixed(2)}
${t.description||""}`}}}).filter(t=>t!==null)};console.log("更新图表，交易信号数量:",o.tradeSignals.length),console.log("交易信号详情:",JSON.stringify(o.tradeSignals));const S=v(o.tradeSignals,"buy"),m=v(o.tradeSignals,"sell");console.log("生成的买入信号数量:",S.length),console.log("生成的卖出信号数量:",m.length),console.log("卖出信号详情:",JSON.stringify(m));const F={title:{text:o.title||`${o.stockName}(${o.stockCode})K线图`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:e=>{let a=`<div style="font-weight:bold;margin-bottom:5px;">${e[0].axisValue}</div>`;return e.forEach(c=>{const t=c.color,d=c.seriesName,i=c.value;d==="K线"&&(a+=`<div style="color:${t};">${d}</div>`,a+=`<div>开盘价: ${i[1]}</div>`,a+=`<div>收盘价: ${i[2]}</div>`,a+=`<div>最低价: ${i[4]}</div>`,a+=`<div>最高价: ${i[3]}</div>`)}),a}},grid:{left:"10%",right:"10%",top:"15%",bottom:"15%"},xAxis:{type:"category",data:n,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1}},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",bottom:"5%",start:0,end:100}],series:[{name:"K线",type:"candlestick",data:h.map(e=>[e[0],e[1],e[3],e[2]]),markPoint:{symbol:"arrow",symbolSize:50,data:[...S,...m],clipByCoordinateSystem:!1,silent:!1,animation:!1,avoidLabelOverlap:!0,zlevel:10,emphasis:{disabled:!1},label:{fontSize:14,fontWeight:"bold",padding:[5,10],borderRadius:4,show:!0,formatter:function(e){return e.data&&e.data.name==="卖出点"?`卖出
${e.data.value.toFixed(2)}元`:e.data&&e.data.name==="买入点"?`买入
${e.data.value.toFixed(2)}元`:e.name}},itemStyle:{borderWidth:2,borderColor:"#fff",color:function(e){return e.data.name==="卖出点"?"#00FF00":"#FF0000"}}},itemStyle:{color:"#ec0000",color0:"#00da3c",borderColor:"#8A0000",borderColor0:"#008F28"}}]};r.setOption(F,!0)},b=()=>{r?.resize()};return k([()=>o.klineData,()=>o.tradeSignals],()=>{g(()=>{p()})},{deep:!0,immediate:!0}),k(()=>o.tradeSignals,()=>{g(()=>{p()})},{deep:!0,immediate:!0}),N(()=>{g(()=>{w()})}),A(()=>{r&&(r.dispose(),r=null),window.removeEventListener("resize",b)}),(n,h)=>($(),x("div",R,[_("div",V,[n.title?($(),x("h3",W,K(n.title),1)):B("",!0)]),_("div",{ref_key:"chartContainer",ref:u,class:"chart-container"},null,512)]))}}),P=O(I,[["__scopeId","data-v-e1ddaf0b"]]);export{P as S};
