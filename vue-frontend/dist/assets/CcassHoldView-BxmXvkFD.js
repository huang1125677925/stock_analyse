import{x as K,d as Q,a as x,y as J,C as W,c as w,e as l,g as Y,D as X,w as r,i as c,G as Z,f as k,k as C,b as o,t as v,F as ee,A as te,o as _,_ as ae}from"./index-orgCiLiJ.js";import{i as se,L as z}from"./index-ElshY9iF.js";async function le(D){return(await K.get("/django/api/tasks/ccass-hold/",{params:D})).data}const oe={class:"page-container"},ne={class:"card-header"},re={key:0,class:"charts-row"},ie={class:"data-list"},ce={class:"item-header"},de={class:"stock-info"},ue={class:"stock-name"},me={class:"stock-code"},_e={class:"item-body"},pe={class:"metric-row"},fe={class:"value-highlight"},ve={class:"metric-grid"},he={class:"metric-item"},ge={class:"value"},ye={class:"metric-item"},be={class:"value"},xe=Q({__name:"CcassHoldView",setup(D){const h=x(!1),g=x(null),F=x("last7d"),p=x({}),d=x([]),A=x(null);let m=null;function E(t){const e=Number(t);return isNaN(e)?"-":e>1e8?(e/1e8).toFixed(2)+"亿":e>1e4?(e/1e4).toFixed(2)+"万":e.toLocaleString()}function N(t){return t>70?"#F56C6C":t>30?"#E6A23C":"#67C23A"}function B(t){if(!t)return[];if(Array.isArray(t.records)&&t.records.length>0)return t.records;if(Array.isArray(t.items)&&Array.isArray(t.fields)){const e=t.fields;return t.items.map(a=>{const s={};return e.forEach((f,u)=>s[f]=a[u]),s})}return[]}async function M(){h.value=!0;try{const t={...p.value};g.value&&(t.start_date=g.value[0],t.end_date=g.value[1]);const e=await le(t);d.value=B(e),U()}finally{h.value=!1}}function I(){p.value={},S("last7d"),d.value=[],m&&(m.dispose(),m=null)}function L(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}${a}${s}`}function S(t){const e=new Date,a=new Date;switch(t){case"last7d":a.setDate(e.getDate()-6);break;case"last1m":a.setMonth(e.getMonth()-1);break;case"last3m":a.setMonth(e.getMonth()-3);break;case"last6m":a.setMonth(e.getMonth()-6);break;case"last1y":a.setFullYear(e.getFullYear()-1);break;case"last3y":a.setFullYear(e.getFullYear()-3);break}g.value=[L(a),L(e)]}function q(t){S(t)}function U(){if(!d.value.length||!A.value)return;m||(m=se(A.value));const e=new Set(d.value.map(s=>s.ts_code)).size===1,a={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},legend:{data:["持股比例(%)","持股数量"]}};if(e){const s=[...d.value].sort((n,b)=>n.trade_date.localeCompare(b.trade_date)),f=s.map(n=>n.trade_date),u=s.map(n=>n.hold_ratio),y=s.map(n=>n.shareholding);a.title={text:`${s[0].name} (${s[0].ts_code}) 持股趋势`},a.xAxis={type:"category",data:f},a.yAxis=[{type:"value",name:"持股比例(%)",max:100},{type:"value",name:"持股数量",splitLine:{show:!1}}],a.series=[{name:"持股比例(%)",type:"line",data:u,yAxisIndex:0,smooth:!0,itemStyle:{color:"#409EFF"},areaStyle:{color:new z(0,0,0,1,[{offset:0,color:"rgba(64,158,255,0.3)"},{offset:1,color:"rgba(64,158,255,0.01)"}])}},{name:"持股数量",type:"bar",data:y,yAxisIndex:1,itemStyle:{color:"#E6A23C",opacity:.6}}]}else{const s=[...d.value].sort((n,b)=>b.hold_ratio-n.hold_ratio).slice(0,20),f=s.map(n=>n.name),u=s.map(n=>n.hold_ratio),y=s.map(n=>n.shareholding);a.title={text:"持股比例 TOP20"},a.xAxis={type:"category",data:f,axisLabel:{interval:0,rotate:30}},a.yAxis=[{type:"value",name:"持股比例(%)",max:100},{type:"value",name:"持股数量",splitLine:{show:!1}}],a.series=[{name:"持股比例(%)",type:"bar",data:u,yAxisIndex:0,itemStyle:{color:new z(0,0,0,1,[{offset:0,color:"#67C23A"},{offset:1,color:"#95D475"}])}},{name:"持股数量",type:"line",data:y,yAxisIndex:1,itemStyle:{color:"#E6A23C"},symbol:"circle",symbolSize:8}]}m.setOption(a)}const R=()=>{m?.resize()};return J(()=>{S("last7d"),M(),window.addEventListener("resize",R)}),W(()=>{window.removeEventListener("resize",R),m?.dispose()}),(t,e)=>{const a=c("el-tag"),s=c("el-option"),f=c("el-select"),u=c("el-form-item"),y=c("el-input"),n=c("el-date-picker"),b=c("el-button"),$=c("el-form"),V=c("el-card"),H=c("el-empty"),P=c("el-progress"),T=c("el-col"),j=c("el-row"),G=Z("loading");return _(),w("div",oe,[l(V,{class:"search-card"},{header:r(()=>[o("div",ne,[e[4]||(e[4]=o("span",{class:"title"},"中结持股汇总",-1)),d.value.length?(_(),k(a,{key:0,type:"success",effect:"plain",class:"count-tag"},{default:r(()=>[C(" 共 "+v(d.value.length)+" 条数据 ",1)]),_:1})):Y("",!0)])]),default:r(()=>[l($,{inline:!0,model:p.value,class:"query-form"},{default:r(()=>[l(u,{label:"快捷选择"},{default:r(()=>[l(f,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=i=>F.value=i),style:{width:"140px"},onChange:q},{default:r(()=>[l(s,{label:"最近一周",value:"last7d"}),l(s,{label:"最近1月",value:"last1m"}),l(s,{label:"最近三月",value:"last3m"}),l(s,{label:"最近半年",value:"last6m"}),l(s,{label:"最近一年",value:"last1y"}),l(s,{label:"最近三年",value:"last3y"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"股票代码"},{default:r(()=>[l(y,{modelValue:p.value.ts_code,"onUpdate:modelValue":e[1]||(e[1]=i=>p.value.ts_code=i),placeholder:"如 00960.HK",clearable:"",style:{width:"160px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"港交所代码"},{default:r(()=>[l(y,{modelValue:p.value.hk_code,"onUpdate:modelValue":e[2]||(e[2]=i=>p.value.hk_code=i),placeholder:"如 95009",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"日期范围"},{default:r(()=>[l(n,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=i=>g.value=i),type:"daterange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束","value-format":"YYYYMMDD","unlink-panels":"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:r(()=>[l(b,{type:"primary",loading:h.value,onClick:M},{default:r(()=>[...e[5]||(e[5]=[C("查询",-1)])]),_:1},8,["loading"]),l(b,{onClick:I},{default:r(()=>[...e[6]||(e[6]=[C("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),d.value.length>0?(_(),w("div",re,[l(V,{class:"chart-card",shadow:"hover"},{default:r(()=>[o("div",{ref_key:"mainChartRef",ref:A,class:"chart-container"},null,512)]),_:1})])):Y("",!0),X((_(),w("div",ie,[!h.value&&d.value.length===0?(_(),k(H,{key:0,description:"暂无数据，请调整查询条件"})):(_(),k(j,{key:1,gutter:16},{default:r(()=>[(_(!0),w(ee,null,te(d.value,(i,O)=>(_(),k(T,{xs:24,sm:12,md:8,lg:6,xl:4,key:O,class:"data-col"},{default:r(()=>[l(V,{class:"data-item-card",shadow:"hover"},{default:r(()=>[o("div",ce,[o("div",de,[o("span",ue,v(i.name),1),o("span",me,v(i.ts_code),1)]),l(a,{size:"small",effect:"light"},{default:r(()=>[C(v(i.trade_date),1)]),_:2},1024)]),o("div",_e,[o("div",pe,[e[7]||(e[7]=o("span",{class:"label"},"持股比例",-1)),o("div",fe,v(i.hold_ratio)+"%",1)]),l(P,{percentage:Math.min(i.hold_ratio,100),color:N,"show-text":!1,"stroke-width":8,class:"ratio-progress"},null,8,["percentage"]),o("div",ve,[o("div",he,[e[8]||(e[8]=o("span",{class:"label"},"持股数量",-1)),o("span",ge,v(E(i.shareholding)),1)]),o("div",ye,[e[9]||(e[9]=o("span",{class:"label"},"持股人数",-1)),o("span",be,v(i.hold_nums),1)])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))])),[[G,h.value]])])}}}),Ce=ae(xe,[["__scopeId","data-v-685a210e"]]);export{Ce as default};
