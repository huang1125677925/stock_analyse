import{x as W,d as Z,a as g,B,z,c as Y,b as v,D as j,e as n,i as N,w as x,L as X,k as q,X as J,o as H,H as ae,_ as G,y as Q,Y as oe,I as ne,E as K,G as le,g as re,F as se,A as ie,f as ce}from"./index-DkT5_nCy.js";import{i as de}from"./index-ElshY9iF.js";import{H as P}from"./HeatmapChart-BOQYSM1i.js";/* empty css                                                                   */const ue="/django/api/market",U={main_net_inflow_amount:{name:"主力净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},small_net_inflow_amount:{name:"小单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},medium_net_inflow_amount:{name:"中单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},large_net_inflow_amount:{name:"大单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},super_large_net_inflow_amount:{name:"超大单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},main_net_inflow_ratio:{name:"主力净流入比例",unit:"%",formatter:e=>e.toFixed(2)},small_net_inflow_ratio:{name:"小单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},medium_net_inflow_ratio:{name:"中单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},large_net_inflow_ratio:{name:"大单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},super_large_net_inflow_ratio:{name:"超大单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},shanghai_close_price:{name:"上证收盘价",unit:"点",formatter:e=>e.toFixed(2)},shanghai_change_rate:{name:"上证涨跌幅",unit:"%",formatter:e=>e.toFixed(2)},shenzhen_close_price:{name:"深证收盘价",unit:"点",formatter:e=>e.toFixed(2)},shenzhen_change_rate:{name:"深证涨跌幅",unit:"%",formatter:e=>e.toFixed(2)}};async function me(e,c,u=1,_=20,m="-date"){try{const i={page:u,page_size:_,order_by:m};return e&&(i.start_date=e),c&&(i.end_date=c),(await W.get(`${ue}/fund-flow/`,{params:i})).data}catch(i){throw console.error("获取大盘资金流数据失败:",i),i}}const fe={class:"market-fund-flow-heatmaps"},pe={class:"heatmap-toolbar"},he={class:"heatmap-section"},_e={class:"heatmap-section"},ve=Z({name:"MarketFundFlowHeatmap",__name:"MarketFundFlowHeatmap",props:{data:{},selectedMetric:{default:"main_net_inflow_amount"},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(e,{emit:c}){const u=g("amount"),_=g(null),m=g(null);B(u,async r=>{await ae(),r==="amount"?_.value?.resize():m.value?.resize(),setTimeout(()=>{r==="amount"?_.value?.resize():m.value?.resize()},50)});const i=e,d=c,F=z(()=>{if(!i.data)return[];let r=i.data;return i.searchKeyword?.trim()&&(r=i.data.filter(a=>a.date.toLowerCase().includes(i.searchKeyword.toLowerCase()))),[...r].sort((a,o)=>{const t=new Date(a.date).getTime(),h=new Date(o.date).getTime();return Number.isNaN(t)||Number.isNaN(h)?a.date.localeCompare(o.date):t-h})}),$=z(()=>Object.keys(U).filter(r=>r.endsWith("_amount"))),C=z(()=>Object.keys(U).filter(r=>r.endsWith("_ratio"))),s=(r,a,o)=>{const t=F.value;if(!t||t.length===0)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const h=r.map(k=>U[k].name),y=t.map(k=>k.date),D=[];let l=1/0,S=-1/0;return t.forEach((k,M)=>{r.forEach((A,L)=>{const V=k[A];if(typeof V=="number"&&!isNaN(V)&&isFinite(V)){let E=!0;if((i.valueFilter==="positive"&&V<=0||i.valueFilter==="negative"&&V>=0)&&(E=!1),E){const T=A.endsWith("_amount")?V/1e8:V;D.push([M,L,T]),l=Math.min(l,T),S=Math.max(S,T)}}})}),(l===1/0||S===-1/0)&&(l=0,S=100),{title:{text:a,left:"center"},tooltip:{position:"top",formatter:function(k){const[M,A,L]=k.data,V=t[M],E=r[A],O=U[E],T=E.endsWith("_amount"),ee=T?Number(L).toFixed(2):O.formatter?O.formatter(L):Number(L).toFixed(2),te=T?"亿":O.unit;return`${V.date}<br/>${O.name}: ${ee}${te}`}},grid:{height:Math.max(240,r.length*24)+"px",top:"8%",left:"2%",right:"16%",bottom:"6%",containLabel:!0},xAxis:[{type:"category",data:y,splitArea:{show:!0},axisLabel:{fontSize:12}}],yAxis:[{type:"category",data:h,splitArea:{show:!0},axisLabel:{fontSize:11}}],visualMap:{min:l,max:S,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#00C853","#FF1744"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a,type:"heatmap",data:D,label:{show:o,fontSize:9,formatter:function(k){const M=k.data[2];return r[k.data[1]].endsWith("_amount")?Number(M).toFixed(1)+"亿":Number(M).toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},p=z(()=>s($.value,"金额热力图",!1)),f=z(()=>s(C.value,"比例热力图",!0));z(()=>[{key:"shanghai_close_price",label:"上证收盘价",color:"#409EFF",yAxisIndex:0},{key:"shanghai_change_rate",label:"上证涨跌幅(%)",color:"#67C23A",yAxisIndex:1}]);const b=r=>d("chart-ready",r),I=r=>d("chart-ready",r),R=r=>{const a=r?.data;if(!a)return;const[o,t,h]=a;if(typeof o!="number"||typeof t!="number")return;const y=F.value;if(o<0||o>=y.length||t<0||t>=$.value.length)return;const D=y[o],l=$.value[t],S=D?.date;d("chart-click",{date:S,value:h,metric:l,rawParams:r})},w=r=>{const a=r?.data;if(!a)return;const[o,t,h]=a;if(typeof o!="number"||typeof t!="number")return;const y=F.value;if(o<0||o>=y.length||t<0||t>=C.value.length)return;const D=y[o],l=C.value[t],S=D?.date;d("chart-click",{date:S,value:h,metric:l,rawParams:r})};return(r,a)=>{const o=N("el-button"),t=N("el-button-group");return H(),Y("div",fe,[v("div",pe,[n(t,null,{default:x(()=>[n(o,{type:"primary",plain:"",class:X({active:u.value==="amount"}),onClick:a[0]||(a[0]=h=>u.value="amount")},{default:x(()=>[...a[2]||(a[2]=[q("金额热力图",-1)])]),_:1},8,["class"]),n(o,{type:"primary",plain:"",class:X({active:u.value==="ratio"}),onClick:a[1]||(a[1]=h=>u.value="ratio")},{default:x(()=>[...a[3]||(a[3]=[q("比例热力图",-1)])]),_:1},8,["class"])]),_:1})]),j(v("div",he,[n(P,{ref_key:"amountChartRef",ref:_,option:p.value,onChartReady:b,onChartClick:R},null,8,["option"])],512),[[J,u.value==="amount"]]),j(v("div",_e,[n(P,{ref_key:"ratioChartRef",ref:m,option:f.value,onChartReady:I,onChartClick:w},null,8,["option"])],512),[[J,u.value==="ratio"]])])}}}),ye=G(ve,[["__scopeId","data-v-6aebdb21"]]);function xe(e){if(!e)return"";const c=String(e);if(c.length===8&&/^\d{8}$/.test(c)){const u=c.slice(0,4),_=c.slice(4,6),m=c.slice(6,8);return`${u}-${_}-${m}`}return c}async function ge(e,c,u){return((await W.get("/django/api/tasks/index-daily/",{params:{ts_code:e,start_date:c,end_date:u,fields:"trade_date,vol,amount,close"}})).data?.records||[]).map(d=>{const F=d.date??d.trade_date,$=d.volume??d.vol,C=d.amount,s=d.close,p=xe(F),f=Number($??0),b=C!=null?Number(C):void 0,I=s!=null?Number(s):void 0;return{date:p,volume:f,amount:b,close:I}}).filter(d=>!!d.date).sort((d,F)=>d.date.localeCompare(F.date))}const be={class:"index-volume-trend"},we={class:"chart-header"},Fe={class:"chart-controls"},Ce=Z({__name:"IndexVolumeTrend",props:{tsCode:{default:"000001.SH"},height:{default:"420px"}},setup(e){ne(s=>({"80d07a6c":s.height}));const c=e,u=g("1y"),_=g(null);let m=null;function i(s){const p=s.getFullYear(),f=String(s.getMonth()+1).padStart(2,"0"),b=String(s.getDate()).padStart(2,"0");return`${p}${f}${b}`}function d(){const s=new Date,p=new Date,f=u.value==="1y"?1:u.value==="3y"?3:5;return p.setFullYear(s.getFullYear()-f),{start:i(p),end:i(s)}}async function F(){try{const{start:s,end:p}=d(),f=await ge(c.tsCode,s,p);$(f)}catch(s){console.error("加载指数成交量失败:",s),K.error("加载指数成交量失败")}}function $(s){if(!_.value)return;m||(m=de(_.value));const p=s.map(w=>w.date),f=s.map(w=>w.volume),b=s.map(w=>w.amount!=null?Number(w.amount):null),I=s.map(w=>w.close!=null?Number(w.close):null),R={tooltip:{trigger:"axis",formatter:w=>{const r=w[0]?.dataIndex??0,a=b[r],o=I[r];return`日期: ${p[r]}<br/>成交量: ${f[r]}<br/>成交额: ${a??"-"}<br/>收盘价: ${o??"-"}`}},legend:{data:["成交量","成交额","收盘价"],top:0},grid:{left:50,right:70,top:30,bottom:40},xAxis:{type:"category",data:p,axisLabel:{rotate:45}},yAxis:[{type:"value",name:"成交量/成交额",position:"left"},{type:"value",name:"收盘价",position:"right"}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}],series:[{name:"成交量",type:"bar",data:f,itemStyle:{color:"#E6A23C"}},{name:"成交额",type:"line",yAxisIndex:0,data:b,smooth:!0,lineStyle:{color:"#409EFF"}},{name:"收盘价",type:"line",yAxisIndex:1,data:I,smooth:!0,lineStyle:{color:"#67C23A"}}]};m.setOption(R)}function C(){m?.resize()}return Q(()=>{F(),window.addEventListener("resize",C)}),oe(()=>{window.removeEventListener("resize",C),m?.dispose(),m=null}),B(()=>c.tsCode,()=>{F()}),(s,p)=>{const f=N("el-option"),b=N("el-select");return H(),Y("div",be,[v("div",we,[p[1]||(p[1]=v("h3",null,null,-1)),v("div",Fe,[n(b,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=I=>u.value=I),placeholder:"时间范围",style:{width:"160px"},onChange:F},{default:x(()=>[n(f,{label:"近一年",value:"1y"}),n(f,{label:"近三年",value:"3y"}),n(f,{label:"近五年",value:"5y"})]),_:1},8,["modelValue"])])]),v("div",{ref_key:"chartRef",ref:_,class:"chart"},null,512)])}}}),ke=G(Ce,[["__scopeId","data-v-4c636128"]]),Se="/django/api/market";async function Ie(e){const{indexCode:c,startDate:u,endDate:_,limit:m}=e;return(await W.get(`${Se}/rise-fall-ratio/`,{params:{index_code:c,start_date:u,end_date:_,limit:m}})).data?.results??[]}async function De(e={}){return[...(await W.get("/django/api/tasks/index-basic/",{params:{fields:e.fields??"ts_code,name,market,publisher,category",category:e.category,market:e.market,name:e.name,publisher:e.publisher}})).data?.records||[]].sort((_,m)=>{const i=(_.name||"").localeCompare(m.name||"");return i!==0?i:_.ts_code.localeCompare(m.ts_code)})}const Me={class:"market-analysis","element-loading-text":"正在加载大盘数据..."},$e={class:"fund-flow-section"},Ae={class:"chart-header"},Ve={class:"chart-controls"},Re={class:"chart-container"},ze={class:"chart-header"},Ne={class:"chart-controls"},Le={key:0,class:"rise-fall-section"},Ee={class:"chart-header"},Te={class:"chart-controls"},He={class:"chart-container"},Oe=Z({__name:"MarketAnalysis",setup(e){const c=g(!1),u=g([]),_=g("main_net_inflow_amount"),m=g(""),i=g("all"),d=g(20);async function F(){try{c.value=!0;const a=new Date().toISOString().split("T")[0],o=new Date(Date.now()-d.value*24*60*60*1e3).toISOString().split("T")[0],t=await me(o,a,1,d.value,"-date");u.value=t.list??[]}catch(a){console.error("获取大盘资金流数据出错:",a),K.error("获取大盘资金流数据出错")}finally{c.value=!1}}function $(a){console.log("fund flow chart click:",a)}const C=g("all"),s=g([]),p=g([]),f=g("000001.SH"),b=g("SSE");async function I(){try{const a=await De({market:b.value});p.value=a,a.find(o=>o.ts_code===f.value)||(f.value=a.length?a[0].ts_code:"")}catch(a){console.error("获取指数列表失败:",a),K.error("获取指数列表失败")}}async function R(){try{c.value=!0;const a=new Date().toISOString().split("T")[0],o=new Date(Date.now()-d.value*24*60*60*1e3).toISOString().split("T")[0],t=await Ie({indexCode:C.value,startDate:o,endDate:a});s.value=[...t].sort((h,y)=>h.date.localeCompare(y.date))}catch(a){console.error("获取涨跌比数据出错:",a),K.error("获取涨跌比数据出错")}finally{c.value=!1}}const w=z(()=>{const a=s.value.map(l=>l.date),o=[{key:"rise_fall_ratio_20",label:"20日涨跌比"},{key:"rise_fall_ratio_60",label:"60日涨跌比"},{key:"rise_fall_ratio_120",label:"120日涨跌比"}],t=[],h=[];s.value.forEach((l,S)=>{o.forEach((k,M)=>{const A=l[k.key];typeof A=="number"&&(t.push(A),h.push([S,M,A]))})});const y=t.length?Math.min(...t):0,D=t.length?Math.max(...t):1;return{tooltip:{position:"top",formatter:l=>{const S=a[l.value[0]],k=o[l.value[1]].label,M=l.value[2];return`${S}<br/>${k}: ${M.toFixed(4)}`}},grid:{left:80,right:30,top:40,bottom:40},xAxis:{type:"category",data:a,axisLabel:{rotate:45}},yAxis:{type:"category",data:o.map(l=>l.label)},visualMap:{min:y,max:D,calculable:!0,orient:"horizontal",left:"center",bottom:0,inRange:{color:["#50a3ba","#eac763","#d94e5d"]}},series:[{name:"涨跌比热力图",type:"heatmap",data:h,progressive:0,label:{show:!1}}]}});function r(a){console.log("rise-fall chart click:",a)}return Q(()=>{F(),R(),I()}),B(d,()=>{F(),R()}),B(C,()=>{R()}),B(b,()=>{I()}),(a,o)=>{const t=N("el-option"),h=N("el-select"),y=N("el-card"),D=le("loading");return j((H(),Y("div",Me,[v("div",$e,[n(y,{shadow:"hover"},{header:x(()=>[v("div",Ae,[o[5]||(o[5]=v("h3",null,"大盘资金流热力图",-1)),v("div",Ve,[n(h,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=l=>d.value=l),placeholder:"时间范围",style:{width:"120px","margin-right":"10px"}},{default:x(()=>[n(t,{label:"20天",value:20}),n(t,{label:"30天",value:30}),n(t,{label:"40天",value:40}),n(t,{label:"60天",value:60}),n(t,{label:"90天",value:90}),n(t,{label:"120天",value:120}),n(t,{label:"180天",value:180})]),_:1},8,["modelValue"]),n(h,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=l=>i.value=l),placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:x(()=>[n(t,{label:"全部",value:"all"}),n(t,{label:"正值",value:"positive"}),n(t,{label:"负值",value:"negative"})]),_:1},8,["modelValue"])])])]),default:x(()=>[v("div",Re,[n(ye,{data:u.value,selectedMetric:_.value,searchKeyword:m.value,valueFilter:i.value,onChartClick:$},null,8,["data","selectedMetric","searchKeyword","valueFilter"])])]),_:1}),n(y,{class:"mt-16",shadow:"never"},{default:x(()=>[n(y,{class:"mt-16",shadow:"hover"},{header:x(()=>[v("div",ze,[o[6]||(o[6]=v("h3",null,"指数趋势（成交量/额/收盘价）",-1)),v("div",Ne,[n(h,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=l=>b.value=l),placeholder:"选择市场",style:{width:"160px","margin-right":"10px"}},{default:x(()=>[n(t,{label:"MSCI指数",value:"MSCI"}),n(t,{label:"中证指数",value:"CSI"}),n(t,{label:"上交所指数",value:"SSE"}),n(t,{label:"深交所指数",value:"SZSE"}),n(t,{label:"中金指数",value:"CICC"}),n(t,{label:"申万指数",value:"SW"}),n(t,{label:"其他指数",value:"OTH"})]),_:1},8,["modelValue"]),n(h,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=l=>f.value=l),placeholder:"选择指数",style:{width:"220px"},filterable:""},{default:x(()=>[(H(!0),Y(se,null,ie(p.value,l=>(H(),ce(t,{key:l.ts_code,label:`${l.name??l.ts_code} (${l.ts_code})`,value:l.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:x(()=>[n(ke,{"ts-code":f.value,height:"420px"},null,8,["ts-code"])]),_:1}),s.value.length>0?(H(),Y("div",Le,[n(y,{class:"mt-16",shadow:"hover"},{header:x(()=>[v("div",Ee,[o[7]||(o[7]=v("h3",null,"新高新低比热力图",-1)),v("div",Te,[n(h,{modelValue:C.value,"onUpdate:modelValue":o[4]||(o[4]=l=>C.value=l),placeholder:"指数代码",style:{width:"160px"}},{default:x(()=>[n(t,{label:"全部A股",value:"all"}),n(t,{label:"上证50",value:"sz50"}),n(t,{label:"沪深300",value:"hs300"}),n(t,{label:"中证500",value:"zz500"})]),_:1},8,["modelValue"])])])]),default:x(()=>[v("div",He,[n(P,{option:w.value,height:480,onChartClick:r},null,8,["option"])])]),_:1})])):re("",!0)]),_:1})])])),[[D,c.value]])}}}),We=G(Oe,[["__scopeId","data-v-9e4f5392"]]);export{We as default};
