import{J as Z,d as W,f as B,w as L,c as R,F as J,e as p,i as M,o as V,_ as z,x as T,a as $,A as Y,b as x,k as j,u as ee,E as O,y as ne,l as q,z as X,B as se,C as ce,Z as pe,t as G,g as me,W as fe,G as re,$ as he}from"./index-BagcchU3.js";import{i as ae}from"./index-ElshY9iF.js";import{H as te}from"./HeatmapChart-CXNy7WQ3.js";import{a as le,F as ve,f as _e}from"./industry-fund-flow-7ELfyrXn.js";import{a as ye}from"./industryApi-BFAlYzfr.js";import ge from"./IndexRpsView-m-LBviGl.js";import{g as be}from"./personalHoldingsApi-DWhp69Df.js";import"./strategyApi-CRuBTCU2.js";const xe="/django/api/strategy";async function we(_,f){try{return(await Z.get(`${xe}/industry-turnover-percentile/`,{params:{start_date:_,end_date:f}})).data}catch(e){throw console.error("获取行业换手率分位数数据失败:",e),e}}const Ce=W({__name:"DateRangeSelector",props:{modelValue:{},weekFlag:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(_){return(f,e)=>{const u=M("el-option"),l=M("el-select");return V(),B(l,{"model-value":f.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>f.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>f.$emit("change",m)),placeholder:"选择日期范围",style:{width:"150px"}},{default:L(()=>[f.weekFlag?(V(),R(J,{key:1},[p(u,{label:"最近5周",value:"5"}),p(u,{label:"最近10周",value:"10"}),p(u,{label:"最近20周",value:"20"})],64)):(V(),R(J,{key:0},[p(u,{label:"最近5天",value:"5"}),p(u,{label:"最近10天",value:"10"}),p(u,{label:"最近15天",value:"15"}),p(u,{label:"最近20天",value:"20"}),p(u,{label:"全部29天",value:"all"})],64))]),_:1},8,["model-value"])}}}),ie=z(Ce,[["__scopeId","data-v-678a0eb8"]]),Se=W({__name:"TurnoverHeatmap",props:{industries:{},dates:{},searchKeyword:{default:""},sortMetric:{default:"amount"},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(_,{emit:f}){const e=_,u=f,l=T(()=>{let i=e.industries;return e.searchKeyword?.trim()&&(i=e.industries.filter(b=>b.name.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...i].sort((b,d)=>{if(b.data.length===0||d.data.length===0)return 0;const v=b.data[b.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"],a=d.data[d.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"];return e.sortAscending?v-a:a-v})}),m=T(()=>e.searchKeyword?.trim()?I():C()),C=()=>{const i=[];l.value.forEach((d,v)=>{d.data.forEach((a,n)=>{const t=e.sortMetric==="turnover"?a.turnoverRateFQuantile:a.amountCongestionQuantile;typeof t=="number"&&!isNaN(t)&&isFinite(t)&&i.push([n,v,t])})});const b=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{tooltip:{position:"top",formatter:function(d){const[v,a,n]=d.data,t=e.dates[v];return`${l.value[a].name}<br/>${t}<br/>${b}: ${n}`}},grid:{height:Math.max(400,l.value.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:e.dates.map(d=>d.substring(5)),splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:e.dates.map(d=>d.substring(5)),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:l.value.map(d=>d.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:l.value.map(d=>d.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:0,max:100,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:b,type:"heatmap",data:i,label:{show:!0,fontSize:9,formatter:function(d){return d.data[2]}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},I=()=>{const i=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#EA7CCC","#2f4554","#61a0a8","#d48265","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],b=a=>{let n=0;for(let t=0;t<a.length;t++)n=n*31+a.charCodeAt(t)>>>0;return i[n%i.length]},d=l.value.map(a=>{const n=b(a.name);return{name:a.name,type:"line",data:a.data.map(t=>e.sortMetric==="turnover"?t.turnoverRateFQuantile:t.amountCongestionQuantile),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:n},itemStyle:{color:n}}}),v=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{title:{text:`${e.searchKeyword} - ${v}趋势`,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:l.value.map(a=>a.name),top:"8%",type:"scroll"},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.dates.map(a=>a.substring(5)),axisLabel:{rotate:45}},yAxis:{type:"value",name:v,nameLocation:"middle",nameGap:50},series:d}},y=i=>{u("chart-ready",i)},g=i=>{const b=i?.data,[d,v,a]=b??[],n=typeof v=="number"?l.value[v]:void 0,t=typeof d=="number"?e.dates[d]:void 0;u("chart-click",{industry:n?{name:n.name}:void 0,date:t,value:a,metric:e.sortMetric??"amount",rawParams:i})};return(i,b)=>(V(),B(te,{option:m.value,onChartReady:y,onChartClick:g},null,8,["option"]))}}),ke=z(Se,[["__scopeId","data-v-5dd4a692"]]),$e={class:"turnover-analysis"},Ie={class:"controls"},Ve={class:"chart-container"},Fe=W({__name:"TurnoverAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(_){const f=_,e=ee(),u=$("amount"),l=$("20"),m=$(!0),C=$(!1),I=$([]),y=$([]),g=T(()=>{if(!f.industryWhitelist||f.industryWhitelist.length===0)return I.value;const n=new Set(f.industryWhitelist.map(t=>t.trim().toLowerCase()));return I.value.filter(t=>n.has(t.name.trim().toLowerCase()))}),i=async()=>{C.value=!0;try{const n=new Date,t=n.toISOString().split("T")[0],w=l.value==="all"?30:parseInt(l.value),S=new Date(n);S.setDate(n.getDate()-w);const D=S.toISOString().split("T")[0],c=await we(D,t);if(c){const r=c.data;if(!Array.isArray(r))throw console.error("API返回的数据不是数组:",r),new Error("API返回的数据格式不正确");const N=[...new Set(r.map(s=>s.date))].sort();y.value=N;const o=new Map;r.forEach(s=>{o.has(s.sector_code)||o.set(s.sector_code,{name:s.sector_name,data:[]});const h=o.get(s.sector_code),k=N.indexOf(s.date);for(;h.data.length<N.length;)h.data.push({turnoverRateFQuantile:0,amountCongestionQuantile:0});h.data[k]={turnoverRateFQuantile:s.turnover_ratio_percentile,amountCongestionQuantile:s.turnover_ratio_percentile}}),I.value=Array.from(o.values())}else O.error("获取数据失败")}catch(n){console.error("获取数据出错:",n),O.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{C.value=!1}},b=()=>{i()},d=()=>{m.value=!m.value},v=n=>{},a=n=>{console.log("Chart clicked payload:",n);const t=n?.industry?.name;t&&(e.push({path:"/stock-list",query:{industry:t}}),O.success(`正在跳转到 ${t} 行业的股票列表`))};return Y(()=>{i()}),(n,t)=>{const w=M("el-button");return V(),R("div",$e,[x("div",Ie,[p(ie,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=S=>l.value=S),onChange:b,style:{"margin-right":"10px"}},null,8,["modelValue"]),p(w,{onClick:d,type:"primary"},{default:L(()=>[...t[1]||(t[1]=[j("按最后一列排序",-1)])]),_:1})]),x("div",Ve,[p(ke,{industries:g.value,dates:y.value,"sort-metric":u.value,"sort-ascending":m.value,onChartReady:v,onChartClick:a},null,8,["industries","dates","sort-metric","sort-ascending"])])])}}}),Ne=z(Fe,[["__scopeId","data-v-4533d3ae"]]),Ae="/django/api/stock";async function De(_,f,e,u){try{const l={};return f&&(l.report_type=f),(await Z.get(`${Ae}/industry/heatmap-data/`,{params:l})).data}catch(l){throw console.error("获取行业热力图数据失败:",l),l}}var de=(_=>(_.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",_.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",_.TOTAL_OPERATING_REVENUE="total_operating_revenue",_.TOTAL_NET_PROFIT="total_net_profit",_.EARNINGS_PER_SHARE="avg_earnings_per_share",_.ROE="avg_roe",_.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",_.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",_.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",_))(de||{});const ue={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:_=>_.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:_=>_.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:_=>(_/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:_=>(_/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:_=>_.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:_=>_.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:_=>_.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:_=>_.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:_=>_.toFixed(2)}},Le=W({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(_){return(f,e)=>{const u=M("el-option"),l=M("el-select");return V(),B(l,{"model-value":f.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>f.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>f.$emit("change",m)),placeholder:"选择指标",style:{width:"180px"}},{default:L(()=>[(V(!0),R(J,null,ne(q(ue),(m,C)=>(V(),B(u,{key:C,label:m.name,value:C},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Me=z(Le,[["__scopeId","data-v-26626d73"]]),Re=W({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(_){return(f,e)=>{const u=M("el-option"),l=M("el-select");return V(),B(l,{"model-value":f.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>f.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>f.$emit("change",m)),placeholder:"选择报告类型",style:{width:"120px"}},{default:L(()=>[p(u,{label:"年报",value:"annual"}),p(u,{label:"中报",value:"semi_annual"}),p(u,{label:"一季报",value:"q1"}),p(u,{label:"三季报",value:"q3"}),p(u,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),Ee=z(Re,[["__scopeId","data-v-38f9ba58"]]),Te=W({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(_,{emit:f}){const e=_,u=f,l=T(()=>{if(!e.data)return[];const{swCodeNames:y,congestions:g}=e.data;let i=y;return e.searchKeyword?.trim()&&(i=y.filter(b=>b.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...i].sort((b,d)=>{const v=g[b.indexCode]||g[b.indexName],a=g[d.indexCode]||g[d.indexName];if(!v||!a||v.length===0||a.length===0)return 0;const n=v[v.length-1][e.selectedMetric],t=a[a.length-1][e.selectedMetric];return e.sortAscending?n-t:t-n})}),m=T(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:y,congestions:g}=e.data,i=l.value,b=[];let d=1/0,v=-1/0;i.forEach((n,t)=>{const w=g[n.indexCode]||g[n.indexName];w&&w.forEach((S,D)=>{const c=S[e.selectedMetric];typeof c=="number"&&!isNaN(c)&&isFinite(c)&&(b.push([D,t,c]),d=Math.min(d,c),v=Math.max(v,c))})}),(d===1/0||v===-1/0)&&(d=0,v=100);const a=ue[e.selectedMetric];return{tooltip:{position:"top",formatter:function(n){const[t,w,S]=n.data,D=y[t],c=i[w].indexName,r=a.formatter?a.formatter(S):S.toFixed(2);return`${c}<br/>${D}<br/>${a.name}: ${r}${a.unit}`}},grid:{height:Math.max(400,i.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:y,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:y,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:i.map(n=>n.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:i.map(n=>n.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:d,max:v,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a.name,type:"heatmap",data:b,label:{show:!0,fontSize:9,formatter:function(n){const t=n.data[2];return a.formatter?a.formatter(t):t.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),C=y=>{u("chart-ready",y)},I=y=>{const g=y?.data,[i,b,d]=g??[],v=typeof b=="number"?l.value[b]:void 0,a=typeof i=="number"?e.data?.dates[i]:void 0;u("chart-click",{industry:v,date:a,value:d,metric:e.selectedMetric,rawParams:y})};return(y,g)=>(V(),B(te,{option:m.value,onChartReady:C,onChartClick:I},null,8,["option"]))}}),Pe=z(Te,[["__scopeId","data-v-c7e44af1"]]),We={class:"performance-analysis"},ze={class:"controls"},Oe={class:"chart-container"},Be=W({__name:"PerformanceAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(_){const f=_,e=ee(),u=$(de.OPERATING_REVENUE_GROWTH),l=$("annual"),m=$(!0),C=$(!1),I=$(null),y=T(()=>{const a=I.value;if(!a)return null;if(!f.industryWhitelist||f.industryWhitelist.length===0)return a;const n=new Set(f.industryWhitelist.map(S=>S.trim().toLowerCase())),t=a.swCodeNames.filter(S=>n.has(S.indexName.trim().toLowerCase())),w={};return t.forEach(S=>{const D=S.indexCode,c=S.indexName,r=a.congestions[D]||a.congestions[c];r&&(w[D]=r)}),{dates:a.dates,swCodeNames:t,congestions:w}}),g=async()=>{C.value=!0;try{const a=await De(void 0,l.value,void 0,void 0);a?I.value=a:O.error("获取行业业绩数据失败")}catch(a){console.error("获取业绩数据出错:",a),O.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{C.value=!1}},i=()=>{g()},b=()=>{m.value=!m.value},d=a=>{},v=a=>{console.log("Performance chart clicked payload:",a);const n=a?.industry?.indexName||a?.industry?.indexCode;n&&(e.push({path:"/stock-list",query:{industry:n}}),O.success(`正在跳转到 ${n} 的股票列表`))};return Y(()=>{g()}),(a,n)=>{const t=M("el-button");return V(),R("div",We,[x("div",ze,[p(Me,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=w=>u.value=w),onChange:i,style:{"margin-right":"10px"}},null,8,["modelValue"]),p(Ee,{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=w=>l.value=w),onChange:i,style:{"margin-right":"10px"}},null,8,["modelValue"]),p(t,{onClick:b,type:"primary"},{default:L(()=>[...n[2]||(n[2]=[j("按最后一列排序",-1)])]),_:1})]),x("div",Oe,[p(Pe,{data:y.value,"selected-metric":u.value,"sort-ascending":m.value,onChartReady:d,onChartClick:v},null,8,["data","selected-metric","sort-ascending"])])])}}}),Ue=z(Be,[["__scopeId","data-v-a8d2dea3"]]),He=W({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(_){return(f,e)=>{const u=M("el-option"),l=M("el-select");return V(),B(l,{"model-value":f.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>f.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>f.$emit("change",m)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:L(()=>[(V(!0),R(J,null,ne(q(le),(m,C)=>(V(),B(u,{key:C,label:m.name,value:C},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Ge=z(He,[["__scopeId","data-v-d875eab1"]]),Ke=W({name:"FundFlowHeatmap",__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(_,{emit:f}){const e=_,u=f,l=T(()=>{if(!e.data)return[];const{swCodeNames:y,congestions:g}=e.data;let i=y;return e.searchKeyword?.trim()&&(i=y.filter(b=>b.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...i].sort((b,d)=>{const v=g[b.indexCode]||g[b.indexName],a=g[d.indexCode]||g[d.indexName];if(!v||!a||v.length===0||a.length===0)return 0;const n=v[v.length-1][e.selectedMetric],t=a[a.length-1][e.selectedMetric];return e.sortAscending?n-t:t-n})}),m=T(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:y,congestions:g}=e.data,i=l.value,b=[];let d=1/0,v=-1/0;i.forEach((n,t)=>{const w=g[n.indexCode]||g[n.indexName];w&&w.forEach((S,D)=>{const c=S[e.selectedMetric];if(typeof c=="number"&&!isNaN(c)&&isFinite(c)){let r=!0;(e.valueFilter==="positive"&&c<=0||e.valueFilter==="negative"&&c>=0)&&(r=!1),r&&(b.push([D,t,c]),d=Math.min(d,c),v=Math.max(v,c))}})}),(d===1/0||v===-1/0)&&(d=0,v=100);const a=le[e.selectedMetric];return{tooltip:{position:"top",formatter:function(n){const[t,w,S]=n.data,D=y[t],c=i[w].indexName,r=a.formatter?a.formatter(S):S.toFixed(2);return`${c}<br/>${D}<br/>${a.name}: ${r}${a.unit}`}},grid:{height:Math.max(400,i.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:y,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:y,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:i.map(n=>n.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:i.map(n=>n.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:d,max:v,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a.name,type:"heatmap",data:b,label:{show:!0,fontSize:9,formatter:function(n){const t=n.data[2];return a.formatter?a.formatter(t):t.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),C=y=>{u("chart-ready",y)},I=y=>{const g=y?.data,[i,b,d]=g??[],v=typeof b=="number"?l.value[b]:void 0,a=typeof i=="number"?e.data?.dates[i]:void 0;u("chart-click",{industry:v,date:a,value:d,metric:e.selectedMetric,rawParams:y})};return(y,g)=>(V(),B(te,{option:m.value,onChartReady:C,onChartClick:I},null,8,["option"]))}}),Qe=z(Ke,[["__scopeId","data-v-f3482af5"]]),qe={class:"fund-flow-analysis"},je={class:"controls"},Ye={class:"chart-container"},Je=W({__name:"FundFlowAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(_){const f=_,e=ee(),u=$(ve.MAIN_NET_INFLOW_AMOUNT),l=$("5"),m=$(!1),C=$("all"),I=$(!0),y=$(!1),g=$(null),i=T(()=>{const t=g.value;if(!t)return null;if(!f.industryWhitelist||f.industryWhitelist.length===0)return t;const w=new Set(f.industryWhitelist.map(c=>c.trim().toLowerCase())),S=t.swCodeNames.filter(c=>w.has(c.indexName.trim().toLowerCase())),D={};return S.forEach(c=>{const r=c.indexCode,N=c.indexName,o=t.congestions[r]||t.congestions[N];o&&(D[r]=o)}),{dates:t.dates,swCodeNames:S,congestions:D}}),b=async()=>{y.value=!0;try{const t=new Date,w=t.toISOString().split("T")[0];let S;m.value?S=(l.value==="all"?5:parseInt(l.value))*7:S=l.value==="all"?30:parseInt(l.value);const D=new Date(t);D.setDate(t.getDate()-S);const c=D.toISOString().split("T")[0],r=await _e(c,w,m.value);r?g.value=r:O.error("获取行业资金流数据失败")}catch(t){console.error("获取资金流数据出错:",t),O.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{y.value=!1}},d=()=>{b()};X(m,t=>{l.value="5",d()});const v=()=>{I.value=!I.value},a=t=>{},n=t=>{console.log("Fund flow chart clicked payload:",t);const w=t?.industry?.indexName||t?.industry?.indexCode;w&&(e.push({path:"/stock-list",query:{industry:w}}),O.success(`正在跳转到 ${w} 的股票列表`))};return Y(()=>{b()}),(t,w)=>{const S=M("el-option"),D=M("el-select"),c=M("el-button");return V(),R("div",qe,[x("div",je,[p(D,{modelValue:m.value,"onUpdate:modelValue":w[0]||(w[0]=r=>m.value=r),onChange:d,placeholder:"数据周期",style:{width:"120px","margin-right":"10px"}},{default:L(()=>[p(S,{label:"按天",value:!1}),p(S,{label:"按周",value:!0})]),_:1},8,["modelValue"]),p(Ge,{modelValue:u.value,"onUpdate:modelValue":w[1]||(w[1]=r=>u.value=r),onChange:d,style:{"margin-right":"10px"}},null,8,["modelValue"]),p(ie,{modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=r=>l.value=r),"week-flag":m.value,onChange:d},null,8,["modelValue","week-flag"]),p(D,{modelValue:C.value,"onUpdate:modelValue":w[3]||(w[3]=r=>C.value=r),onChange:d,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:L(()=>[p(S,{label:"全部",value:"all"}),p(S,{label:"仅正值",value:"positive"}),p(S,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),p(c,{onClick:v,type:"primary"},{default:L(()=>[...w[4]||(w[4]=[j("按最后一列排序",-1)])]),_:1})]),x("div",Ye,[p(Qe,{data:i.value,"selected-metric":u.value,"sort-ascending":I.value,"value-filter":C.value,onChartReady:a,onChartClick:n},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),Xe=z(Je,[["__scopeId","data-v-2688a7ce"]]),Ze={class:"industry-treemap"},et={class:"control-panel"},tt={class:"metric-selector"},at=["value"],nt={class:"refresh-controls"},ot=["disabled"],st={key:0},rt={key:1},lt={key:0,class:"update-time"},it={key:0,class:"loading-container"},dt={key:1,class:"error-container"},ut={class:"error-message"},ct={key:2,class:"treemap-container"},pt={class:"chart-info"},mt={class:"statistics"},ft={class:"stats-grid"},ht={class:"stat-item"},vt={class:"stat-value"},_t={class:"stat-item"},yt={class:"stat-value"},gt={class:"stat-item"},bt={class:"stat-value"},xt={class:"stat-item"},wt={class:"stat-value"},Ct=W({__name:"IndustryTreemap",props:{industryWhitelist:{default:()=>[]}},setup(_){const f=_,e=ee(),u=$(!1),l=$(null),m=$([]),C=$("total_market_cap_sum"),I=$(null),y=$();let g=null;const i=[{key:"total_market_cap_sum",label:"总市值",unit:"元",isPercent:!1},{key:"circulating_market_cap_sum",label:"流通市值",unit:"元",isPercent:!1},{key:"avg_change_percent",label:"平均涨跌幅",unit:"%",isPercent:!0},{key:"total_volume",label:"总成交量",unit:"手",isPercent:!1},{key:"total_amount",label:"总成交额",unit:"元",isPercent:!1},{key:"avg_turnover_rate",label:"平均换手率",unit:"%",isPercent:!0},{key:"avg_pe_ratio",label:"平均市盈率",unit:"",isPercent:!1},{key:"avg_pb_ratio",label:"平均市净率",unit:"",isPercent:!1},{key:"stock_count",label:"股票数量",unit:"只",isPercent:!1},{key:"avg_change_60d",label:"60日平均涨跌幅",unit:"%",isPercent:!0},{key:"avg_change_ytd",label:"年初至今平均涨跌幅",unit:"%",isPercent:!0}],b=T(()=>i.find(s=>s.key===C.value)?.label||""),d=T(()=>{if(!f.industryWhitelist||f.industryWhitelist.length===0)return m.value;const o=new Set(f.industryWhitelist.map(s=>s.trim().toLowerCase()));return m.value.filter(s=>o.has(s.industry.trim().toLowerCase()))});X(()=>f.industryWhitelist,()=>{D()},{deep:!0}),X(d,()=>{D()});const v=T(()=>d.value?.length||0),a=T(()=>{const o=d.value;return!o||o.length===0?0:Math.max(...o.map(s=>s[C.value]))}),n=T(()=>{const o=d.value;return!o||o.length===0?0:Math.min(...o.map(s=>s[C.value]))});async function t(){try{u.value=!0,l.value=null,console.log("开始加载行业数据...");const o=await ye();console.log("API响应数据:",o),m.value=o.industries||[],console.log("设置industryData:",m.value),console.log("数据条数:",m.value?.length||0),I.value=new Date}catch(o){l.value=o instanceof Error?o.message:"加载数据失败",console.error("Failed to load industry data:",o)}finally{u.value=!1,await re(),console.log("DOM更新完成，开始更新树图"),D()}}async function w(){await t()}function S(o){const s=o.data.name;console.log("点击行业:",s),e.push({path:"/stock-list",query:{industry:s}})}function D(){if(console.log("updateTreemap被调用"),console.log("treemapChart.value:",y.value),console.log("industryData.value:",m.value),console.log("industryData长度:",m.value?.length||0),!y.value){console.error("treemapChart容器未找到");return}const o=d.value;if(!o||o.length===0){console.error("可见数据为空或未定义"),g&&(g.setOption({title:{text:"暂无数据",left:"center",top:"center"}}),g.resize());return}g||(console.log("初始化ECharts实例"),g=ae(y.value));const s=i.find(F=>F.key===C.value);console.log("当前选择的指标:",s);const k=o.map(F=>{const P=F[C.value],U=typeof P=="number"?P:Number(P),H=Number.isNaN(U)?0:U,A=typeof F.stock_count=="number"&&F.stock_count>0?F.stock_count:1,K=H;return{name:F.industry,value:K,stockCount:A,metricKey:C.value}}).map(F=>({name:F.name,value:Math.abs(F.value),children:[{name:`${F.name}`,value:Math.abs(F.value),originalValue:F.value,label:{show:!0,formatter:P=>`${P.name}
${r(P.data.originalValue)}`},itemStyle:{color:F.value>0?"#73C0DE":F.value<0?"#EE6666":"#999"}}]})),E={title:{text:`行业矩形树图（${s?.label||""}）`,left:"center"},tooltip:{formatter:F=>{const U=(typeof F?.name=="string"?F.name:"").replace(/\s*\(.+\)\s*$/,""),H=F?.data&&"originalValue"in F.data?Number(F.data.originalValue):void 0,A=o.find(Q=>Q.industry===U),K=H!==void 0?H:A?A[C.value]:0;return`${U}<br/>${s?.label||""}: ${r(Number(K))}`}},series:[{type:"treemap",data:k,roam:!0,nodeClick:!1,breadcrumb:{show:!1},label:{show:!0,color:"#2c3e50",textShadowColor:"rgba(255,255,255,0.9)",textShadowBlur:2,textShadowOffsetX:0,textShadowOffsetY:0},itemStyle:{borderColor:"#ffffff",borderWidth:1,gapWidth:2},levels:[{itemStyle:{borderColor:"#e5e7eb",borderWidth:1,gapWidth:3},upperLabel:{show:!1}},{itemStyle:{borderColor:"#ffffff",borderWidth:1,gapWidth:2}}],emphasis:{itemStyle:{borderColor:"#409EFF",borderWidth:2}}}]};g.setOption(E),g.resize(),g.off("click"),g.on("click",S)}function c(){g&&g.resize()}Y(async()=>{await t(),window.addEventListener("resize",c)}),se(()=>{window.removeEventListener("resize",c),g&&(g.dispose(),g=null)});function r(o){const s=i.find(k=>k.key===C.value),h=typeof o=="number"?o:Number(o);if(Number.isNaN(h))return"--";if(s?.isPercent)return`${h.toFixed(2)}%`;if(s?.unit==="元"){const k=Math.abs(h);return k>=1e12?`${(h/1e12).toFixed(2)}万亿`:k>=1e8?`${(h/1e8).toFixed(2)}亿`:k>=1e4?`${(h/1e4).toFixed(2)}万`:h.toFixed(2)}if(s?.unit==="手"){const k=Math.abs(h);return k>=1e8?`${(h/1e8).toFixed(2)}亿手`:k>=1e4?`${(h/1e4).toFixed(2)}万手`:`${h.toFixed(2)}手`}return s?.unit?`${h.toFixed(2)}${s.unit}`:h.toFixed(2)}function N(o){try{return new Date(o).toLocaleString("zh-CN")}catch{return""}}return(o,s)=>(V(),R("div",Ze,[x("div",et,[x("div",tt,[s[1]||(s[1]=x("label",{for:"metric-select"},"选择指标：",-1)),ce(x("select",{id:"metric-select","onUpdate:modelValue":s[0]||(s[0]=h=>C.value=h),onChange:D,class:"metric-select"},[(V(),R(J,null,ne(i,h=>x("option",{key:h.key,value:h.key},G(h.label),9,at)),64))],544),[[pe,C.value]])]),x("div",nt,[x("button",{onClick:w,disabled:u.value,class:"refresh-btn"},[u.value?(V(),R("span",st,"刷新中...")):(V(),R("span",rt,"刷新数据"))],8,ot),I.value?(V(),R("span",lt," 最后更新："+G(N(I.value)),1)):me("",!0)])]),u.value?(V(),R("div",it,[...s[2]||(s[2]=[x("div",{class:"loading-spinner"},null,-1),x("p",null,"正在加载行业数据...",-1)])])):l.value?(V(),R("div",dt,[x("div",ut,[s[3]||(s[3]=x("h3",null,"数据加载失败",-1)),x("p",null,G(l.value),1),x("button",{onClick:w,class:"retry-btn"},"重试")])])):(V(),R("div",ct,[x("div",{ref_key:"treemapChart",ref:y,class:"treemap-chart"},null,512),x("div",pt,[s[9]||(s[9]=fe('<div class="legend" data-v-de2ff2f5><h4 data-v-de2ff2f5>图例说明</h4><div class="legend-items" data-v-de2ff2f5><div class="legend-item positive" data-v-de2ff2f5><span class="color-box positive" data-v-de2ff2f5></span><span data-v-de2ff2f5>正值/上涨</span></div><div class="legend-item negative" data-v-de2ff2f5><span class="color-box negative" data-v-de2ff2f5></span><span data-v-de2ff2f5>负值/下跌</span></div><div class="legend-item neutral" data-v-de2ff2f5><span class="color-box neutral" data-v-de2ff2f5></span><span data-v-de2ff2f5>中性/无变化</span></div></div></div>',1)),x("div",mt,[s[8]||(s[8]=x("h4",null,"统计信息",-1)),x("div",ft,[x("div",ht,[s[4]||(s[4]=x("span",{class:"stat-label"},"行业总数：",-1)),x("span",vt,G(v.value),1)]),x("div",_t,[s[5]||(s[5]=x("span",{class:"stat-label"},"当前指标：",-1)),x("span",yt,G(b.value),1)]),x("div",gt,[s[6]||(s[6]=x("span",{class:"stat-label"},"最大值：",-1)),x("span",bt,G(r(a.value)),1)]),x("div",xt,[s[7]||(s[7]=x("span",{class:"stat-label"},"最小值：",-1)),x("span",wt,G(r(n.value)),1)])])])])]))]))}}),St=z(Ct,[["__scopeId","data-v-de2ff2f5"]]);async function kt(_,f,e=20,u){const l={};return _&&(l.start_date=_),f&&(l.end_date=f),e&&(l.ma_window=e),(await Z.get("/django/api/strategy/industry-ma-breadth/",{params:l})).data}async function $t(_){const f={};return(await Z.get("/django/api/strategy/industry-scale-breadth/",{params:f})).data}async function It(_,f=3,e){const u={top_n:f};return(await Z.get("/django/api/strategy/industry-actual-output/",{params:u})).data}const Vt={class:"industry-breadth-analysis"},Ft={class:"controls"},Nt={class:"control-group"},At={class:"control-group"},Dt={class:"control-group"},Lt={class:"control-group"},Mt={class:"card-header"},Rt={key:1,class:"empty-tip"},Et=W({__name:"IndustryBreadthAnalysis",props:{industryWhitelist:{default:()=>[]}},emits:["chartReady","chartClick"],setup(_,{emit:f}){const e=_,u=f,l=$(!1),m=$(20),C=$(20),I=$(!0);function y(c){const r=c.getFullYear(),N=`${c.getMonth()+1}`.padStart(2,"0"),o=`${c.getDate()}`.padStart(2,"0");return`${r}-${N}-${o}`}function g(c){const r=new Date,N=new Date;return N.setDate(r.getDate()-c),[y(N),y(r)]}const i=$([]),b=()=>{I.value=!I.value},d=T(()=>{let c=Array.from(new Set(i.value.map(r=>r.sector_name)));if(e.industryWhitelist&&e.industryWhitelist.length>0&&(c=c.filter(r=>e.industryWhitelist.includes(r))),I.value&&v.value.length>0){const r=v.value[v.value.length-1],N=new Map;i.value.forEach(o=>{if(o.date===r&&c.includes(o.sector_name)){const s=typeof o.breadth_ratio=="number"?o.breadth_ratio:Number(o.breadth_ratio);N.set(o.sector_name,Number.isNaN(s)?0:s)}}),c.sort((o,s)=>{const h=N.get(o)||0,k=N.get(s)||0;return h-k||0})}return c}),v=T(()=>Array.from(new Set(i.value.map(r=>r.date))).sort()),a=T(()=>{const c=new Map(v.value.map((o,s)=>[o,s])),r=new Map(d.value.map((o,s)=>[o,s])),N=[];return i.value.forEach(o=>{const s=c.get(o.date),h=r.get(o.sector_name);if(s!==void 0&&h!==void 0){const k=typeof o.breadth_ratio=="number"?o.breadth_ratio:Number(o.breadth_ratio);N.push([s,h,Number.isNaN(k)?0:k])}}),N}),n=T(()=>v.value.length===0||d.value.length===0||a.value.length===0?null:{animation:!1,tooltip:{position:"top",formatter:c=>{const[r,N,o]=c?.data??[],s=typeof r=="number"?v.value[r]:"",h=typeof N=="number"?d.value[N]:"";return`${s}<br/>${h}<br/>宽度比例: ${(Number(o)*100).toFixed(2)}%`}},grid:{left:140,right:80,top:80,bottom:20},xAxis:{type:"category",data:v.value,position:"top",axisLabel:{rotate:0,hideOverlap:!0,interval:"auto"}},yAxis:{type:"category",data:d.value},visualMap:{min:0,max:1,calculable:!0,orient:"vertical",right:10,top:40,bottom:40,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}},series:[{type:"heatmap",data:a.value,itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{itemStyle:{shadowBlur:5,shadowColor:"rgba(0, 0, 0, 0.3)"}}}]}),t=async()=>{l.value=!0;try{const[c,r]=g(m.value),N=await kt(c,r,C.value);i.value=N.data??[]}catch(c){console.error("获取行业MA宽度数据失败:",c)}finally{l.value=!1}},w=()=>{t()},S=c=>u("chartReady",c),D=c=>{const[r,N,o]=c?.data??[],s={date:typeof r=="number"?v.value[r]:"",industry:typeof N=="number"?d.value[N]:"",value:typeof o=="number"?o:0};u("chartClick",s)};return X(()=>e.industryWhitelist,()=>{},{deep:!0}),Y(()=>{t()}),(c,r)=>{const N=M("el-option"),o=M("el-select"),s=M("el-input-number"),h=M("el-button"),k=M("el-card");return V(),R("div",Vt,[p(k,{class:"control-card",shadow:"hover"},{default:L(()=>[x("div",Ft,[x("div",Nt,[r[2]||(r[2]=x("span",{class:"control-label"},"时间范围：",-1)),p(o,{modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=E=>m.value=E),placeholder:"选择最近天数",disabled:l.value,onChange:w,style:{width:"160px"}},{default:L(()=>[p(N,{label:"最近20天",value:20}),p(N,{label:"最近30天",value:30}),p(N,{label:"最近40天",value:40})]),_:1},8,["modelValue","disabled"])]),x("div",At,[r[3]||(r[3]=x("span",{class:"control-label"},"MA窗口：",-1)),p(s,{modelValue:C.value,"onUpdate:modelValue":r[1]||(r[1]=E=>C.value=E),min:5,max:120,step:5,disabled:l.value,onChange:w},null,8,["modelValue","disabled"])]),x("div",Dt,[p(h,{type:"primary",loading:l.value,onClick:t},{default:L(()=>[...r[4]||(r[4]=[j("刷新",-1)])]),_:1},8,["loading"])]),x("div",Lt,[p(h,{type:"default",disabled:l.value||!i.value.length,onClick:b,icon:I.value?"SortDown":"Sort"},{default:L(()=>[j(G(I.value?"取消排序":"按最后一列排序"),1)]),_:1},8,["disabled","icon"])])])]),_:1}),p(k,{class:"chart-card",shadow:"hover"},{header:L(()=>[x("div",Mt,[x("span",null,"行业宽度热力图（MA "+G(C.value)+"）",1),r[5]||(r[5]=x("span",{class:"tips"},"数据来源：行业MA宽度接口",-1))])]),default:L(()=>[n.value?(V(),B(te,{key:0,option:n.value,onChartReady:S,onChartClick:D},null,8,["option"])):(V(),R("div",Rt,"暂无数据"))]),_:1})])}}}),Tt=z(Et,[["__scopeId","data-v-a964d011"]]),Pt={class:"industry-scale-breadth-panel"},Wt={class:"card-header"},zt={key:0},Ot={key:1},Bt={class:"header-actions"},Ut={key:0,class:"tips"},Ht={key:1,class:"tips"},Gt=W({__name:"IndustryScaleBreadthPanel",props:{industryWhitelist:{default:()=>[]},panelType:{default:"breadth"}},setup(_){const f=_,e=f.panelType,u=$(),l=$();let m=null,C=null;const I=$([]),y=$([]),g=$(!1),i=$("scale_breadth"),b=$("estimated_industry_output");function d(h,k){return Number(h[k]??0)}function v(h,k){return h?Number(h[k]??0):0}function a(){const h=w(),k=i.value;return[...h].sort((E,F)=>d(F,k)-d(E,k))}function n(){const h=w(),k=new Map(y.value.map(F=>[F.sector_code,F])),E=b.value;return[...h].sort((F,P)=>v(k.get(P.sector_code),E)-v(k.get(F.sector_code),E))}function t(){e==="breadth"?u.value&&(m&&m.dispose(),m=ae(u.value)):l.value&&(C&&C.dispose(),C=ae(l.value))}function w(){return f.industryWhitelist&&f.industryWhitelist.length>0?I.value.filter(h=>f.industryWhitelist.includes(h.sector_name)):I.value}function S(h){return Math.max(500,h*22+120)}function D(){if(!m)return;const h=a(),k=h.map(A=>A.sector_name),E=h.map(A=>A.market_cap_ratio),F=h.map(A=>A.company_ratio),P=h.map(A=>A.scale_breadth),U=S(h.length);u.value&&(u.value.style.height=`${U}px`);const H={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:A=>{const K=A.map(Q=>`${Q.seriesName}: ${(Q.value*100).toFixed(2)}%`);return`${A[0].name}<br/>${K.join("<br/>")}`}},grid:{left:100,right:10,top:12,bottom:20},xAxis:{type:"value",boundaryGap:[0,.01],axisLabel:{formatter:A=>`${(A*100).toFixed(0)}%`}},yAxis:{type:"category",data:k,inverse:!0},series:[{name:"market_cap_ratio",type:"bar",data:E,barWidth:6},{name:"company_ratio",type:"bar",data:F,barWidth:6},{name:"scale_breadth",type:"bar",data:P,barWidth:6}]};m.setOption(H),m.resize()}function c(){if(!C)return;const h=n(),k=h.map(A=>A.sector_name),E=new Map(y.value.map(A=>[A.sector_code,A])),F=h.map(A=>(E.get(A.sector_code)?.top_n_revenue_sum||0)/1e8),P=h.map(A=>(E.get(A.sector_code)?.estimated_industry_output||0)/1e8),U=S(h.length);l.value&&(l.value.style.height=`${U}px`);const H={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:A=>{const K=A.map(Q=>`${Q.seriesName}: ${Q.value.toFixed(2)} 亿元`);return`${A[0].name}<br/>${K.join("<br/>")}`}},grid:{left:100,right:10,top:12,bottom:40},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:k,inverse:!0},series:[{name:"top_n_revenue_sum",type:"bar",data:F,barWidth:8},{name:"estimated_industry_output",type:"bar",data:P,barWidth:8}]};C.setOption(H),C.resize()}function r(){D(),o()}function N(){c(),o()}function o(){m?.resize(),C?.resize()}async function s(){g.value=!0;try{const[h,k]=await Promise.all([$t(),It(void 0,3)]);I.value=h.data||[],y.value=k.data||[],e==="breadth"?D():c(),o()}catch(h){console.error("加载行业规模宽度/实际产出数据失败:",h)}finally{g.value=!1}}return Y(()=>{t(),s(),window.addEventListener("resize",o)}),se(()=>{window.removeEventListener("resize",o)}),X(()=>f.industryWhitelist,()=>{e==="breadth"?D():c(),o()},{deep:!0}),(h,k)=>{const E=M("el-option"),F=M("el-select"),P=M("el-card"),U=M("el-col"),H=M("el-row");return V(),R("div",Pt,[p(H,{gutter:16},{default:L(()=>[p(U,{span:24},{default:L(()=>[p(P,{shadow:"hover",class:"chart-card"},{header:L(()=>[x("div",Wt,[q(e)==="breadth"?(V(),R("span",zt,"行业规模宽度指标")):(V(),R("span",Ot,"行业产出与营收（亿元）")),x("div",Bt,[q(e)==="breadth"?(V(),R("span",Ut,"展示：market_cap_ratio、company_ratio、scale_breadth（全行业）")):(V(),R("span",Ht,"展示：top_n_revenue_sum、estimated_industry_output（全行业）")),q(e)==="breadth"?(V(),B(F,{key:2,modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=A=>i.value=A),size:"small",class:"sort-select",onChange:r},{default:L(()=>[p(E,{label:"按规模宽度",value:"scale_breadth"}),p(E,{label:"按总市值占比",value:"market_cap_ratio"}),p(E,{label:"按公司数量占比",value:"company_ratio"})]),_:1},8,["modelValue"])):(V(),B(F,{key:3,modelValue:b.value,"onUpdate:modelValue":k[1]||(k[1]=A=>b.value=A),size:"small",class:"sort-select",onChange:N},{default:L(()=>[p(E,{label:"按估算行业总产出",value:"estimated_industry_output"}),p(E,{label:"按TopN营收总和",value:"top_n_revenue_sum"})]),_:1},8,["modelValue"]))])])]),default:L(()=>[q(e)==="breadth"?(V(),R("div",{key:0,ref_key:"breadthChartRef",ref:u,class:"chart"},null,512)):(V(),R("div",{key:1,ref_key:"barChartRef",ref:l,class:"chart"},null,512))]),_:1})]),_:1})]),_:1})])}}}),oe=z(Gt,[["__scopeId","data-v-184aed4d"]]),Kt={class:"congestion-heatmap"},Qt={class:"header-controls"},qt=W({__name:"CongestionHeatmap",setup(_){const f=$("turnover"),e=$(!1),u=$([]),l=ee(),m=async()=>{if(e.value){if(!he()){O.error("请先登录后再启用“仅看我的”"),e.value=!1,l.push("/login");return}try{const I=await be(),y=Array.from(new Set((I.data?.list||[]).map(g=>(g.industry||"").trim()).filter(g=>!!g)));u.value=y,y.length===0?O.warning("您的持有/关注列表为空，当前无可筛选的行业"):O.success(`已启用，仅展示 ${y.length} 个相关行业`)}catch(I){console.error("获取个人持有/关注列表失败:",I),O.error("获取个人行业列表失败，请稍后重试"),e.value=!1,u.value=[]}}else u.value=[]},C=async I=>{f.value=I,await re(),window.dispatchEvent(new Event("resize"))};return(I,y)=>{const g=M("el-checkbox"),i=M("el-tab-pane"),b=M("el-tabs"),d=M("el-card");return V(),R("div",Kt,[p(d,null,{default:L(()=>[x("div",Qt,[y[3]||(y[3]=x("h3",null,"行业拥挤度分析",-1)),x("div",null,[p(g,{modelValue:e.value,"onUpdate:modelValue":y[0]||(y[0]=v=>e.value=v),onChange:m},{default:L(()=>[...y[2]||(y[2]=[j("仅看我的",-1)])]),_:1},8,["modelValue"])])]),p(b,{modelValue:f.value,"onUpdate:modelValue":y[1]||(y[1]=v=>f.value=v),onTabChange:C},{default:L(()=>[p(i,{label:"成交金额占比分位数",name:"turnover"},{default:L(()=>[p(Ne,{"industry-whitelist":u.value},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"行业业绩指标",name:"performance"},{default:L(()=>[p(Ue,{"industry-whitelist":u.value},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"行业资金流",name:"fundflow"},{default:L(()=>[p(Xe,{"industry-whitelist":u.value},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"行业矩形树图",name:"treemap"},{default:L(()=>[p(St,{"industry-whitelist":u.value},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"行业宽度热力图",name:"breadth"},{default:L(()=>[p(Tt,{"industry-whitelist":u.value},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"行业规模宽度",name:"scaleBreadth"},{default:L(()=>[p(oe,{"industry-whitelist":u.value,"panel-type":"breadth"},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"行业产出营收",name:"outputScale"},{default:L(()=>[p(oe,{"industry-whitelist":u.value,"panel-type":"output"},null,8,["industry-whitelist"])]),_:1}),p(i,{label:"指数RPS强度排名",name:"indexrps"},{default:L(()=>[p(ge)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),na=z(qt,[["__scopeId","data-v-a4519cb3"]]);export{na as default};
