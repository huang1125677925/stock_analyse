import{M as J,d as N,f as M,w as $,c as A,F as U,e as v,i as D,o as S,_ as L,x as R,a as k,A as B,b as h,k as Q,u as H,E as T,y as K,l as X,z as ne,B as oe,C as se,W as re,t as P,g as le,U as ie,G as Y}from"./index-CdMtGc3W.js";import{i as de}from"./index-1yOyFXf9.js";import{H as q}from"./HeatmapChart-5kLpDem4.js";import{a as Z,F as ce,f as ue}from"./industry-fund-flow-Da_LXV2S.js";import{a as me}from"./industryApi-loor7xQQ.js";import pe from"./IndexRpsView-BuUW7GRK.js";import"./strategyApi-Cie2gTU5.js";const fe="/django/api/strategy";async function ve(m,_){try{return(await J.get(`${fe}/industry-turnover-percentile/`,{params:{start_date:m,end_date:_}})).data}catch(e){throw console.error("获取行业换手率分位数数据失败:",e),e}}const _e=N({__name:"DateRangeSelector",props:{modelValue:{},weekFlag:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(m){return(_,e)=>{const r=D("el-option"),o=D("el-select");return S(),M(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=d=>_.$emit("update:modelValue",d)),onChange:e[1]||(e[1]=d=>_.$emit("change",d)),placeholder:"选择日期范围",style:{width:"150px"}},{default:$(()=>[_.weekFlag?(S(),A(U,{key:1},[v(r,{label:"最近5周",value:"5"}),v(r,{label:"最近10周",value:"10"}),v(r,{label:"最近20周",value:"20"})],64)):(S(),A(U,{key:0},[v(r,{label:"最近5天",value:"5"}),v(r,{label:"最近10天",value:"10"}),v(r,{label:"最近15天",value:"15"}),v(r,{label:"最近20天",value:"20"}),v(r,{label:"全部29天",value:"all"})],64))]),_:1},8,["model-value"])}}}),ee=L(_e,[["__scopeId","data-v-678a0eb8"]]),he=N({__name:"TurnoverHeatmap",props:{industries:{},dates:{},searchKeyword:{default:""},sortMetric:{default:"amount"},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(m,{emit:_}){const e=m,r=_,o=R(()=>{let l=e.industries;return e.searchKeyword?.trim()&&(l=e.industries.filter(f=>f.name.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...l].sort((f,s)=>{if(f.data.length===0||s.data.length===0)return 0;const n=f.data[f.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"],t=s.data[s.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"];return e.sortAscending?n-t:t-n})}),d=R(()=>e.searchKeyword?.trim()?I():x()),x=()=>{const l=[];o.value.forEach((s,n)=>{s.data.forEach((t,a)=>{const i=e.sortMetric==="turnover"?t.turnoverRateFQuantile:t.amountCongestionQuantile;typeof i=="number"&&!isNaN(i)&&isFinite(i)&&l.push([a,n,i])})});const f=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{tooltip:{position:"top",formatter:function(s){const[n,t,a]=s.data,i=e.dates[n];return`${o.value[t].name}<br/>${i}<br/>${f}: ${a}`}},grid:{height:Math.max(400,o.value.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:e.dates.map(s=>s.substring(5)),splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:e.dates.map(s=>s.substring(5)),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:o.value.map(s=>s.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:o.value.map(s=>s.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:0,max:100,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:f,type:"heatmap",data:l,label:{show:!0,fontSize:9,formatter:function(s){return s.data[2]}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},I=()=>{const l=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#EA7CCC","#2f4554","#61a0a8","#d48265","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],f=t=>{let a=0;for(let i=0;i<t.length;i++)a=a*31+t.charCodeAt(i)>>>0;return l[a%l.length]},s=o.value.map(t=>{const a=f(t.name);return{name:t.name,type:"line",data:t.data.map(i=>e.sortMetric==="turnover"?i.turnoverRateFQuantile:i.amountCongestionQuantile),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:a},itemStyle:{color:a}}}),n=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{title:{text:`${e.searchKeyword} - ${n}趋势`,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:o.value.map(t=>t.name),top:"8%",type:"scroll"},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.dates.map(t=>t.substring(5)),axisLabel:{rotate:45}},yAxis:{type:"value",name:n,nameLocation:"middle",nameGap:50},series:s}},c=l=>{r("chart-ready",l)},g=l=>{const f=l?.data,[s,n,t]=f??[],a=typeof n=="number"?o.value[n]:void 0,i=typeof s=="number"?e.dates[s]:void 0;r("chart-click",{industry:a?{name:a.name}:void 0,date:i,value:t,metric:e.sortMetric??"amount",rawParams:l})};return(l,f)=>(S(),M(q,{option:d.value,onChartReady:c,onChartClick:g},null,8,["option"]))}}),ge=L(he,[["__scopeId","data-v-5dd4a692"]]),ye={class:"turnover-analysis"},xe={class:"controls"},be={class:"chart-container"},Ce=N({__name:"TurnoverAnalysis",setup(m){const _=H(),e=k("amount"),r=k("20"),o=k(!0),d=k(!1),x=k([]),I=k([]),c=async()=>{d.value=!0;try{const n=new Date,t=n.toISOString().split("T")[0],a=r.value==="all"?30:parseInt(r.value),i=new Date(n);i.setDate(n.getDate()-a);const V=i.toISOString().split("T")[0],F=await ve(V,t);if(F){const y=F.data;if(!Array.isArray(y))throw console.error("API返回的数据不是数组:",y),new Error("API返回的数据格式不正确");const b=[...new Set(y.map(p=>p.date))].sort();I.value=b;const u=new Map;y.forEach(p=>{u.has(p.sector_code)||u.set(p.sector_code,{name:p.sector_name,data:[]});const w=u.get(p.sector_code),z=b.indexOf(p.date);for(;w.data.length<b.length;)w.data.push({turnoverRateFQuantile:0,amountCongestionQuantile:0});w.data[z]={turnoverRateFQuantile:p.turnover_ratio_percentile,amountCongestionQuantile:p.turnover_ratio_percentile}}),x.value=Array.from(u.values())}else T.error("获取数据失败")}catch(n){console.error("获取数据出错:",n),T.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{d.value=!1}},g=()=>{c()},l=()=>{o.value=!o.value},f=n=>{},s=n=>{console.log("Chart clicked payload:",n);const t=n?.industry?.name;t&&(_.push({path:"/stock-list",query:{industry:t}}),T.success(`正在跳转到 ${t} 行业的股票列表`))};return B(()=>{c()}),(n,t)=>{const a=D("el-button");return S(),A("div",ye,[h("div",xe,[v(ee,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=i=>r.value=i),onChange:g,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(a,{onClick:l,type:"primary"},{default:$(()=>[...t[1]||(t[1]=[Q("按最后一列排序",-1)])]),_:1})]),h("div",be,[v(ge,{industries:x.value,dates:I.value,"sort-metric":e.value,"sort-ascending":o.value,onChartReady:f,onChartClick:s},null,8,["industries","dates","sort-metric","sort-ascending"])])])}}}),we=L(Ce,[["__scopeId","data-v-2ff5c927"]]),Se="/django/api/stock";async function ke(m,_,e,r){try{const o={};return _&&(o.report_type=_),(await J.get(`${Se}/industry/heatmap-data/`,{params:o})).data}catch(o){throw console.error("获取行业热力图数据失败:",o),o}}var te=(m=>(m.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",m.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",m.TOTAL_OPERATING_REVENUE="total_operating_revenue",m.TOTAL_NET_PROFIT="total_net_profit",m.EARNINGS_PER_SHARE="avg_earnings_per_share",m.ROE="avg_roe",m.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",m.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",m.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",m))(te||{});const ae={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:m=>m.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:m=>m.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:m=>(m/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:m=>(m/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:m=>m.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:m=>m.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:m=>m.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:m=>m.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:m=>m.toFixed(2)}},Ie=N({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(m){return(_,e)=>{const r=D("el-option"),o=D("el-select");return S(),M(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=d=>_.$emit("update:modelValue",d)),onChange:e[1]||(e[1]=d=>_.$emit("change",d)),placeholder:"选择指标",style:{width:"180px"}},{default:$(()=>[(S(!0),A(U,null,K(X(ae),(d,x)=>(S(),M(r,{key:x,label:d.name,value:x},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Ve=L(Ie,[["__scopeId","data-v-26626d73"]]),Fe=N({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(m){return(_,e)=>{const r=D("el-option"),o=D("el-select");return S(),M(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=d=>_.$emit("update:modelValue",d)),onChange:e[1]||(e[1]=d=>_.$emit("change",d)),placeholder:"选择报告类型",style:{width:"120px"}},{default:$(()=>[v(r,{label:"年报",value:"annual"}),v(r,{label:"中报",value:"semi_annual"}),v(r,{label:"一季报",value:"q1"}),v(r,{label:"三季报",value:"q3"}),v(r,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),Ae=L(Fe,[["__scopeId","data-v-38f9ba58"]]),$e=N({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(m,{emit:_}){const e=m,r=_,o=R(()=>{if(!e.data)return[];const{swCodeNames:c,congestions:g}=e.data;let l=c;return e.searchKeyword?.trim()&&(l=c.filter(f=>f.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...l].sort((f,s)=>{const n=g[f.indexCode]||g[f.indexName],t=g[s.indexCode]||g[s.indexName];if(!n||!t||n.length===0||t.length===0)return 0;const a=n[n.length-1][e.selectedMetric],i=t[t.length-1][e.selectedMetric];return e.sortAscending?a-i:i-a})}),d=R(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:c,congestions:g}=e.data,l=o.value,f=[];let s=1/0,n=-1/0;l.forEach((a,i)=>{const V=g[a.indexCode]||g[a.indexName];V&&V.forEach((F,y)=>{const b=F[e.selectedMetric];typeof b=="number"&&!isNaN(b)&&isFinite(b)&&(f.push([y,i,b]),s=Math.min(s,b),n=Math.max(n,b))})}),(s===1/0||n===-1/0)&&(s=0,n=100);const t=ae[e.selectedMetric];return{tooltip:{position:"top",formatter:function(a){const[i,V,F]=a.data,y=c[i],b=l[V].indexName,u=t.formatter?t.formatter(F):F.toFixed(2);return`${b}<br/>${y}<br/>${t.name}: ${u}${t.unit}`}},grid:{height:Math.max(400,l.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:c,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:c,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:l.map(a=>a.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:l.map(a=>a.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:s,max:n,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:t.name,type:"heatmap",data:f,label:{show:!0,fontSize:9,formatter:function(a){const i=a.data[2];return t.formatter?t.formatter(i):i.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),x=c=>{r("chart-ready",c)},I=c=>{const g=c?.data,[l,f,s]=g??[],n=typeof f=="number"?o.value[f]:void 0,t=typeof l=="number"?e.data?.dates[l]:void 0;r("chart-click",{industry:n,date:t,value:s,metric:e.selectedMetric,rawParams:c})};return(c,g)=>(S(),M(q,{option:d.value,onChartReady:x,onChartClick:I},null,8,["option"]))}}),De=L($e,[["__scopeId","data-v-c7e44af1"]]),Ne={class:"performance-analysis"},Le={class:"controls"},Re={class:"chart-container"},Ee=N({__name:"PerformanceAnalysis",setup(m){const _=H(),e=k(te.OPERATING_REVENUE_GROWTH),r=k("annual"),o=k(!0),d=k(!1),x=k(null),I=async()=>{d.value=!0;try{const s=await ke(void 0,r.value,void 0,void 0);s?x.value=s:T.error("获取行业业绩数据失败")}catch(s){console.error("获取业绩数据出错:",s),T.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{d.value=!1}},c=()=>{I()},g=()=>{o.value=!o.value},l=s=>{},f=s=>{console.log("Performance chart clicked payload:",s);const n=s?.industry?.indexName||s?.industry?.indexCode;n&&(_.push({path:"/stock-list",query:{industry:n}}),T.success(`正在跳转到 ${n} 的股票列表`))};return B(()=>{I()}),(s,n)=>{const t=D("el-button");return S(),A("div",Ne,[h("div",Le,[v(Ve,{modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=a=>e.value=a),onChange:c,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(Ae,{modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=a=>r.value=a),onChange:c,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(t,{onClick:g,type:"primary"},{default:$(()=>[...n[2]||(n[2]=[Q("按最后一列排序",-1)])]),_:1})]),h("div",Re,[v(De,{data:x.value,"selected-metric":e.value,"sort-ascending":o.value,onChartReady:l,onChartClick:f},null,8,["data","selected-metric","sort-ascending"])])])}}}),Te=L(Ee,[["__scopeId","data-v-1cd79c66"]]),Me=N({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(m){return(_,e)=>{const r=D("el-option"),o=D("el-select");return S(),M(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=d=>_.$emit("update:modelValue",d)),onChange:e[1]||(e[1]=d=>_.$emit("change",d)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:$(()=>[(S(!0),A(U,null,K(X(Z),(d,x)=>(S(),M(r,{key:x,label:d.name,value:x},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Pe=L(Me,[["__scopeId","data-v-d875eab1"]]),ze=N({name:"FundFlowHeatmap",__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(m,{emit:_}){const e=m,r=_,o=R(()=>{if(!e.data)return[];const{swCodeNames:c,congestions:g}=e.data;let l=c;return e.searchKeyword?.trim()&&(l=c.filter(f=>f.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...l].sort((f,s)=>{const n=g[f.indexCode]||g[f.indexName],t=g[s.indexCode]||g[s.indexName];if(!n||!t||n.length===0||t.length===0)return 0;const a=n[n.length-1][e.selectedMetric],i=t[t.length-1][e.selectedMetric];return e.sortAscending?a-i:i-a})}),d=R(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:c,congestions:g}=e.data,l=o.value,f=[];let s=1/0,n=-1/0;l.forEach((a,i)=>{const V=g[a.indexCode]||g[a.indexName];V&&V.forEach((F,y)=>{const b=F[e.selectedMetric];if(typeof b=="number"&&!isNaN(b)&&isFinite(b)){let u=!0;(e.valueFilter==="positive"&&b<=0||e.valueFilter==="negative"&&b>=0)&&(u=!1),u&&(f.push([y,i,b]),s=Math.min(s,b),n=Math.max(n,b))}})}),(s===1/0||n===-1/0)&&(s=0,n=100);const t=Z[e.selectedMetric];return{tooltip:{position:"top",formatter:function(a){const[i,V,F]=a.data,y=c[i],b=l[V].indexName,u=t.formatter?t.formatter(F):F.toFixed(2);return`${b}<br/>${y}<br/>${t.name}: ${u}${t.unit}`}},grid:{height:Math.max(400,l.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:c,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:c,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:l.map(a=>a.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:l.map(a=>a.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:s,max:n,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:t.name,type:"heatmap",data:f,label:{show:!0,fontSize:9,formatter:function(a){const i=a.data[2];return t.formatter?t.formatter(i):i.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),x=c=>{r("chart-ready",c)},I=c=>{const g=c?.data,[l,f,s]=g??[],n=typeof f=="number"?o.value[f]:void 0,t=typeof l=="number"?e.data?.dates[l]:void 0;r("chart-click",{industry:n,date:t,value:s,metric:e.selectedMetric,rawParams:c})};return(c,g)=>(S(),M(q,{option:d.value,onChartReady:x,onChartClick:I},null,8,["option"]))}}),Oe=L(ze,[["__scopeId","data-v-f3482af5"]]),Ue={class:"fund-flow-analysis"},Be={class:"controls"},He={class:"chart-container"},Ge=N({__name:"FundFlowAnalysis",setup(m){const _=H(),e=k(ce.MAIN_NET_INFLOW_AMOUNT),r=k("5"),o=k(!1),d=k("all"),x=k(!0),I=k(!1),c=k(null),g=async()=>{I.value=!0;try{const t=new Date,a=t.toISOString().split("T")[0];let i;o.value?i=(r.value==="all"?5:parseInt(r.value))*7:i=r.value==="all"?30:parseInt(r.value);const V=new Date(t);V.setDate(t.getDate()-i);const F=V.toISOString().split("T")[0],y=await ue(F,a,o.value);y?c.value=y:T.error("获取行业资金流数据失败")}catch(t){console.error("获取资金流数据出错:",t),T.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{I.value=!1}},l=()=>{g()};ne(o,t=>{r.value="5",l()});const f=()=>{x.value=!x.value},s=t=>{},n=t=>{console.log("Fund flow chart clicked payload:",t);const a=t?.industry?.indexName||t?.industry?.indexCode;a&&(_.push({path:"/stock-list",query:{industry:a}}),T.success(`正在跳转到 ${a} 的股票列表`))};return B(()=>{g()}),(t,a)=>{const i=D("el-option"),V=D("el-select"),F=D("el-button");return S(),A("div",Ue,[h("div",Be,[v(V,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=y=>o.value=y),onChange:l,placeholder:"数据周期",style:{width:"120px","margin-right":"10px"}},{default:$(()=>[v(i,{label:"按天",value:!1}),v(i,{label:"按周",value:!0})]),_:1},8,["modelValue"]),v(Pe,{modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=y=>e.value=y),onChange:l,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(ee,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=y=>r.value=y),"week-flag":o.value,onChange:l},null,8,["modelValue","week-flag"]),v(V,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=y=>d.value=y),onChange:l,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:$(()=>[v(i,{label:"全部",value:"all"}),v(i,{label:"仅正值",value:"positive"}),v(i,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),v(F,{onClick:f,type:"primary"},{default:$(()=>[...a[4]||(a[4]=[Q("按最后一列排序",-1)])]),_:1})]),h("div",He,[v(Oe,{data:c.value,"selected-metric":e.value,"sort-ascending":x.value,"value-filter":d.value,onChartReady:s,onChartClick:n},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),We=L(Ge,[["__scopeId","data-v-66206a62"]]),Qe={class:"industry-treemap"},Ke={class:"control-panel"},qe={class:"metric-selector"},je=["value"],Je={class:"refresh-controls"},Xe=["disabled"],Ye={key:0},Ze={key:1},et={key:0,class:"update-time"},tt={key:0,class:"loading-container"},at={key:1,class:"error-container"},nt={class:"error-message"},ot={key:2,class:"treemap-container"},st={class:"chart-info"},rt={class:"statistics"},lt={class:"stats-grid"},it={class:"stat-item"},dt={class:"stat-value"},ct={class:"stat-item"},ut={class:"stat-value"},mt={class:"stat-item"},pt={class:"stat-value"},ft={class:"stat-item"},vt={class:"stat-value"},_t=N({__name:"IndustryTreemap",setup(m){const _=H(),e=k(!1),r=k(null),o=k([]),d=k("total_market_cap_sum"),x=k(null),I=k();let c=null;const g=[{key:"total_market_cap_sum",label:"总市值",unit:"元",isPercent:!1},{key:"circulating_market_cap_sum",label:"流通市值",unit:"元",isPercent:!1},{key:"avg_change_percent",label:"平均涨跌幅",unit:"%",isPercent:!0},{key:"total_volume",label:"总成交量",unit:"手",isPercent:!1},{key:"total_amount",label:"总成交额",unit:"元",isPercent:!1},{key:"avg_turnover_rate",label:"平均换手率",unit:"%",isPercent:!0},{key:"avg_pe_ratio",label:"平均市盈率",unit:"",isPercent:!1},{key:"avg_pb_ratio",label:"平均市净率",unit:"",isPercent:!1},{key:"stock_count",label:"股票数量",unit:"只",isPercent:!1},{key:"avg_change_60d",label:"60日平均涨跌幅",unit:"%",isPercent:!0},{key:"avg_change_ytd",label:"年初至今平均涨跌幅",unit:"%",isPercent:!0}],l=R(()=>g.find(p=>p.key===d.value)?.label||""),f=R(()=>o.value?.length||0),s=R(()=>!o.value||o.value.length===0?0:Math.max(...o.value.map(u=>u[d.value]))),n=R(()=>!o.value||o.value.length===0?0:Math.min(...o.value.map(u=>u[d.value])));async function t(){try{e.value=!0,r.value=null,console.log("开始加载行业数据...");const u=await me();console.log("API响应数据:",u),o.value=u.industries||[],console.log("设置industryData:",o.value),console.log("数据条数:",o.value?.length||0),x.value=new Date}catch(u){r.value=u instanceof Error?u.message:"加载数据失败",console.error("Failed to load industry data:",u)}finally{e.value=!1,await Y(),console.log("DOM更新完成，开始更新树图"),V()}}async function a(){await t()}function i(u){const p=u.data.name;console.log("点击行业:",p),_.push({path:"/stock-list",query:{industry:p}})}function V(){if(console.log("updateTreemap被调用"),console.log("treemapChart.value:",I.value),console.log("industryData.value:",o.value),console.log("industryData长度:",o.value?.length||0),!I.value){console.error("treemapChart容器未找到");return}if(!o.value||o.value.length===0){console.error("industryData为空或未定义");return}c||(console.log("初始化ECharts实例"),c=de(I.value));const u=g.find(C=>C.key===d.value);console.log("当前选择的指标:",u);const p=o.value.map(C=>{const E=C[d.value],O=typeof E=="number"?E:Number(E),G=Number.isNaN(O)?0:O,W=typeof C.stock_count=="number"&&C.stock_count>0?C.stock_count:1;return{industry:C.industry,originalValue:G,stockCount:W}});console.log("baseData处理结果:",p.slice(0,3));let w=p.map(C=>({name:C.industry,value:Math.abs(C.originalValue),originalValue:C.originalValue,itemStyle:{color:F(C.originalValue,u?.isPercent||!1)}}));console.log("初始treemapData:",w.slice(0,3));const z=w.reduce((C,E)=>C+E.value,0);if(console.log("总面积:",z),z<=0&&(console.log("所有值为0，使用股票数量作为回退"),w=p.map(C=>({name:C.industry,value:C.stockCount,originalValue:C.originalValue,itemStyle:{color:F(C.originalValue,u?.isPercent||!1)}}))),w=w.filter(C=>C.value>0),console.log("过滤后的treemapData长度:",w.length),console.log("最终treemapData:",w.slice(0,3)),w.length===0){console.error("treemapData为空，无法渲染图表");return}const j={title:{text:`行业${l.value}分布`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:C=>{const E=C.data,O=w.reduce((G,W)=>G+W.value,0);return`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 4px;">${E.name}</div>
            <div>${l.value}: ${y(E.originalValue)}</div>
            <div>占比: ${O>0?(E.value/O*100).toFixed(2):"0.00"}%</div>
            <div style="color: #999; font-size: 12px; margin-top: 4px;">点击查看该行业股票列表</div>
          </div>
        `}},series:[{type:"treemap",data:w,roam:!1,nodeClick:!0,breadcrumb:{show:!1},label:{show:!0,formatter:C=>`${C.name}
${y(C.data.originalValue)}`,fontSize:12,color:"#fff",fontWeight:"bold"},itemStyle:{borderColor:"#fff",borderWidth:2,gapWidth:2},emphasis:{itemStyle:{borderColor:"#333",borderWidth:3},label:{fontSize:14}}}]};console.log("设置ECharts选项:",j),c.setOption(j),c.off("click"),c.on("click",i),console.log("ECharts选项设置完成")}function F(u,p){if(p)return u>0?"#52c41a":u<0?"#ff4d4f":"#d9d9d9";{const w=["#1890ff","#13c2c2","#52c41a","#faad14","#f759ab","#722ed1","#fa541c","#eb2f96"],z=Math.abs(u.toString().charCodeAt(0))%w.length;return w[z]}}function y(u){const p=g.find(w=>w.key===d.value);return p?.isPercent?`${u.toFixed(2)}%`:p?.unit==="元"?u>=1e12?`${(u/1e12).toFixed(2)}万亿`:u>=1e8?`${(u/1e8).toFixed(2)}亿`:u>=1e4?`${(u/1e4).toFixed(2)}万`:u.toFixed(2):u>=1e8?`${(u/1e8).toFixed(2)}亿`:u>=1e4?`${(u/1e4).toFixed(2)}万`:u.toFixed(2)+(p?.unit||"")}function b(u){return u.toLocaleString("zh-CN")}return B(async()=>{await t(),window.addEventListener("resize",()=>{c&&c.resize()})}),oe(()=>{c&&(c.dispose(),c=null),window.removeEventListener("resize",()=>{c&&c.resize()})}),(u,p)=>(S(),A("div",Qe,[h("div",Ke,[h("div",qe,[p[1]||(p[1]=h("label",{for:"metric-select"},"选择指标：",-1)),se(h("select",{id:"metric-select","onUpdate:modelValue":p[0]||(p[0]=w=>d.value=w),onChange:V,class:"metric-select"},[(S(),A(U,null,K(g,w=>h("option",{key:w.key,value:w.key},P(w.label),9,je)),64))],544),[[re,d.value]])]),h("div",Je,[h("button",{onClick:a,disabled:e.value,class:"refresh-btn"},[e.value?(S(),A("span",Ye,"刷新中...")):(S(),A("span",Ze,"刷新数据"))],8,Xe),x.value?(S(),A("span",et," 最后更新："+P(b(x.value)),1)):le("",!0)])]),e.value?(S(),A("div",tt,[...p[2]||(p[2]=[h("div",{class:"loading-spinner"},null,-1),h("p",null,"正在加载行业数据...",-1)])])):r.value?(S(),A("div",at,[h("div",nt,[p[3]||(p[3]=h("h3",null,"数据加载失败",-1)),h("p",null,P(r.value),1),h("button",{onClick:a,class:"retry-btn"},"重试")])])):(S(),A("div",ot,[h("div",{ref_key:"treemapChart",ref:I,class:"treemap-chart"},null,512),h("div",st,[p[9]||(p[9]=ie('<div class="legend" data-v-fef80d80><h4 data-v-fef80d80>图例说明</h4><div class="legend-items" data-v-fef80d80><div class="legend-item positive" data-v-fef80d80><span class="color-box positive" data-v-fef80d80></span><span data-v-fef80d80>正值/上涨</span></div><div class="legend-item negative" data-v-fef80d80><span class="color-box negative" data-v-fef80d80></span><span data-v-fef80d80>负值/下跌</span></div><div class="legend-item neutral" data-v-fef80d80><span class="color-box neutral" data-v-fef80d80></span><span data-v-fef80d80>中性/无变化</span></div></div></div>',1)),h("div",rt,[p[8]||(p[8]=h("h4",null,"统计信息",-1)),h("div",lt,[h("div",it,[p[4]||(p[4]=h("span",{class:"stat-label"},"行业总数：",-1)),h("span",dt,P(f.value),1)]),h("div",ct,[p[5]||(p[5]=h("span",{class:"stat-label"},"当前指标：",-1)),h("span",ut,P(l.value),1)]),h("div",mt,[p[6]||(p[6]=h("span",{class:"stat-label"},"最大值：",-1)),h("span",pt,P(y(s.value)),1)]),h("div",ft,[p[7]||(p[7]=h("span",{class:"stat-label"},"最小值：",-1)),h("span",vt,P(y(n.value)),1)])])])])]))]))}}),ht=L(_t,[["__scopeId","data-v-fef80d80"]]),gt={class:"congestion-heatmap"},yt=N({__name:"CongestionHeatmap",setup(m){const _=k("turnover"),e=async r=>{_.value=r,await Y(),window.dispatchEvent(new Event("resize"))};return(r,o)=>{const d=D("el-tab-pane"),x=D("el-tabs"),I=D("el-card");return S(),A("div",gt,[v(I,null,{default:$(()=>[v(x,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=c=>_.value=c),onTabChange:e},{default:$(()=>[v(d,{label:"成交金额占比分位数",name:"turnover"},{default:$(()=>[v(we)]),_:1}),v(d,{label:"行业业绩指标",name:"performance"},{default:$(()=>[v(Te)]),_:1}),v(d,{label:"行业资金流",name:"fundflow"},{default:$(()=>[v(We)]),_:1}),v(d,{label:"行业矩形树图",name:"treemap"},{default:$(()=>[v(ht)]),_:1}),v(d,{label:"指数RPS强度排名",name:"indexrps"},{default:$(()=>[v(pe)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Vt=L(yt,[["__scopeId","data-v-d267c18b"]]);export{Vt as default};
