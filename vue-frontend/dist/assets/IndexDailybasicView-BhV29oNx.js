import{x as J,d as K,a as p,r as Q,B as W,y as X,C as ee,c as E,e as s,b as c,w as r,i as v,E as te,F as H,A as P,k as D,f as ae,g as le,t as S,o as C,_ as ne}from"./index-B-X9N5Dz.js";import{i as oe}from"./index-ElshY9iF.js";async function se(_){return(await J.get("/django/api/tasks/index-dailybasic/",{params:{ts_code:_.tsCode,start_date:_.startDate,end_date:_.endDate,trade_date:_.tradeDate,fields:_.fields}})).data}const re={class:"index-dailybasic-view"},ie={class:"header-content"},de={class:"actions"},ue={class:"search-section"},ce={class:"chart-section"},fe={class:"card-header"},ve={class:"header-title"},pe=K({__name:"IndexDailybasicView",emits:["loaded"],setup(_,{emit:B}){const Z=B,F=p(!1),L=[{label:"上证综指",value:"000001.SH"},{label:"沪深300",value:"000300.SH"},{label:"中证500",value:"000905.SH"},{label:"深证成指",value:"399001.SZ"},{label:"中小板指",value:"399005.SZ"},{label:"创业板指",value:"399006.SZ"},{label:"深证创新",value:"399016.SZ"},{label:"沪深300(深)",value:"399300.SZ"}],k=[{label:"PE (市盈率)",value:"pe"},{label:"PE TTM (滚动市盈率)",value:"pe_ttm"},{label:"PB (市净率)",value:"pb"},{label:"总市值",value:"total_mv"},{label:"流通市值",value:"float_mv"},{label:"总股本",value:"total_share"},{label:"流通股本",value:"float_share"},{label:"自由流通股本",value:"free_share"},{label:"换手率",value:"turnover_rate"},{label:"换手率(自由流通)",value:"turnover_rate_f"}],$=[{text:"最近一年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,t]}},{text:"最近三年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-3),[e,t]}},{text:"最近五年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-5),[e,t]}},{text:"最近十年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-10),[e,t]}}],d=Q({tsCode:"000001.SH",fields:""}),f=p("pe"),m=p(),w=p([]),V=p(0),Y=p(null);let u=null;const h=p(null);function z(t,e){if(t.length===0)return 0;const n=[...t].sort((o,i)=>o-i),l=n.findIndex(o=>o>=e);return l===-1?100:l/n.length*100}function U(t){if(t.length===0){h.value=null;return}const e=t[t.length-1],n=z(t,e);let l="适中",o="info";n>=90?(l="极高",o="danger"):n>=70?(l="较高",o="warning"):n<=10?(l="极低",o="success"):n<=30&&(l="较低",o="primary"),h.value={value:e,percentile:n,status:l,type:o}}function A(t=365){const e=new Date,n=new Date(Date.now()-t*24*60*60*1e3),l=o=>`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}`;return[l(n),l(e)]}async function b(){try{F.value=!0,u&&u.showLoading();const[t,e]=m.value||A(),n=await se({tsCode:d.tsCode,startDate:t,endDate:e,fields:d.fields||void 0});w.value=(n.records||[]).sort((l,o)=>{const i=String(l.trade_date||""),y=String(o.trade_date||"");return i.localeCompare(y)}),V.value=n.count||w.value.length,Z("loaded",V.value),I()}catch(t){te.error(t?.message||"数据加载失败")}finally{F.value=!1,u&&u.hideLoading()}}function O(){Y.value&&(u=oe(Y.value),window.addEventListener("resize",R))}function g(t,e){if(t.length===0)return 0;const n=e/100*(t.length-1),l=Math.floor(n),o=Math.ceil(n),i=n-l;return t[l]*(1-i)+t[o]*i}function I(){if(!u)return;const t=w.value.map(a=>a.trade_date),e=w.value.map(a=>Number(a[f.value])),n=k.find(a=>a.value===f.value)?.label||f.value,l=e.filter(a=>!isNaN(a)).sort((a,G)=>a-G);U(e.filter(a=>!isNaN(a)));const o=g(l,10),i=g(l,30),y=g(l,50),M=g(l,70),x=g(l,90),N={title:{text:`${L.find(a=>a.value===d.tsCode)?.label||d.tsCode} - ${n} 趋势`,left:"center"},tooltip:{trigger:"axis"},grid:{right:"15%"},xAxis:{type:"category",data:t},yAxis:{type:"value",scale:!0},series:[{name:n,type:"line",data:e,smooth:!0,showSymbol:!1,markLine:{symbol:"none",data:[{yAxis:x,name:"90%分位",label:{formatter:"90%: {c}"},lineStyle:{color:"#FF4500",type:"dashed"}},{yAxis:M,name:"70%分位",label:{formatter:"70%: {c}"},lineStyle:{color:"#FFA500",type:"dashed"}},{yAxis:y,name:"50%分位",label:{formatter:"50%: {c}"},lineStyle:{color:"#32CD32",width:2}},{yAxis:i,name:"30%分位",label:{formatter:"30%: {c}"},lineStyle:{color:"#1E90FF",type:"dashed"}},{yAxis:o,name:"10%分位",label:{formatter:"10%: {c}"},lineStyle:{color:"#0000FF",type:"dashed"}}]}}]};u.setOption(N)}function R(){u?.resize()}function T(){b()}function j(){b()}function q(){d.tsCode="000001.SH",d.fields="",f.value="pe",m.value=A(),b()}return W([()=>d.tsCode,m],()=>{b()}),X(()=>{m.value=A(),O(),b()}),ee(()=>{window.removeEventListener("resize",R),u?.dispose()}),(t,e)=>{const n=v("el-button"),l=v("el-option"),o=v("el-select"),i=v("el-form-item"),y=v("el-date-picker"),M=v("el-form"),x=v("el-card"),N=v("el-tag");return C(),E("div",re,[s(x,{class:"page-header",shadow:"hover"},{header:r(()=>[c("div",ie,[e[5]||(e[5]=c("h2",null,"大盘指数估值",-1)),c("div",de,[s(n,{type:"primary",loading:F.value,onClick:T},{default:r(()=>[...e[3]||(e[3]=[D("查询",-1)])]),_:1},8,["loading"]),s(n,{onClick:q},{default:r(()=>[...e[4]||(e[4]=[D("重置",-1)])]),_:1})])])]),default:r(()=>[c("div",ue,[s(M,{inline:!0,model:d,class:"query-form"},{default:r(()=>[s(i,{label:"指数代码"},{default:r(()=>[s(o,{modelValue:d.tsCode,"onUpdate:modelValue":e[0]||(e[0]=a=>d.tsCode=a),placeholder:"请选择指数代码",style:{width:"200px"}},{default:r(()=>[(C(),E(H,null,P(L,a=>s(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"指标"},{default:r(()=>[s(o,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),placeholder:"请选择展示指标",style:{width:"200px"},onChange:I},{default:r(()=>[(C(),E(H,null,P(k,a=>s(l,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"日期范围"},{default:r(()=>[s(y,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYYMMDD",shortcuts:$},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1}),c("div",ce,[s(x,null,{header:r(()=>[c("div",fe,[c("div",ve,[c("span",null,"趋势图（"+S(V.value)+" 条数据）",1),h.value?(C(),ae(N,{key:0,type:h.value.type,effect:"dark",class:"valuation-tag"},{default:r(()=>[D(" 当前"+S(k.find(a=>a.value===f.value)?.label||f.value)+"分位: "+S(h.value.percentile.toFixed(2))+"% - "+S(h.value.status),1)]),_:1},8,["type"])):le("",!0)]),s(n,{link:"",onClick:j},{default:r(()=>[...e[6]||(e[6]=[D("刷新",-1)])]),_:1})])]),default:r(()=>[c("div",{ref_key:"chartRef",ref:Y,class:"chart-container",style:{width:"100%",height:"500px"}},null,512)]),_:1})])])}}}),he=ne(pe,[["__scopeId","data-v-da5d2aa9"]]);export{he as default};
