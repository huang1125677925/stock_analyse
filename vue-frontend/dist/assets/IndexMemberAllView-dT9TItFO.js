import{d as F,a as V,r as C,z as q,y as L,c as m,e as l,w as a,i as d,x as U,b as y,f as p,g as j,k as I,F as T,A as B,o as s,_ as G}from"./index-GxQC_MOV.js";const H={class:"index-member-all-view"},J={class:"form-row"},K={key:3},P={key:0,class:"table-wrapper"},Q={key:1,class:"table-wrapper"},R=F({__name:"IndexMemberAllView",setup(W){const b=V(!1),f=V(""),g=V(""),n=C({}),t=C({fields:"index_code,ts_code,name,weight",is_new:1,l1_code:"",l2_code:"",l3_code:"",ts_code:"",token:""}),M=q(()=>!n.items||!n.fields?[]:n.items.map(u=>{const e={};return n.fields.forEach((i,r)=>{e[String(i)]=u[r]}),e}));function N(){t.fields="index_code,ts_code,name,weight",t.is_new=1,t.l1_code="",t.l2_code="",t.l3_code="",t.token=""}async function w(){b.value=!0,f.value="",g.value="";try{const u={...t},e=await U.get("/django/api/tasks/index-member-all/",{params:u});Object.assign(n,e.data||{}),!n.items&&!n.records&&(g.value="查询成功但数据为空，请尝试调整代码或字段参数")}catch(u){f.value=u?.message||"请求失败",Object.assign(n,{})}finally{b.value=!1}}async function A(){try{const e=(await U.get("/django/api/tasks/index-classify/",{params:{fields:"index_code,industry,level,name"}})).data;let i="";if(e?.items&&e?.fields){const r=e.fields.indexOf("index_code");r>=0&&e.items.length&&(i=String(e.items[0][r]??""))}else if(e?.records&&e.records.length){const r=e.records[0];r&&r.index_code&&(i=String(r.index_code))}i&&(t.ts_code=i)}catch{}}return L(async()=>{await A(),await w()}),(u,e)=>{const i=d("el-option"),r=d("el-select"),c=d("el-form-item"),_=d("el-input"),x=d("el-button"),D=d("el-form"),k=d("el-alert"),O=d("el-skeleton"),h=d("el-table-column"),S=d("el-table"),z=d("el-empty"),E=d("el-card");return s(),m("div",H,[l(E,{shadow:"hover"},{header:a(()=>[...e[7]||(e[7]=[y("div",{class:"card-header"},[y("span",null,"申万行业成分构成（分级/TS代码）")],-1)])]),default:a(()=>[y("div",J,[l(D,{inline:!0,"label-width":"120px"},{default:a(()=>[l(c,{label:"是否最新"},{default:a(()=>[l(r,{modelValue:t.is_new,"onUpdate:modelValue":e[0]||(e[0]=o=>t.is_new=o),style:{width:"120px"}},{default:a(()=>[l(i,{value:1,label:"是"}),l(i,{value:0,label:"否"})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"一级行业代码"},{default:a(()=>[l(_,{modelValue:t.l1_code,"onUpdate:modelValue":e[1]||(e[1]=o=>t.l1_code=o),placeholder:"可选，与l2/l3/ts_code二选一"},null,8,["modelValue"])]),_:1}),l(c,{label:"二级行业代码"},{default:a(()=>[l(_,{modelValue:t.l2_code,"onUpdate:modelValue":e[2]||(e[2]=o=>t.l2_code=o),placeholder:"可选"},null,8,["modelValue"])]),_:1}),l(c,{label:"三级行业代码"},{default:a(()=>[l(_,{modelValue:t.l3_code,"onUpdate:modelValue":e[3]||(e[3]=o=>t.l3_code=o),placeholder:"可选"},null,8,["modelValue"])]),_:1}),l(c,{label:"TS代码"},{default:a(()=>[l(_,{modelValue:t.ts_code,"onUpdate:modelValue":e[4]||(e[4]=o=>t.ts_code=o),placeholder:"优先使用(来自分类接口)"},null,8,["modelValue"])]),_:1}),l(c,{label:"字段列表"},{default:a(()=>[l(_,{modelValue:t.fields,"onUpdate:modelValue":e[5]||(e[5]=o=>t.fields=o),placeholder:"例如: index_code,ts_code,name,weight"},null,8,["modelValue"])]),_:1}),l(c,{label:"Token"},{default:a(()=>[l(_,{modelValue:t.token,"onUpdate:modelValue":e[6]||(e[6]=o=>t.token=o),placeholder:"可留空，走服务端默认"},null,8,["modelValue"])]),_:1}),l(c,null,{default:a(()=>[l(x,{type:"primary",loading:b.value,onClick:w},{default:a(()=>[...e[8]||(e[8]=[I("查询",-1)])]),_:1},8,["loading"]),l(x,{onClick:N},{default:a(()=>[...e[9]||(e[9]=[I("重置默认",-1)])]),_:1})]),_:1})]),_:1})]),g.value?(s(),p(k,{key:0,type:"info",closable:!1,title:g.value,class:"mb-12"},null,8,["title"])):j("",!0),f.value?(s(),p(k,{key:1,type:"error",closable:!1,title:f.value,class:"mb-12"},null,8,["title"])):j("",!0),b.value&&!f.value?(s(),p(O,{key:2,rows:"6",animated:""})):(s(),m("div",K,[n.items&&n.fields?(s(),m("div",P,[l(S,{data:M.value,border:"",height:"520"},{default:a(()=>[(s(!0),m(T,null,B(n.fields,o=>(s(),p(h,{key:String(o),prop:String(o),label:String(o)},null,8,["prop","label"]))),128))]),_:1},8,["data"])])):n.records&&n.records.length?(s(),m("div",Q,[l(S,{data:n.records,border:"",height:"520"},{default:a(()=>[(s(!0),m(T,null,B(n.records[0],(o,v)=>(s(),p(h,{key:String(v),prop:String(v),label:String(v)},null,8,["prop","label"]))),128))]),_:1},8,["data"])])):(s(),p(z,{key:2,description:"暂无数据"}))]))]),_:1})])}}}),Y=G(R,[["__scopeId","data-v-257d9167"]]);export{Y as default};
