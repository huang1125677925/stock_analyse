import{g as te}from"./newsApi-1Ew633kj.js";import{H as se}from"./HeatmapChart-COfhTpbS.js";import{d as oe,a as y,z as k,y as le,B as ne,c as v,e as i,D as ae,w as a,i as p,G as re,f as z,E as W,b as l,k as g,F as S,A as L,t as m,g as E,o as d,_ as ie}from"./index-B_RXet-9.js";import"./index-ElshY9iF.js";const ue={class:"news-heatmap-view"},de={class:"query-form"},ce={class:"panel-header"},ve={class:"stats"},fe={key:0,class:"content-split"},pe={class:"industry-list-pane"},me=["onClick","title"],_e={class:"name"},ye={class:"heatmap-pane"},ge={class:"heatmap-scroll"},he={key:0},be={class:"reason-list"},we={class:"reason-index"},Ce={class:"reason-text"},ke={key:0,class:"industry-reasons"},xe={class:"date"},Ve={class:"reason-list"},$e={class:"reason-index"},Ne={class:"reason-text"},Ae=oe({__name:"NewsWordcloud",setup(De){const x=["航空机场","铁路公路","物流行业","水泥建材","工程建设","公用事业","电力行业","交运设备","农牧饲渔","纺织服装","煤炭行业","食品饮料","家用轻工","互联网服务","通信设备","航运港口","房地产开发","塑料制品","家电行业","电网设备","仪器仪表","电子元件","石油行业","化学制药","造纸印刷","化纤行业","证券","保险","银行","装修建材","酿酒行业","有色金属","钢铁行业","航天航空","汽车零部件","商业百货","贸易行业","旅游酒店","文化传媒","化学制品","综合行业","通用设备","玻璃玻纤","装修装饰","工程咨询服务","医疗服务","环保行业","船舶制造","农药兽药","化肥行业","贵金属","包装材料","珠宝首饰","计算机设备","通信服务","软件开发","多元金融","工程机械","教育","专用设备","能源金属","汽车服务","采掘行业","橡胶制品","化学原料","非金属材料","小金属","燃气","汽车整车","电机","光伏设备","风电设备","电池","电源设备","美容护理","半导体","消费电子","光学光电子","电子化学品","中药","医疗器械","医药商业","专业服务","生物制品","房地产服务","游戏"],_=y(20),V=y(!1),c=k(()=>{const s=new Date,e=[];for(let t=_.value-1;t>=0;t--){const o=new Date(s.getTime()-t*24*60*60*1e3);e.push(j(o))}return e}),h=y({}),$=y(!1),b=y(null),U=k(()=>b.value?`${b.value.date} · ${b.value.industry}`:"利好原因"),N=y(!1),I=y("行业利好消息"),B=y([]);function j(s){return s.toISOString().split("T")[0]}function q(){_.value=20,A()}function F(s){if(!s)return{};try{const e=JSON.parse(s),t={};for(const[o,n]of Object.entries(e))x.includes(o)&&(Array.isArray(n)?t[o]=n.map(u=>String(u)).filter(Boolean):typeof n=="string"?t[o]=[n]:n!=null&&(t[o]=[String(n)]));return t}catch(e){return console.warn("AI内容解析失败:",e),{}}}function G(s){const e={};for(const t of c.value){e[t]={};for(const o of x)e[t][o]=[]}for(const t of s){const o=t.publish_date?.slice(0,10);if(!o||!(o in e))continue;const n=F(t.ai_content);for(const[u,f]of Object.entries(n))u in e[o]&&e[o][u].push(...f)}h.value=e}async function A(){V.value=!0;try{const s=Math.min(_.value*20,600),t=(await te(s,0)).news||[],o=new Set(c.value),n=t.filter(u=>o.has(u.publish_date?.slice(0,10)));G(n)}catch(s){console.error("加载新闻列表失败:",s),W.error("加载新闻列表失败")}finally{V.value=!1}}function D(s){let e=0;for(const t of c.value)(h.value[t]?.[s]||[]).length>0&&e++;return e}const w=k(()=>{const s=[...x];return s.sort((e,t)=>{const o=D(e)-D(t);return o!==0?o:e.localeCompare(t,"zh-CN")}),s});function H(s){const e=[];for(const t of c.value){const o=h.value[t]?.[s]||[];o.length>0&&e.push({date:t,reasons:o})}if(e.length===0){W.info(`${s} 近${_.value}天暂无利好消息`);return}B.value=e,I.value=`${s} · 近${_.value}天利好消息`,N.value=!0}function P(s,e){const t=h.value[e]?.[s]||[];t.length!==0&&(b.value={date:e,industry:s,reasons:t},$.value=!0)}const J=k(()=>{const s=[],e=w.value;for(let t=0;t<e.length;t++){const o=e[t];for(let n=0;n<c.value.length;n++){const u=c.value[n],f=h.value[u]?.[o]||[];s.push([n,t,f.length>0?1:0])}}return s}),Q=k(()=>({grid:{left:160,right:20,top:40,bottom:40},tooltip:{formatter:s=>{const e=s?.value;if(!Array.isArray(e))return"";const t=Number(e[0]),o=Number(e[1]),n=c.value[t],u=w.value[o],f=h.value[n]?.[u]||[];return f.length>0?`${u} · ${n}：利好${f.length}条`:`${u} · ${n}：无利好`}},xAxis:{type:"category",position:"top",data:c.value,axisLabel:{color:"#606266"},axisLine:{lineStyle:{color:"#ebeef5"}}},yAxis:{type:"category",data:w.value,axisLabel:{color:"#606266"},axisLine:{lineStyle:{color:"#ebeef5"}}},visualMap:{show:!1,type:"piecewise",pieces:[{value:0,color:"rgba(0,0,0,0)"},{value:1,color:"rgba(245,108,108,0.18)"}]},series:[{type:"heatmap",data:J.value,label:{show:!0,color:"#f56c6c",fontWeight:600,formatter:s=>s.value?.[2]>0?"利好":""},itemStyle:{borderColor:"#f0f2f5",borderWidth:1},emphasis:{itemStyle:{shadowBlur:8,shadowColor:"rgba(0,0,0,0.2)"}}}]}));function K(s){const e=s?.value;if(!Array.isArray(e))return;const t=Number(e[0]),o=Number(e[1]),n=c.value[t],u=w.value[o];P(u,n)}return le(()=>{A()}),ne(_,()=>{A()}),(s,e)=>{const t=p("el-card"),o=p("el-radio-button"),n=p("el-radio-group"),u=p("el-form-item"),f=p("el-button"),R=p("el-form"),X=p("el-tag"),Y=p("el-scrollbar"),Z=p("el-empty"),T=p("el-dialog"),ee=re("loading");return d(),v("div",ue,[i(t,{shadow:"hover",class:"page-header"},{default:a(()=>[...e[5]||(e[5]=[l("div",{class:"header-content"},[l("h2",null,"新闻利好行业热力图"),l("p",null,"统计最近若干天 CCTV 新闻的 AI 行业分析，纵轴为行业，横轴为日期；有利好标红，点击显示利好原因。")],-1)])]),_:1}),i(t,{shadow:"hover",class:"query-panel"},{header:a(()=>[...e[6]||(e[6]=[l("div",{class:"panel-header"},[l("span",null,"查询条件")],-1)])]),default:a(()=>[l("div",de,[i(R,{inline:!0,"label-width":"80px"},{default:a(()=>[i(u,{label:"最近天数"},{default:a(()=>[i(n,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r)},{default:a(()=>[i(o,{label:10},{default:a(()=>[...e[7]||(e[7]=[g("10天",-1)])]),_:1}),i(o,{label:20},{default:a(()=>[...e[8]||(e[8]=[g("20天",-1)])]),_:1}),i(o,{label:40},{default:a(()=>[...e[9]||(e[9]=[g("40天",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),i(u,null,{default:a(()=>[i(f,{type:"primary",loading:V.value,onClick:A},{default:a(()=>[...e[10]||(e[10]=[g("查询",-1)])]),_:1},8,["loading"]),i(f,{onClick:q},{default:a(()=>[...e[11]||(e[11]=[g("重置",-1)])]),_:1})]),_:1})]),_:1})])]),_:1}),ae((d(),z(t,{shadow:"hover",class:"result-panel"},{header:a(()=>[l("div",ce,[e[13]||(e[13]=l("span",null,"行业×日期热力图",-1)),l("div",ve,[l("span",null,"日期范围："+m(c.value[0])+" 至 "+m(c.value[c.value.length-1]),1),e[12]||(e[12]=l("span",{class:"divider"},"|",-1)),l("span",null,"行业数："+m(x.length),1)])])]),default:a(()=>[c.value.length>0?(d(),v("div",fe,[l("div",pe,[e[14]||(e[14]=l("div",{class:"pane-title"},"行业列表",-1)),i(Y,{class:"industry-scroll"},{default:a(()=>[(d(!0),v(S,null,L(w.value.slice().reverse(),(r,C)=>(d(),v("div",{key:r,class:"industry-item",onClick:M=>H(r),title:`点击查看 ${r} 近${_.value}天的利好消息`},[l("span",_e,m(r),1),i(X,{size:"small",type:D(r)>0?"success":"info"},{default:a(()=>[g(m(D(r))+" 天有利好 ",1)]),_:2},1032,["type"])],8,me))),128))]),_:1})]),l("div",ye,[l("div",ge,[i(se,{option:Q.value,onChartClick:K},null,8,["option"])])])])):(d(),z(Z,{key:1,description:"暂无数据，尝试调整查询条件","image-size":200}))]),_:1})),[[ee,V.value]]),i(T,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=r=>$.value=r),title:U.value,width:"600px"},{footer:a(()=>[i(f,{onClick:e[1]||(e[1]=r=>$.value=!1)},{default:a(()=>[...e[15]||(e[15]=[g("关闭",-1)])]),_:1})]),default:a(()=>[b.value?(d(),v("div",he,[l("div",be,[(d(!0),v(S,null,L(b.value.reasons,(r,C)=>(d(),v("div",{class:"reason-item",key:C},[l("span",we,m(C+1)+".",1),l("span",Ce,m(r),1)]))),128))])])):E("",!0)]),_:1},8,["modelValue","title"]),i(T,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=r=>N.value=r),title:I.value,width:"700px"},{footer:a(()=>[i(f,{onClick:e[3]||(e[3]=r=>N.value=!1)},{default:a(()=>[...e[16]||(e[16]=[g("关闭",-1)])]),_:1})]),default:a(()=>[B.value.length>0?(d(),v("div",ke,[(d(!0),v(S,null,L(B.value,(r,C)=>(d(),v("div",{class:"industry-date-block",key:C},[l("div",xe,m(r.date),1),l("div",Ve,[(d(!0),v(S,null,L(r.reasons,(M,O)=>(d(),v("div",{class:"reason-item",key:O},[l("span",$e,m(O+1)+".",1),l("span",Ne,m(M),1)]))),128))])]))),128))])):E("",!0)]),_:1},8,["modelValue","title"])])}}}),Te=ie(Ae,[["__scopeId","data-v-05aadf3a"]]);export{Te as default};
