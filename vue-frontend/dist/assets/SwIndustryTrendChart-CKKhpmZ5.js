import{d as H,a as h,B as q,y as J,H as K,C as Q,c as $,e as d,w as p,i as v,x as W,b as g,f as z,g as P,D as X,F as ee,A as te,k as R,G as ae,t as F,o as C,_ as le}from"./index-DBlIMAuh.js";import{i as ne}from"./index-ElshY9iF.js";const oe={class:"sw-industry-trend-chart"},se={class:"card-header"},re={class:"header-title"},ie={class:"form-row"},ce=H({__name:"SwIndustryTrendChart",props:{tsCode:{},industryName:{}},setup(T){const b=T,Y=h(null);let i=null;const x=h(!1),y=h(""),f=h(null),U=[{text:"最近一年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,t]}},{text:"最近三年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-3),[e,t]}},{text:"最近五年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-5),[e,t]}},{text:"最近十年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-10),[e,t]}}],w=[{label:"收盘价",value:"close"},{label:"开盘价",value:"open"},{label:"最高价",value:"high"},{label:"最低价",value:"low"},{label:"市盈率 (PE)",value:"pe"},{label:"市净率 (PB)",value:"pb"},{label:"涨跌额",value:"change"},{label:"涨跌幅",value:"pct_change"},{label:"成交量",value:"vol"},{label:"成交额",value:"amount"},{label:"流通市值",value:"float_mv"},{label:"总市值",value:"total_mv"}],c=h("pe"),D=h([]),m=h(null);function G(){const t=new Date,e=new Date;e.setFullYear(e.getFullYear()-10);const l=a=>{const n=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0");return`${n}${s}${u}`};f.value=[l(e),l(t)]}function L(){Y.value&&(i&&i.dispose(),i=ne(Y.value),i.resize())}function B(){i?.resize()}function O(t,e){if(t.length===0)return 0;const l=[...t].sort((n,s)=>n-s),a=l.findIndex(n=>n>=e);return a===-1?100:a/l.length*100}function _(t,e){if(t.length===0)return 0;const l=e/100*(t.length-1),a=Math.floor(l),n=Math.ceil(l),s=l-a;return t[a]*(1-s)+t[n]*s}function Z(t){if(t.length===0){m.value=null;return}const e=t[t.length-1],l=O(t,e);let a="适中",n="info";l>=90?(a="极高",n="danger"):l>=70?(a="较高",n="warning"):l<=10?(a="极低",n="success"):l<=30&&(a="较低",n="primary"),m.value={value:e,percentile:l,status:a,type:n}}function E(t=D.value){if(i||L(),!i)return;const e=[...t].sort((o,M)=>o.trade_date.localeCompare(M.trade_date)),l=e.map(o=>o.trade_date),a=e.map(o=>Number(o[c.value])),n=e.map(o=>o.vol),s=w.find(o=>o.value===c.value)?.label||c.value,u=a.filter(o=>!isNaN(o)).sort((o,M)=>o-M);Z(a.filter(o=>!isNaN(o)));const k=_(u,10),A=_(u,30),N=_(u,50),I=_(u,70),V=_(u,90),r={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:[s,"成交量"],top:0},grid:[{left:"10%",right:"15%",bottom:"20%",height:"60%"},{left:"10%",right:"15%",bottom:"5%",height:"10%"}],xAxis:[{type:"category",data:l,boundaryGap:!1,axisLine:{onZero:!1}},{type:"category",gridIndex:1,data:l,axisLabel:{show:!1}}],yAxis:[{type:"value",name:s,scale:!0},{type:"value",name:"成交量",gridIndex:1,axisLabel:{show:!1},splitLine:{show:!1}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:0,end:100},{show:!0,xAxisIndex:[0,1],type:"slider",bottom:"0%",start:0,end:100}],series:[{name:s,type:"line",data:a,smooth:!0,lineStyle:{width:2},itemStyle:{color:"#409EFF"},markLine:{symbol:"none",data:[{yAxis:V,name:"90%分位",label:{formatter:"90%: {c}"},lineStyle:{color:"#FF4500",type:"dashed"}},{yAxis:I,name:"70%分位",label:{formatter:"70%: {c}"},lineStyle:{color:"#FFA500",type:"dashed"}},{yAxis:N,name:"50%分位",label:{formatter:"50%: {c}"},lineStyle:{color:"#32CD32",width:2}},{yAxis:A,name:"30%分位",label:{formatter:"30%: {c}"},lineStyle:{color:"#1E90FF",type:"dashed"}},{yAxis:k,name:"10%分位",label:{formatter:"10%: {c}"},lineStyle:{color:"#0000FF",type:"dashed"}}]}},{name:"成交量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:n,itemStyle:{color:"#67C23A"}}]};i.setOption(r,!0)}function j(){E()}async function S(){if(b.tsCode){x.value=!0,y.value="";try{const t={ts_code:b.tsCode};f.value&&f.value.length===2&&(t.start_date=f.value[0],t.end_date=f.value[1]);const e=await W.get("/django/api/index/sw-daily/",{params:t});e.data&&Array.isArray(e.data.records)?(D.value=e.data.records,E(D.value)):(D.value=[],y.value="暂无数据",i?.clear(),m.value=null)}catch(t){y.value=t?.message||"请求失败"}finally{x.value=!1}}}return q(()=>b.tsCode,t=>{t&&S()}),J(()=>{G(),K(()=>{L(),b.tsCode&&S(),window.addEventListener("resize",B)})}),Q(()=>{window.removeEventListener("resize",B),i?.dispose()}),(t,e)=>{const l=v("el-tag"),a=v("el-option"),n=v("el-select"),s=v("el-form-item"),u=v("el-date-picker"),k=v("el-button"),A=v("el-form"),N=v("el-alert"),I=v("el-card"),V=ae("loading");return C(),$("div",oe,[d(I,{shadow:"never",class:"chart-card"},{header:p(()=>[g("div",se,[g("div",re,[g("span",null,F(t.industryName?`${t.tsCode} - ${t.industryName} - ${w.find(r=>r.value===c.value)?.label||c.value} 趋势`:"行业趋势"),1),m.value?(C(),z(l,{key:0,type:m.value.type,effect:"dark",class:"valuation-tag"},{default:p(()=>[R(" 当前"+F(w.find(r=>r.value===c.value)?.label||c.value)+"分位: "+F(m.value.percentile.toFixed(2))+"% - "+F(m.value.status),1)]),_:1},8,["type"])):P("",!0)])])]),default:p(()=>[g("div",ie,[d(A,{inline:!0,"label-width":"80px"},{default:p(()=>[d(s,{label:"指标"},{default:p(()=>[d(n,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=r=>c.value=r),placeholder:"选择指标",style:{width:"150px"},onChange:j},{default:p(()=>[(C(),$(ee,null,te(w,r=>d(a,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),d(s,{label:"日期范围"},{default:p(()=>[d(u,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=r=>f.value=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYYMMDD","value-format":"YYYYMMDD",shortcuts:U,style:{width:"320px"}},null,8,["modelValue"])]),_:1}),d(s,null,{default:p(()=>[d(k,{type:"primary",loading:x.value,onClick:S},{default:p(()=>[...e[2]||(e[2]=[R("查询",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),y.value?(C(),z(N,{key:0,type:"error",closable:!1,title:y.value,class:"mb-12"},null,8,["title"])):P("",!0),X(g("div",{class:"chart-container",ref_key:"chartRef",ref:Y},null,512),[[V,x.value]])]),_:1})])}}}),pe=le(ce,[["__scopeId","data-v-0db14bcf"]]);export{pe as S};
