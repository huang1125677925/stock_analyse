import{i as N}from"./index-ElshY9iF.js";import{a as q}from"./individualStockApi-rhOl1QhO.js";import{x as P,d as I,a as w,y as E,Y as V,B,f as T,w as f,E as Y,i as D,b as o,t as L,o as F,_ as O,c as G,e as m,k}from"./index-yvE1imiI.js";const H="/django/api/strategy/market-analysis";async function J(v={days:30}){return(await P.get(`${H}/adr/`,{params:v})).data}async function K(v={days:30}){return(await P.get(`${H}/adl/`,{params:v})).data}const Q={class:"header"},X={class:"subtitle"},Z={class:"counts"},ee=I({__name:"AdrTrend",props:{days:{default:30},startDate:{default:void 0},endDate:{default:void 0}},setup(v){const s=v,c=w(null);let l=null;const d=w(0),u=w(0),i=w(0),y=async()=>{try{const a=await J({days:s.days,start_date:s.startDate,end_date:s.endDate}),t=a.daily.map(n=>n.date),r=a.daily.map(n=>n.daily_adr==null?null:Number(n.daily_adr)),[_,x]=a.aggregated.typical_range,b=a.daily.map(n=>Number(n.adv_count)),g=a.daily.map(n=>Number(n.decl_count)),$=a.daily.map(n=>Number(n.flat_count));if(d.value=a.aggregated.adv_sum,u.value=a.aggregated.decl_sum,i.value=a.daily.reduce((n,A)=>n+(A.flat_count||0),0),!c.value)return;l||(l=N(c.value));const C={tooltip:{trigger:"axis",formatter:n=>{const A=n?.[0]?.axisValueLabel||"",p=n.find(S=>S.seriesName==="ADR"),R=n.find(S=>S.seriesName==="上涨家数"),e=n.find(S=>S.seriesName==="下跌家数"),M=n.find(S=>S.seriesName==="平家数"),z=p?`ADR：${p.data==null?"-":Number(p.data).toFixed(4)}`:"",j=R?`上涨家数：${R.data}`:"",U=e?`下跌家数：${e.data}`:"",W=M?`平家数：${M.data}`:"";return[A,z,j,U,W].filter(Boolean).join("<br/>")}},legend:{data:["ADR","上涨家数","下跌家数","平家数","典型区间"],top:8},grid:{left:48,right:24,top:80,bottom:48},xAxis:{type:"category",data:t},yAxis:[{type:"value",name:"ADR",position:"left",min:n=>Math.min(_,Math.floor(n.min*10)/10),max:n=>Math.max(x,Math.ceil(n.max*10)/10)},{type:"value",name:"家数",position:"right"}],series:[{name:"ADR",type:"line",yAxisIndex:0,smooth:!0,showSymbol:!1,data:r,lineStyle:{width:2},itemStyle:{color:"#4a7bd0"},connectNulls:!0,z:3},{name:"上涨家数",type:"bar",yAxisIndex:1,stack:"counts",data:b,itemStyle:{color:"#F56C6C"},barMaxWidth:28,z:2},{name:"下跌家数",type:"bar",yAxisIndex:1,stack:"counts",data:g,itemStyle:{color:"#67C23A"},barMaxWidth:28,z:2},{name:"平家数",type:"bar",yAxisIndex:1,stack:"counts",data:$,itemStyle:{color:"#909399"},barMaxWidth:28,z:2},{name:"典型区间",type:"line",data:[],markArea:{itemStyle:{color:"rgba(255, 193, 7, 0.15)"},data:[[{yAxis:_},{yAxis:x}]]},z:1}]};l.setOption(C),window.addEventListener("resize",h)}catch(a){console.error(a),Y.error("获取ADR数据失败，请稍后重试")}},h=()=>l?.resize();return E(y),V(()=>{window.removeEventListener("resize",h),l?.dispose(),l=null}),B(()=>[s.days,s.startDate,s.endDate],()=>{y()}),(a,t)=>{const r=D("el-card");return F(),T(r,{shadow:"hover",class:"adr-trend"},{default:f(()=>[o("div",Q,[t[0]||(t[0]=o("h2",null,"涨跌家数比（ADR）趋势",-1)),o("span",X,"区间默认最近"+L(a.days)+"个交易日",1)]),o("div",Z,[o("span",null,"上涨："+L(d.value),1),o("span",null,"下跌："+L(u.value),1),o("span",null,"平："+L(i.value),1)]),o("div",{ref_key:"chartRef",ref:c,class:"chart"},null,512)]),_:1})}}}),te=O(ee,[["__scopeId","data-v-d60e2b56"]]),ae={class:"header"},oe={class:"subtitle"},ne=I({__name:"AdlTrend",props:{days:{default:30},startDate:{default:void 0},endDate:{default:void 0}},setup(v){const s=v,c=w(null);let l=null;const d=async()=>{try{const i=await K({days:s.days,start_date:s.startDate,end_date:s.endDate}),y=i.adl.map(r=>r.date),h=i.adl.map(r=>Number(r.daily_diff)),a=i.adl.map(r=>Number(r.adl_cumulative));if(!c.value)return;l||(l=N(c.value));const t={tooltip:{trigger:"axis"},legend:{data:["每日差值","ADL累计"],top:8},grid:{left:50,right:50,top:70,bottom:40},xAxis:{type:"category",data:y},yAxis:[{type:"value",name:"每日差值",position:"left"},{type:"value",name:"ADL累计",position:"right"}],series:[{name:"每日差值",type:"bar",data:h,itemStyle:{color:"#4a7bd0"}},{name:"ADL累计",type:"line",yAxisIndex:1,smooth:!0,showSymbol:!1,data:a,itemStyle:{color:"#c23531"},lineStyle:{width:2}}]};l.setOption(t),window.addEventListener("resize",u)}catch(i){console.error(i),Y.error("获取ADL数据失败，请稍后重试")}},u=()=>l?.resize();return E(d),V(()=>{window.removeEventListener("resize",u),l?.dispose(),l=null}),B(()=>[s.days,s.startDate,s.endDate],()=>{d()}),(i,y)=>{const h=D("el-card");return F(),T(h,{shadow:"hover",class:"adl-trend"},{default:f(()=>[o("div",ae,[y[0]||(y[0]=o("h2",null,"腾落指标（ADL）趋势",-1)),o("span",oe,"区间默认最近"+L(i.days)+"个交易日",1)]),o("div",{ref_key:"chartRef",ref:c,class:"chart"},null,512)]),_:1})}}}),se=O(ne,[["__scopeId","data-v-31337704"]]),le={class:"market-change-heatmap"},re={class:"header"},de={class:"header-actions"},ie=I({name:"MarketChangeHeatmap",__name:"MarketChangeHeatmap",setup(v){const s=w(null),c=w(null),l=w("piecewise");let d=null,u=null;const i=a=>{const t=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),_=String(a.getDate()).padStart(2,"0");return`${t}${r}${_}`},y=async()=>{try{if(!s.value)return;d=N(s.value);const a=new Date,t=new Date;t.setDate(a.getDate()-365);const r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,_=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,b=(await q("sh000001",{start_date:i(t),end_date:i(a),adjust:""})).map(e=>[e.date,Number(e.change_percent)]),g=b.map(e=>e[1]).filter(e=>typeof e=="number"&&!Number.isNaN(e)),$=g.length?Math.min(...g):-5,C=g.length?Math.max(...g):5,n={tooltip:{position:"top",formatter:e=>{const M=e.data?.[0],z=e.data?.[1];return`${M}<br/>涨跌幅：${(z??0).toFixed(2)}%`}},visualMap:{type:"piecewise",pieces:[{lt:-1,label:"< -1%",color:"#2c4d8a"},{gte:-1,lt:0,label:"-1% ~ 0%",color:"#4a7bd0"},{gte:0,lt:1,label:"0% ~ 1%",color:"#f57c6e"},{gte:1,label:">= 1%",color:"#c23531"}],orient:"horizontal",left:"center",top:"62%",textStyle:{fontSize:12}},calendar:{range:[r,_],cellSize:18,left:"center",splitLine:{show:!0,lineStyle:{color:"#ddd",width:1}},yearLabel:{show:!1},dayLabel:{firstDay:1},monthLabel:{nameMap:"cn"}},series:[{type:"heatmap",coordinateSystem:"calendar",data:b,emphasis:{itemStyle:{shadowBlur:8,shadowColor:"rgba(0,0,0,0.3)"}}}]},A={tooltip:{position:"top",formatter:e=>{const M=e.data?.[0],z=e.data?.[1];return`${M}<br/>涨跌幅：${(z??0).toFixed(2)}%`}},visualMap:{type:"continuous",min:Math.floor($),max:Math.ceil(C),calculable:!0,inRange:{color:["#2c4d8a","#e9e9e9","#c23531"]},orient:"horizontal",left:"center",top:"62%",textStyle:{fontSize:12}},calendar:{range:[r,_],cellSize:18,left:"center",splitLine:{show:!0,lineStyle:{color:"#ddd",width:1}},yearLabel:{show:!1},dayLabel:{firstDay:1},monthLabel:{nameMap:"cn"}},series:[{type:"heatmap",coordinateSystem:"calendar",data:b}]},p=[{name:"< -1%",color:"#2c4d8a",count:0},{name:"-1% ~ 0%",color:"#4a7bd0",count:0},{name:"0% ~ 1%",color:"#f57c6e",count:0},{name:">= 1%",color:"#c23531",count:0}];for(const e of g)e<-1?p[0].count++:e>=-1&&e<0?p[1].count++:e>=0&&e<1?p[2].count++:e>=1&&p[3].count++;const R={tooltip:{trigger:"item"},legend:{bottom:0},color:p.map(e=>e.color),series:[{name:"区间分布",type:"pie",radius:"60%",center:["50%","45%"],label:{formatter:"{b}: {c} ({d}%)"},data:p.map(e=>({name:e.name,value:e.count}))}]};d.setOption(l.value==="piecewise"?n:A),c.value&&(u=N(c.value),u.setOption(R)),window.addEventListener("resize",h),B(l,e=>{d&&d.setOption(e==="piecewise"?n:A,!0)})}catch(a){console.error(a),Y.error("获取大盘历史数据失败，请稍后重试")}},h=()=>{d?.resize(),u?.resize()};return E(()=>{y()}),V(()=>{window.removeEventListener("resize",h),d?.dispose(),u?.dispose(),d=null,u=null}),(a,t)=>{const r=D("el-radio-button"),_=D("el-radio-group"),x=D("el-card"),b=D("el-col"),g=D("el-row");return F(),G("div",le,[m(g,{gutter:12,class:"top-split"},{default:f(()=>[m(b,{span:18},{default:f(()=>[m(x,{shadow:"hover"},{default:f(()=>[o("div",re,[t[3]||(t[3]=o("h2",null,"大盘涨跌（日历热力图）",-1)),t[4]||(t[4]=o("span",{class:"subtitle"},"数据来源：上证指数（sh000001）",-1)),o("div",de,[m(_,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=$=>l.value=$),size:"small"},{default:f(()=>[m(r,{label:"piecewise"},{default:f(()=>[...t[1]||(t[1]=[k("分段色阶",-1)])]),_:1}),m(r,{label:"continuous"},{default:f(()=>[...t[2]||(t[2]=[k("连续色条",-1)])]),_:1})]),_:1},8,["modelValue"])])]),o("div",{ref_key:"chartRef",ref:s,class:"chart"},null,512)]),_:1})]),_:1}),m(b,{span:6},{default:f(()=>[m(x,{shadow:"hover"},{default:f(()=>[t[5]||(t[5]=o("div",{class:"header"},[o("h2",null,"区间分布（饼图）"),o("span",{class:"subtitle"},"区间：< -1%、-1% ~ 0%、0% ~ 1%、≥ 1%")],-1)),o("div",{ref_key:"pieChartRef",ref:c,class:"chart chart-pie"},null,512)]),_:1})]),_:1})]),_:1}),t[6]||(t[6]=o("div",{class:"breadth-intro"},[o("p",null,[o("strong",null,"涨跌家数比（ADR）"),k("：一段时间内上涨股票家数之和与下跌股票家数之和的比值，常用参数为 10 日。比值通常在特定区间（如 0.5–1.5）波动，超出则可能预示市场超买或超卖，趋势可能反转。")]),o("p",null,[o("strong",null,"腾落指标（ADL）"),k("：每日上涨家数与下跌家数的差值的累计。从基期（通常为一段行情起点）开始，每天用上涨家数减去下跌家数并持续累加。观察与大盘指数的同步或背离；背离常被视为趋势反转的先行信号。")])],-1)),m(te,{days:30}),m(se,{days:30})])}}}),me=O(ie,[["__scopeId","data-v-f35c6d54"]]);export{me as default};
