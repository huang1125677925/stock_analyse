import{x as j,d as R,f as E,w as F,e as y,i as k,o as V,_ as $,a as S,z as L,D as q,y as P,G as J,c as A,W as ne,J as U,b as g,k as G,E as z,F as Q,A as W,l as X,H as oe,X as se,t as N,g as re,V as le}from"./index-XfLqPdCy.js";import{i as Y}from"./index-1yOyFXf9.js";import{a as Z,F as ie,f as ce}from"./industry-fund-flow-DsmJPaSG.js";import{a as de}from"./industryApi-CtWVsqOn.js";const ue="/django/api/strategy";async function me(c,u){try{return(await j.get(`${ue}/industry-turnover-percentile/`,{params:{start_date:c,end_date:u}})).data}catch(e){throw console.error("获取行业换手率分位数数据失败:",e),e}}const pe=R({__name:"DateRangeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(u,e)=>{const a=k("el-option"),i=k("el-select");return V(),E(i,{"model-value":u.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>u.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>u.$emit("change",m)),placeholder:"选择日期范围",style:{width:"150px"}},{default:F(()=>[y(a,{label:"最近10天",value:"10"}),y(a,{label:"最近15天",value:"15"}),y(a,{label:"最近20天",value:"20"}),y(a,{label:"全部29天",value:"all"})]),_:1},8,["model-value"])}}}),ee=$(pe,[["__scopeId","data-v-d72742a0"]]),fe=R({__name:"HeatmapChart",props:{option:{},height:{},autoResize:{type:Boolean,default:!0}},emits:["chartReady","chartClick"],setup(c,{expose:u,emit:e}){const a=c,i=e,m=S();let d=null;const b=L(()=>{if(a.height)return a.height;const r=a.option?.yAxis;if(r&&Array.isArray(r)&&r[0]?.data){const t=r[0].data.length;return Math.max(500,t*22+120)}else if(r&&r.data){const t=r.data.length;return Math.max(500,t*22+120)}return 500}),f=()=>{m.value&&(d=Y(m.value),d.on("click",r=>{i("chartClick",r)}),i("chartReady",d),x())},x=()=>{!d||!a.option||U(()=>{d&&(d.clear(),d.setOption(a.option),setTimeout(()=>{d&&d.resize()},0))})};q(()=>a.option,x,{deep:!0}),q(b,()=>{U(()=>{d&&d.resize()})});const _=()=>{d&&a.autoResize&&d.resize()};return P(()=>{f(),a.autoResize&&window.addEventListener("resize",_)}),J(()=>{d&&(d.dispose(),d=null),a.autoResize&&window.removeEventListener("resize",_)}),u({getChart:()=>d,resize:()=>{d&&d.resize()},clear:()=>{d&&d.clear()}}),(r,t)=>(V(),A("div",{ref_key:"chartContainer",ref:m,class:"heatmap-chart",style:ne({height:b.value+"px"})},null,4))}}),K=$(fe,[["__scopeId","data-v-b4aa47f4"]]),_e=R({__name:"TurnoverHeatmap",props:{industries:{},dates:{},searchKeyword:{default:""},sortMetric:{default:"amount"},sortAscending:{type:Boolean,default:!1}},emits:["chartReady","chartClick"],setup(c,{emit:u}){const e=c,a=u,i=L(()=>{let _=e.industries;return e.searchKeyword?.trim()&&(_=e.industries.filter(r=>r.name.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[..._].sort((r,t)=>{if(r.data.length===0||t.data.length===0)return 0;const s=r.data[r.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"],n=t.data[t.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"];return e.sortAscending?s-n:n-s})}),m=L(()=>e.searchKeyword?.trim()?b():d()),d=()=>{const _=[];i.value.forEach((t,s)=>{t.data.forEach((n,l)=>{const h=e.sortMetric==="turnover"?n.turnoverRateFQuantile:n.amountCongestionQuantile;typeof h=="number"&&!isNaN(h)&&isFinite(h)&&_.push([l,s,h])})});const r=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{tooltip:{position:"top",formatter:function(t){const[s,n,l]=t.data,h=e.dates[s];return`${i.value[n].name}<br/>${h}<br/>${r}: ${l}`}},grid:{height:Math.max(400,i.value.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:e.dates.map(t=>t.substring(5)),splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:e.dates.map(t=>t.substring(5)),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:i.value.map(t=>t.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:i.value.map(t=>t.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:0,max:100,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:r,type:"heatmap",data:_,label:{show:!0,fontSize:9,formatter:function(t){return t.data[2]}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},b=()=>{const _=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#EA7CCC","#2f4554","#61a0a8","#d48265","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],r=n=>{let l=0;for(let h=0;h<n.length;h++)l=l*31+n.charCodeAt(h)>>>0;return _[l%_.length]},t=i.value.map(n=>{const l=r(n.name);return{name:n.name,type:"line",data:n.data.map(h=>e.sortMetric==="turnover"?h.turnoverRateFQuantile:h.amountCongestionQuantile),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:l},itemStyle:{color:l}}}),s=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{title:{text:`${e.searchKeyword} - ${s}趋势`,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:i.value.map(n=>n.name),top:"8%",type:"scroll"},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.dates.map(n=>n.substring(5)),axisLabel:{rotate:45}},yAxis:{type:"value",name:s,nameLocation:"middle",nameGap:50},series:t}},f=_=>{a("chartReady",_)},x=_=>{a("chartClick",_)};return(_,r)=>(V(),E(K,{option:m.value,onChartReady:f,onChartClick:x},null,8,["option"]))}}),he=$(_e,[["__scopeId","data-v-f7491ec8"]]),ve={class:"turnover-analysis"},ge={class:"controls"},ye={class:"chart-container"},xe=R({__name:"TurnoverAnalysis",setup(c){const u=S("amount"),e=S("20"),a=S(!0),i=S(!1),m=S([]),d=S([]),b=async()=>{i.value=!0;try{const t=new Date,s=t.toISOString().split("T")[0],n=e.value==="all"?30:parseInt(e.value),l=new Date(t);l.setDate(t.getDate()-n);const h=l.toISOString().split("T")[0],C=await me(h,s);if(C){const I=C.data;if(!Array.isArray(I))throw console.error("API返回的数据不是数组:",I),new Error("API返回的数据格式不正确");const p=[...new Set(I.map(v=>v.date))].sort();d.value=p;const o=new Map;I.forEach(v=>{o.has(v.sector_code)||o.set(v.sector_code,{name:v.sector_name,data:[]});const T=o.get(v.sector_code),O=p.indexOf(v.date);for(;T.data.length<p.length;)T.data.push({turnoverRateFQuantile:0,amountCongestionQuantile:0});T.data[O]={turnoverRateFQuantile:v.turnover_ratio_percentile,amountCongestionQuantile:v.turnover_ratio_percentile}}),m.value=Array.from(o.values())}else z.error("获取数据失败")}catch(t){console.error("获取数据出错:",t),z.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{i.value=!1}},f=()=>{b()},x=()=>{a.value=!a.value},_=t=>{},r=t=>{console.log("Chart clicked:",t)};return P(()=>{b()}),(t,s)=>{const n=k("el-button");return V(),A("div",ve,[g("div",ge,[y(ee,{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=l=>e.value=l),onChange:f,style:{"margin-right":"10px"}},null,8,["modelValue"]),y(n,{onClick:x,type:"primary"},{default:F(()=>[...s[1]||(s[1]=[G("按最后一列排序",-1)])]),_:1})]),g("div",ye,[y(he,{industries:m.value,dates:d.value,"sort-metric":u.value,"sort-ascending":a.value,onChartReady:_,onChartClick:r},null,8,["industries","dates","sort-metric","sort-ascending"])])])}}}),be=$(xe,[["__scopeId","data-v-65392abb"]]),Ce="/django/api/stock";async function we(c,u,e,a){try{const i={};return u&&(i.report_type=u),(await j.get(`${Ce}/industry/heatmap-data/`,{params:i})).data}catch(i){throw console.error("获取行业热力图数据失败:",i),i}}var te=(c=>(c.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",c.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",c.TOTAL_OPERATING_REVENUE="total_operating_revenue",c.TOTAL_NET_PROFIT="total_net_profit",c.EARNINGS_PER_SHARE="avg_earnings_per_share",c.ROE="avg_roe",c.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",c.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",c.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",c))(te||{});const ae={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:c=>c.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:c=>c.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:c=>(c/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:c=>(c/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:c=>c.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:c=>c.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:c=>c.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:c=>c.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:c=>c.toFixed(2)}},Se=R({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(u,e)=>{const a=k("el-option"),i=k("el-select");return V(),E(i,{"model-value":u.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>u.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>u.$emit("change",m)),placeholder:"选择指标",style:{width:"180px"}},{default:F(()=>[(V(!0),A(Q,null,W(X(ae),(m,d)=>(V(),E(a,{key:d,label:m.name,value:d},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Ve=$(Se,[["__scopeId","data-v-26626d73"]]),Ie=R({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(u,e)=>{const a=k("el-option"),i=k("el-select");return V(),E(i,{"model-value":u.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>u.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>u.$emit("change",m)),placeholder:"选择报告类型",style:{width:"120px"}},{default:F(()=>[y(a,{label:"年报",value:"annual"}),y(a,{label:"中报",value:"semi_annual"}),y(a,{label:"一季报",value:"q1"}),y(a,{label:"三季报",value:"q3"}),y(a,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),ke=$(Ie,[["__scopeId","data-v-38f9ba58"]]),Ae=R({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chartReady","chartClick"],setup(c,{emit:u}){const e=c,a=u,i=L(()=>{if(!e.data)return[];const{swCodeNames:f,congestions:x}=e.data;let _=f;return e.searchKeyword?.trim()&&(_=f.filter(r=>r.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[..._].sort((r,t)=>{const s=x[r.indexCode]||x[r.indexName],n=x[t.indexCode]||x[t.indexName];if(!s||!n||s.length===0||n.length===0)return 0;const l=s[s.length-1][e.selectedMetric],h=n[n.length-1][e.selectedMetric];return e.sortAscending?l-h:h-l})}),m=L(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:f,congestions:x}=e.data,_=i.value,r=[];let t=1/0,s=-1/0;_.forEach((l,h)=>{const C=x[l.indexCode]||x[l.indexName];C&&C.forEach((I,p)=>{const o=I[e.selectedMetric];typeof o=="number"&&!isNaN(o)&&isFinite(o)&&(r.push([p,h,o]),t=Math.min(t,o),s=Math.max(s,o))})}),(t===1/0||s===-1/0)&&(t=0,s=100);const n=ae[e.selectedMetric];return{tooltip:{position:"top",formatter:function(l){const[h,C,I]=l.data,p=f[h],o=_[C].indexName,v=n.formatter?n.formatter(I):I.toFixed(2);return`${o}<br/>${p}<br/>${n.name}: ${v}${n.unit}`}},grid:{height:Math.max(400,_.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:f,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:f,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:_.map(l=>l.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:_.map(l=>l.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:t,max:s,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:n.name,type:"heatmap",data:r,label:{show:!0,fontSize:9,formatter:function(l){const h=l.data[2];return n.formatter?n.formatter(h):h.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),d=f=>{a("chartReady",f)},b=f=>{a("chartClick",f)};return(f,x)=>(V(),E(K,{option:m.value,onChartReady:d,onChartClick:b},null,8,["option"]))}}),Fe=$(Ae,[["__scopeId","data-v-a3df8f81"]]),Re={class:"performance-analysis"},$e={class:"controls"},Le={class:"chart-container"},De=R({__name:"PerformanceAnalysis",setup(c){const u=S(te.OPERATING_REVENUE_GROWTH),e=S("annual"),a=S(!0),i=S(!1),m=S(null),d=async()=>{i.value=!0;try{const r=await we(void 0,e.value,void 0,void 0);r?m.value=r:z.error("获取行业业绩数据失败")}catch(r){console.error("获取业绩数据出错:",r),z.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{i.value=!1}},b=()=>{d()},f=()=>{a.value=!a.value},x=r=>{},_=r=>{console.log("Performance chart clicked:",r)};return P(()=>{d()}),(r,t)=>{const s=k("el-button");return V(),A("div",Re,[g("div",$e,[y(Ve,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),onChange:b,style:{"margin-right":"10px"}},null,8,["modelValue"]),y(ke,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value=n),onChange:b,style:{"margin-right":"10px"}},null,8,["modelValue"]),y(s,{onClick:f,type:"primary"},{default:F(()=>[...t[2]||(t[2]=[G("按最后一列排序",-1)])]),_:1})]),g("div",Le,[y(Fe,{data:m.value,"selected-metric":u.value,"sort-ascending":a.value,onChartReady:x,onChartClick:_},null,8,["data","selected-metric","sort-ascending"])])])}}}),Ee=$(De,[["__scopeId","data-v-5daf1c05"]]),Te=R({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(u,e)=>{const a=k("el-option"),i=k("el-select");return V(),E(i,{"model-value":u.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>u.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>u.$emit("change",m)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:F(()=>[(V(!0),A(Q,null,W(X(Z),(m,d)=>(V(),E(a,{key:d,label:m.name,value:d},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Ne=$(Te,[["__scopeId","data-v-0473adf8"]]),ze=R({__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chartReady","chartClick"],setup(c,{emit:u}){const e=c,a=u,i=L(()=>{if(!e.data)return[];const{swCodeNames:f,congestions:x}=e.data;let _=f;return e.searchKeyword?.trim()&&(_=f.filter(r=>r.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[..._].sort((r,t)=>{const s=x[r.indexCode]||x[r.indexName],n=x[t.indexCode]||x[t.indexName];if(!s||!n||s.length===0||n.length===0)return 0;const l=s[s.length-1][e.selectedMetric],h=n[n.length-1][e.selectedMetric];return e.sortAscending?l-h:h-l})}),m=L(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:f,congestions:x}=e.data,_=i.value,r=[];let t=1/0,s=-1/0;_.forEach((l,h)=>{const C=x[l.indexCode]||x[l.indexName];C&&C.forEach((I,p)=>{const o=I[e.selectedMetric];if(typeof o=="number"&&!isNaN(o)&&isFinite(o)){let v=!0;(e.valueFilter==="positive"&&o<=0||e.valueFilter==="negative"&&o>=0)&&(v=!1),v&&(r.push([p,h,o]),t=Math.min(t,o),s=Math.max(s,o))}})}),(t===1/0||s===-1/0)&&(t=0,s=100);const n=Z[e.selectedMetric];return{tooltip:{position:"top",formatter:function(l){const[h,C,I]=l.data,p=f[h],o=_[C].indexName,v=n.formatter?n.formatter(I):I.toFixed(2);return`${o}<br/>${p}<br/>${n.name}: ${v}${n.unit}`}},grid:{height:Math.max(400,_.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:f,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:f,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:_.map(l=>l.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:_.map(l=>l.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:t,max:s,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:n.name,type:"heatmap",data:r,label:{show:!0,fontSize:9,formatter:function(l){const h=l.data[2];return n.formatter?n.formatter(h):h.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),d=f=>{a("chartReady",f)},b=f=>{a("chartClick",f)};return(f,x)=>(V(),E(K,{option:m.value,onChartReady:d,onChartClick:b},null,8,["option"]))}}),Me=$(ze,[["__scopeId","data-v-772aad27"]]),Pe={class:"fund-flow-analysis"},Oe={class:"controls"},Ue={class:"chart-container"},Be=R({__name:"FundFlowAnalysis",setup(c){const u=S(ie.MAIN_NET_INFLOW_AMOUNT),e=S("20"),a=S("all"),i=S(!0),m=S(!1),d=S(null),b=async()=>{m.value=!0;try{const t=new Date,s=t.toISOString().split("T")[0],n=e.value==="all"?30:parseInt(e.value),l=new Date(t);l.setDate(t.getDate()-n);const h=l.toISOString().split("T")[0],C=await ce(h,s);C?d.value=C:z.error("获取行业资金流数据失败")}catch(t){console.error("获取资金流数据出错:",t),z.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{m.value=!1}},f=()=>{b()},x=()=>{i.value=!i.value},_=t=>{},r=t=>{console.log("Fund flow chart clicked:",t)};return P(()=>{b()}),(t,s)=>{const n=k("el-option"),l=k("el-select"),h=k("el-button");return V(),A("div",Pe,[g("div",Oe,[y(Ne,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=C=>u.value=C),onChange:f,style:{"margin-right":"10px"}},null,8,["modelValue"]),y(ee,{modelValue:e.value,"onUpdate:modelValue":s[1]||(s[1]=C=>e.value=C),onChange:f,style:{"margin-right":"10px"}},null,8,["modelValue"]),y(l,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=C=>a.value=C),onChange:f,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:F(()=>[y(n,{label:"全部",value:"all"}),y(n,{label:"仅正值",value:"positive"}),y(n,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),y(h,{onClick:x,type:"primary"},{default:F(()=>[...s[3]||(s[3]=[G("按最后一列排序",-1)])]),_:1})]),g("div",Ue,[y(Me,{data:d.value,"selected-metric":u.value,"sort-ascending":i.value,"value-filter":a.value,onChartReady:_,onChartClick:r},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),He=$(Be,[["__scopeId","data-v-58fcd392"]]),Ge={class:"industry-treemap"},Qe={class:"control-panel"},We={class:"metric-selector"},Ke=["value"],qe={class:"refresh-controls"},je=["disabled"],Je={key:0},Xe={key:1},Ye={key:0,class:"update-time"},Ze={key:0,class:"loading-container"},et={key:1,class:"error-container"},tt={class:"error-message"},at={key:2,class:"treemap-container"},nt={class:"chart-info"},ot={class:"statistics"},st={class:"stats-grid"},rt={class:"stat-item"},lt={class:"stat-value"},it={class:"stat-item"},ct={class:"stat-value"},dt={class:"stat-item"},ut={class:"stat-value"},mt={class:"stat-item"},pt={class:"stat-value"},ft=R({__name:"IndustryTreemap",setup(c){const u=S(!1),e=S(null),a=S([]),i=S("total_market_cap_sum"),m=S(null),d=S();let b=null;const f=[{key:"total_market_cap_sum",label:"总市值",unit:"元",isPercent:!1},{key:"circulating_market_cap_sum",label:"流通市值",unit:"元",isPercent:!1},{key:"avg_change_percent",label:"平均涨跌幅",unit:"%",isPercent:!0},{key:"total_volume",label:"总成交量",unit:"手",isPercent:!1},{key:"total_amount",label:"总成交额",unit:"元",isPercent:!1},{key:"avg_turnover_rate",label:"平均换手率",unit:"%",isPercent:!0},{key:"avg_pe_ratio",label:"平均市盈率",unit:"",isPercent:!1},{key:"avg_pb_ratio",label:"平均市净率",unit:"",isPercent:!1},{key:"stock_count",label:"股票数量",unit:"只",isPercent:!1},{key:"avg_change_60d",label:"60日平均涨跌幅",unit:"%",isPercent:!0},{key:"avg_change_ytd",label:"年初至今平均涨跌幅",unit:"%",isPercent:!0}],x=L(()=>f.find(o=>o.key===i.value)?.label||""),_=L(()=>a.value?.length||0),r=L(()=>!a.value||a.value.length===0?0:Math.max(...a.value.map(p=>p[i.value]))),t=L(()=>!a.value||a.value.length===0?0:Math.min(...a.value.map(p=>p[i.value])));async function s(){try{u.value=!0,e.value=null,console.log("开始加载行业数据...");const p=await de();console.log("API响应数据:",p),a.value=p.industries||[],console.log("设置industryData:",a.value),console.log("数据条数:",a.value?.length||0),m.value=new Date}catch(p){e.value=p instanceof Error?p.message:"加载数据失败",console.error("Failed to load industry data:",p)}finally{u.value=!1,await U(),console.log("DOM更新完成，开始更新树图"),l()}}async function n(){await s()}function l(){if(console.log("updateTreemap被调用"),console.log("treemapChart.value:",d.value),console.log("industryData.value:",a.value),console.log("industryData长度:",a.value?.length||0),!d.value){console.error("treemapChart容器未找到");return}if(!a.value||a.value.length===0){console.error("industryData为空或未定义");return}b||(console.log("初始化ECharts实例"),b=Y(d.value));const p=f.find(w=>w.key===i.value);console.log("当前选择的指标:",p);const o=a.value.map(w=>{const D=w[i.value],M=typeof D=="number"?D:Number(D),B=Number.isNaN(M)?0:M,H=typeof w.stock_count=="number"&&w.stock_count>0?w.stock_count:1;return{industry:w.industry,originalValue:B,stockCount:H}});console.log("baseData处理结果:",o.slice(0,3));let v=o.map(w=>({name:w.industry,value:Math.abs(w.originalValue),originalValue:w.originalValue,itemStyle:{color:h(w.originalValue,p?.isPercent||!1)}}));console.log("初始treemapData:",v.slice(0,3));const T=v.reduce((w,D)=>w+D.value,0);if(console.log("总面积:",T),T<=0&&(console.log("所有值为0，使用股票数量作为回退"),v=o.map(w=>({name:w.industry,value:w.stockCount,originalValue:w.originalValue,itemStyle:{color:h(w.originalValue,p?.isPercent||!1)}}))),v=v.filter(w=>w.value>0),console.log("过滤后的treemapData长度:",v.length),console.log("最终treemapData:",v.slice(0,3)),v.length===0){console.error("treemapData为空，无法渲染图表");return}const O={title:{text:`行业${x.value}分布`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:w=>{const D=w.data,M=v.reduce((B,H)=>B+H.value,0);return`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 4px;">${D.name}</div>
            <div>${x.value}: ${C(D.originalValue)}</div>
            <div>占比: ${M>0?(D.value/M*100).toFixed(2):"0.00"}%</div>
          </div>
        `}},series:[{type:"treemap",data:v,roam:!1,nodeClick:!1,breadcrumb:{show:!1},label:{show:!0,formatter:w=>`${w.name}
${C(w.data.originalValue)}`,fontSize:12,color:"#fff",fontWeight:"bold"},itemStyle:{borderColor:"#fff",borderWidth:2,gapWidth:2},emphasis:{itemStyle:{borderColor:"#333",borderWidth:3},label:{fontSize:14}}}]};console.log("设置ECharts选项:",O),b.setOption(O),console.log("ECharts选项设置完成")}function h(p,o){if(o)return p>0?"#52c41a":p<0?"#ff4d4f":"#d9d9d9";{const v=["#1890ff","#13c2c2","#52c41a","#faad14","#f759ab","#722ed1","#fa541c","#eb2f96"],T=Math.abs(p.toString().charCodeAt(0))%v.length;return v[T]}}function C(p){const o=f.find(v=>v.key===i.value);return o?.isPercent?`${p.toFixed(2)}%`:o?.unit==="元"?p>=1e12?`${(p/1e12).toFixed(2)}万亿`:p>=1e8?`${(p/1e8).toFixed(2)}亿`:p>=1e4?`${(p/1e4).toFixed(2)}万`:p.toFixed(2):p>=1e8?`${(p/1e8).toFixed(2)}亿`:p>=1e4?`${(p/1e4).toFixed(2)}万`:p.toFixed(2)+(o?.unit||"")}function I(p){return p.toLocaleString("zh-CN")}return P(async()=>{await s(),window.addEventListener("resize",()=>{b&&b.resize()})}),J(()=>{b&&(b.dispose(),b=null),window.removeEventListener("resize",()=>{b&&b.resize()})}),(p,o)=>(V(),A("div",Ge,[g("div",Qe,[g("div",We,[o[1]||(o[1]=g("label",{for:"metric-select"},"选择指标：",-1)),oe(g("select",{id:"metric-select","onUpdate:modelValue":o[0]||(o[0]=v=>i.value=v),onChange:l,class:"metric-select"},[(V(),A(Q,null,W(f,v=>g("option",{key:v.key,value:v.key},N(v.label),9,Ke)),64))],544),[[se,i.value]])]),g("div",qe,[g("button",{onClick:n,disabled:u.value,class:"refresh-btn"},[u.value?(V(),A("span",Je,"刷新中...")):(V(),A("span",Xe,"刷新数据"))],8,je),m.value?(V(),A("span",Ye," 最后更新："+N(I(m.value)),1)):re("",!0)])]),u.value?(V(),A("div",Ze,[...o[2]||(o[2]=[g("div",{class:"loading-spinner"},null,-1),g("p",null,"正在加载行业数据...",-1)])])):e.value?(V(),A("div",et,[g("div",tt,[o[3]||(o[3]=g("h3",null,"数据加载失败",-1)),g("p",null,N(e.value),1),g("button",{onClick:n,class:"retry-btn"},"重试")])])):(V(),A("div",at,[g("div",{ref_key:"treemapChart",ref:d,class:"treemap-chart"},null,512),g("div",nt,[o[9]||(o[9]=le('<div class="legend" data-v-60ed27e1><h4 data-v-60ed27e1>图例说明</h4><div class="legend-items" data-v-60ed27e1><div class="legend-item positive" data-v-60ed27e1><span class="color-box positive" data-v-60ed27e1></span><span data-v-60ed27e1>正值/上涨</span></div><div class="legend-item negative" data-v-60ed27e1><span class="color-box negative" data-v-60ed27e1></span><span data-v-60ed27e1>负值/下跌</span></div><div class="legend-item neutral" data-v-60ed27e1><span class="color-box neutral" data-v-60ed27e1></span><span data-v-60ed27e1>中性/无变化</span></div></div></div>',1)),g("div",ot,[o[8]||(o[8]=g("h4",null,"统计信息",-1)),g("div",st,[g("div",rt,[o[4]||(o[4]=g("span",{class:"stat-label"},"行业总数：",-1)),g("span",lt,N(_.value),1)]),g("div",it,[o[5]||(o[5]=g("span",{class:"stat-label"},"当前指标：",-1)),g("span",ct,N(x.value),1)]),g("div",dt,[o[6]||(o[6]=g("span",{class:"stat-label"},"最大值：",-1)),g("span",ut,N(C(r.value)),1)]),g("div",mt,[o[7]||(o[7]=g("span",{class:"stat-label"},"最小值：",-1)),g("span",pt,N(C(t.value)),1)])])])])]))]))}}),_t=$(ft,[["__scopeId","data-v-60ed27e1"]]),ht={class:"congestion-heatmap"},vt=R({__name:"CongestionHeatmap",setup(c){const u=S("turnover"),e=async a=>{u.value=a,await U(),window.dispatchEvent(new Event("resize"))};return(a,i)=>{const m=k("el-tab-pane"),d=k("el-tabs"),b=k("el-card");return V(),A("div",ht,[y(b,null,{default:F(()=>[y(d,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=f=>u.value=f),onTabChange:e},{default:F(()=>[y(m,{label:"成交金额占比分位数",name:"turnover"},{default:F(()=>[y(be)]),_:1}),y(m,{label:"行业业绩指标",name:"performance"},{default:F(()=>[y(Ee)]),_:1}),y(m,{label:"行业资金流",name:"fundflow"},{default:F(()=>[y(He)]),_:1}),y(m,{label:"行业矩形树图",name:"treemap"},{default:F(()=>[y(_t)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Ct=$(vt,[["__scopeId","data-v-96bfaee7"]]);export{Ct as default};
