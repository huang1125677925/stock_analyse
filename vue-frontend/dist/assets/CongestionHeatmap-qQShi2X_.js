import{x as Y,d as L,f as z,w as $,c as A,F as U,e as h,i as R,o as w,_ as D,a as S,z as N,D as K,y as B,G as Z,W as re,J as H,b as y,k as q,u as G,E as T,A as j,l as ee,H as le,X as ie,t as M,g as ce,V as de}from"./index-6CnVgsnb.js";import{i as te}from"./index-1yOyFXf9.js";import{a as ae,F as ue,f as me}from"./industry-fund-flow-DwayN-SW.js";import{a as pe}from"./industryApi-Bu11C9Zk.js";import fe from"./IndexRpsView-1oIoJrDe.js";import"./strategyApi-DwvlWtvp.js";const ve="/django/api/strategy";async function he(p,_){try{return(await Y.get(`${ve}/industry-turnover-percentile/`,{params:{start_date:p,end_date:_}})).data}catch(e){throw console.error("获取行业换手率分位数数据失败:",e),e}}const _e=L({__name:"DateRangeSelector",props:{modelValue:{},weekFlag:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(p){return(_,e)=>{const s=R("el-option"),o=R("el-select");return w(),z(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>_.$emit("update:modelValue",l)),onChange:e[1]||(e[1]=l=>_.$emit("change",l)),placeholder:"选择日期范围",style:{width:"150px"}},{default:$(()=>[_.weekFlag?(w(),A(U,{key:1},[h(s,{label:"最近5周",value:"5"}),h(s,{label:"最近10周",value:"10"}),h(s,{label:"最近20周",value:"20"})],64)):(w(),A(U,{key:0},[h(s,{label:"最近5天",value:"5"}),h(s,{label:"最近10天",value:"10"}),h(s,{label:"最近15天",value:"15"}),h(s,{label:"最近20天",value:"20"}),h(s,{label:"全部29天",value:"all"})],64))]),_:1},8,["model-value"])}}}),ne=D(_e,[["__scopeId","data-v-678a0eb8"]]),ge=L({__name:"HeatmapChart",props:{option:{},height:{},autoResize:{type:Boolean,default:!0}},emits:["chartReady","chartClick"],setup(p,{expose:_,emit:e}){const s=p,o=e,l=S();let f=null;const I=N(()=>{if(s.height)return s.height;const c=s.option?.yAxis;if(c&&Array.isArray(c)&&c[0]?.data){const n=c[0].data.length;return Math.max(500,n*22+120)}else if(c&&c.data){const n=c.data.length;return Math.max(500,n*22+120)}return 500}),d=()=>{l.value&&(f=te(l.value),f.on("click",c=>{o("chartClick",c)}),o("chartReady",f),g())},g=()=>{!f||!s.option||H(()=>{f&&(f.clear(),f.setOption(s.option),setTimeout(()=>{f&&f.resize()},0))})};K(()=>s.option,g,{deep:!0}),K(I,()=>{H(()=>{f&&f.resize()})});const i=()=>{f&&s.autoResize&&f.resize()};return B(()=>{d(),s.autoResize&&window.addEventListener("resize",i)}),Z(()=>{f&&(f.dispose(),f=null),s.autoResize&&window.removeEventListener("resize",i)}),_({getChart:()=>f,resize:()=>{f&&f.resize()},clear:()=>{f&&f.clear()}}),(c,n)=>(w(),A("div",{ref_key:"chartContainer",ref:l,class:"heatmap-chart",style:re({height:I.value+"px"})},null,4))}}),J=D(ge,[["__scopeId","data-v-b4aa47f4"]]),ye=L({__name:"TurnoverHeatmap",props:{industries:{},dates:{},searchKeyword:{default:""},sortMetric:{default:"amount"},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(p,{emit:_}){const e=p,s=_,o=N(()=>{let i=e.industries;return e.searchKeyword?.trim()&&(i=e.industries.filter(c=>c.name.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...i].sort((c,n)=>{if(c.data.length===0||n.data.length===0)return 0;const r=c.data[c.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"],t=n.data[n.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"];return e.sortAscending?r-t:t-r})}),l=N(()=>e.searchKeyword?.trim()?I():f()),f=()=>{const i=[];o.value.forEach((n,r)=>{n.data.forEach((t,a)=>{const u=e.sortMetric==="turnover"?t.turnoverRateFQuantile:t.amountCongestionQuantile;typeof u=="number"&&!isNaN(u)&&isFinite(u)&&i.push([a,r,u])})});const c=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{tooltip:{position:"top",formatter:function(n){const[r,t,a]=n.data,u=e.dates[r];return`${o.value[t].name}<br/>${u}<br/>${c}: ${a}`}},grid:{height:Math.max(400,o.value.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:e.dates.map(n=>n.substring(5)),splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:e.dates.map(n=>n.substring(5)),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:o.value.map(n=>n.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:o.value.map(n=>n.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:0,max:100,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:c,type:"heatmap",data:i,label:{show:!0,fontSize:9,formatter:function(n){return n.data[2]}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},I=()=>{const i=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#EA7CCC","#2f4554","#61a0a8","#d48265","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],c=t=>{let a=0;for(let u=0;u<t.length;u++)a=a*31+t.charCodeAt(u)>>>0;return i[a%i.length]},n=o.value.map(t=>{const a=c(t.name);return{name:t.name,type:"line",data:t.data.map(u=>e.sortMetric==="turnover"?u.turnoverRateFQuantile:u.amountCongestionQuantile),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:a},itemStyle:{color:a}}}),r=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{title:{text:`${e.searchKeyword} - ${r}趋势`,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:o.value.map(t=>t.name),top:"8%",type:"scroll"},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.dates.map(t=>t.substring(5)),axisLabel:{rotate:45}},yAxis:{type:"value",name:r,nameLocation:"middle",nameGap:50},series:n}},d=i=>{s("chart-ready",i)},g=i=>{const c=i?.data,[n,r,t]=c??[],a=typeof r=="number"?o.value[r]:void 0,u=typeof n=="number"?e.dates[n]:void 0;s("chart-click",{industry:a?{name:a.name}:void 0,date:u,value:t,metric:e.sortMetric??"amount",rawParams:i})};return(i,c)=>(w(),z(J,{option:l.value,onChartReady:d,onChartClick:g},null,8,["option"]))}}),xe=D(ye,[["__scopeId","data-v-5dd4a692"]]),be={class:"turnover-analysis"},Ce={class:"controls"},we={class:"chart-container"},Se=L({__name:"TurnoverAnalysis",setup(p){const _=G(),e=S("amount"),s=S("20"),o=S(!0),l=S(!1),f=S([]),I=S([]),d=async()=>{l.value=!0;try{const r=new Date,t=r.toISOString().split("T")[0],a=s.value==="all"?30:parseInt(s.value),u=new Date(r);u.setDate(r.getDate()-a);const V=u.toISOString().split("T")[0],F=await he(V,t);if(F){const x=F.data;if(!Array.isArray(x))throw console.error("API返回的数据不是数组:",x),new Error("API返回的数据格式不正确");const b=[...new Set(x.map(v=>v.date))].sort();I.value=b;const m=new Map;x.forEach(v=>{m.has(v.sector_code)||m.set(v.sector_code,{name:v.sector_name,data:[]});const k=m.get(v.sector_code),P=b.indexOf(v.date);for(;k.data.length<b.length;)k.data.push({turnoverRateFQuantile:0,amountCongestionQuantile:0});k.data[P]={turnoverRateFQuantile:v.turnover_ratio_percentile,amountCongestionQuantile:v.turnover_ratio_percentile}}),f.value=Array.from(m.values())}else T.error("获取数据失败")}catch(r){console.error("获取数据出错:",r),T.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{l.value=!1}},g=()=>{d()},i=()=>{o.value=!o.value},c=r=>{},n=r=>{console.log("Chart clicked payload:",r);const t=r?.industry?.name;t&&(_.push({path:"/stock-list",query:{industry:t}}),T.success(`正在跳转到 ${t} 行业的股票列表`))};return B(()=>{d()}),(r,t)=>{const a=R("el-button");return w(),A("div",be,[y("div",Ce,[h(ne,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=u=>s.value=u),onChange:g,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(a,{onClick:i,type:"primary"},{default:$(()=>[...t[1]||(t[1]=[q("按最后一列排序",-1)])]),_:1})]),y("div",we,[h(xe,{industries:f.value,dates:I.value,"sort-metric":e.value,"sort-ascending":o.value,onChartReady:c,onChartClick:n},null,8,["industries","dates","sort-metric","sort-ascending"])])])}}}),ke=D(Se,[["__scopeId","data-v-2ff5c927"]]),Ie="/django/api/stock";async function Ve(p,_,e,s){try{const o={};return _&&(o.report_type=_),(await Y.get(`${Ie}/industry/heatmap-data/`,{params:o})).data}catch(o){throw console.error("获取行业热力图数据失败:",o),o}}var oe=(p=>(p.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",p.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",p.TOTAL_OPERATING_REVENUE="total_operating_revenue",p.TOTAL_NET_PROFIT="total_net_profit",p.EARNINGS_PER_SHARE="avg_earnings_per_share",p.ROE="avg_roe",p.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",p.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",p.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",p))(oe||{});const se={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:p=>p.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:p=>p.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:p=>(p/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:p=>(p/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:p=>p.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:p=>p.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:p=>p.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:p=>p.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:p=>p.toFixed(2)}},Fe=L({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(p){return(_,e)=>{const s=R("el-option"),o=R("el-select");return w(),z(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>_.$emit("update:modelValue",l)),onChange:e[1]||(e[1]=l=>_.$emit("change",l)),placeholder:"选择指标",style:{width:"180px"}},{default:$(()=>[(w(!0),A(U,null,j(ee(se),(l,f)=>(w(),z(s,{key:f,label:l.name,value:f},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Ae=D(Fe,[["__scopeId","data-v-26626d73"]]),$e=L({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(p){return(_,e)=>{const s=R("el-option"),o=R("el-select");return w(),z(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>_.$emit("update:modelValue",l)),onChange:e[1]||(e[1]=l=>_.$emit("change",l)),placeholder:"选择报告类型",style:{width:"120px"}},{default:$(()=>[h(s,{label:"年报",value:"annual"}),h(s,{label:"中报",value:"semi_annual"}),h(s,{label:"一季报",value:"q1"}),h(s,{label:"三季报",value:"q3"}),h(s,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),Re=D($e,[["__scopeId","data-v-38f9ba58"]]),Le=L({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(p,{emit:_}){const e=p,s=_,o=N(()=>{if(!e.data)return[];const{swCodeNames:d,congestions:g}=e.data;let i=d;return e.searchKeyword?.trim()&&(i=d.filter(c=>c.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...i].sort((c,n)=>{const r=g[c.indexCode]||g[c.indexName],t=g[n.indexCode]||g[n.indexName];if(!r||!t||r.length===0||t.length===0)return 0;const a=r[r.length-1][e.selectedMetric],u=t[t.length-1][e.selectedMetric];return e.sortAscending?a-u:u-a})}),l=N(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:d,congestions:g}=e.data,i=o.value,c=[];let n=1/0,r=-1/0;i.forEach((a,u)=>{const V=g[a.indexCode]||g[a.indexName];V&&V.forEach((F,x)=>{const b=F[e.selectedMetric];typeof b=="number"&&!isNaN(b)&&isFinite(b)&&(c.push([x,u,b]),n=Math.min(n,b),r=Math.max(r,b))})}),(n===1/0||r===-1/0)&&(n=0,r=100);const t=se[e.selectedMetric];return{tooltip:{position:"top",formatter:function(a){const[u,V,F]=a.data,x=d[u],b=i[V].indexName,m=t.formatter?t.formatter(F):F.toFixed(2);return`${b}<br/>${x}<br/>${t.name}: ${m}${t.unit}`}},grid:{height:Math.max(400,i.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:d,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:d,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:i.map(a=>a.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:i.map(a=>a.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:n,max:r,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:t.name,type:"heatmap",data:c,label:{show:!0,fontSize:9,formatter:function(a){const u=a.data[2];return t.formatter?t.formatter(u):u.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),f=d=>{s("chart-ready",d)},I=d=>{const g=d?.data,[i,c,n]=g??[],r=typeof c=="number"?o.value[c]:void 0,t=typeof i=="number"?e.data?.dates[i]:void 0;s("chart-click",{industry:r,date:t,value:n,metric:e.selectedMetric,rawParams:d})};return(d,g)=>(w(),z(J,{option:l.value,onChartReady:f,onChartClick:I},null,8,["option"]))}}),De=D(Le,[["__scopeId","data-v-c7e44af1"]]),Ne={class:"performance-analysis"},Ee={class:"controls"},Te={class:"chart-container"},ze=L({__name:"PerformanceAnalysis",setup(p){const _=G(),e=S(oe.OPERATING_REVENUE_GROWTH),s=S("annual"),o=S(!0),l=S(!1),f=S(null),I=async()=>{l.value=!0;try{const n=await Ve(void 0,s.value,void 0,void 0);n?f.value=n:T.error("获取行业业绩数据失败")}catch(n){console.error("获取业绩数据出错:",n),T.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{l.value=!1}},d=()=>{I()},g=()=>{o.value=!o.value},i=n=>{},c=n=>{console.log("Performance chart clicked payload:",n);const r=n?.industry?.indexName||n?.industry?.indexCode;r&&(_.push({path:"/stock-list",query:{industry:r}}),T.success(`正在跳转到 ${r} 的股票列表`))};return B(()=>{I()}),(n,r)=>{const t=R("el-button");return w(),A("div",Ne,[y("div",Ee,[h(Ae,{modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=a=>e.value=a),onChange:d,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(Re,{modelValue:s.value,"onUpdate:modelValue":r[1]||(r[1]=a=>s.value=a),onChange:d,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(t,{onClick:g,type:"primary"},{default:$(()=>[...r[2]||(r[2]=[q("按最后一列排序",-1)])]),_:1})]),y("div",Te,[h(De,{data:f.value,"selected-metric":e.value,"sort-ascending":o.value,onChartReady:i,onChartClick:c},null,8,["data","selected-metric","sort-ascending"])])])}}}),Me=D(ze,[["__scopeId","data-v-1cd79c66"]]),Pe=L({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(p){return(_,e)=>{const s=R("el-option"),o=R("el-select");return w(),z(o,{"model-value":_.modelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>_.$emit("update:modelValue",l)),onChange:e[1]||(e[1]=l=>_.$emit("change",l)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:$(()=>[(w(!0),A(U,null,j(ee(ae),(l,f)=>(w(),z(s,{key:f,label:l.name,value:f},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Oe=D(Pe,[["__scopeId","data-v-d875eab1"]]),Ue=L({name:"FundFlowHeatmap",__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(p,{emit:_}){const e=p,s=_,o=N(()=>{if(!e.data)return[];const{swCodeNames:d,congestions:g}=e.data;let i=d;return e.searchKeyword?.trim()&&(i=d.filter(c=>c.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...i].sort((c,n)=>{const r=g[c.indexCode]||g[c.indexName],t=g[n.indexCode]||g[n.indexName];if(!r||!t||r.length===0||t.length===0)return 0;const a=r[r.length-1][e.selectedMetric],u=t[t.length-1][e.selectedMetric];return e.sortAscending?a-u:u-a})}),l=N(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:d,congestions:g}=e.data,i=o.value,c=[];let n=1/0,r=-1/0;i.forEach((a,u)=>{const V=g[a.indexCode]||g[a.indexName];V&&V.forEach((F,x)=>{const b=F[e.selectedMetric];if(typeof b=="number"&&!isNaN(b)&&isFinite(b)){let m=!0;(e.valueFilter==="positive"&&b<=0||e.valueFilter==="negative"&&b>=0)&&(m=!1),m&&(c.push([x,u,b]),n=Math.min(n,b),r=Math.max(r,b))}})}),(n===1/0||r===-1/0)&&(n=0,r=100);const t=ae[e.selectedMetric];return{tooltip:{position:"top",formatter:function(a){const[u,V,F]=a.data,x=d[u],b=i[V].indexName,m=t.formatter?t.formatter(F):F.toFixed(2);return`${b}<br/>${x}<br/>${t.name}: ${m}${t.unit}`}},grid:{height:Math.max(400,i.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:d,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:d,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:i.map(a=>a.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:i.map(a=>a.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:n,max:r,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:t.name,type:"heatmap",data:c,label:{show:!0,fontSize:9,formatter:function(a){const u=a.data[2];return t.formatter?t.formatter(u):u.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),f=d=>{s("chart-ready",d)},I=d=>{const g=d?.data,[i,c,n]=g??[],r=typeof c=="number"?o.value[c]:void 0,t=typeof i=="number"?e.data?.dates[i]:void 0;s("chart-click",{industry:r,date:t,value:n,metric:e.selectedMetric,rawParams:d})};return(d,g)=>(w(),z(J,{option:l.value,onChartReady:f,onChartClick:I},null,8,["option"]))}}),Be=D(Ue,[["__scopeId","data-v-f3482af5"]]),He={class:"fund-flow-analysis"},Ge={class:"controls"},We={class:"chart-container"},Qe=L({__name:"FundFlowAnalysis",setup(p){const _=G(),e=S(ue.MAIN_NET_INFLOW_AMOUNT),s=S("5"),o=S(!1),l=S("all"),f=S(!0),I=S(!1),d=S(null),g=async()=>{I.value=!0;try{const t=new Date,a=t.toISOString().split("T")[0];let u;o.value?u=(s.value==="all"?5:parseInt(s.value))*7:u=s.value==="all"?30:parseInt(s.value);const V=new Date(t);V.setDate(t.getDate()-u);const F=V.toISOString().split("T")[0],x=await me(F,a,o.value);x?d.value=x:T.error("获取行业资金流数据失败")}catch(t){console.error("获取资金流数据出错:",t),T.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{I.value=!1}},i=()=>{g()};K(o,t=>{s.value="5",i()});const c=()=>{f.value=!f.value},n=t=>{},r=t=>{console.log("Fund flow chart clicked payload:",t);const a=t?.industry?.indexName||t?.industry?.indexCode;a&&(_.push({path:"/stock-list",query:{industry:a}}),T.success(`正在跳转到 ${a} 的股票列表`))};return B(()=>{g()}),(t,a)=>{const u=R("el-option"),V=R("el-select"),F=R("el-button");return w(),A("div",He,[y("div",Ge,[h(V,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=x=>o.value=x),onChange:i,placeholder:"数据周期",style:{width:"120px","margin-right":"10px"}},{default:$(()=>[h(u,{label:"按天",value:!1}),h(u,{label:"按周",value:!0})]),_:1},8,["modelValue"]),h(Oe,{modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=x=>e.value=x),onChange:i,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(ne,{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=x=>s.value=x),"week-flag":o.value,onChange:i},null,8,["modelValue","week-flag"]),h(V,{modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=x=>l.value=x),onChange:i,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:$(()=>[h(u,{label:"全部",value:"all"}),h(u,{label:"仅正值",value:"positive"}),h(u,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),h(F,{onClick:c,type:"primary"},{default:$(()=>[...a[4]||(a[4]=[q("按最后一列排序",-1)])]),_:1})]),y("div",We,[h(Be,{data:d.value,"selected-metric":e.value,"sort-ascending":f.value,"value-filter":l.value,onChartReady:n,onChartClick:r},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),Ke=D(Qe,[["__scopeId","data-v-66206a62"]]),qe={class:"industry-treemap"},je={class:"control-panel"},Je={class:"metric-selector"},Xe=["value"],Ye={class:"refresh-controls"},Ze=["disabled"],et={key:0},tt={key:1},at={key:0,class:"update-time"},nt={key:0,class:"loading-container"},ot={key:1,class:"error-container"},st={class:"error-message"},rt={key:2,class:"treemap-container"},lt={class:"chart-info"},it={class:"statistics"},ct={class:"stats-grid"},dt={class:"stat-item"},ut={class:"stat-value"},mt={class:"stat-item"},pt={class:"stat-value"},ft={class:"stat-item"},vt={class:"stat-value"},ht={class:"stat-item"},_t={class:"stat-value"},gt=L({__name:"IndustryTreemap",setup(p){const _=G(),e=S(!1),s=S(null),o=S([]),l=S("total_market_cap_sum"),f=S(null),I=S();let d=null;const g=[{key:"total_market_cap_sum",label:"总市值",unit:"元",isPercent:!1},{key:"circulating_market_cap_sum",label:"流通市值",unit:"元",isPercent:!1},{key:"avg_change_percent",label:"平均涨跌幅",unit:"%",isPercent:!0},{key:"total_volume",label:"总成交量",unit:"手",isPercent:!1},{key:"total_amount",label:"总成交额",unit:"元",isPercent:!1},{key:"avg_turnover_rate",label:"平均换手率",unit:"%",isPercent:!0},{key:"avg_pe_ratio",label:"平均市盈率",unit:"",isPercent:!1},{key:"avg_pb_ratio",label:"平均市净率",unit:"",isPercent:!1},{key:"stock_count",label:"股票数量",unit:"只",isPercent:!1},{key:"avg_change_60d",label:"60日平均涨跌幅",unit:"%",isPercent:!0},{key:"avg_change_ytd",label:"年初至今平均涨跌幅",unit:"%",isPercent:!0}],i=N(()=>g.find(v=>v.key===l.value)?.label||""),c=N(()=>o.value?.length||0),n=N(()=>!o.value||o.value.length===0?0:Math.max(...o.value.map(m=>m[l.value]))),r=N(()=>!o.value||o.value.length===0?0:Math.min(...o.value.map(m=>m[l.value])));async function t(){try{e.value=!0,s.value=null,console.log("开始加载行业数据...");const m=await pe();console.log("API响应数据:",m),o.value=m.industries||[],console.log("设置industryData:",o.value),console.log("数据条数:",o.value?.length||0),f.value=new Date}catch(m){s.value=m instanceof Error?m.message:"加载数据失败",console.error("Failed to load industry data:",m)}finally{e.value=!1,await H(),console.log("DOM更新完成，开始更新树图"),V()}}async function a(){await t()}function u(m){const v=m.data.name;console.log("点击行业:",v),_.push({path:"/stock-list",query:{industry:v}})}function V(){if(console.log("updateTreemap被调用"),console.log("treemapChart.value:",I.value),console.log("industryData.value:",o.value),console.log("industryData长度:",o.value?.length||0),!I.value){console.error("treemapChart容器未找到");return}if(!o.value||o.value.length===0){console.error("industryData为空或未定义");return}d||(console.log("初始化ECharts实例"),d=te(I.value));const m=g.find(C=>C.key===l.value);console.log("当前选择的指标:",m);const v=o.value.map(C=>{const E=C[l.value],O=typeof E=="number"?E:Number(E),W=Number.isNaN(O)?0:O,Q=typeof C.stock_count=="number"&&C.stock_count>0?C.stock_count:1;return{industry:C.industry,originalValue:W,stockCount:Q}});console.log("baseData处理结果:",v.slice(0,3));let k=v.map(C=>({name:C.industry,value:Math.abs(C.originalValue),originalValue:C.originalValue,itemStyle:{color:F(C.originalValue,m?.isPercent||!1)}}));console.log("初始treemapData:",k.slice(0,3));const P=k.reduce((C,E)=>C+E.value,0);if(console.log("总面积:",P),P<=0&&(console.log("所有值为0，使用股票数量作为回退"),k=v.map(C=>({name:C.industry,value:C.stockCount,originalValue:C.originalValue,itemStyle:{color:F(C.originalValue,m?.isPercent||!1)}}))),k=k.filter(C=>C.value>0),console.log("过滤后的treemapData长度:",k.length),console.log("最终treemapData:",k.slice(0,3)),k.length===0){console.error("treemapData为空，无法渲染图表");return}const X={title:{text:`行业${i.value}分布`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:C=>{const E=C.data,O=k.reduce((W,Q)=>W+Q.value,0);return`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 4px;">${E.name}</div>
            <div>${i.value}: ${x(E.originalValue)}</div>
            <div>占比: ${O>0?(E.value/O*100).toFixed(2):"0.00"}%</div>
            <div style="color: #999; font-size: 12px; margin-top: 4px;">点击查看该行业股票列表</div>
          </div>
        `}},series:[{type:"treemap",data:k,roam:!1,nodeClick:!0,breadcrumb:{show:!1},label:{show:!0,formatter:C=>`${C.name}
${x(C.data.originalValue)}`,fontSize:12,color:"#fff",fontWeight:"bold"},itemStyle:{borderColor:"#fff",borderWidth:2,gapWidth:2},emphasis:{itemStyle:{borderColor:"#333",borderWidth:3},label:{fontSize:14}}}]};console.log("设置ECharts选项:",X),d.setOption(X),d.off("click"),d.on("click",u),console.log("ECharts选项设置完成")}function F(m,v){if(v)return m>0?"#52c41a":m<0?"#ff4d4f":"#d9d9d9";{const k=["#1890ff","#13c2c2","#52c41a","#faad14","#f759ab","#722ed1","#fa541c","#eb2f96"],P=Math.abs(m.toString().charCodeAt(0))%k.length;return k[P]}}function x(m){const v=g.find(k=>k.key===l.value);return v?.isPercent?`${m.toFixed(2)}%`:v?.unit==="元"?m>=1e12?`${(m/1e12).toFixed(2)}万亿`:m>=1e8?`${(m/1e8).toFixed(2)}亿`:m>=1e4?`${(m/1e4).toFixed(2)}万`:m.toFixed(2):m>=1e8?`${(m/1e8).toFixed(2)}亿`:m>=1e4?`${(m/1e4).toFixed(2)}万`:m.toFixed(2)+(v?.unit||"")}function b(m){return m.toLocaleString("zh-CN")}return B(async()=>{await t(),window.addEventListener("resize",()=>{d&&d.resize()})}),Z(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",()=>{d&&d.resize()})}),(m,v)=>(w(),A("div",qe,[y("div",je,[y("div",Je,[v[1]||(v[1]=y("label",{for:"metric-select"},"选择指标：",-1)),le(y("select",{id:"metric-select","onUpdate:modelValue":v[0]||(v[0]=k=>l.value=k),onChange:V,class:"metric-select"},[(w(),A(U,null,j(g,k=>y("option",{key:k.key,value:k.key},M(k.label),9,Xe)),64))],544),[[ie,l.value]])]),y("div",Ye,[y("button",{onClick:a,disabled:e.value,class:"refresh-btn"},[e.value?(w(),A("span",et,"刷新中...")):(w(),A("span",tt,"刷新数据"))],8,Ze),f.value?(w(),A("span",at," 最后更新："+M(b(f.value)),1)):ce("",!0)])]),e.value?(w(),A("div",nt,[...v[2]||(v[2]=[y("div",{class:"loading-spinner"},null,-1),y("p",null,"正在加载行业数据...",-1)])])):s.value?(w(),A("div",ot,[y("div",st,[v[3]||(v[3]=y("h3",null,"数据加载失败",-1)),y("p",null,M(s.value),1),y("button",{onClick:a,class:"retry-btn"},"重试")])])):(w(),A("div",rt,[y("div",{ref_key:"treemapChart",ref:I,class:"treemap-chart"},null,512),y("div",lt,[v[9]||(v[9]=de('<div class="legend" data-v-fef80d80><h4 data-v-fef80d80>图例说明</h4><div class="legend-items" data-v-fef80d80><div class="legend-item positive" data-v-fef80d80><span class="color-box positive" data-v-fef80d80></span><span data-v-fef80d80>正值/上涨</span></div><div class="legend-item negative" data-v-fef80d80><span class="color-box negative" data-v-fef80d80></span><span data-v-fef80d80>负值/下跌</span></div><div class="legend-item neutral" data-v-fef80d80><span class="color-box neutral" data-v-fef80d80></span><span data-v-fef80d80>中性/无变化</span></div></div></div>',1)),y("div",it,[v[8]||(v[8]=y("h4",null,"统计信息",-1)),y("div",ct,[y("div",dt,[v[4]||(v[4]=y("span",{class:"stat-label"},"行业总数：",-1)),y("span",ut,M(c.value),1)]),y("div",mt,[v[5]||(v[5]=y("span",{class:"stat-label"},"当前指标：",-1)),y("span",pt,M(i.value),1)]),y("div",ft,[v[6]||(v[6]=y("span",{class:"stat-label"},"最大值：",-1)),y("span",vt,M(x(n.value)),1)]),y("div",ht,[v[7]||(v[7]=y("span",{class:"stat-label"},"最小值：",-1)),y("span",_t,M(x(r.value)),1)])])])])]))]))}}),yt=D(gt,[["__scopeId","data-v-fef80d80"]]),xt={class:"congestion-heatmap"},bt=L({__name:"CongestionHeatmap",setup(p){const _=S("turnover"),e=async s=>{_.value=s,await H(),window.dispatchEvent(new Event("resize"))};return(s,o)=>{const l=R("el-tab-pane"),f=R("el-tabs"),I=R("el-card");return w(),A("div",xt,[h(I,null,{default:$(()=>[h(f,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=d=>_.value=d),onTabChange:e},{default:$(()=>[h(l,{label:"成交金额占比分位数",name:"turnover"},{default:$(()=>[h(ke)]),_:1}),h(l,{label:"行业业绩指标",name:"performance"},{default:$(()=>[h(Me)]),_:1}),h(l,{label:"行业资金流",name:"fundflow"},{default:$(()=>[h(Ke)]),_:1}),h(l,{label:"行业矩形树图",name:"treemap"},{default:$(()=>[h(yt)]),_:1}),h(l,{label:"指数RPS强度排名",name:"indexrps"},{default:$(()=>[h(fe)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Ft=D(bt,[["__scopeId","data-v-d267c18b"]]);export{Ft as default};
