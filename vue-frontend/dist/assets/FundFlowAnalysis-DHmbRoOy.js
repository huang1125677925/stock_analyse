import{d as D,f as N,w as S,c as z,F as R,A as B,i as C,l as E,o as b,_ as L,z as k,a as F,B as U,y as W,b as T,e as v,k as O,u as H,E as V}from"./index-D8Wty6Yi.js";import{a as $,F as K,f as P}from"./industry-fund-flow-gp_xf3Wi.js";import{D as q}from"./DateRangeSelector-uYTFkG-B.js";import"./index-ElshY9iF.js";import{H as j}from"./HeatmapChart-DanAI2Ve.js";const G=D({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(I){return(g,a)=>{const x=C("el-option"),h=C("el-select");return b(),N(h,{"model-value":g.modelValue,"onUpdate:modelValue":a[0]||(a[0]=u=>g.$emit("update:modelValue",u)),onChange:a[1]||(a[1]=u=>g.$emit("change",u)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:S(()=>[(b(!0),z(R,null,B(E($),(u,w)=>(b(),N(x,{key:w,label:u.name,value:w},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),J=L(G,[["__scopeId","data-v-d875eab1"]]),Q=D({name:"FundFlowHeatmap",__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(I,{emit:g}){const a=I,x=g,h=k(()=>{if(!a.data)return[];const{swCodeNames:i,congestions:m}=a.data;let f=i;return a.searchKeyword?.trim()&&(f=i.filter(p=>p.indexName.toLowerCase().includes(a.searchKeyword.toLowerCase()))),[...f].sort((p,s)=>{const c=m[p.indexCode]||m[p.indexName],r=m[s.indexCode]||m[s.indexName];if(!c||!r||c.length===0||r.length===0)return 0;const d=c[c.length-1][a.selectedMetric],e=r[r.length-1][a.selectedMetric];return a.sortAscending?d-e:e-d})}),u=k(()=>{if(!a.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:i,congestions:m}=a.data,f=h.value,p=[];let s=1/0,c=-1/0;f.forEach((d,e)=>{const t=m[d.indexCode]||m[d.indexName];t&&t.forEach((l,y)=>{const n=l[a.selectedMetric];if(typeof n=="number"&&!isNaN(n)&&isFinite(n)){let o=!0;(a.valueFilter==="positive"&&n<=0||a.valueFilter==="negative"&&n>=0)&&(o=!1),o&&(p.push([y,e,n]),s=Math.min(s,n),c=Math.max(c,n))}})}),(s===1/0||c===-1/0)&&(s=0,c=100);const r=$[a.selectedMetric];return{tooltip:{position:"top",formatter:function(d){const[e,t,l]=d.data,y=i[e],n=f[t].indexName,o=r.formatter?r.formatter(l):l.toFixed(2);return`${n}<br/>${y}<br/>${r.name}: ${o}${r.unit}`}},grid:{height:Math.max(400,f.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:i,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:i,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:f.map(d=>d.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:f.map(d=>d.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:s,max:c,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:r.name,type:"heatmap",data:p,label:{show:!0,fontSize:9,formatter:function(d){const e=d.data[2];return r.formatter?r.formatter(e):e.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),w=i=>{x("chart-ready",i)},_=i=>{const m=i?.data,[f,p,s]=m??[],c=typeof p=="number"?h.value[p]:void 0,r=typeof f=="number"?a.data?.dates[f]:void 0;x("chart-click",{industry:c,date:r,value:s,metric:a.selectedMetric,rawParams:i})};return(i,m)=>(b(),N(j,{option:u.value,onChartReady:w,onChartClick:_},null,8,["option"]))}}),X=L(Q,[["__scopeId","data-v-f3482af5"]]),Y={class:"fund-flow-analysis"},Z={class:"controls"},ee={class:"chart-container"},te=D({__name:"FundFlowAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(I){const g=I,a=H(),x=F(K.MAIN_NET_INFLOW_AMOUNT),h=F("5"),u=F(!1),w=F("all"),_=F(!0),i=F(!1),m=F(null),f=k(()=>{const e=m.value;if(!e)return null;if(!g.industryWhitelist||g.industryWhitelist.length===0)return e;const t=new Set(g.industryWhitelist.map(n=>n.trim().toLowerCase())),l=e.swCodeNames.filter(n=>t.has(n.indexName.trim().toLowerCase())),y={};return l.forEach(n=>{const o=n.indexCode,M=n.indexName,A=e.congestions[o]||e.congestions[M];A&&(y[o]=A)}),{dates:e.dates,swCodeNames:l,congestions:y}}),p=async()=>{i.value=!0;try{const e=new Date,t=e.toISOString().split("T")[0];let l;u.value?l=(h.value==="all"?5:parseInt(h.value))*7:l=h.value==="all"?30:parseInt(h.value);const y=new Date(e);y.setDate(e.getDate()-l);const n=y.toISOString().split("T")[0],o=await P(n,t,u.value);o?m.value=o:V.error("获取行业资金流数据失败")}catch(e){console.error("获取资金流数据出错:",e),V.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{i.value=!1}},s=()=>{p()};U(u,e=>{h.value="5",s()});const c=()=>{_.value=!_.value},r=e=>{},d=e=>{console.log("Fund flow chart clicked payload:",e);const t=e?.industry?.indexName||e?.industry?.indexCode;t&&(a.push({path:"/stock-list",query:{industry:t}}),V.success(`正在跳转到 ${t} 的股票列表`))};return W(()=>{p()}),(e,t)=>{const l=C("el-option"),y=C("el-select"),n=C("el-button");return b(),z("div",Y,[T("div",Z,[v(y,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),onChange:s,placeholder:"数据周期",style:{width:"120px","margin-right":"10px"}},{default:S(()=>[v(l,{label:"按天",value:!1}),v(l,{label:"按周",value:!0})]),_:1},8,["modelValue"]),v(J,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=o=>x.value=o),onChange:s,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(q,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=o=>h.value=o),"week-flag":u.value,onChange:s},null,8,["modelValue","week-flag"]),v(y,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=o=>w.value=o),onChange:s,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:S(()=>[v(l,{label:"全部",value:"all"}),v(l,{label:"仅正值",value:"positive"}),v(l,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),v(n,{onClick:c,type:"primary"},{default:S(()=>[...t[4]||(t[4]=[O("按最后一列排序",-1)])]),_:1})]),T("div",ee,[v(X,{data:f.value,"selected-metric":x.value,"sort-ascending":_.value,"value-filter":w.value,onChartReady:r,onChartClick:d},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),re=L(te,[["__scopeId","data-v-2688a7ce"]]);export{re as F};
