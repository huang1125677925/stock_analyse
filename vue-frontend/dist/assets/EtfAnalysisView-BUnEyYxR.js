import{i as u}from"./index-ElshY9iF.js";import{g as V}from"./etfApi-CUoMHvdn.js";import{d as F,a as c,y as N,C as W,c as T,b as r,D as G,e as l,w as s,i as C,G as H,E as I,H as U,k as X,o as M,_ as Z}from"./index-yvE1imiI.js";const j={class:"etf-analysis-view"},q={class:"page-header"},J={class:"charts-container"},K=F({__name:"EtfAnalysisView",setup(Q){const x=c(!1),w=c([]),D=c(),E=c(),A=c(),R=c(),k=c(),z=c();let f=null,h=null,m=null,v=null,g=null,y=null;const L=async()=>{x.value=!0;try{const n=await V({page:1,page_size:1e4});n.data&&(w.value=n.data,P())}catch(n){I.error(n?.message||"获取数据失败")}finally{x.value=!1}},b=n=>{const e=new Map;return w.value.forEach(o=>{const a=String(o[n]||"未知");e.set(a,(e.get(a)||0)+1)}),Array.from(e.entries()).map(([o,a])=>({name:o,value:a})).sort((o,a)=>a.value-o.value)},B=n=>{const e=new Map;return w.value.forEach(o=>{const a=String(o[n]||"");if(a&&a.length>=6){const i=a.substring(0,6);e.set(i,(e.get(i)||0)+1)}}),Array.from(e.entries()).map(([o,a])=>({name:o,value:a})).sort((o,a)=>o.name.localeCompare(a.name))},P=async()=>{await U(),!f&&D.value&&(f=u(D.value)),!h&&E.value&&(h=u(E.value)),!m&&A.value&&(m=u(A.value)),!v&&R.value&&(v=u(R.value)),!g&&k.value&&(g=u(k.value)),!y&&z.value&&(y=u(z.value));const n=b("exchange");f?.setOption({tooltip:{trigger:"item"},legend:{bottom:"5%",left:"center"},series:[{name:"交易所",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:20,fontWeight:"bold"}},data:n}]});const e={L:"上市",D:"退市",P:"暂停"},o=b("list_status").map(t=>({...t,name:e[t.name]||t.name}));h?.setOption({tooltip:{trigger:"item"},legend:{bottom:"5%",left:"center"},series:[{name:"状态",type:"pie",radius:"50%",data:o,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});const a=B("list_date");m?.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",data:a.map(t=>t.name)},yAxis:{type:"value"},dataZoom:[{type:"inside"},{type:"slider",bottom:0}],series:[{name:"上市数量",type:"line",smooth:!0,data:a.map(t=>t.value),itemStyle:{color:"#EE6666"},areaStyle:{opacity:.3}}]});const i=b("etf_type");v?.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:i.map(t=>t.name),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value"},series:[{name:"数量",type:"bar",data:i.map(t=>t.value),itemStyle:{color:"#5470C6"}}]});const d=b("mgr_name").slice(0,20);g?.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:d.map(t=>t.name),axisLabel:{interval:0,rotate:45}},yAxis:{type:"value"},series:[{name:"管理基金数量",type:"bar",data:d.map(t=>t.value),itemStyle:{color:"#91CC75"}}]});const _=new Map;w.value.forEach(t=>{const p=t.index_name||t.index_code||"未知";_.set(p,(_.get(p)||0)+1)});const O=Array.from(_.entries()).map(([t,p])=>({name:t,value:p})).sort((t,p)=>p.value-t.value).slice(0,20);y?.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:O.map(t=>t.name),axisLabel:{interval:0,rotate:45,width:100,overflow:"truncate"}},yAxis:{type:"value"},series:[{name:"跟踪基金数量",type:"bar",data:O.map(t=>t.value),itemStyle:{color:"#FAC858"}}]})},S=()=>{f?.resize(),h?.resize(),m?.resize(),v?.resize(),g?.resize(),y?.resize()};return N(()=>{L(),window.addEventListener("resize",S)}),W(()=>{window.removeEventListener("resize",S),f?.dispose(),h?.dispose(),m?.dispose(),v?.dispose(),g?.dispose(),y?.dispose()}),(n,e)=>{const o=C("el-button"),a=C("el-card"),i=C("el-col"),d=C("el-row"),_=H("loading");return M(),T("div",j,[r("div",q,[e[1]||(e[1]=r("h2",null,"ETF 数据统计分析",-1)),l(o,{type:"primary",loading:x.value,onClick:L},{default:s(()=>[...e[0]||(e[0]=[X("刷新数据",-1)])]),_:1},8,["loading"])]),G((M(),T("div",J,[l(d,{gutter:20},{default:s(()=>[l(i,{span:12},{default:s(()=>[l(a,{shadow:"hover",class:"chart-card"},{header:s(()=>[...e[2]||(e[2]=[r("div",{class:"card-header"},[r("span",null,"交易所分布")],-1)])]),default:s(()=>[r("div",{ref_key:"exchangeChartRef",ref:D,class:"chart"},null,512)]),_:1})]),_:1}),l(i,{span:12},{default:s(()=>[l(a,{shadow:"hover",class:"chart-card"},{header:s(()=>[...e[3]||(e[3]=[r("div",{class:"card-header"},[r("span",null,"上市状态分布")],-1)])]),default:s(()=>[r("div",{ref_key:"statusChartRef",ref:E,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),l(d,{gutter:20,class:"mt-20"},{default:s(()=>[l(i,{span:24},{default:s(()=>[l(a,{shadow:"hover",class:"chart-card"},{header:s(()=>[...e[4]||(e[4]=[r("div",{class:"card-header"},[r("span",null,"上市数量趋势 (按月)")],-1)])]),default:s(()=>[r("div",{ref_key:"listDateChartRef",ref:A,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),l(d,{gutter:20,class:"mt-20"},{default:s(()=>[l(i,{span:24},{default:s(()=>[l(a,{shadow:"hover",class:"chart-card"},{header:s(()=>[...e[5]||(e[5]=[r("div",{class:"card-header"},[r("span",null,"ETF类型分布")],-1)])]),default:s(()=>[r("div",{ref_key:"typeChartRef",ref:R,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),l(d,{gutter:20,class:"mt-20"},{default:s(()=>[l(i,{span:24},{default:s(()=>[l(a,{shadow:"hover",class:"chart-card"},{header:s(()=>[...e[6]||(e[6]=[r("div",{class:"card-header"},[r("span",null,"基金管理人分布 (Top 20)")],-1)])]),default:s(()=>[r("div",{ref_key:"mgrChartRef",ref:k,class:"chart",style:{height:"500px"}},null,512)]),_:1})]),_:1})]),_:1}),l(d,{gutter:20,class:"mt-20"},{default:s(()=>[l(i,{span:24},{default:s(()=>[l(a,{shadow:"hover",class:"chart-card"},{header:s(()=>[...e[7]||(e[7]=[r("div",{class:"card-header"},[r("span",null,"跟踪指数分布 (Top 20)")],-1)])]),default:s(()=>[r("div",{ref_key:"indexChartRef",ref:z,class:"chart",style:{height:"500px"}},null,512)]),_:1})]),_:1})]),_:1})])),[[_,x.value]])])}}}),te=Z(K,[["__scopeId","data-v-fd2350ba"]]);export{te as default};
