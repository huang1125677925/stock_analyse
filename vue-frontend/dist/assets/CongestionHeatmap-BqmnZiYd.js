import{M as Z,d as M,f as P,w as $,c as L,F as B,e as h,i as A,o as F,_ as T,x as D,a as k,A as Q,b as g,k as q,u as H,E,y as Y,l as ee,z as X,B as ie,C as de,W as ue,t as W,g as ce,U as me,G as te,X as fe}from"./index-q6z-zJYt.js";import{i as pe}from"./index-1yOyFXf9.js";import{H as J}from"./HeatmapChart-vDrEXQBu.js";import{a as ae,F as ve,f as he}from"./industry-fund-flow-BTPn9267.js";import{a as _e}from"./industryApi-B73f5c3a.js";import ye from"./IndexRpsView-rxqum6GH.js";import{g as ge}from"./personalHoldingsApi-Cczc5vP_.js";import"./strategyApi-9SwQke93.js";const be="/django/api/strategy";async function xe(c,p){try{return(await Z.get(`${be}/industry-turnover-percentile/`,{params:{start_date:c,end_date:p}})).data}catch(e){throw console.error("获取行业换手率分位数数据失败:",e),e}}const we=M({__name:"DateRangeSelector",props:{modelValue:{},weekFlag:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(c){return(p,e)=>{const r=A("el-option"),d=A("el-select");return F(),P(d,{"model-value":p.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>p.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>p.$emit("change",m)),placeholder:"选择日期范围",style:{width:"150px"}},{default:$(()=>[p.weekFlag?(F(),L(B,{key:1},[h(r,{label:"最近5周",value:"5"}),h(r,{label:"最近10周",value:"10"}),h(r,{label:"最近20周",value:"20"})],64)):(F(),L(B,{key:0},[h(r,{label:"最近5天",value:"5"}),h(r,{label:"最近10天",value:"10"}),h(r,{label:"最近15天",value:"15"}),h(r,{label:"最近20天",value:"20"}),h(r,{label:"全部29天",value:"all"})],64))]),_:1},8,["model-value"])}}}),ne=T(we,[["__scopeId","data-v-678a0eb8"]]),Ce=M({__name:"TurnoverHeatmap",props:{industries:{},dates:{},searchKeyword:{default:""},sortMetric:{default:"amount"},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(c,{emit:p}){const e=c,r=p,d=D(()=>{let s=e.industries;return e.searchKeyword?.trim()&&(s=e.industries.filter(v=>v.name.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...s].sort((v,o)=>{if(v.data.length===0||o.data.length===0)return 0;const f=v.data[v.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"],a=o.data[o.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"];return e.sortAscending?f-a:a-f})}),m=D(()=>e.searchKeyword?.trim()?S():w()),w=()=>{const s=[];d.value.forEach((o,f)=>{o.data.forEach((a,n)=>{const t=e.sortMetric==="turnover"?a.turnoverRateFQuantile:a.amountCongestionQuantile;typeof t=="number"&&!isNaN(t)&&isFinite(t)&&s.push([n,f,t])})});const v=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{tooltip:{position:"top",formatter:function(o){const[f,a,n]=o.data,t=e.dates[f];return`${d.value[a].name}<br/>${t}<br/>${v}: ${n}`}},grid:{height:Math.max(400,d.value.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:e.dates.map(o=>o.substring(5)),splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:e.dates.map(o=>o.substring(5)),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:d.value.map(o=>o.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:d.value.map(o=>o.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:0,max:100,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:v,type:"heatmap",data:s,label:{show:!0,fontSize:9,formatter:function(o){return o.data[2]}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},S=()=>{const s=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#EA7CCC","#2f4554","#61a0a8","#d48265","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],v=a=>{let n=0;for(let t=0;t<a.length;t++)n=n*31+a.charCodeAt(t)>>>0;return s[n%s.length]},o=d.value.map(a=>{const n=v(a.name);return{name:a.name,type:"line",data:a.data.map(t=>e.sortMetric==="turnover"?t.turnoverRateFQuantile:t.amountCongestionQuantile),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:n},itemStyle:{color:n}}}),f=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{title:{text:`${e.searchKeyword} - ${f}趋势`,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:d.value.map(a=>a.name),top:"8%",type:"scroll"},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.dates.map(a=>a.substring(5)),axisLabel:{rotate:45}},yAxis:{type:"value",name:f,nameLocation:"middle",nameGap:50},series:o}},l=s=>{r("chart-ready",s)},u=s=>{const v=s?.data,[o,f,a]=v??[],n=typeof f=="number"?d.value[f]:void 0,t=typeof o=="number"?e.dates[o]:void 0;r("chart-click",{industry:n?{name:n.name}:void 0,date:t,value:a,metric:e.sortMetric??"amount",rawParams:s})};return(s,v)=>(F(),P(J,{option:m.value,onChartReady:l,onChartClick:u},null,8,["option"]))}}),Se=T(Ce,[["__scopeId","data-v-5dd4a692"]]),ke={class:"turnover-analysis"},Ie={class:"controls"},Fe={class:"chart-container"},Ve=M({__name:"TurnoverAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(c){const p=c,e=H(),r=k("amount"),d=k("20"),m=k(!0),w=k(!1),S=k([]),l=k([]),u=D(()=>{if(!p.industryWhitelist||p.industryWhitelist.length===0)return S.value;const n=new Set(p.industryWhitelist.map(t=>t.trim().toLowerCase()));return S.value.filter(t=>n.has(t.name.trim().toLowerCase()))}),s=async()=>{w.value=!0;try{const n=new Date,t=n.toISOString().split("T")[0],_=d.value==="all"?30:parseInt(d.value),x=new Date(n);x.setDate(n.getDate()-_);const I=x.toISOString().split("T")[0],b=await xe(I,t);if(b){const C=b.data;if(!Array.isArray(C))throw console.error("API返回的数据不是数组:",C),new Error("API返回的数据格式不正确");const z=[...new Set(C.map(i=>i.date))].sort();l.value=z;const y=new Map;C.forEach(i=>{y.has(i.sector_code)||y.set(i.sector_code,{name:i.sector_name,data:[]});const V=y.get(i.sector_code),R=z.indexOf(i.date);for(;V.data.length<z.length;)V.data.push({turnoverRateFQuantile:0,amountCongestionQuantile:0});V.data[R]={turnoverRateFQuantile:i.turnover_ratio_percentile,amountCongestionQuantile:i.turnover_ratio_percentile}}),S.value=Array.from(y.values())}else E.error("获取数据失败")}catch(n){console.error("获取数据出错:",n),E.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{w.value=!1}},v=()=>{s()},o=()=>{m.value=!m.value},f=n=>{},a=n=>{console.log("Chart clicked payload:",n);const t=n?.industry?.name;t&&(e.push({path:"/stock-list",query:{industry:t}}),E.success(`正在跳转到 ${t} 行业的股票列表`))};return Q(()=>{s()}),(n,t)=>{const _=A("el-button");return F(),L("div",ke,[g("div",Ie,[h(ne,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=x=>d.value=x),onChange:v,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(_,{onClick:o,type:"primary"},{default:$(()=>[...t[1]||(t[1]=[q("按最后一列排序",-1)])]),_:1})]),g("div",Fe,[h(Se,{industries:u.value,dates:l.value,"sort-metric":r.value,"sort-ascending":m.value,onChartReady:f,onChartClick:a},null,8,["industries","dates","sort-metric","sort-ascending"])])])}}}),Ne=T(Ve,[["__scopeId","data-v-4533d3ae"]]),$e="/django/api/stock";async function Ae(c,p,e,r){try{const d={};return p&&(d.report_type=p),(await Z.get(`${$e}/industry/heatmap-data/`,{params:d})).data}catch(d){throw console.error("获取行业热力图数据失败:",d),d}}var oe=(c=>(c.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",c.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",c.TOTAL_OPERATING_REVENUE="total_operating_revenue",c.TOTAL_NET_PROFIT="total_net_profit",c.EARNINGS_PER_SHARE="avg_earnings_per_share",c.ROE="avg_roe",c.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",c.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",c.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",c))(oe||{});const se={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:c=>c.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:c=>c.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:c=>(c/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:c=>(c/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:c=>c.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:c=>c.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:c=>c.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:c=>c.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:c=>c.toFixed(2)}},Le=M({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(p,e)=>{const r=A("el-option"),d=A("el-select");return F(),P(d,{"model-value":p.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>p.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>p.$emit("change",m)),placeholder:"选择指标",style:{width:"180px"}},{default:$(()=>[(F(!0),L(B,null,Y(ee(se),(m,w)=>(F(),P(r,{key:w,label:m.name,value:w},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),De=T(Le,[["__scopeId","data-v-26626d73"]]),Ee=M({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(p,e)=>{const r=A("el-option"),d=A("el-select");return F(),P(d,{"model-value":p.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>p.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>p.$emit("change",m)),placeholder:"选择报告类型",style:{width:"120px"}},{default:$(()=>[h(r,{label:"年报",value:"annual"}),h(r,{label:"中报",value:"semi_annual"}),h(r,{label:"一季报",value:"q1"}),h(r,{label:"三季报",value:"q3"}),h(r,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),Re=T(Ee,[["__scopeId","data-v-38f9ba58"]]),Me=M({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(c,{emit:p}){const e=c,r=p,d=D(()=>{if(!e.data)return[];const{swCodeNames:l,congestions:u}=e.data;let s=l;return e.searchKeyword?.trim()&&(s=l.filter(v=>v.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...s].sort((v,o)=>{const f=u[v.indexCode]||u[v.indexName],a=u[o.indexCode]||u[o.indexName];if(!f||!a||f.length===0||a.length===0)return 0;const n=f[f.length-1][e.selectedMetric],t=a[a.length-1][e.selectedMetric];return e.sortAscending?n-t:t-n})}),m=D(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:l,congestions:u}=e.data,s=d.value,v=[];let o=1/0,f=-1/0;s.forEach((n,t)=>{const _=u[n.indexCode]||u[n.indexName];_&&_.forEach((x,I)=>{const b=x[e.selectedMetric];typeof b=="number"&&!isNaN(b)&&isFinite(b)&&(v.push([I,t,b]),o=Math.min(o,b),f=Math.max(f,b))})}),(o===1/0||f===-1/0)&&(o=0,f=100);const a=se[e.selectedMetric];return{tooltip:{position:"top",formatter:function(n){const[t,_,x]=n.data,I=l[t],b=s[_].indexName,C=a.formatter?a.formatter(x):x.toFixed(2);return`${b}<br/>${I}<br/>${a.name}: ${C}${a.unit}`}},grid:{height:Math.max(400,s.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:l,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:l,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:s.map(n=>n.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:s.map(n=>n.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:o,max:f,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a.name,type:"heatmap",data:v,label:{show:!0,fontSize:9,formatter:function(n){const t=n.data[2];return a.formatter?a.formatter(t):t.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),w=l=>{r("chart-ready",l)},S=l=>{const u=l?.data,[s,v,o]=u??[],f=typeof v=="number"?d.value[v]:void 0,a=typeof s=="number"?e.data?.dates[s]:void 0;r("chart-click",{industry:f,date:a,value:o,metric:e.selectedMetric,rawParams:l})};return(l,u)=>(F(),P(J,{option:m.value,onChartReady:w,onChartClick:S},null,8,["option"]))}}),Te=T(Me,[["__scopeId","data-v-c7e44af1"]]),Pe={class:"performance-analysis"},ze={class:"controls"},Oe={class:"chart-container"},We=M({__name:"PerformanceAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(c){const p=c,e=H(),r=k(oe.OPERATING_REVENUE_GROWTH),d=k("annual"),m=k(!0),w=k(!1),S=k(null),l=D(()=>{const a=S.value;if(!a)return null;if(!p.industryWhitelist||p.industryWhitelist.length===0)return a;const n=new Set(p.industryWhitelist.map(x=>x.trim().toLowerCase())),t=a.swCodeNames.filter(x=>n.has(x.indexName.trim().toLowerCase())),_={};return t.forEach(x=>{const I=x.indexCode,b=x.indexName,C=a.congestions[I]||a.congestions[b];C&&(_[I]=C)}),{dates:a.dates,swCodeNames:t,congestions:_}}),u=async()=>{w.value=!0;try{const a=await Ae(void 0,d.value,void 0,void 0);a?S.value=a:E.error("获取行业业绩数据失败")}catch(a){console.error("获取业绩数据出错:",a),E.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{w.value=!1}},s=()=>{u()},v=()=>{m.value=!m.value},o=a=>{},f=a=>{console.log("Performance chart clicked payload:",a);const n=a?.industry?.indexName||a?.industry?.indexCode;n&&(e.push({path:"/stock-list",query:{industry:n}}),E.success(`正在跳转到 ${n} 的股票列表`))};return Q(()=>{u()}),(a,n)=>{const t=A("el-button");return F(),L("div",Pe,[g("div",ze,[h(De,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=_=>r.value=_),onChange:s,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(Re,{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=_=>d.value=_),onChange:s,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(t,{onClick:v,type:"primary"},{default:$(()=>[...n[2]||(n[2]=[q("按最后一列排序",-1)])]),_:1})]),g("div",Oe,[h(Te,{data:l.value,"selected-metric":r.value,"sort-ascending":m.value,onChartReady:o,onChartClick:f},null,8,["data","selected-metric","sort-ascending"])])])}}}),Ue=T(We,[["__scopeId","data-v-a8d2dea3"]]),Be=M({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(p,e)=>{const r=A("el-option"),d=A("el-select");return F(),P(d,{"model-value":p.modelValue,"onUpdate:modelValue":e[0]||(e[0]=m=>p.$emit("update:modelValue",m)),onChange:e[1]||(e[1]=m=>p.$emit("change",m)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:$(()=>[(F(!0),L(B,null,Y(ee(ae),(m,w)=>(F(),P(r,{key:w,label:m.name,value:w},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),He=T(Be,[["__scopeId","data-v-d875eab1"]]),Ke=M({name:"FundFlowHeatmap",__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(c,{emit:p}){const e=c,r=p,d=D(()=>{if(!e.data)return[];const{swCodeNames:l,congestions:u}=e.data;let s=l;return e.searchKeyword?.trim()&&(s=l.filter(v=>v.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[...s].sort((v,o)=>{const f=u[v.indexCode]||u[v.indexName],a=u[o.indexCode]||u[o.indexName];if(!f||!a||f.length===0||a.length===0)return 0;const n=f[f.length-1][e.selectedMetric],t=a[a.length-1][e.selectedMetric];return e.sortAscending?n-t:t-n})}),m=D(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:l,congestions:u}=e.data,s=d.value,v=[];let o=1/0,f=-1/0;s.forEach((n,t)=>{const _=u[n.indexCode]||u[n.indexName];_&&_.forEach((x,I)=>{const b=x[e.selectedMetric];if(typeof b=="number"&&!isNaN(b)&&isFinite(b)){let C=!0;(e.valueFilter==="positive"&&b<=0||e.valueFilter==="negative"&&b>=0)&&(C=!1),C&&(v.push([I,t,b]),o=Math.min(o,b),f=Math.max(f,b))}})}),(o===1/0||f===-1/0)&&(o=0,f=100);const a=ae[e.selectedMetric];return{tooltip:{position:"top",formatter:function(n){const[t,_,x]=n.data,I=l[t],b=s[_].indexName,C=a.formatter?a.formatter(x):x.toFixed(2);return`${b}<br/>${I}<br/>${a.name}: ${C}${a.unit}`}},grid:{height:Math.max(400,s.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:l,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:l,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:s.map(n=>n.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:s.map(n=>n.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:o,max:f,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a.name,type:"heatmap",data:v,label:{show:!0,fontSize:9,formatter:function(n){const t=n.data[2];return a.formatter?a.formatter(t):t.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),w=l=>{r("chart-ready",l)},S=l=>{const u=l?.data,[s,v,o]=u??[],f=typeof v=="number"?d.value[v]:void 0,a=typeof s=="number"?e.data?.dates[s]:void 0;r("chart-click",{industry:f,date:a,value:o,metric:e.selectedMetric,rawParams:l})};return(l,u)=>(F(),P(J,{option:m.value,onChartReady:w,onChartClick:S},null,8,["option"]))}}),Ge=T(Ke,[["__scopeId","data-v-f3482af5"]]),Qe={class:"fund-flow-analysis"},qe={class:"controls"},je={class:"chart-container"},Xe=M({__name:"FundFlowAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(c){const p=c,e=H(),r=k(ve.MAIN_NET_INFLOW_AMOUNT),d=k("5"),m=k(!1),w=k("all"),S=k(!0),l=k(!1),u=k(null),s=D(()=>{const t=u.value;if(!t)return null;if(!p.industryWhitelist||p.industryWhitelist.length===0)return t;const _=new Set(p.industryWhitelist.map(b=>b.trim().toLowerCase())),x=t.swCodeNames.filter(b=>_.has(b.indexName.trim().toLowerCase())),I={};return x.forEach(b=>{const C=b.indexCode,z=b.indexName,y=t.congestions[C]||t.congestions[z];y&&(I[C]=y)}),{dates:t.dates,swCodeNames:x,congestions:I}}),v=async()=>{l.value=!0;try{const t=new Date,_=t.toISOString().split("T")[0];let x;m.value?x=(d.value==="all"?5:parseInt(d.value))*7:x=d.value==="all"?30:parseInt(d.value);const I=new Date(t);I.setDate(t.getDate()-x);const b=I.toISOString().split("T")[0],C=await he(b,_,m.value);C?u.value=C:E.error("获取行业资金流数据失败")}catch(t){console.error("获取资金流数据出错:",t),E.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{l.value=!1}},o=()=>{v()};X(m,t=>{d.value="5",o()});const f=()=>{S.value=!S.value},a=t=>{},n=t=>{console.log("Fund flow chart clicked payload:",t);const _=t?.industry?.indexName||t?.industry?.indexCode;_&&(e.push({path:"/stock-list",query:{industry:_}}),E.success(`正在跳转到 ${_} 的股票列表`))};return Q(()=>{v()}),(t,_)=>{const x=A("el-option"),I=A("el-select"),b=A("el-button");return F(),L("div",Qe,[g("div",qe,[h(I,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=C=>m.value=C),onChange:o,placeholder:"数据周期",style:{width:"120px","margin-right":"10px"}},{default:$(()=>[h(x,{label:"按天",value:!1}),h(x,{label:"按周",value:!0})]),_:1},8,["modelValue"]),h(He,{modelValue:r.value,"onUpdate:modelValue":_[1]||(_[1]=C=>r.value=C),onChange:o,style:{"margin-right":"10px"}},null,8,["modelValue"]),h(ne,{modelValue:d.value,"onUpdate:modelValue":_[2]||(_[2]=C=>d.value=C),"week-flag":m.value,onChange:o},null,8,["modelValue","week-flag"]),h(I,{modelValue:w.value,"onUpdate:modelValue":_[3]||(_[3]=C=>w.value=C),onChange:o,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:$(()=>[h(x,{label:"全部",value:"all"}),h(x,{label:"仅正值",value:"positive"}),h(x,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),h(b,{onClick:f,type:"primary"},{default:$(()=>[..._[4]||(_[4]=[q("按最后一列排序",-1)])]),_:1})]),g("div",je,[h(Ge,{data:s.value,"selected-metric":r.value,"sort-ascending":S.value,"value-filter":w.value,onChartReady:a,onChartClick:n},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),Ye=T(Xe,[["__scopeId","data-v-2688a7ce"]]),Je={class:"industry-treemap"},Ze={class:"control-panel"},et={class:"metric-selector"},tt=["value"],at={class:"refresh-controls"},nt=["disabled"],ot={key:0},st={key:1},rt={key:0,class:"update-time"},lt={key:0,class:"loading-container"},it={key:1,class:"error-container"},dt={class:"error-message"},ut={key:2,class:"treemap-container"},ct={class:"chart-info"},mt={class:"statistics"},ft={class:"stats-grid"},pt={class:"stat-item"},vt={class:"stat-value"},ht={class:"stat-item"},_t={class:"stat-value"},yt={class:"stat-item"},gt={class:"stat-value"},bt={class:"stat-item"},xt={class:"stat-value"},wt=M({__name:"IndustryTreemap",props:{industryWhitelist:{default:()=>[]}},setup(c){const p=c,e=H(),r=k(!1),d=k(null),m=k([]),w=k("total_market_cap_sum"),S=k(null),l=k();let u=null;const s=[{key:"total_market_cap_sum",label:"总市值",unit:"元",isPercent:!1},{key:"circulating_market_cap_sum",label:"流通市值",unit:"元",isPercent:!1},{key:"avg_change_percent",label:"平均涨跌幅",unit:"%",isPercent:!0},{key:"total_volume",label:"总成交量",unit:"手",isPercent:!1},{key:"total_amount",label:"总成交额",unit:"元",isPercent:!1},{key:"avg_turnover_rate",label:"平均换手率",unit:"%",isPercent:!0},{key:"avg_pe_ratio",label:"平均市盈率",unit:"",isPercent:!1},{key:"avg_pb_ratio",label:"平均市净率",unit:"",isPercent:!1},{key:"stock_count",label:"股票数量",unit:"只",isPercent:!1},{key:"avg_change_60d",label:"60日平均涨跌幅",unit:"%",isPercent:!0},{key:"avg_change_ytd",label:"年初至今平均涨跌幅",unit:"%",isPercent:!0}],v=D(()=>s.find(i=>i.key===w.value)?.label||""),o=D(()=>{if(!p.industryWhitelist||p.industryWhitelist.length===0)return m.value;const y=new Set(p.industryWhitelist.map(i=>i.trim().toLowerCase()));return m.value.filter(i=>y.has(i.industry.trim().toLowerCase()))});X(()=>p.industryWhitelist,()=>{I()},{deep:!0}),X(o,()=>{I()});const f=D(()=>o.value?.length||0),a=D(()=>{const y=o.value;return!y||y.length===0?0:Math.max(...y.map(i=>i[w.value]))}),n=D(()=>{const y=o.value;return!y||y.length===0?0:Math.min(...y.map(i=>i[w.value]))});async function t(){try{r.value=!0,d.value=null,console.log("开始加载行业数据...");const y=await _e();console.log("API响应数据:",y),m.value=y.industries||[],console.log("设置industryData:",m.value),console.log("数据条数:",m.value?.length||0),S.value=new Date}catch(y){d.value=y instanceof Error?y.message:"加载数据失败",console.error("Failed to load industry data:",y)}finally{r.value=!1,await te(),console.log("DOM更新完成，开始更新树图"),I()}}async function _(){await t()}function x(y){const i=y.data.name;console.log("点击行业:",i),e.push({path:"/stock-list",query:{industry:i}})}function I(){if(console.log("updateTreemap被调用"),console.log("treemapChart.value:",l.value),console.log("industryData.value:",m.value),console.log("industryData长度:",m.value?.length||0),!l.value){console.error("treemapChart容器未找到");return}const y=o.value;if(!y||y.length===0){console.error("可见数据为空或未定义"),u&&(u.setOption({title:{text:"暂无数据",left:"center",top:"center"}}),u.resize());return}u||(console.log("初始化ECharts实例"),u=pe(l.value));const i=s.find(N=>N.key===w.value);console.log("当前选择的指标:",i);const R=y.map(N=>{const O=N[w.value],U=typeof O=="number"?O:Number(O),K=Number.isNaN(U)?0:U,G=typeof N.stock_count=="number"&&N.stock_count>0?N.stock_count:1,j=K;return{name:N.industry,value:j,stockCount:G,metricKey:w.value}}).map(N=>({name:N.name,value:Math.abs(N.value),children:[{name:`${N.name}`,value:Math.abs(N.value),originalValue:N.value,label:{show:!0,formatter:O=>`${O.name}
${C(O.data.originalValue)}`},itemStyle:{color:N.value>0?"#73C0DE":N.value<0?"#EE6666":"#999"}}]})),re={title:{text:`行业矩形树图（${i?.label||""}）`,left:"center"},tooltip:{formatter:N=>{const U=(typeof N?.name=="string"?N.name:"").replace(/\s*\(.+\)\s*$/,""),K=N?.data&&"originalValue"in N.data?Number(N.data.originalValue):void 0,G=y.find(le=>le.industry===U),j=K!==void 0?K:G?G[w.value]:0;return`${U}<br/>${i?.label||""}: ${C(Number(j))}`}},series:[{type:"treemap",data:R,roam:!0,nodeClick:!1,breadcrumb:{show:!1},label:{show:!0,color:"#2c3e50",textShadowColor:"rgba(255,255,255,0.9)",textShadowBlur:2,textShadowOffsetX:0,textShadowOffsetY:0},itemStyle:{borderColor:"#ffffff",borderWidth:1,gapWidth:2},levels:[{itemStyle:{borderColor:"#e5e7eb",borderWidth:1,gapWidth:3},upperLabel:{show:!1}},{itemStyle:{borderColor:"#ffffff",borderWidth:1,gapWidth:2}}],emphasis:{itemStyle:{borderColor:"#409EFF",borderWidth:2}}}]};u.setOption(re),u.resize(),u.off("click"),u.on("click",x)}function b(){u&&u.resize()}Q(async()=>{await t(),window.addEventListener("resize",b)}),ie(()=>{window.removeEventListener("resize",b),u&&(u.dispose(),u=null)});function C(y){const i=s.find(R=>R.key===w.value),V=typeof y=="number"?y:Number(y);if(Number.isNaN(V))return"--";if(i?.isPercent)return`${V.toFixed(2)}%`;if(i?.unit==="元"){const R=Math.abs(V);return R>=1e12?`${(V/1e12).toFixed(2)}万亿`:R>=1e8?`${(V/1e8).toFixed(2)}亿`:R>=1e4?`${(V/1e4).toFixed(2)}万`:V.toFixed(2)}if(i?.unit==="手"){const R=Math.abs(V);return R>=1e8?`${(V/1e8).toFixed(2)}亿手`:R>=1e4?`${(V/1e4).toFixed(2)}万手`:`${V.toFixed(2)}手`}return i?.unit?`${V.toFixed(2)}${i.unit}`:V.toFixed(2)}function z(y){try{return new Date(y).toLocaleString("zh-CN")}catch{return""}}return(y,i)=>(F(),L("div",Je,[g("div",Ze,[g("div",et,[i[1]||(i[1]=g("label",{for:"metric-select"},"选择指标：",-1)),de(g("select",{id:"metric-select","onUpdate:modelValue":i[0]||(i[0]=V=>w.value=V),onChange:I,class:"metric-select"},[(F(),L(B,null,Y(s,V=>g("option",{key:V.key,value:V.key},W(V.label),9,tt)),64))],544),[[ue,w.value]])]),g("div",at,[g("button",{onClick:_,disabled:r.value,class:"refresh-btn"},[r.value?(F(),L("span",ot,"刷新中...")):(F(),L("span",st,"刷新数据"))],8,nt),S.value?(F(),L("span",rt," 最后更新："+W(z(S.value)),1)):ce("",!0)])]),r.value?(F(),L("div",lt,[...i[2]||(i[2]=[g("div",{class:"loading-spinner"},null,-1),g("p",null,"正在加载行业数据...",-1)])])):d.value?(F(),L("div",it,[g("div",dt,[i[3]||(i[3]=g("h3",null,"数据加载失败",-1)),g("p",null,W(d.value),1),g("button",{onClick:_,class:"retry-btn"},"重试")])])):(F(),L("div",ut,[g("div",{ref_key:"treemapChart",ref:l,class:"treemap-chart"},null,512),g("div",ct,[i[9]||(i[9]=me('<div class="legend" data-v-de2ff2f5><h4 data-v-de2ff2f5>图例说明</h4><div class="legend-items" data-v-de2ff2f5><div class="legend-item positive" data-v-de2ff2f5><span class="color-box positive" data-v-de2ff2f5></span><span data-v-de2ff2f5>正值/上涨</span></div><div class="legend-item negative" data-v-de2ff2f5><span class="color-box negative" data-v-de2ff2f5></span><span data-v-de2ff2f5>负值/下跌</span></div><div class="legend-item neutral" data-v-de2ff2f5><span class="color-box neutral" data-v-de2ff2f5></span><span data-v-de2ff2f5>中性/无变化</span></div></div></div>',1)),g("div",mt,[i[8]||(i[8]=g("h4",null,"统计信息",-1)),g("div",ft,[g("div",pt,[i[4]||(i[4]=g("span",{class:"stat-label"},"行业总数：",-1)),g("span",vt,W(f.value),1)]),g("div",ht,[i[5]||(i[5]=g("span",{class:"stat-label"},"当前指标：",-1)),g("span",_t,W(v.value),1)]),g("div",yt,[i[6]||(i[6]=g("span",{class:"stat-label"},"最大值：",-1)),g("span",gt,W(C(a.value)),1)]),g("div",bt,[i[7]||(i[7]=g("span",{class:"stat-label"},"最小值：",-1)),g("span",xt,W(C(n.value)),1)])])])])]))]))}}),Ct=T(wt,[["__scopeId","data-v-de2ff2f5"]]),St={class:"congestion-heatmap"},kt={class:"header-controls"},It=M({__name:"CongestionHeatmap",setup(c){const p=k("turnover"),e=k(!1),r=k([]),d=H(),m=async()=>{if(e.value){if(!fe()){E.error("请先登录后再启用“仅看我的”"),e.value=!1,d.push("/login");return}try{const S=await ge(),l=Array.from(new Set((S.data?.list||[]).map(u=>(u.industry||"").trim()).filter(u=>!!u)));r.value=l,l.length===0?E.warning("您的持有/关注列表为空，当前无可筛选的行业"):E.success(`已启用，仅展示 ${l.length} 个相关行业`)}catch(S){console.error("获取个人持有/关注列表失败:",S),E.error("获取个人行业列表失败，请稍后重试"),e.value=!1,r.value=[]}}else r.value=[]},w=async S=>{p.value=S,await te(),window.dispatchEvent(new Event("resize"))};return(S,l)=>{const u=A("el-checkbox"),s=A("el-tab-pane"),v=A("el-tabs"),o=A("el-card");return F(),L("div",St,[h(o,null,{default:$(()=>[g("div",kt,[l[3]||(l[3]=g("h3",null,"行业拥挤度分析",-1)),g("div",null,[h(u,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=f=>e.value=f),onChange:m},{default:$(()=>[...l[2]||(l[2]=[q("仅看我的",-1)])]),_:1},8,["modelValue"])])]),h(v,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=f=>p.value=f),onTabChange:w},{default:$(()=>[h(s,{label:"成交金额占比分位数",name:"turnover"},{default:$(()=>[h(Ne,{"industry-whitelist":r.value},null,8,["industry-whitelist"])]),_:1}),h(s,{label:"行业业绩指标",name:"performance"},{default:$(()=>[h(Ue,{"industry-whitelist":r.value},null,8,["industry-whitelist"])]),_:1}),h(s,{label:"行业资金流",name:"fundflow"},{default:$(()=>[h(Ye,{"industry-whitelist":r.value},null,8,["industry-whitelist"])]),_:1}),h(s,{label:"行业矩形树图",name:"treemap"},{default:$(()=>[h(Ct,{"industry-whitelist":r.value},null,8,["industry-whitelist"])]),_:1}),h(s,{label:"指数RPS强度排名",name:"indexrps"},{default:$(()=>[h(ye)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Rt=T(It,[["__scopeId","data-v-a302d69a"]]);export{Rt as default};
