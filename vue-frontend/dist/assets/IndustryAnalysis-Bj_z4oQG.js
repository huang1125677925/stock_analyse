import{g as ze,a as $e}from"./industryAnalysisApi-CfBqZJ5s.js";import{i as ue,r as Pe}from"./index-ElshY9iF.js";import{F as q,f as Ue,a as Ce}from"./industry-fund-flow-BnShEPvX.js";import{d as ce,a as z,z as ie,B as re,y as ve,C as ye,c as H,e as O,i as K,w as V,D as Ve,G as We,b as S,f as j,g as J,t as X,k as Ie,H as de,E as oe,o as U,_ as fe,I as Be,J as Ke,x as Ye,K as Xe,F as pe,A as ge,l as Le}from"./index-DuOz8Dc6.js";import{g as Ge}from"./industryApi-DVJm4tE6.js";const ke={class:"industry-fund-flow-heatmap"},qe={class:"header-controls"},He={class:"controls"},Ze={"element-loading-text":"正在加载数据..."},Qe={key:1,class:"stats-container"},Je={class:"card-header"},je={class:"stats-content"},et={class:"stat-item"},tt={class:"stat-value positive"},nt={class:"stat-item"},at={class:"stat-value negative"},rt={class:"stat-item"},ot={class:"stat-value"},st={class:"stat-item"},lt={class:"stat-value positive"},it={class:"stat-item"},ut={class:"stat-value negative"},dt=ce({__name:"IndustryFundFlowHeatmap",props:{industry:{},title:{default:"行业资金流热力图"}},setup(G,{expose:$}){const c=G,d=z();let n=null;const l=z(!1),w=z(!1),_=z("amount"),A=z("20"),h=z("all"),g=z(null),x=z(null),y=ie(()=>_.value==="amount"?[{key:q.TOTAL_NET_INFLOW_AMOUNT,name:"全部净流入"},{key:q.MAIN_NET_INFLOW_AMOUNT,name:"主力净流入"},{key:q.SUPER_LARGE_NET_INFLOW_AMOUNT,name:"超大单净流入"},{key:q.LARGE_NET_INFLOW_AMOUNT,name:"大单净流入"},{key:q.MEDIUM_NET_INFLOW_AMOUNT,name:"中单净流入"},{key:q.SMALL_NET_INFLOW_AMOUNT,name:"小单净流入"}]:[{key:q.TOTAL_NET_INFLOW_RATIO,name:"全部净流入占比"},{key:q.MAIN_NET_INFLOW_RATIO,name:"主力净流入占比"},{key:q.SUPER_LARGE_NET_INFLOW_RATIO,name:"超大单净流入占比"},{key:q.LARGE_NET_INFLOW_RATIO,name:"大单净流入占比"},{key:q.MEDIUM_NET_INFLOW_RATIO,name:"中单净流入占比"},{key:q.SMALL_NET_INFLOW_RATIO,name:"小单净流入占比"}]),i=()=>{if(!g.value){x.value=null;return}const a=g.value,r=a.swCodeNames.find(b=>b.indexName===c.industry);if(!r){x.value=null;return}const f=a.congestions[r.indexCode]||a.congestions[r.indexName];if(!f||f.length===0){x.value=null;return}const s=["main_net_inflow_amount","main_net_inflow_ratio","super_large_net_inflow_amount","super_large_net_inflow_ratio","large_net_inflow_amount","large_net_inflow_ratio","medium_net_inflow_amount","medium_net_inflow_ratio","small_net_inflow_amount","small_net_inflow_ratio"];let u=0,m=0,v=0;f.forEach(b=>{s.forEach(p=>{const D=b[p];if(typeof D=="number"&&!isNaN(D)&&isFinite(D)){let N=!0;(h.value==="positive"&&D<=0||h.value==="negative"&&D>=0)&&(N=!1),N&&(v++,D>0?u++:D<0&&m++)}})});const F=v>0?(u/v*100).toFixed(2):"0.00",R=v>0?(m/v*100).toFixed(2):"0.00";x.value={positiveCount:u,negativeCount:m,totalCount:v,positiveRatio:F,negativeRatio:R}},E=async()=>{l.value=!0;try{const a=new Date,r=a.toISOString().split("T")[0],f=A.value==="all"?30:parseInt(A.value),s=new Date(a);s.setDate(a.getDate()-f);const u=s.toISOString().split("T")[0],m=await Ue(u,r);m?(g.value=m,await de(),t(),i()):oe.error("获取资金流数据失败")}catch(a){console.error("获取资金流数据出错:",a),oe.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{l.value=!1}},o=()=>{d.value&&(n=ue(d.value),t())},t=()=>{if(!n||!g.value)return;const a=g.value,r=a.dates,f=a.swCodeNames.find(p=>p.indexName===c.industry);if(!f){oe.warning(`未找到行业"${c.industry}"的数据`);return}const s=a.congestions[f.indexCode]||a.congestions[f.indexName];if(!s||s.length===0){oe.warning(`行业"${c.industry}"暂无资金流数据`);return}const u=[...y.value].sort((p,D)=>{if(s.length===0)return 0;const N=s[s.length-1];let M,I;return p.key===q.TOTAL_NET_INFLOW_AMOUNT?M=N.super_large_net_inflow_amount+N.large_net_inflow_amount+N.medium_net_inflow_amount+N.small_net_inflow_amount:p.key===q.TOTAL_NET_INFLOW_RATIO?M=N.super_large_net_inflow_ratio+N.large_net_inflow_ratio+N.medium_net_inflow_ratio+N.small_net_inflow_ratio:M=N[p.key],D.key===q.TOTAL_NET_INFLOW_AMOUNT?I=N.super_large_net_inflow_amount+N.large_net_inflow_amount+N.medium_net_inflow_amount+N.small_net_inflow_amount:D.key===q.TOTAL_NET_INFLOW_RATIO?I=N.super_large_net_inflow_ratio+N.large_net_inflow_ratio+N.medium_net_inflow_ratio+N.small_net_inflow_ratio:I=N[D.key],w.value?M-I:I-M}),m=[];let v=1/0,F=-1/0;s.map(p=>{const D=p.main_net_inflow_amount+p.super_large_net_inflow_amount+p.large_net_inflow_amount+p.medium_net_inflow_amount+p.small_net_inflow_amount,N=p.main_net_inflow_ratio+p.super_large_net_inflow_ratio+p.large_net_inflow_ratio+p.medium_net_inflow_ratio+p.small_net_inflow_ratio;return{...p,total_net_inflow_amount:D,total_net_inflow_ratio:N}}).forEach((p,D)=>{u.forEach((N,M)=>{const I=p[N.key];if(typeof I=="number"&&!isNaN(I)&&isFinite(I)){let T=!0;(h.value==="positive"&&I<=0||h.value==="negative"&&I>=0)&&(T=!1),T&&(m.push([D,M,I]),v=Math.min(v,I),F=Math.max(F,I))}})}),(v===1/0||F===-1/0)&&(v=0,F=100),n.clear();const b={tooltip:{position:"top",formatter:function(p){const[D,N,M]=p.data,I=r[D],T=u[N],C=Ce[T.key],P=C.formatter?C.formatter(M):M.toFixed(2);return`${T.name}<br/>${I}<br/>数值: ${P}${C.unit}`}},grid:{height:Math.max(300,u.length*40)+"px",top:"2%",left:"5%",right:"10%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:r,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:r,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:u.map(p=>p.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:u.map(p=>p.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"资金类型",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:v,max:F,calculable:!0,orient:"vertical",right:"0%",top:"5%",width:15,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:_.value==="amount"?"资金流入金额":"资金流入占比",type:"heatmap",data:m,label:{show:!0,fontSize:9,formatter:function(p){const[D,N,M]=p.data,I=u[N],T=Ce[I.key];return T.formatter?T.formatter(M):M.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};de(()=>{if(n&&(n.setOption(b),d.value)){const p=Math.max(400,u.length*50+120);d.value.style.height=p+"px",setTimeout(()=>{n&&n.resize()},0)}})},e=()=>{w.value=!w.value,t()};return re(_,()=>{t()}),re(()=>c.industry,()=>{t(),i()}),re([g,()=>c.industry],()=>{i()}),re(h,()=>{i()}),ve(()=>{o(),E()}),ye(()=>{n&&(n.dispose(),n=null)}),$({refreshData:E}),(a,r)=>{const f=K("el-radio-button"),s=K("el-radio-group"),u=K("el-option"),m=K("el-select"),v=K("el-button"),F=K("el-empty"),R=K("el-card"),b=We("loading");return U(),H("div",ke,[O(R,{shadow:"hover"},{header:V(()=>[S("div",qe,[S("h3",null,X(a.title),1),S("div",He,[O(s,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=p=>_.value=p),onChange:t,size:"small"},{default:V(()=>[O(f,{label:"amount"},{default:V(()=>[...r[3]||(r[3]=[Ie("资金数量",-1)])]),_:1}),O(f,{label:"ratio"},{default:V(()=>[...r[4]||(r[4]=[Ie("资金比率",-1)])]),_:1})]),_:1},8,["modelValue"]),O(m,{modelValue:A.value,"onUpdate:modelValue":r[1]||(r[1]=p=>A.value=p),onChange:E,placeholder:"选择日期范围",style:{width:"150px","margin-left":"10px"}},{default:V(()=>[O(u,{label:"最近10天",value:"10"}),O(u,{label:"最近15天",value:"15"}),O(u,{label:"最近20天",value:"20"}),O(u,{label:"全部29天",value:"all"})]),_:1},8,["modelValue"]),O(m,{modelValue:h.value,"onUpdate:modelValue":r[2]||(r[2]=p=>h.value=p),onChange:t,placeholder:"数值过滤",style:{width:"120px","margin-left":"10px"}},{default:V(()=>[O(u,{label:"全部",value:"all"}),O(u,{label:"仅正值",value:"positive"}),O(u,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),O(v,{onClick:e,type:"primary",style:{"margin-left":"10px"}},{default:V(()=>[...r[5]||(r[5]=[Ie(" 按最后一列排序 ",-1)])]),_:1})])])]),default:V(()=>[Ve((U(),H("div",Ze,[S("div",{ref_key:"chartContainer",ref:d,class:"chart-container"},null,512),!l.value&&!g.value?(U(),j(F,{key:0,description:"暂无数据","image-size":200})):J("",!0),!l.value&&g.value&&x.value?(U(),H("div",Qe,[O(R,{class:"stats-card",shadow:"hover"},{header:V(()=>[S("div",Je,[S("span",null,"净流入正负比率统计 ("+X(h.value==="all"?"全部数值":h.value==="positive"?"仅正值":"仅负值")+")",1)])]),default:V(()=>[S("div",je,[S("div",et,[r[6]||(r[6]=S("span",{class:"stat-label"},"正值项数:",-1)),S("span",tt,X(x.value.positiveCount),1)]),S("div",nt,[r[7]||(r[7]=S("span",{class:"stat-label"},"负值项数:",-1)),S("span",at,X(x.value.negativeCount),1)]),S("div",rt,[r[8]||(r[8]=S("span",{class:"stat-label"},"总项数:",-1)),S("span",ot,X(x.value.totalCount),1)]),S("div",st,[r[9]||(r[9]=S("span",{class:"stat-label"},"正值比率:",-1)),S("span",lt,X(x.value.positiveRatio)+"%",1)]),S("div",it,[r[10]||(r[10]=S("span",{class:"stat-label"},"负值比率:",-1)),S("span",ut,X(x.value.negativeRatio)+"%",1)])])]),_:1})])):J("",!0)])),[[b,l.value]])]),_:1})])}}}),ct=fe(dt,[["__scopeId","data-v-10cda965"]]),vt={class:"industry-trend-charts"},ft={class:"chart-header"},mt={class:"chart-info"},ht={class:"info-item"},pt={class:"info-item"},gt={class:"chart-header"},yt={class:"chart-info"},_t={class:"info-item"},xt={class:"info-item"},Dt={class:"chart-header"},Et={class:"chart-info"},Nt={class:"info-item"},At={class:"info-item"},It={key:0,class:"loading-overlay"},bt=ce({__name:"IndustryTrendCharts",props:{industry:{default:void 0},quarter:{},industryName:{},quarterName:{}},setup(G){const $=G,c=z(!1),d=z(),n=z(),l=z(),w=z(),_=z(),A=z(),h=z([]),g=async()=>{if($.quarter){c.value=!0;try{const t={report_type:$.quarter};$.industry&&$.industry!=="all"&&(t.industry=$.industry);const e=await ze(t);h.value=e.aggregated_reports,await de(),x()}catch(t){console.error("获取行业数据失败:",t),oe.error("获取数据失败，请稍后重试")}finally{c.value=!1}}},x=()=>{y(),i(),E()},y=()=>{const t=h.value;if(!d.value||t.length===0)return;w.value&&w.value.dispose(),w.value=ue(d.value);const e=t.map(s=>s.report_date),a=t.map(s=>s.total_operating_revenue||0),r=t.map(s=>s.total_net_profit||0),f={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["营业收入","净利润"]},xAxis:{type:"category",data:e},yAxis:[{type:"value",name:"营业收入 (万元)",position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"净利润 (万元)",position:"right",axisLabel:{formatter:"{value}"}}],series:[{name:"营业收入",type:"line",yAxisIndex:0,data:a,smooth:!0,itemStyle:{color:"#1890ff"},lineStyle:{color:"#1890ff"}},{name:"净利润",type:"line",yAxisIndex:1,data:r,smooth:!0,itemStyle:{color:"#52c41a"},lineStyle:{color:"#52c41a"}}]};w.value.setOption(f)},i=()=>{const t=h.value;if(!n.value||t.length===0)return;_.value&&_.value.dispose(),_.value=ue(n.value);const e=t.map(u=>u.report_date),a=t.map(u=>u.avg_operating_revenue_growth_rate||0),r=t.map(u=>u.avg_net_profit_growth_rate||0),f=t.map(u=>u.avg_gross_profit_margin||0),s={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(u){let m=u[0].name+"<br/>";return u.forEach(v=>{m+=v.marker+v.seriesName+": "+v.value.toFixed(2)+"%<br/>"}),m}},legend:{data:["营业收入增长率","净利润增长率","毛利率"]},xAxis:{type:"category",data:e},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"营业收入增长率",type:"line",data:a,smooth:!0,itemStyle:{color:"#faad14"},lineStyle:{color:"#faad14"}},{name:"净利润增长率",type:"line",data:r,smooth:!0,itemStyle:{color:"#f5222d"},lineStyle:{color:"#f5222d"}},{name:"毛利率",type:"line",data:f,smooth:!0,itemStyle:{color:"#722ed1"},lineStyle:{color:"#722ed1"}}]};_.value.setOption(s)},E=()=>{const t=h.value;if(!l.value||t.length===0)return;A.value&&A.value.dispose(),A.value=ue(l.value);const e=t.map(s=>s.report_date),a=t.map(s=>s.avg_roe||0),r=t.map(s=>(s.avg_roe||0)*.8),f={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(s){let u=s[0].name+"<br/>";return s.forEach(m=>{u+=m.marker+m.seriesName+": "+m.value.toFixed(2)+"%<br/>"}),u}},legend:{data:["ROE","ROA"]},xAxis:{type:"category",data:e},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"ROE",type:"line",data:a,smooth:!0,itemStyle:{color:"#13c2c2"},lineStyle:{color:"#13c2c2"}},{name:"ROA",type:"line",data:r,smooth:!0,itemStyle:{color:"#eb2f96"},lineStyle:{color:"#eb2f96"}}]};A.value.setOption(f)},o=()=>{w.value?.resize(),_.value?.resize(),A.value?.resize()};return re([()=>$.industry,()=>$.quarter],()=>{g()},{immediate:!1}),ve(()=>{g(),window.addEventListener("resize",o)}),ye(()=>{window.removeEventListener("resize",o),w.value?.dispose(),_.value?.dispose(),A.value?.dispose()}),(t,e)=>{const a=K("el-card"),r=K("el-loading");return U(),H("div",vt,[O(a,{class:"chart-card",shadow:"hover"},{default:V(()=>[S("div",ft,[e[0]||(e[0]=S("h3",null,"收入利润数据",-1)),S("div",mt,[S("span",ht,"行业: "+X(t.industryName),1),S("span",pt,"季度: "+X(t.quarterName),1)])]),S("div",{ref_key:"revenueChartRef",ref:d,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),O(a,{class:"chart-card",shadow:"hover"},{default:V(()=>[S("div",gt,[e[1]||(e[1]=S("h3",null,"增长率毛利率数据",-1)),S("div",yt,[S("span",_t,"行业: "+X(t.industryName),1),S("span",xt,"季度: "+X(t.quarterName),1)])]),S("div",{ref_key:"growthChartRef",ref:n,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),O(a,{class:"chart-card",shadow:"hover"},{default:V(()=>[S("div",Dt,[e[2]||(e[2]=S("h3",null,"ROA/ROE数据",-1)),S("div",Et,[S("span",Nt,"行业: "+X(t.industryName),1),S("span",At,"季度: "+X(t.quarterName),1)])]),S("div",{ref_key:"roeChartRef",ref:l,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),c.value?(U(),H("div",It,[O(r,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):J("",!0)])}}}),St=fe(bt,[["__scopeId","data-v-58f63c1a"]]),Mt={class:"industry-kline"},wt={class:"chart-header"},Tt={key:0},Ct={key:1,class:"chart-subtitle"},Lt=ce({__name:"IndustryKline",props:{industryCode:{},title:{default:"行业K线图"},height:{default:"600px"},startDate:{},endDate:{}},setup(G){Be(y=>({"57cc0291":$.height}));const $=G,c=z();let d=null;const n=z(!1),l=z(""),w=z([]),_=()=>{c.value&&(d&&d.dispose(),d=ue(c.value),A(),window.addEventListener("resize",x))},A=()=>{if(!d)return;const y=w.value;if(!y||y.length===0){d.clear();return}const i=y.map(e=>g(e.date)),E=y.map(e=>[e.open_price,e.close_price,e.low_price,e.high_price]),o=y.map(e=>e.total_volume||0),t={animation:!1,title:{text:$.title,left:"center"},legend:{data:["K线","成交量"],left:"left"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},toolbox:{feature:{brush:{type:["lineX","clear"]},saveAsImage:{},dataZoom:{yAxisIndex:!1}}},axisPointer:{link:[{xAxisIndex:[0,1]}]},grid:[{left:"10%",right:"8%",top:"10%",height:"55%"},{left:"10%",right:"8%",top:"72%",height:"18%"}],xAxis:[{type:"category",data:i,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},{type:"category",gridIndex:1,data:i,boundaryGap:!1,axisLine:{onZero:!1},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},min:"dataMin",max:"dataMax"}],yAxis:[{scale:!0,splitArea:{show:!0}},{gridIndex:1,splitNumber:2,axisLabel:{show:!0},axisLine:{show:!0},axisTick:{show:!0},splitLine:{show:!1}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:0,end:100},{show:!0,xAxisIndex:[0,1],type:"slider",top:"90%",start:0,end:100}],brush:{xAxisIndex:"all",brushLink:"all",outOfBrush:{colorAlpha:.1}},series:[{name:"K线",type:"candlestick",data:E,itemStyle:{color:"#ec0000",color0:"#00da3c",borderColor:"#8A0000",borderColor0:"#008F28"}},{name:"成交量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:o,itemStyle:{color:"#7fbe9e"}}]};d.setOption(t,!0)},h=async()=>{if($.industryCode){n.value=!0;try{const y=o=>o?o.replace(/-/g,""):void 0,i={start_date:y($.startDate),end_date:y($.endDate)},E=await Ge($.industryCode,i);l.value=E.sector_name,w.value=(E.daily_data||[]).sort((o,t)=>o.date>t.date?1:-1),de(A)}catch(y){console.error(y),oe.error("获取行业K线数据失败")}finally{n.value=!1}}},g=y=>{const i=y.replace(/[^0-9]/g,"");return i.length===8?`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`:y},x=()=>d?.resize();return re(()=>$.industryCode,()=>{h()}),re([()=>$.startDate,()=>$.endDate],()=>{h()}),ve(()=>{de(()=>{_(),h()})}),ye(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",x)}),(y,i)=>{const E=K("el-empty");return U(),H("div",Mt,[S("div",wt,[y.title?(U(),H("h3",Tt,X(y.title),1)):J("",!0),l.value?(U(),H("div",Ct," 行业板块："+X(l.value)+"（代码："+X(y.industryCode)+"） ",1)):J("",!0)]),S("div",{ref_key:"chartRef",ref:c,class:"chart-container"},null,512),!n.value&&w.value.length===0?(U(),j(E,{key:0,description:"暂无数据"})):J("",!0)])}}}),Ft=fe(Lt,[["__scopeId","data-v-627f886a"]]);var he={exports:{}},Ot=he.exports,Fe;function Rt(){return Fe||(Fe=1,(function(G,$){(function(d,n){G.exports=n()})(Ot,function(){return(function(c){var d={};function n(l){if(d[l])return d[l].exports;var w=d[l]={exports:{},id:l,loaded:!1};return c[l].call(w.exports,w,w.exports,n),w.loaded=!0,w.exports}return n.m=c,n.c=d,n.p="",n(0)})([(function(c,d,n){var l;l=(function(w){return{clustering:n(1),regression:n(5),statistics:n(6),histogram:n(15),transform:{regression:n(18),histogram:n(21),clustering:n(22)}}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(2),A=_.dataPreprocess,h=_.normalizeDimensions,g=n(3),o=n(4),x=g.size,y=g.sumOfColumn,i=g.sum,E=g.zeros,o=n(4),t=o.isNumber,e=Math.pow,a={SINGLE:"single",MULTIPLE:"multiple"};function r(b,p,D){for(var N=E(b.length,2),M=m(p,R(b,D.dimensions)),I=!0,T,C,P,W;I;){I=!1;for(var L=0;L<b.length;L++){T=1/0,C=-1;for(var Y=0;Y<p;Y++)P=v(b[L],M[Y],D),P<T&&(T=P,C=Y);N[L][0]!==C&&(I=!0),N[L][0]=C,N[L][1]=T}for(var L=0;L<p;L++){W=[];for(var Y=0;Y<N.length;Y++)N[Y][0]===L&&W.push(b[Y]);M[L]=f(W,D)}}var se={centroids:M,clusterAssigned:N};return se}function f(b,p){for(var D=[],N,M,I=0;I<p.dimensions.length;I++){var T=p.dimensions[I];N=0;for(var C=0;C<b.length;C++)N+=b[C][T];M=N/b.length,D.push(M)}return D}function s(b,p,D){var N=(t(p)?{clusterCount:p,stepByStep:D}:p)||{clusterCount:2},M=N.clusterCount;if(M<2)return;var I=F(b,N),T=I.outputType===a.SINGLE,C=A(b,{dimensions:I.dimensions}),P=E(C.length,2),W,L,Y;function se(k,ne){P[k][1]=ne}function Z(k){return P[k][1]}if(T){W=[];var Se=I.outputClusterIndexDimension;L=function(k,ne){W[k][Se]=ne},Y=function(k){return W[k][Se]};for(var ee=0;ee<C.length;ee++)W.push(C[ee].slice()),se(ee,0),L(ee,0)}else L=function(k,ne){P[k][0]=ne},Y=function(k){return P[k][0]};for(var Me=f(C,I),le=[Me],ee=0;ee<C.length;ee++){var Re=v(C[ee],Me,I);se(ee,Re)}var _e,xe,De,me,Ee,Ne,we=1,te={data:W,centroids:le,isEnd:!1};T||(te.clusterAssment=P);function Te(){if(we<M){_e=1/0;for(var k,ne,ae,Q=0;Q<le.length;Q++){xe=[],De=[];for(var B=0;B<C.length;B++)Y(B)===Q?xe.push(C[B]):De.push(Z(B));me=r(xe,2,I),Ee=y(me.clusterAssigned,1),Ne=i(De),Ee+Ne<_e&&(_e=Ne+Ee,k=Q,ne=me.centroids,ae=me.clusterAssigned)}for(var B=0;B<ae.length;B++)ae[B][0]===0?ae[B][0]=k:ae[B][0]===1&&(ae[B][0]=le.length);le[k]=ne[0],le.push(ne[1]);for(var B=0,Q=0;B<C.length&&Q<ae.length;B++)Y(B)===k&&(L(B,ae[Q][0]),se(B,ae[Q++][1]));var Ae=[];if(!T){for(var B=0;B<le.length;B++){Ae[B]=[];for(var Q=0;Q<C.length;Q++)Y(Q)===B&&Ae[B].push(C[Q])}te.pointsInCluster=Ae}we++}else te.isEnd=!0}if(N.stepByStep)te.next=function(){return Te(),u(te,I),te};else for(;Te(),!te.isEnd;);return u(te,I),te}function u(b,p){var D=p.outputCentroidDimensions;if(!(p.outputType!==a.SINGLE||D==null))for(var N=b.data,M=b.centroids,I=0;I<N.length;I++)for(var T=N[I],C=T[p.outputClusterIndexDimension],P=M[C],W=Math.min(P.length,D.length),L=0;L<W;L++)T[D[L]]=P[L]}function m(b,p){for(var D=E(b,p.length),N=0;N<p.length;N++)for(var M=p[N],I=0;I<b;I++)D[I][N]=M.min+M.span*Math.random();return D}function v(b,p,D){for(var N=0,M=D.dimensions,I=D.rawExtents,T=0;T<M.length;T++){var C=I[T].span;if(C){var P=M[T],W=(b[P]-p[T])/C;N+=e(W,2)}}return N}function F(b,p){var D=x(b);if(D.length<1)throw new Error("The input data of clustering should be two-dimension array.");for(var N=D[1],M=[],I=0;I<N;I++)M.push(I);var T=h(p.dimensions,M),C=p.outputType||a.MULTIPLE,P=p.outputClusterIndexDimension;if(C===a.SINGLE&&!o.isNumber(P))throw new Error("outputClusterIndexDimension is required as a number.");var W=R(b,T);return{dimensions:T,rawExtents:W,outputType:C,outputClusterIndexDimension:P,outputCentroidDimensions:p.outputCentroidDimensions}}function R(b,p){for(var D=[],N=p.length,M=0;M<N;M++)D.push({min:1/0,max:-1/0});for(var M=0;M<b.length;M++)for(var I=b[M],T=0;T<N;T++){var C=D[T],P=I[p[T]];C.min>P&&(C.min=P),C.max<P&&(C.max=P)}for(var M=0;M<N;M++)D[M].span=D[M].max-D[M].min;return D}return{OutputType:a,hierarchicalKMeans:s}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(3),A=_.isArray,h=_.size,g=n(4),x=g.isNumber;function y(o,t){return typeof o=="number"?[o]:o??t}function i(o,t){t=t||{};var e=t.dimensions,a={};if(e!=null)for(var r=0;r<e.length;r++)a[e[r]]=!0;var f=t.toOneDimensionArray?e?e[0]:0:null;function s(b){return!e||a.hasOwnProperty(b)}if(!A(o))throw new Error("Invalid data type, you should input an array");var u=[],m=h(o);if(m.length===1)for(var r=0;r<m[0];r++){var v=o[r];x(v)&&u.push(v)}else if(m.length===2)for(var r=0;r<m[0];r++){for(var F=!0,v=o[r],R=0;R<m[1];R++)s(R)&&!x(v[R])&&(F=!1);F&&u.push(f!=null?v[f]:v)}return u}function E(o){var t=o.toString(),e=t.indexOf(".");return e<0?0:t.length-1-e}return{normalizeDimensions:y,dataPreprocess:i,getPrecision:E}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=Object.prototype.toString,A=Array.prototype,h=A.map;function g(a){for(var r=[];x(a);)r.push(a.length),a=a[0];return r}function x(a){return _.call(a)==="[object Array]"}function y(a,r){for(var f=[],s=0;s<a;s++){f[s]=[];for(var u=0;u<r;u++)f[s][u]=0}return f}function i(a){for(var r=0,f=0;f<a.length;f++)r+=a[f];return r}function E(a,r){for(var f=0,s=0;s<a.length;s++)f+=a[s][r];return f}function o(a,r){return a>r?1:a<r?-1:a===r?0:NaN}function t(a,r,f,s){for(f==null&&(f=0),s==null&&(s=a.length);f<s;){var u=Math.floor((f+s)/2),m=o(a[u],r);if(m>0)s=u;else if(m<0)f=u+1;else return u+1}return f}function e(a,r,f){if(a&&r){if(a.map&&a.map===h)return a.map(r,f);for(var s=[],u=0,m=a.length;u<m;u++)s.push(r.call(f,a[u],u,a));return s}}return{size:g,isArray:x,zeros:y,sum:i,sumOfColumn:E,ascending:o,bisect:t,map:e}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){function _(g){return g=g===null?NaN:+g,typeof g=="number"&&!isNaN(g)}function A(g){return isFinite(g)&&g===Math.round(g)}function h(g){if(g===0)return 0;var x=Math.floor(Math.log(g)/Math.LN10);return g/Math.pow(10,x)>=10&&x++,x}return{isNumber:_,isInteger:A,quantityExponent:h}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(2),A=_.dataPreprocess,h=_.normalizeDimensions,g={linear:function(i,E){for(var o=E.dimensions[0],t=E.dimensions[1],e=0,a=0,r=0,f=0,s=i.length,u=0;u<s;u++){var m=i[u];e+=m[o],a+=m[t],r+=m[o]*m[t],f+=m[o]*m[o]}for(var v=(s*r-e*a)/(s*f-e*e),F=a/s-v*e/s,R=[],b=0;b<i.length;b++){var m=i[b],p=m.slice();p[o]=m[o],p[t]=v*m[o]+F,R.push(p)}var D="y = "+Math.round(v*100)/100+"x + "+Math.round(F*100)/100;return{points:R,parameter:{gradient:v,intercept:F},expression:D}},linearThroughOrigin:function(i,E){for(var o=E.dimensions[0],t=E.dimensions[1],e=0,a=0,r=0;r<i.length;r++){var f=i[r];e+=f[o]*f[o],a+=f[o]*f[t]}for(var s=a/e,u=[],m=0;m<i.length;m++){var f=i[m],v=f.slice();v[o]=f[o],v[t]=f[o]*s,u.push(v)}var F="y = "+Math.round(s*100)/100+"x";return{points:u,parameter:{gradient:s},expression:F}},exponential:function(i,E){for(var o=E.dimensions[0],t=E.dimensions[1],e=0,a=0,r=0,f=0,s=0,u=0,m=0;m<i.length;m++){var v=i[m];e+=v[o],a+=v[t],u+=v[o]*v[t],r+=v[o]*v[o]*v[t],f+=v[t]*Math.log(v[t]),s+=v[o]*v[t]*Math.log(v[t])}for(var F=a*r-u*u,R=Math.pow(Math.E,(r*f-u*s)/F),b=(a*s-u*f)/F,p=[],D=0;D<i.length;D++){var v=i[D],N=v.slice();N[o]=v[o],N[t]=R*Math.pow(Math.E,b*v[o]),p.push(N)}var M="y = "+Math.round(R*100)/100+"e^("+Math.round(b*100)/100+"x)";return{points:p,parameter:{coefficient:R,index:b},expression:M}},logarithmic:function(i,E){for(var o=E.dimensions[0],t=E.dimensions[1],e=0,a=0,r=0,f=0,s=0;s<i.length;s++){var u=i[s];e+=Math.log(u[o]),a+=u[t]*Math.log(u[o]),r+=u[t],f+=Math.pow(Math.log(u[o]),2)}for(var m=(s*a-r*e)/(s*f-e*e),v=(r-m*e)/s,F=[],R=0;R<i.length;R++){var u=i[R],b=u.slice();b[o]=u[o],b[t]=m*Math.log(u[o])+v,F.push(b)}var p="y = "+Math.round(v*100)/100+" + "+Math.round(m*100)/100+"ln(x)";return{points:F,parameter:{gradient:m,intercept:v},expression:p}},polynomial:function(i,E){var o=E.dimensions[0],t=E.dimensions[1],e=E.order;e==null&&(e=2);for(var a=[],r=[],f=e+1,s=0;s<f;s++){for(var u=0,m=0;m<i.length;m++){var v=i[m];u+=v[t]*Math.pow(v[o],s)}r.push(u);for(var F=[],R=0;R<f;R++){for(var b=0,p=0;p<i.length;p++)b+=Math.pow(i[p][o],s+R);F.push(b)}a.push(F)}a.push(r);for(var D=x(a,f),N=[],s=0;s<i.length;s++){for(var M=0,v=i[s],m=0;m<D.length;m++)M+=D[m]*Math.pow(v[o],m);var I=v.slice();I[o]=v[o],I[t]=M,N.push(I)}for(var T="y = ",s=D.length-1;s>=0;s--)s>1?T+=Math.round(D[s]*Math.pow(10,s+1))/Math.pow(10,s+1)+"x^"+s+" + ":s===1?T+=Math.round(D[s]*100)/100+"x + ":T+=Math.round(D[s]*100)/100;return{points:N,parameter:D,expression:T}}};function x(i,E){for(var o=0;o<i.length-1;o++){for(var t=o,e=o+1;e<i.length-1;e++)Math.abs(i[o][e])>Math.abs(i[o][t])&&(t=e);for(var a=o;a<i.length;a++){var r=i[a][o];i[a][o]=i[a][t],i[a][t]=r}for(var f=o+1;f<i.length-1;f++)for(var s=i.length-1;s>=o;s--)i[s][f]-=i[s][o]/i[o][o]*i[o][f]}for(var u=new Array(E),m=i.length-1,e=i.length-2;e>=0;e--){for(var r=0,o=e+1;o<i.length-1;o++)r+=i[o][e]*u[o];u[e]=(i[m][e]-r)/i[e][e]}return u}var y=function(i,E,o){var t=typeof o=="number"?{order:o}:o||{},e=h(t.dimensions,[0,1]),a=A(E,{dimensions:e}),r=g[i](a,{order:t.order,dimensions:e}),f=e[0];return r.points.sort(function(s,u){return s[f]-u[f]}),r};return y}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _={};return _.max=n(7),_.deviation=n(8),_.mean=n(10),_.median=n(12),_.min=n(14),_.quantile=n(13),_.sampleVariance=n(9),_.sum=n(11),_}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(4),A=_.isNumber;function h(g){for(var x=-1/0,y=0;y<g.length;y++)A(g[y])&&g[y]>x&&(x=g[y]);return x}return h}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(9);return function(A){var h=_(A);return h&&Math.sqrt(h)}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(4),A=_.isNumber,h=n(10);function g(x){var y=x.length;if(!y||y<2)return 0;if(x.length>=2){for(var i=h(x),E=0,o,t=0;t<x.length;t++)A(x[t])&&(o=x[t]-i,E+=o*o);return E/(x.length-1)}}return g}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(11);function A(h){var g=h.length;return g?_(h)/h.length:0}return A}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(4),A=_.isNumber;function h(g){var x=g.length;if(!x)return 0;for(var y=0,i=0;i<x;i++)A(g[i])&&(y+=g[i]);return y}return h}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(13);function A(h){return _(h,.5)}return A}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){return function(_,A){var h=_.length;if(!h)return 0;if(A<=0||h<2)return _[0];if(A>=1)return _[h-1];var g=(h-1)*A,x=Math.floor(g),y=_[x],i=_[x+1];return y+(i-y)*(g-x)}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(4),A=_.isNumber;function h(g){for(var x=1/0,y=0;y<g.length;y++)A(g[y])&&g[y]<x&&(x=g[y]);return x}return h}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(7),A=n(14),h=n(13),g=n(8),x=n(2),y=x.dataPreprocess,i=x.normalizeDimensions,E=n(3),o=E.ascending,t=E.map,e=n(16),a=E.bisect,r=n(17);function f(Y,m){for(var v=typeof m=="string"?{method:m}:m||{},F=v.method==null?s.squareRoot:s[v.method],R=i(v.dimensions),b=y(Y,{dimensions:R,toOneDimensionArray:!0}),p=_(b),D=A(b),N=F(b,D,p),M=r(D,p,N),I=M.step,T=M.toFixedPrecision,C=e(+(Math.ceil(D/I)*I).toFixed(T),+(Math.floor(p/I)*I).toFixed(T),I,T),P=C.length,W=new Array(P+1),L=0;L<=P;L++)W[L]={},W[L].sample=[],W[L].x0=L>0?C[L-1]:C[L]-D===I?D:C[L]-I,W[L].x1=L<P?C[L]:p-C[L-1]===I?p:C[L-1]+I;for(var L=0;L<b.length;L++)D<=b[L]&&b[L]<=p&&W[a(C,b[L],0,P)].sample.push(b[L]);var Y=t(W,function(Z){return[+((Z.x0+Z.x1)/2).toFixed(T),Z.sample.length,Z.x0,Z.x1,Z.x0+" - "+Z.x1]}),se=t(W,function(Z){return[Z.x0,Z.x1,Z.sample.length]});return{bins:W,data:Y,customData:se}}var s={squareRoot:function(u){var m=Math.ceil(Math.sqrt(u.length));return m>50?50:m},scott:function(u,m,v){return Math.ceil((v-m)/(3.5*g(u)*Math.pow(u.length,-1/3)))},freedmanDiaconis:function(u,m,v){return u.sort(o),Math.ceil((v-m)/(2*(h(u,.75)-h(u,.25))*Math.pow(u.length,-1/3)))},sturges:function(u){return Math.ceil(Math.log(u.length)/Math.LN2)+1}};return f}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(2),A=_.getPrecision;return function(h,g,x,y){var i=arguments.length;i<2?(g=h,h=0,x=1):i<3?x=1:i<4?(x=+x,y=A(x)):y=+y;for(var E=Math.ceil(((g-h)/x).toFixed(y)),o=new Array(E+1),t=0;t<E+1;t++)o[t]=+(h+t*x).toFixed(y);return o}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(4);return function(A,h,g){var x=Math.abs(h-A)/g,y=_.quantityExponent(x),i=Math.pow(10,y),E=x/i;E>=Math.sqrt(50)?i*=10:E>=Math.sqrt(10)?i*=5:E>=Math.sqrt(2)&&(i*=2);var o=y<0?-y:0,t=+(h>=A?i:-i).toFixed(o);return{step:t,toFixedPrecision:o}}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(5),A=n(19),h=2;return{type:"ecStat:regression",transform:function(x){var y=x.upstream,i=x.config||{},E=i.method||"linear",o=_(E,y.cloneRawData(),{order:i.order,dimensions:A.normalizeExistingDimensions(x,i.dimensions)}),t=o.points,e=i.formulaOn;e==null&&(e="end");var a;if(e!=="none"){for(var r=0;r<t.length;r++)t[r][h]=e==="start"&&r===0||e==="all"||e==="end"&&r===t.length-1?o.expression:"";a=y.cloneAllDimensionInfo(),a[h]={}}return[{dimensions:a,data:t}]}}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(3),A=n(4),h=n(20);function g(y,i){if(i==null)return;var E=y.upstream;if(_.isArray(i)){for(var o=[],t=0;t<i.length;t++){var e=E.getDimensionInfo(i[t]);a(e,i[t]),o[t]=e.index}return o}else{var e=E.getDimensionInfo(i);return a(e,i),e.index}function a(r,f){if(!r)throw new Error("Can not find dimension by "+f)}}function x(y){if(_.isArray(y)){for(var i=[],E=[],o=0;o<y.length;o++){var t=e(y[o]);i.push(t.name),E.push(t.index)}return{name:i,index:E}}else if(y!=null)return e(y);function e(a){if(A.isNumber(a))return{index:a};if(h.isObject(a)&&A.isNumber(a.index))return a;throw new Error("Illegle new dimensions config. Expect `{ name: string, index: number }`.")}}return{normalizeExistingDimensions:g,normalizeNewDimensions:x}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){function _(h,g){if(Object.assign)Object.assign(h,g);else for(var x in g)g.hasOwnProperty(x)&&(h[x]=g[x]);return h}function A(h){const g=typeof h;return g==="function"||!!h&&g==="object"}return{extend:_,isObject:A}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(15),A=n(19);return{type:"ecStat:histogram",transform:function(g){var x=g.upstream,y=g.config||{},i=_(x.cloneRawData(),{method:y.method,dimensions:A.normalizeExistingDimensions(g,y.dimensions)});return[{dimensions:["MeanOfV0V1","VCount","V0","V1","DisplayableName"],data:i.data},{data:i.customData}]}}}).call(d,n,d,c),l!==void 0&&(c.exports=l)}),(function(c,d,n){var l;l=(function(w){var _=n(1),A=n(4),h=n(19),g=A.isNumber;return{type:"ecStat:clustering",transform:function(y){var i=y.upstream,E=y.config||{},o=E.clusterCount;if(!g(o)||o<=0)throw new Error('config param "clusterCount" need to be specified as an interger greater than 1.');if(o===1)return[{},{data:[]}];var t=h.normalizeNewDimensions(E.outputClusterIndexDimension),e=h.normalizeNewDimensions(E.outputCentroidDimensions);if(t==null)throw new Error("outputClusterIndexDimension is required as a number.");for(var a=_.hierarchicalKMeans(i.cloneRawData(),{clusterCount:o,stepByStep:!1,dimensions:h.normalizeExistingDimensions(y,E.dimensions),outputType:_.OutputType.SINGLE,outputClusterIndexDimension:t.index,outputCentroidDimensions:(e||{}).index}),r=i.cloneAllDimensionInfo(),f=[],s=0;s<r.length;s++){var u=r[s];f.push(u.name)}if(f[t.index]=t.name,e)for(var s=0;s<e.index.length;s++)e.name[s]!=null&&(f[e.index[s]]=e.name[s]);return[{dimensions:f,data:a.data},{data:a.centroids}]}}}).call(d,n,d,c),l!==void 0&&(c.exports=l)})])})})(he)),he.exports}var be,Oe;function zt(){return Oe||(Oe=1,be=Rt()),be}var $t=zt();const Pt=Ke($t);async function Ut(G){return(await Ye.get("/django/api/strategy/industry-fund-flow-correlation/",{params:{sector_code:G.sector_code,start_date:G.start_date,end_date:G.end_date,x_axis:G.x_axis??"change_percent",y_axis:G.y_axis??"main",sort_order:G.sort_order??"desc"}})).data}const Vt=[{value:"change_percent",label:"涨跌幅(%)"},{value:"turnover_rate",label:"换手率(%)"},{value:"amplitude",label:"振幅(%)"}],Wt=[{value:"main",label:"主力净流入"},{value:"super_large",label:"超大单净流入"},{value:"large",label:"大单净流入"},{value:"medium",label:"中单净流入"},{value:"small",label:"小单净流入"},{value:"all",label:"全部净流入"}],Bt={class:"industry-fund-flow-correlation-scatter"},Kt={class:"card-header"},Yt={class:"title-left"},Xt={class:"subtitle"},Gt={class:"controls"},kt={class:"control-group"},qt={class:"control-group"},Ht={class:"control-group"},Zt={class:"control-group"},Qt=ce({__name:"IndustryFundFlowCorrelationScatter",props:{sectorCode:{},industryName:{},title:{},height:{default:"480px"}},setup(G){Pe(Pt.transform.regression);const $=G,c=z(20),d=z("change_percent"),n=z(["main","all"]),l=z("desc"),w=Vt,_=Wt,A=z();let h=null;const g=z(!1),x=z(0);function y(t){return t.toISOString().split("T")[0]}function i(t){const e=new Date,a=new Date(Date.now()-t*24*60*60*1e3);return[y(a),y(e)]}async function E(){if($.sectorCode){g.value=!0;try{const[t,e]=i(c.value),a=await Promise.all(n.value.map(m=>Ut({sector_code:$.sectorCode,start_date:t,end_date:e,x_axis:d.value,y_axis:m,sort_order:l.value}).catch(v=>(console.error("获取相关性散点失败:",v),null)))),r=[],f=[],s=[];if(a.forEach((m,v)=>{if(!m||!m.points||m.points.length===0)return;const F=n.value[v],R=_.find(D=>D.value===F)?.label||F,b=m.points.map(D=>[D.x,D.y,D.date]),p=r.length;r.push({source:b}),r.push({transform:{type:"ecStat:regression",config:{method:"polynomial",order:3}},fromDatasetIndex:p}),f.push({name:`${R} 散点`,type:"scatter",datasetIndex:p,symbolSize:8,emphasis:{focus:"none",scale:!1,label:{show:!1}},label:{show:!1}}),f.push({name:`${R} 回归`,type:"line",smooth:!0,datasetIndex:p+1,symbolSize:.1,symbol:"circle",emphasis:{focus:"none",scale:!1,label:{show:!1}},label:{show:!1}}),s.push(`${R} 散点`),s.push(`${R} 回归`)}),x.value=f.length,await de(),!A.value)return;h||(h=ue(A.value));const u={title:{text:$.title||`${$.industryName||""} - 资金流相关性散点图（含多项式回归）`,left:"center",top:10},tooltip:{trigger:"item",formatter:m=>{if(Array.isArray(m.data)){const[v,F,R]=m.data,b=w.find(p=>p.value===d.value)?.label||d.value;return`${R||""}<br/>${b}: ${typeof v=="number"?v.toFixed(2):v}<br/>${m.seriesName}: ${typeof F=="number"?F.toFixed(2):F}`}return`${m.seriesName}`},confine:!0,appendToBody:!0},legend:{top:54,data:s},grid:{left:60,right:30,top:150,bottom:40,containLabel:!0},xAxis:{type:"value",name:w.find(m=>m.value===d.value)?.label},yAxis:{type:"value",name:"净流入(元)"},dataset:r,series:f};h.setOption(u),h.resize()}catch(t){console.error(t),oe.error("获取相关性散点数据失败")}finally{g.value=!1}}}re(()=>$.sectorCode,E),re([c,d,n,l],E,{deep:!0}),ve(()=>{E(),window.addEventListener("resize",o)}),ye(()=>{h&&(h.dispose(),h=null),window.removeEventListener("resize",o)});function o(){h?.resize()}return(t,e)=>{const a=K("el-option"),r=K("el-select"),f=K("el-empty"),s=K("el-card");return U(),H("div",Bt,[O(s,{class:"control-card",shadow:"hover"},{header:V(()=>[S("div",Kt,[S("div",Yt,[S("h3",null,X(t.title||`${t.industryName} - 行业资金流相关性散点图`),1),S("div",Xt,"行业板块代码："+X(t.sectorCode),1)]),S("div",Gt,[S("div",kt,[e[4]||(e[4]=S("span",{class:"control-label"},"时间范围：",-1)),O(r,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=u=>c.value=u),style:{width:"120px"}},{default:V(()=>[O(a,{value:20,label:"最近20天"}),O(a,{value:40,label:"最近40天"}),O(a,{value:60,label:"最近60天"}),O(a,{value:120,label:"最近120天"})]),_:1},8,["modelValue"])]),S("div",qt,[e[5]||(e[5]=S("span",{class:"control-label"},"X轴：",-1)),O(r,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=u=>d.value=u),style:{width:"160px"}},{default:V(()=>[(U(!0),H(pe,null,ge(Le(w),u=>(U(),j(a,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),S("div",Ht,[e[6]||(e[6]=S("span",{class:"control-label"},"Y轴（可多选）：",-1)),O(r,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=u=>n.value=u),multiple:"","collapse-tags":"","max-collapse-tags":2,style:{"min-width":"260px"}},{default:V(()=>[(U(!0),H(pe,null,ge(Le(_),u=>(U(),j(a,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),S("div",Zt,[e[7]||(e[7]=S("span",{class:"control-label"},"排序：",-1)),O(r,{modelValue:l.value,"onUpdate:modelValue":e[3]||(e[3]=u=>l.value=u),style:{width:"120px"}},{default:V(()=>[O(a,{value:"desc",label:"按Y降序"}),O(a,{value:"asc",label:"按Y升序"})]),_:1},8,["modelValue"])])])])]),default:V(()=>[S("div",{ref_key:"chartRef",ref:A,class:"chart-container",style:Xe({height:t.height})},null,4),!g.value&&x.value===0?(U(),j(f,{key:0,description:"暂无数据"})):J("",!0)]),_:1})])}}}),Jt=fe(Qt,[["__scopeId","data-v-002ed94d"]]),jt={class:"industry-analysis"},en={class:"filter-row"},tn={class:"filter-item"},nn={class:"filter-item"},an={class:"filter-item"},rn={key:5,class:"loading-overlay"},on=ce({__name:"IndustryAnalysis",setup(G){const $=z(!1),c=z(),d=z(""),n=z(null),l=z([]),w=z([{label:"年报",value:"annual"},{label:"中报",value:"semi_annual"},{label:"一季报",value:"q1"},{label:"三季报",value:"q3"},{label:"季报",value:"quarterly"}]),_=ie(()=>c.value==="all"?"全部行业":l.value.find(e=>e.name===c.value)?.name||"未知行业"),A=ie(()=>w.value.find(e=>e.value===d.value)?.label||"未选择"),h=ie(()=>l.value.find(e=>e.name===c.value)?.code||""),g=ie(()=>{if(n.value)return n.value[0];const t=new Date;return new Date(t.getTime()-480*60*60*1e3).toISOString().split("T")[0]}),x=ie(()=>n.value?n.value[1]:new Date().toISOString().split("T")[0]),y=async()=>{$.value=!0;try{const t=await $e();console.log("获取行业列表响应:",t),l.value=t.sectors,console.log("行业列表:",l.value),w.value.length>0&&(d.value=w.value[0].value);const e=new Date,a=new Date(e.getTime()-480*60*60*1e3);n.value=[a.toISOString().split("T")[0],e.toISOString().split("T")[0]],oe.success("页面初始化完成")}catch(t){console.error("初始化数据失败:",t),oe.error("初始化数据失败，请刷新页面重试")}finally{$.value=!1}},i=()=>{console.log("行业已变更为:",c.value)},E=()=>{console.log("季度已变更为:",d.value)},o=()=>{console.log("日期范围已变更为:",n.value)};return ve(()=>{y()}),(t,e)=>{const a=K("el-option"),r=K("el-select"),f=K("el-date-picker"),s=K("el-card"),u=K("el-empty"),m=K("el-loading");return U(),H("div",jt,[O(s,{class:"filter-panel",shadow:"hover"},{default:V(()=>[S("div",en,[S("div",tn,[e[3]||(e[3]=S("label",{class:"filter-label"},"选择行业：",-1)),O(r,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=v=>c.value=v),placeholder:"请选择行业",style:{width:"200px"},onChange:i},{default:V(()=>[(U(!0),H(pe,null,ge(l.value,v=>(U(),j(a,{key:v.name,label:v.name,value:v.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),S("div",nn,[e[4]||(e[4]=S("label",{class:"filter-label"},"选择季度：",-1)),O(r,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=v=>d.value=v),placeholder:"请选择季度",style:{width:"150px"},onChange:E},{default:V(()=>[(U(!0),H(pe,null,ge(w.value,v=>(U(),j(a,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),S("div",an,[e[5]||(e[5]=S("label",{class:"filter-label"},"日期范围：",-1)),O(f,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=v=>n.value=v),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"320px"},onChange:o},null,8,["modelValue"])])])]),_:1}),c.value&&c.value!=="all"&&h.value?(U(),j(s,{key:0,class:"kline-panel",shadow:"hover"},{default:V(()=>[O(Ft,{"industry-code":h.value,title:`${_.value} - 行业K线图`,"start-date":g.value,"end-date":x.value},null,8,["industry-code","title","start-date","end-date"])]),_:1})):J("",!0),c.value&&c.value!=="all"?(U(),j(s,{key:1,class:"fund-flow-panel",shadow:"hover"},{default:V(()=>[O(ct,{industry:_.value,title:`${_.value} - 资金流热力图`,"start-date":g.value,"end-date":x.value},null,8,["industry","title","start-date","end-date"])]),_:1})):J("",!0),c.value&&d.value?(U(),j(St,{key:2,industry:c.value,quarter:d.value,"industry-name":_.value,"quarter-name":A.value},null,8,["industry","quarter","industry-name","quarter-name"])):J("",!0),!c.value||!d.value?(U(),j(u,{key:3,description:"请选择行业和季度查看趋势分析","image-size":200})):J("",!0),c.value&&c.value!=="all"&&h.value?(U(),j(s,{key:4,class:"fund-flow-panel",shadow:"hover"},{default:V(()=>[O(Jt,{"sector-code":h.value,"industry-name":_.value,title:`${_.value} - 资金流相关性散点图`,height:"500px"},null,8,["sector-code","industry-name","title"])]),_:1})):J("",!0),$.value?(U(),H("div",rn,[O(m,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):J("",!0)])}}}),vn=fe(on,[["__scopeId","data-v-2739633f"]]);export{vn as default};
