import{d as q,a as w,z as R,B as H,c as C,b as i,e as o,w as a,i as p,t as k,f as c,g as v,k as u,E as I,u as P,o as r,_ as U}from"./index-DBlIMAuh.js";import{f as W}from"./indexBasicApi-DHXZFlIS.js";const Z={class:"index-tree-view"},j={class:"main-container"},F={class:"tree-wrapper"},J={class:"custom-tree-node"},Q={class:"node-label"},ee={class:"node-info"},te={key:0,class:"detail-content"},ae={class:"tab-content"},le={class:"detail-title"},ne={key:0,class:"children-section"},oe={class:"section-header"},se={key:1,class:"no-children-tip"},re={key:1,class:"empty-state"},de=q({__name:"IndexTreeView",setup(ie){const A=P(),n=w(null),m=w(null),b=w([]),x=w("basic"),T=w(new Map),D=[{code:"MSCI",name:"MSCI"},{code:"CSI",name:"中证"},{code:"SSE",name:"上交所"},{code:"SZSE",name:"深交所"},{code:"CICC",name:"中金"},{code:"SW",name:"申万"},{code:"OTH",name:"其他"}],O={label:"label",isLeaf:(l,e)=>l.nodeType==="INDEX"},g=l=>{l&&l.childNodes?b.value=l.childNodes.map(e=>e.data):b.value=[]},M=async(l,e)=>{try{if(l.level===0){e([{key:"ROOT",label:"指数分类",nodeType:"ROOT"}]);return}const t=l.data;if(t.nodeType==="ROOT"){const d=D.map(_=>({key:`MARKET:${_.code}`,label:`${_.name} (${_.code})`,nodeType:"MARKET",market:_.code}));e(d),m.value&&m.value.key===l.key&&g(l);return}if(t.nodeType==="MARKET"&&t.market){let d=T.value.get(t.market);if(!d){const s=await W({market:t.market});T.value.set(t.market,s),d=s}const y=Array.from(new Set(d.map(s=>s.category||""))).filter(s=>!!s).map(s=>({key:`CATEGORY:${t.market}:${s}`,label:s,nodeType:"CATEGORY",market:t.market,category:s}));e(y),m.value&&m.value.key===l.key&&g(l);return}if(t.nodeType==="CATEGORY"&&t.market&&t.category){const y=(T.value.get(t.market)||[]).filter(s=>s.category===t.category).map(s=>({key:`INDEX:${s.ts_code}`,label:`${s.name||s.ts_code}`,nodeType:"INDEX",market:s.market,category:s.category,index:s}));e(y),m.value&&m.value.key===l.key&&g(l);return}e([])}catch(t){console.error("加载指数分类失败:",t),I.error("加载指数分类失败"),e([])}},S=(l,e)=>{n.value=l,m.value=e,g(e)},$=(l,e)=>{m.value&&m.value.key===e.key&&g(e)},V=R(()=>{if(!n.value||n.value.nodeType!=="MARKET")return[];const l=T.value.get(n.value.market||"")||[],e=new Map;for(const t of l){const d=t.category||"";d&&e.set(d,(e.get(d)||0)+1)}return Array.from(e.entries()).map(([t,d])=>({category:t,count:d}))}),z=R(()=>!n.value||n.value.nodeType!=="CATEGORY"?[]:(T.value.get(n.value.market||"")||[]).filter(e=>e.category===n.value?.category)),X=l=>{A.push({path:"/analysis/index-analysis",query:{ts_code:l.ts_code,market:l.market}}),I.success(`正在跳转到指数分析: ${l.name||""} (${l.ts_code})`)};return H(b,()=>{x.value="basic"}),(l,e)=>{const t=p("el-tag"),d=p("el-tree"),_=p("el-card"),y=p("el-descriptions-item"),s=p("el-descriptions"),f=p("el-table-column"),N=p("el-table"),G=p("el-button"),K=p("el-text"),Y=p("el-tab-pane"),B=p("el-tabs"),L=p("el-empty");return r(),C("div",Z,[i("div",j,[o(_,{class:"left-panel"},{header:a(()=>[...e[1]||(e[1]=[i("div",{class:"card-header"},[i("span",null,"指数分类树状图")],-1)])]),default:a(()=>[i("div",F,[o(d,{props:O,load:M,lazy:"","node-key":"key","highlight-current":"",onNodeClick:S,onNodeExpand:$},{default:a(({node:h,data:E})=>[i("span",J,[i("span",Q,k(h.label),1),i("span",ee,[E.nodeType==="MARKET"?(r(),c(t,{key:0,size:"small",type:"primary",effect:"plain"},{default:a(()=>[u(k(E.market),1)]),_:2},1024)):E.nodeType==="CATEGORY"?(r(),c(t,{key:1,size:"small",type:"warning",effect:"plain"},{default:a(()=>[...e[2]||(e[2]=[u(" 类别 ",-1)])]),_:1})):E.nodeType==="INDEX"?(r(),c(t,{key:2,size:"small",type:"success",effect:"plain"},{default:a(()=>[...e[3]||(e[3]=[u(" 指数 ",-1)])]),_:1})):v("",!0)])])]),_:1})])]),_:1}),o(_,{class:"right-panel"},{header:a(()=>[...e[4]||(e[4]=[i("div",{class:"card-header"},[i("span",null,"详情信息")],-1)])]),default:a(()=>[n.value?(r(),C("div",te,[o(B,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=h=>x.value=h),class:"detail-tabs"},{default:a(()=>[o(Y,{label:"基本信息",name:"basic"},{default:a(()=>[i("div",ae,[o(s,{column:1,border:""},{default:a(()=>[o(y,{label:"类型"},{default:a(()=>[n.value.nodeType==="MARKET"?(r(),c(t,{key:0,type:"primary"},{default:a(()=>[...e[5]||(e[5]=[u("市场",-1)])]),_:1})):n.value.nodeType==="CATEGORY"?(r(),c(t,{key:1,type:"warning"},{default:a(()=>[...e[6]||(e[6]=[u("类别",-1)])]),_:1})):n.value.nodeType==="INDEX"?(r(),c(t,{key:2,type:"success"},{default:a(()=>[...e[7]||(e[7]=[u("指数",-1)])]),_:1})):(r(),c(t,{key:3,type:"info"},{default:a(()=>[...e[8]||(e[8]=[u("根",-1)])]),_:1}))]),_:1}),o(y,{label:"名称"},{default:a(()=>[i("span",le,k(n.value.label),1)]),_:1}),n.value.market?(r(),c(y,{key:0,label:"市场"},{default:a(()=>[o(t,null,{default:a(()=>[u(k(n.value.market),1)]),_:1})]),_:1})):v("",!0),n.value.category?(r(),c(y,{key:1,label:"类别"},{default:a(()=>[o(t,{type:"warning"},{default:a(()=>[u(k(n.value.category),1)]),_:1})]),_:1})):v("",!0),n.value.nodeType==="INDEX"?(r(),c(y,{key:2,label:"指数代码"},{default:a(()=>[o(t,{type:"success"},{default:a(()=>[u(k(n.value.index?.ts_code),1)]),_:1})]),_:1})):v("",!0),n.value.nodeType==="INDEX"&&n.value.index?.publisher?(r(),c(y,{key:3,label:"发布方"},{default:a(()=>[u(k(n.value.index?.publisher),1)]),_:1})):v("",!0)]),_:1}),b.value.length>0?(r(),C("div",ne,[i("div",oe,[i("span",null,"下级列表 ("+k(b.value.length)+")",1)]),n.value.nodeType==="MARKET"?(r(),c(N,{key:0,data:V.value,style:{width:"100%"},height:"300",border:"",stripe:"",size:"small"},{default:a(()=>[o(f,{prop:"category",label:"类别","min-width":"160"}),o(f,{prop:"count",label:"指数数量",width:"100",align:"center"})]),_:1},8,["data"])):n.value.nodeType==="CATEGORY"?(r(),c(N,{key:1,data:z.value,style:{width:"100%"},height:"360",border:"",stripe:"",size:"small"},{default:a(()=>[o(f,{prop:"ts_code",label:"指数代码",width:"140",align:"center"}),o(f,{prop:"name",label:"指数名称","min-width":"200","show-overflow-tooltip":""}),o(f,{prop:"publisher",label:"发布方","min-width":"160","show-overflow-tooltip":""}),o(f,{prop:"market",label:"市场",width:"100",align:"center"}),o(f,{prop:"category",label:"类别",width:"120",align:"center"}),o(f,{label:"操作",width:"120",align:"center",fixed:"right"},{default:a(({row:h})=>[o(G,{type:"primary",link:"",size:"small",onClick:E=>X(h)},{default:a(()=>[...e[9]||(e[9]=[u(" 查看分析 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):v("",!0)])):n.value.nodeType!=="INDEX"?(r(),C("div",se,[o(K,{type:"info"},{default:a(()=>[...e[10]||(e[10]=[u("暂无已展开的下级节点，请在左侧点击展开",-1)])]),_:1})])):v("",!0)])]),_:1})]),_:1},8,["modelValue"])])):(r(),C("div",re,[o(L,{description:"请选择左侧节点查看详情"})]))]),_:1})])])}}}),pe=U(de,[["__scopeId","data-v-b3b064d4"]]);export{pe as default};
