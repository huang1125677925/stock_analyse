import{d as M,a as _,z as g,y as N,c as v,b as c,e as t,g as S,w as o,i as s,k as y,t as E,E as F,l as I,O as P,D as R,G,f as O,L as U,o as h,_ as $}from"./index-GrVrC4rj.js";import{g as j,b as q}from"./etfApi-iYWfUg2U.js";const A={class:"etf-realtime-view"},H={class:"page-header"},J={class:"header-content"},K={key:0,class:"sub-info"},Q={class:"date"},W=M({__name:"EtfRealtimeView",setup(X){const r=_(!1),i=_([]),k=_({}),f=_(""),w=g(()=>{const e=i.value.map(a=>a.trade_date);return e.length?e.sort().slice(-1)[0]:""}),C=g(()=>{const e=f.value.trim().toLowerCase();return e?i.value.filter(a=>(a.csname||"").toLowerCase().includes(e)):i.value}),V=e=>e==null?"":e>0?"pct-up":e<0?"pct-down":"",D=e=>e==null?"":`${e}`,x=async()=>{try{let a=1;const n={};for(;;){const p=await j({page:a,page_size:500}),d=p.data||[];if(d.forEach(u=>{n[u.ts_code]=u.csname||""}),a>=(p.pages||1)||d.length===0)break;a+=1}k.value=n}catch(e){console.warn("加载ETF基础映射失败:",e?.message)}},b=async()=>{r.value=!0;try{i.value=await q()}catch(e){F.error(e?.message||"ETF 最近交易日行情获取失败")}finally{r.value=!1}},B=()=>b();return N(async()=>{await Promise.all([b(),x()])}),(e,a)=>{const n=s("el-input"),p=s("el-icon"),d=s("el-button"),u=s("el-space"),l=s("el-table-column"),z=s("el-table"),L=s("el-card"),T=G("loading");return h(),v("div",A,[c("div",H,[c("div",J,[a[2]||(a[2]=c("h2",null,"ETF 实时行情（最近交易日）",-1)),t(u,null,{default:o(()=>[t(n,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=m=>f.value=m),placeholder:"过滤 基金简称(csname)",clearable:"",style:{width:"240px"}},null,8,["modelValue"]),t(d,{type:"primary",loading:r.value,onClick:B},{default:o(()=>[t(p,null,{default:o(()=>[t(I(P))]),_:1}),a[1]||(a[1]=y("刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),w.value?(h(),v("div",K,[a[3]||(a[3]=y(" 最近交易日：",-1)),c("span",Q,E(w.value),1)])):S("",!0)]),t(L,{class:"table-card"},{default:o(()=>[R((h(),O(z,{data:C.value,border:"",style:{width:"100%"}},{default:o(()=>[t(l,{prop:"ts_code",label:"TS代码","min-width":"140"}),t(l,{prop:"csname",label:"名称","min-width":"140"}),t(l,{prop:"trade_date",label:"交易日","min-width":"120"}),t(l,{prop:"open",label:"开盘","min-width":"90"}),t(l,{prop:"high",label:"最高","min-width":"90"}),t(l,{prop:"low",label:"最低","min-width":"90"}),t(l,{prop:"close",label:"收盘","min-width":"90"}),t(l,{prop:"pre_close",label:"昨收","min-width":"90"}),t(l,{prop:"change",label:"涨跌额","min-width":"90",sortable:""}),t(l,{prop:"pct_chg",label:"涨跌幅(%)","min-width":"110",sortable:""},{default:o(({row:m})=>[c("span",{class:U(V(m.pct_chg))},E(D(m.pct_chg)),3)]),_:1}),t(l,{prop:"vol",label:"成交量(手)","min-width":"120",sortable:""}),t(l,{prop:"amount",label:"成交额","min-width":"120",sortable:""})]),_:1},8,["data"])),[[T,r.value]])]),_:1})])}}}),ee=$(W,[["__scopeId","data-v-a89c7508"]]);export{ee as default};
