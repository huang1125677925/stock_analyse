import{x as J,d as Q,a as v,B,z as D,c as K,b as _,D as P,e as n,i as E,w as x,L as j,k as G,X,o as U,H as te,_ as Y,y as ae,G as oe,E as q,g as ne}from"./index-hKQdfw1y.js";import"./index-ElshY9iF.js";import{H as W}from"./HeatmapChart-D9uMxBb8.js";/* empty css                                                                   */const le="/django/api/market",H={main_net_inflow_amount:{name:"主力净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},small_net_inflow_amount:{name:"小单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},medium_net_inflow_amount:{name:"中单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},large_net_inflow_amount:{name:"大单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},super_large_net_inflow_amount:{name:"超大单净流入金额",unit:"元",formatter:e=>e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2)},main_net_inflow_ratio:{name:"主力净流入比例",unit:"%",formatter:e=>e.toFixed(2)},small_net_inflow_ratio:{name:"小单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},medium_net_inflow_ratio:{name:"中单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},large_net_inflow_ratio:{name:"大单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},super_large_net_inflow_ratio:{name:"超大单净流入比例",unit:"%",formatter:e=>e.toFixed(2)},shanghai_close_price:{name:"上证收盘价",unit:"点",formatter:e=>e.toFixed(2)},shanghai_change_rate:{name:"上证涨跌幅",unit:"%",formatter:e=>e.toFixed(2)},shenzhen_close_price:{name:"深证收盘价",unit:"点",formatter:e=>e.toFixed(2)},shenzhen_change_rate:{name:"深证涨跌幅",unit:"%",formatter:e=>e.toFixed(2)}};async function re(e,f,u=1,w=20,F="-date"){try{const s={page:u,page_size:w,order_by:F};return e&&(s.start_date=e),f&&(s.end_date=f),(await J.get(`${le}/fund-flow/`,{params:s})).data}catch(s){throw console.error("获取大盘资金流数据失败:",s),s}}const ie={class:"market-fund-flow-heatmaps"},se={class:"heatmap-toolbar"},ce={class:"heatmap-section"},ue={class:"heatmap-section"},de=Q({name:"MarketFundFlowHeatmap",__name:"MarketFundFlowHeatmap",props:{data:{},selectedMetric:{default:"main_net_inflow_amount"},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chart-ready","chart-click"],setup(e,{emit:f}){const u=v("amount"),w=v(null),F=v(null);B(u,async a=>{await te(),a==="amount"?w.value?.resize():F.value?.resize(),setTimeout(()=>{a==="amount"?w.value?.resize():F.value?.resize()},50)});const s=e,h=f,A=D(()=>{if(!s.data)return[];let a=s.data;return s.searchKeyword?.trim()&&(a=s.data.filter(o=>o.date.toLowerCase().includes(s.searchKeyword.toLowerCase()))),[...a].sort((o,r)=>{const t=new Date(o.date).getTime(),d=new Date(r.date).getTime();return Number.isNaN(t)||Number.isNaN(d)?o.date.localeCompare(r.date):t-d})}),N=D(()=>Object.keys(H).filter(a=>a.endsWith("_amount"))),k=D(()=>Object.keys(H).filter(a=>a.endsWith("_ratio"))),M=(a,o,r)=>{const t=A.value;if(!t||t.length===0)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const d=a.map(g=>H[g].name),p=t.map(g=>g.date),y=[];let m=1/0,b=-1/0;return t.forEach((g,I)=>{a.forEach(($,R)=>{const C=g[$];if(typeof C=="number"&&!isNaN(C)&&isFinite(C)){let S=!0;if((s.valueFilter==="positive"&&C<=0||s.valueFilter==="negative"&&C>=0)&&(S=!1),S){const z=$.endsWith("_amount")?C/1e8:C;y.push([I,R,z]),m=Math.min(m,z),b=Math.max(b,z)}}})}),(m===1/0||b===-1/0)&&(m=0,b=100),{title:{text:o,left:"center"},tooltip:{position:"top",formatter:function(g){const[I,$,R]=g.data,C=t[I],S=a[$],L=H[S],z=S.endsWith("_amount"),Z=z?Number(R).toFixed(2):L.formatter?L.formatter(R):Number(R).toFixed(2),ee=z?"亿":L.unit;return`${C.date}<br/>${L.name}: ${Z}${ee}`}},grid:{height:Math.max(240,a.length*24)+"px",top:"8%",left:"2%",right:"16%",bottom:"6%",containLabel:!0},xAxis:[{type:"category",data:p,splitArea:{show:!0},axisLabel:{fontSize:12}}],yAxis:[{type:"category",data:d,splitArea:{show:!0},axisLabel:{fontSize:11}}],visualMap:{min:m,max:b,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#00C853","#FF1744"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:o,type:"heatmap",data:y,label:{show:r,fontSize:9,formatter:function(g){const I=g.data[2];return a[g.data[1]].endsWith("_amount")?Number(I).toFixed(1)+"亿":Number(I).toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},V=D(()=>M(N.value,"金额热力图",!1)),O=D(()=>M(k.value,"比例热力图",!0));D(()=>[{key:"shanghai_close_price",label:"上证收盘价",color:"#409EFF",yAxisIndex:0},{key:"shanghai_change_rate",label:"上证涨跌幅(%)",color:"#67C23A",yAxisIndex:1}]);const T=a=>h("chart-ready",a),c=a=>h("chart-ready",a),i=a=>{const o=a?.data;if(!o)return;const[r,t,d]=o;if(typeof r!="number"||typeof t!="number")return;const p=A.value;if(r<0||r>=p.length||t<0||t>=N.value.length)return;const y=p[r],m=N.value[t],b=y?.date;h("chart-click",{date:b,value:d,metric:m,rawParams:a})},l=a=>{const o=a?.data;if(!o)return;const[r,t,d]=o;if(typeof r!="number"||typeof t!="number")return;const p=A.value;if(r<0||r>=p.length||t<0||t>=k.value.length)return;const y=p[r],m=k.value[t],b=y?.date;h("chart-click",{date:b,value:d,metric:m,rawParams:a})};return(a,o)=>{const r=E("el-button"),t=E("el-button-group");return U(),K("div",ie,[_("div",se,[n(t,null,{default:x(()=>[n(r,{type:"primary",plain:"",class:j({active:u.value==="amount"}),onClick:o[0]||(o[0]=d=>u.value="amount")},{default:x(()=>[...o[2]||(o[2]=[G("金额热力图",-1)])]),_:1},8,["class"]),n(r,{type:"primary",plain:"",class:j({active:u.value==="ratio"}),onClick:o[1]||(o[1]=d=>u.value="ratio")},{default:x(()=>[...o[3]||(o[3]=[G("比例热力图",-1)])]),_:1},8,["class"])]),_:1})]),P(_("div",ce,[n(W,{ref_key:"amountChartRef",ref:w,option:V.value,onChartReady:T,onChartClick:i},null,8,["option"])],512),[[X,u.value==="amount"]]),P(_("div",ue,[n(W,{ref_key:"ratioChartRef",ref:F,option:O.value,onChartReady:c,onChartClick:l},null,8,["option"])],512),[[X,u.value==="ratio"]])])}}}),me=Y(de,[["__scopeId","data-v-6aebdb21"]]),fe="/django/api/market";async function he(e){const{indexCode:f,startDate:u,endDate:w,limit:F}=e;return(await J.get(`${fe}/rise-fall-ratio/`,{params:{index_code:f,start_date:u,end_date:w,limit:F}})).data?.results??[]}const _e={class:"market-analysis","element-loading-text":"正在加载大盘数据..."},pe={class:"fund-flow-section"},ve={class:"chart-header"},xe={class:"chart-controls"},ye={class:"chart-container"},ge={key:0,class:"rise-fall-section"},we={class:"chart-header"},Fe={class:"chart-controls"},be={class:"chart-container"},Ce=Q({__name:"MarketAnalysis",setup(e){const f=v(!1),u=v([]),w=v("main_net_inflow_amount"),F=v(""),s=v("all"),h=v(20);async function A(){try{f.value=!0;const c=new Date().toISOString().split("T")[0],i=new Date(Date.now()-h.value*24*60*60*1e3).toISOString().split("T")[0],l=await re(i,c,1,h.value,"-date");u.value=l.list??[]}catch(c){console.error("获取大盘资金流数据出错:",c),q.error("获取大盘资金流数据出错")}finally{f.value=!1}}function N(c){console.log("fund flow chart click:",c)}const k=v("all"),M=v([]);async function V(){try{f.value=!0;const c=new Date().toISOString().split("T")[0],i=new Date(Date.now()-h.value*24*60*60*1e3).toISOString().split("T")[0],l=await he({indexCode:k.value,startDate:i,endDate:c});M.value=[...l].sort((a,o)=>a.date.localeCompare(o.date))}catch(c){console.error("获取涨跌比数据出错:",c),q.error("获取涨跌比数据出错")}finally{f.value=!1}}const O=D(()=>{const c=M.value.map(t=>t.date),i=[{key:"rise_fall_ratio_20",label:"20日涨跌比"},{key:"rise_fall_ratio_60",label:"60日涨跌比"},{key:"rise_fall_ratio_120",label:"120日涨跌比"}],l=[],a=[];M.value.forEach((t,d)=>{i.forEach((p,y)=>{const m=t[p.key];typeof m=="number"&&(l.push(m),a.push([d,y,m]))})});const o=l.length?Math.min(...l):0,r=l.length?Math.max(...l):1;return{tooltip:{position:"top",formatter:t=>{const d=c[t.value[0]],p=i[t.value[1]].label,y=t.value[2];return`${d}<br/>${p}: ${y.toFixed(4)}`}},grid:{left:80,right:30,top:40,bottom:40},xAxis:{type:"category",data:c,axisLabel:{rotate:45}},yAxis:{type:"category",data:i.map(t=>t.label)},visualMap:{min:o,max:r,calculable:!0,orient:"horizontal",left:"center",bottom:0,inRange:{color:["#50a3ba","#eac763","#d94e5d"]}},series:[{name:"涨跌比热力图",type:"heatmap",data:a,progressive:0,label:{show:!1}}]}});function T(c){console.log("rise-fall chart click:",c)}return ae(()=>{A(),V()}),B(h,()=>{A(),V()}),B(k,()=>{V()}),(c,i)=>{const l=E("el-option"),a=E("el-select"),o=E("el-card"),r=oe("loading");return P((U(),K("div",_e,[_("div",pe,[n(o,{shadow:"hover"},{header:x(()=>[_("div",ve,[i[3]||(i[3]=_("h3",null,"大盘资金流热力图",-1)),_("div",xe,[n(a,{modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=t=>h.value=t),placeholder:"时间范围",style:{width:"120px","margin-right":"10px"}},{default:x(()=>[n(l,{label:"20天",value:20}),n(l,{label:"30天",value:30}),n(l,{label:"40天",value:40}),n(l,{label:"60天",value:60}),n(l,{label:"90天",value:90}),n(l,{label:"120天",value:120}),n(l,{label:"180天",value:180})]),_:1},8,["modelValue"]),n(a,{modelValue:s.value,"onUpdate:modelValue":i[1]||(i[1]=t=>s.value=t),placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:x(()=>[n(l,{label:"全部",value:"all"}),n(l,{label:"正值",value:"positive"}),n(l,{label:"负值",value:"negative"})]),_:1},8,["modelValue"])])])]),default:x(()=>[_("div",ye,[n(me,{data:u.value,selectedMetric:w.value,searchKeyword:F.value,valueFilter:s.value,onChartClick:N},null,8,["data","selectedMetric","searchKeyword","valueFilter"])])]),_:1}),n(o,{class:"mt-16",shadow:"never"},{default:x(()=>[M.value.length>0?(U(),K("div",ge,[n(o,{class:"mt-16",shadow:"hover"},{header:x(()=>[_("div",we,[i[4]||(i[4]=_("h3",null,"新高新低比热力图",-1)),_("div",Fe,[n(a,{modelValue:k.value,"onUpdate:modelValue":i[2]||(i[2]=t=>k.value=t),placeholder:"指数代码",style:{width:"160px"}},{default:x(()=>[n(l,{label:"全部A股",value:"all"}),n(l,{label:"上证50",value:"sz50"}),n(l,{label:"沪深300",value:"hs300"}),n(l,{label:"中证500",value:"zz500"})]),_:1},8,["modelValue"])])])]),default:x(()=>[_("div",be,[n(W,{option:O.value,height:480,onChartClick:T},null,8,["option"])])]),_:1})])):ne("",!0)]),_:1})])])),[[r,f.value]])}}}),Ie=Y(Ce,[["__scopeId","data-v-3c7e3fd7"]]);export{Ie as default};
