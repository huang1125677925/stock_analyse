import{H as L}from"./HeatmapChart-DbS_18hy.js";import{g as w,c as O}from"./etfApi-CE2tO5as.js";import{d as q,a as g,r as R,B as U,z as H,y as J,c as Y,b as E,e as l,w as c,i as u,E as h,k as V,F as j,A as G,f as K,o as M,_ as Z}from"./index-Dh57P_Gm.js";import"./index-ElshY9iF.js";const P={class:"etf-correlation-view"},Q={class:"page-header"},W={class:"header-content"},C="etfCorrelationSelectedEtfs",X=q({__name:"EtfCorrelationView",setup(ee){const b=g(!1),v=g([]),p=g(!1),x=g(null),y=g({}),o=R({ts_codes:[],start_date:"",end_date:""}),S=t=>{const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${i}`},F=()=>{const t=new Date,e=new Date;e.setDate(t.getDate()-60),o.start_date=S(e),o.end_date=S(t)},k=async t=>{const e=(t||"").trim();if(e){p.value=!0;try{const a=/^[0-9]{3,6}\.[A-Z]{2,3}$/.test(e),i=await w({ts_code:a?e:void 0,name:a?void 0:e,page:1,page_size:20});v.value=i.data||[]}catch(a){h.error(a?.message||"ETF 基础列表搜索失败")}finally{p.value=!1}}},A=async()=>{p.value=!0;try{const t=await w({page:1,page_size:50});v.value=t.data||[]}catch(t){h.error(t?.message||"ETF 基础列表加载失败")}finally{p.value=!1}},N=async()=>{if(!o.ts_codes||o.ts_codes.length<2){h.warning("请至少选择两个ETF进行相关性分析");return}b.value=!0;try{x.value=await O({ts_codes:o.ts_codes,start_date:o.start_date||void 0,end_date:o.end_date||void 0})}catch(t){h.error(t?.message||"相关性数据查询失败")}finally{b.value=!1}},T=()=>N(),$=()=>{o.ts_codes=[],x.value=null},z=async t=>{const e=t.filter(a=>!y.value[a]);if(e.length!==0)for(const a of e)try{const r=((await w({ts_code:a,page:1,page_size:1})).data||[])[0];r&&(y.value[a]=r)}catch{}},B=()=>{const t=o.ts_codes.slice(),e=t.map(a=>y.value[a]).filter(Boolean);try{localStorage.setItem(C,JSON.stringify({ts_codes:t,details:e}))}catch{}},D=t=>{const e=y.value[t]||v.value.find(a=>a.ts_code===t);return e&&(e.extname||e.csname||e.cname)||t};U(()=>o.ts_codes.slice(),async t=>{await z(t),B()});const I=H(()=>{const t=x.value;if(!t||!t.labels||!t.matrix||t.labels.length===0)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const e=t.labels.map(D),a=t.labels.map(D),i=[];let r=1/0,m=-1/0;for(let n=0;n<a.length;n++){const _=t.matrix[n]||[];for(let d=0;d<e.length;d++){const f=typeof _[d]=="number"?_[d]:NaN;isNaN(f)||(i.push([d,n,+f.toFixed(3)]),r=Math.min(r,f),m=Math.max(m,f))}}return(!isFinite(r)||!isFinite(m))&&(r=-1,m=1),{tooltip:{position:"top",formatter:n=>{const[_,d,f]=n?.data??[],s=e[_]??"";return`${a[d]??""} vs ${s}<br/>相关系数：${f}`}},grid:{left:"8%",right:"8%",top:"8%",bottom:"8%",containLabel:!0},xAxis:{type:"category",data:e,axisLabel:{rotate:45,fontSize:11}},yAxis:{type:"category",data:a,axisLabel:{fontSize:11}},visualMap:{min:Math.min(-1,Math.floor(r*10)/10),max:Math.max(1,Math.ceil(m*10)/10),calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"]},text:["高","低"]},series:[{name:"相关性矩阵",type:"heatmap",data:i,label:{show:!0,fontSize:9,formatter:n=>n?.data?.[2]},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0,0,0,0.5)"}}}]}});return J(async()=>{F(),await A();try{const t=localStorage.getItem(C);if(t){const e=JSON.parse(t);if(Array.isArray(e.ts_codes)&&(o.ts_codes=e.ts_codes),Array.isArray(e.details))for(const a of e.details)y.value[a.ts_code]=a}}catch{}}),(t,e)=>{const a=u("el-button"),i=u("el-space"),r=u("el-option"),m=u("el-select"),n=u("el-form-item"),_=u("el-date-picker"),d=u("el-form"),f=u("el-card");return M(),Y("div",P,[E("div",Q,[E("div",W,[e[5]||(e[5]=E("h2",null,"ETF 相关性分析",-1)),l(i,null,{default:c(()=>[l(a,{type:"primary",loading:b.value,onClick:T},{default:c(()=>[...e[3]||(e[3]=[V("查询",-1)])]),_:1},8,["loading"]),l(a,{onClick:$},{default:c(()=>[...e[4]||(e[4]=[V("重置",-1)])]),_:1})]),_:1})])]),l(f,{class:"search-card"},{default:c(()=>[l(d,{model:o,"label-width":"110px","label-position":"left",inline:""},{default:c(()=>[l(n,{label:"ETF列表",required:""},{default:c(()=>[l(m,{modelValue:o.ts_codes,"onUpdate:modelValue":e[0]||(e[0]=s=>o.ts_codes=s),multiple:"",placeholder:"搜索并添加 ETF（可多选）",filterable:"",remote:"","reserve-keyword":"",clearable:"","remote-method":k,loading:p.value,style:{width:"520px"}},{default:c(()=>[(M(!0),Y(j,null,G(v.value,s=>(M(),K(r,{key:s.ts_code,label:`${s.extname||s.csname||s.cname||""}（${s.ts_code}）`,value:s.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(n,{label:"开始日期"},{default:c(()=>[l(_,{modelValue:o.start_date,"onUpdate:modelValue":e[1]||(e[1]=s=>o.start_date=s),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(n,{label:"结束日期"},{default:c(()=>[l(_,{modelValue:o.end_date,"onUpdate:modelValue":e[2]||(e[2]=s=>o.end_date=s),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(f,{class:"heatmap-card"},{default:c(()=>[l(L,{option:I.value},null,8,["option"])]),_:1})])}}}),ne=Z(X,[["__scopeId","data-v-535494d1"]]);export{ne as default};
