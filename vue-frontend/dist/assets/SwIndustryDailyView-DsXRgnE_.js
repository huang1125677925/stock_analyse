import{d as T,a as f,r as H,y as J,j as K,C as Q,c as $,e as r,w as i,i as u,x as W,b as g,f as B,g as P,D as X,F as ee,A as te,k as z,G as ae,t as D,o as F,_ as le}from"./index-Bun73MF3.js";import{i as ne}from"./index-ElshY9iF.js";const oe={class:"sw-industry-daily-view"},se={class:"card-header"},re={class:"header-title"},ie={class:"form-row"},ue=T({__name:"SwIndustryDailyView",setup(ce){const N=K(),Y=f(null);let _=null;const b=f(!1),y=f(""),c=H({ts_code:"",industry_name:""}),m=f(null),U=[{text:"最近一年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,t]}},{text:"最近三年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-3),[e,t]}},{text:"最近五年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-5),[e,t]}},{text:"最近十年",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-10),[e,t]}}],x=[{label:"收盘价",value:"close"},{label:"开盘价",value:"open"},{label:"最高价",value:"high"},{label:"最低价",value:"low"},{label:"市盈率 (PE)",value:"pe"},{label:"市净率 (PB)",value:"pb"},{label:"涨跌额",value:"change"},{label:"涨跌幅",value:"pct_change"},{label:"成交量",value:"vol"},{label:"成交额",value:"amount"},{label:"流通市值",value:"float_mv"},{label:"总市值",value:"total_mv"}],d=f("close"),w=f([]),v=f(null);function q(){const t=new Date,e=new Date;e.setFullYear(e.getFullYear()-1);const n=l=>{const o=l.getFullYear(),s=String(l.getMonth()+1).padStart(2,"0"),p=String(l.getDate()).padStart(2,"0");return`${o}${s}${p}`};m.value=[n(e),n(t)]}function j(){Y.value&&(_=ne(Y.value),window.addEventListener("resize",L))}function L(){_?.resize()}function G(t,e){if(t.length===0)return 0;const n=[...t].sort((o,s)=>o-s),l=n.findIndex(o=>o>=e);return l===-1?100:l/n.length*100}function h(t,e){if(t.length===0)return 0;const n=e/100*(t.length-1),l=Math.floor(n),o=Math.ceil(n),s=n-l;return t[l]*(1-s)+t[o]*s}function O(t){if(t.length===0){v.value=null;return}const e=t[t.length-1],n=G(t,e);let l="适中",o="info";n>=90?(l="极高",o="danger"):n>=70?(l="较高",o="warning"):n<=10?(l="极低",o="success"):n<=30&&(l="较低",o="primary"),v.value={value:e,percentile:n,status:l,type:o}}function E(t=w.value){if(!_)return;const e=[...t].sort((a,M)=>a.trade_date.localeCompare(M.trade_date)),n=e.map(a=>a.trade_date),l=e.map(a=>Number(a[d.value])),o=e.map(a=>a.vol),s=x.find(a=>a.value===d.value)?.label||d.value,p=l.filter(a=>!isNaN(a)).sort((a,M)=>a-M);O(l.filter(a=>!isNaN(a)));const S=h(p,10),A=h(p,30),V=h(p,50),k=h(p,70),C=h(p,90),I={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:[s,"成交量"],top:30},grid:[{left:"10%",right:"15%",bottom:"20%",height:"60%"},{left:"10%",right:"15%",bottom:"5%",height:"10%"}],xAxis:[{type:"category",data:n,boundaryGap:!1,axisLine:{onZero:!1}},{type:"category",gridIndex:1,data:n,axisLabel:{show:!1}}],yAxis:[{type:"value",name:s,scale:!0},{type:"value",name:"成交量",gridIndex:1,axisLabel:{show:!1},splitLine:{show:!1}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:0,end:100},{show:!0,xAxisIndex:[0,1],type:"slider",bottom:"0%",start:0,end:100}],series:[{name:s,type:"line",data:l,smooth:!0,lineStyle:{width:2},itemStyle:{color:"#409EFF"},markLine:{symbol:"none",data:[{yAxis:C,name:"90%分位",label:{formatter:"90%: {c}"},lineStyle:{color:"#FF4500",type:"dashed"}},{yAxis:k,name:"70%分位",label:{formatter:"70%: {c}"},lineStyle:{color:"#FFA500",type:"dashed"}},{yAxis:V,name:"50%分位",label:{formatter:"50%: {c}"},lineStyle:{color:"#32CD32",width:2}},{yAxis:A,name:"30%分位",label:{formatter:"30%: {c}"},lineStyle:{color:"#1E90FF",type:"dashed"}},{yAxis:S,name:"10%分位",label:{formatter:"10%: {c}"},lineStyle:{color:"#0000FF",type:"dashed"}}]}},{name:"成交量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:o,itemStyle:{color:"#67C23A"}}]};_.setOption(I,!0)}function Z(){E()}async function R(){if(!c.ts_code){y.value="请输入行业代码";return}b.value=!0,y.value="";try{const t={ts_code:c.ts_code};m.value&&m.value.length===2&&(t.start_date=m.value[0],t.end_date=m.value[1]);const e=await W.get("/django/api/index/sw-daily/",{params:t});console.log("res",e),e.data&&Array.isArray(e.data.records)?(w.value=e.data.records,E(w.value)):(w.value=[],y.value="暂无数据或数据格式错误",_?.clear(),v.value=null)}catch(t){y.value=t?.message||"请求失败"}finally{b.value=!1}}return J(()=>{q(),j();const t=N.query.ts_code,e=N.query.industry_name;t&&(c.ts_code=t,e&&(c.industry_name=e),R())}),Q(()=>{window.removeEventListener("resize",L),_?.dispose()}),(t,e)=>{const n=u("el-tag"),l=u("el-input"),o=u("el-form-item"),s=u("el-option"),p=u("el-select"),S=u("el-date-picker"),A=u("el-button"),V=u("el-form"),k=u("el-alert"),C=u("el-card"),I=ae("loading");return F(),$("div",oe,[r(C,{shadow:"hover"},{header:i(()=>[g("div",se,[g("div",re,[g("span",null,D(c.industry_name?`${c.ts_code} - ${c.industry_name} - ${x.find(a=>a.value===d.value)?.label||d.value} 趋势`:"申万行业日线行情趋势"),1),v.value?(F(),B(n,{key:0,type:v.value.type,effect:"dark",class:"valuation-tag"},{default:i(()=>[z(" 当前"+D(x.find(a=>a.value===d.value)?.label||d.value)+"分位: "+D(v.value.percentile.toFixed(2))+"% - "+D(v.value.status),1)]),_:1},8,["type"])):P("",!0)])])]),default:i(()=>[g("div",ie,[r(V,{inline:!0,"label-width":"80px"},{default:i(()=>[r(o,{label:"行业代码"},{default:i(()=>[r(l,{modelValue:c.ts_code,"onUpdate:modelValue":e[0]||(e[0]=a=>c.ts_code=a),placeholder:"输入行业代码",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),r(o,{label:"指标"},{default:i(()=>[r(p,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),placeholder:"选择指标",style:{width:"150px"},onChange:Z},{default:i(()=>[(F(),$(ee,null,te(x,a=>r(s,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),r(o,{label:"日期范围"},{default:i(()=>[r(S,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYYMMDD","value-format":"YYYYMMDD",shortcuts:U,style:{width:"320px"}},null,8,["modelValue"])]),_:1}),r(o,null,{default:i(()=>[r(A,{type:"primary",loading:b.value,onClick:R},{default:i(()=>[...e[3]||(e[3]=[z("查询",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),y.value?(F(),B(k,{key:0,type:"error",closable:!1,title:y.value,class:"mb-12"},null,8,["title"])):P("",!0),X(g("div",{class:"chart-container",ref_key:"chartRef",ref:Y},null,512),[[I,b.value]])]),_:1})])}}}),me=le(ue,[["__scopeId","data-v-dffda6b0"]]);export{me as default};
