import{i as v}from"./index-ElshY9iF.js";import{a as x}from"./individualStockApi-BzOoOvIV.js";import{d as L,a as b,A as R,Y,c as N,e as y,w as S,i as B,E,b as o,o as F,_ as H}from"./index-DjG3W8mg.js";const P={class:"market-change-heatmap"},V=L({name:"MarketChangeHeatmap",__name:"MarketChangeHeatmap",setup(O){const u=b(null),p=b(null),h=b(null);let s=null,l=null,i=null;const w=a=>{const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${t}${n}${d}`},M=async()=>{try{if(!u.value)return;s=v(u.value);const a=new Date,t=new Date;t.setDate(a.getDate()-365);const n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,d=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,m=(await x("sh000001",{start_date:w(t),end_date:w(a),adjust:""})).map(e=>[e.date,Number(e.change_percent)]),c=m.map(e=>e[1]).filter(e=>typeof e=="number"&&!Number.isNaN(e)),C=c.length?Math.min(...c):-5,D=c.length?Math.max(...c):5,$={tooltip:{position:"top",formatter:e=>{const f=e.data?.[0],g=e.data?.[1];return`${f}<br/>涨跌幅：${(g??0).toFixed(2)}%`}},visualMap:{type:"piecewise",pieces:[{lt:-1,label:"< -1%",color:"#2c4d8a"},{gte:-1,lt:0,label:"-1% ~ 0%",color:"#4a7bd0"},{gte:0,lt:1,label:"0% ~ 1%",color:"#f57c6e"},{gte:1,label:">= 1%",color:"#c23531"}],orient:"horizontal",left:"center",top:"62%",textStyle:{fontSize:12}},calendar:{range:[n,d],cellSize:18,splitLine:{show:!0,lineStyle:{color:"#ddd",width:1}},yearLabel:{show:!1},dayLabel:{firstDay:1},monthLabel:{nameMap:"cn"}},series:[{type:"heatmap",coordinateSystem:"calendar",data:m,emphasis:{itemStyle:{shadowBlur:8,shadowColor:"rgba(0,0,0,0.3)"}}}]},z={tooltip:{position:"top",formatter:e=>{const f=e.data?.[0],g=e.data?.[1];return`${f}<br/>涨跌幅：${(g??0).toFixed(2)}%`}},visualMap:{type:"continuous",min:Math.floor(C),max:Math.ceil(D),calculable:!0,inRange:{color:["#2c4d8a","#e9e9e9","#c23531"]},orient:"horizontal",left:"center",top:"62%",textStyle:{fontSize:12}},calendar:{range:[n,d],cellSize:18,splitLine:{show:!0,lineStyle:{color:"#ddd",width:1}},yearLabel:{show:!1},dayLabel:{firstDay:1},monthLabel:{nameMap:"cn"}},series:[{type:"heatmap",coordinateSystem:"calendar",data:m}]},r=[{name:"< -1%",color:"#2c4d8a",count:0},{name:"-1% ~ 0%",color:"#4a7bd0",count:0},{name:"0% ~ 1%",color:"#f57c6e",count:0},{name:">= 1%",color:"#c23531",count:0}];for(const e of c)e<-1?r[0].count++:e>=-1&&e<0?r[1].count++:e>=0&&e<1?r[2].count++:e>=1&&r[3].count++;const k={tooltip:{trigger:"item"},legend:{bottom:0},color:r.map(e=>e.color),series:[{name:"区间分布",type:"pie",radius:"60%",center:["50%","45%"],label:{formatter:"{b}: {c} ({d}%)"},data:r.map(e=>({name:e.name,value:e.count}))}]};s.setOption($),p.value&&(l=v(p.value),l.setOption(z)),h.value&&(i=v(h.value),i.setOption(k)),window.addEventListener("resize",_)}catch(a){console.error(a),E.error("获取大盘历史数据失败，请稍后重试")}},_=()=>{s?.resize(),l?.resize(),i?.resize()};return R(()=>{M()}),Y(()=>{window.removeEventListener("resize",_),s?.dispose(),l?.dispose(),i?.dispose(),s=null,l=null,i=null}),(a,t)=>{const n=B("el-card");return F(),N("div",P,[y(n,{shadow:"hover"},{default:S(()=>[t[0]||(t[0]=o("div",{class:"header"},[o("h2",null,"大盘涨跌（日历热力图）"),o("span",{class:"subtitle"},"数据来源：上证指数（sh000001）")],-1)),o("div",{ref_key:"chartRef",ref:u,class:"chart"},null,512)]),_:1}),y(n,{shadow:"hover"},{default:S(()=>[t[1]||(t[1]=o("div",{class:"header"},[o("h2",null,"连续色条热力图"),o("span",{class:"subtitle"},"连续视觉映射（visualMap: continuous）")],-1)),o("div",{ref_key:"continuousChartRef",ref:p,class:"chart chart-continuous"},null,512)]),_:1}),y(n,{shadow:"hover"},{default:S(()=>[t[2]||(t[2]=o("div",{class:"header"},[o("h2",null,"区间分布（饼图）"),o("span",{class:"subtitle"},"区间：< -1%、-1% ~ 0%、0% ~ 1%、≥ 1%")],-1)),o("div",{ref_key:"pieChartRef",ref:h,class:"chart chart-pie"},null,512)]),_:1})])}}}),q=H(V,[["__scopeId","data-v-f73c29b1"]]);export{q as default};
