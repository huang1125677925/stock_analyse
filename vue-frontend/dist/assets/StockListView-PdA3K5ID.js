import{d as ge,a as r,z as _e,B as H,y as fe,j as ve,E as o,c as E,e as l,w as n,i as u,b as g,F as W,A as j,f as $,l as B,M as he,k as d,N as ye,D as be,G as we,t as y,L as O,O as ke,Z as M,u as Ce,o as b,_ as xe}from"./index-Bun73MF3.js";import{g as Se,b as Ve}from"./individualStockApi-HS10VrSZ.js";import{a as Le}from"./industryAnalysisApi-JhN0DQZ4.js";import{g as ze,c as Q}from"./personalHoldingsApi-D5QdQARd.js";const De={class:"stock-list-view"},Fe={class:"header-content"},He={class:"header-actions"},Ee={class:"search-section"},$e={class:"table-container"},Be={class:"pagination-container"},Me=ge({__name:"StockListView",setup(Ae){const C=Ce(),x=ve(),S=r(!1),z=r([]),V=r(""),f=r(""),A=r([]),v=r(""),N=r([]),_=r(!1),D=r(new Set),w=r([]),R=r(""),G=r("asc"),s=r(1),F=r(10),L=r(0),U=_e(()=>z.value);H(U,e=>{_.value&&(L.value=e.length)});const K=async()=>{if(_.value){if(!M()){o.error("请先登录后再启用“仅看我的”"),_.value=!1,C.push("/login");return}try{const t=(await ze()).data?.list||[],m=t.filter(p=>["WATCHED","HELD"].includes(p.relation_type)).map(p=>p.stock_code?.trim()).filter(Boolean);D.value=new Set(m);const h=t.filter(p=>["WATCHED","HELD"].includes(p.relation_type)).map(p=>p.stock_name?.trim()).filter(Boolean);w.value=h,s.value=1,h.length===0?(o.warning("您的持有/关注列表为空，暂无可展示数据"),z.value=[],L.value=0):(o.success(`已启用，仅展示与您相关的股票（${h.length} 条记录）`),c())}catch(e){console.error("获取个人持有/关注列表失败:",e),o.error("获取个人列表失败，请稍后重试"),_.value=!1,D.value=new Set,w.value=[]}}else D.value=new Set,w.value=[],s.value=1,c()},c=async()=>{S.value=!0;try{const e=await Se({page:s.value,page_size:F.value,keyword:V.value,industry:f.value||void 0,stock_names:_.value&&w.value.length>0?w.value.join(","):void 0,dc_concept:v.value||void 0});z.value=e.data,L.value=e.total,o.success("股票数据加载成功")}catch(e){console.error("获取股票列表失败:",e),o.error("获取股票列表失败，请稍后重试")}finally{S.value=!1}},Z=async()=>{try{const e=await Le();A.value=e.sectors}catch(e){console.error("获取行业列表失败:",e),o.error("获取行业列表失败")}},J=async()=>{try{const e=await Ve();N.value=e.data||[]}catch(e){console.error("获取东财概念列表失败:",e),o.error("获取东财概念列表失败")}},X=()=>{s.value=1,c()},Y=()=>{s.value=1,c()},q=()=>{s.value=1,c()},I=()=>{V.value="",f.value="",v.value="",s.value=1,c()},ee=({prop:e,order:t})=>{R.value=e||"",G.value=t==="ascending"?"asc":"desc"},te=e=>{F.value=e,s.value=1,c()},ae=e=>{s.value=e,c()},le=e=>{C.push(`/stock-history/${e}`)},ne=async e=>{if(!M()){o.error("请先登录后再进行操作"),C.push("/login");return}try{const t=await Q({stock_code:e,relation_type:"WATCHED"});o.success(t.message||"已添加关注")}catch(t){o.error(t?.message||"添加关注失败")}},oe=async e=>{if(!M()){o.error("请先登录后再进行操作"),C.push("/login");return}try{const t=await Q({stock_code:e,relation_type:"HELD"});o.success(t.message||"已添加持有")}catch(t){o.error(t?.message||"添加持有失败")}},P=e=>e==null?"-":e>=1e11?(e/1e11).toFixed(2)+"千亿":e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toString(),re=e=>e==null?"-":e>=1e8?(e/1e8).toFixed(2)+"亿手":e>=1e4?(e/1e4).toFixed(2)+"万手":e.toString()+"手";return fe(()=>{Z(),J();const e=x.query.industry;e&&(f.value=e,o.success(`已自动筛选行业：${e}`));const t=x.query.dc_concept;t&&(v.value=t,o.success(`已自动筛选概念：${t}`)),c()}),H(()=>x.query.industry,e=>{e&&typeof e=="string"&&(f.value=e,s.value=1,c(),o.success(`已切换到行业：${e}`))},{immediate:!1}),H(()=>x.query.dc_concept,e=>{e&&typeof e=="string"&&(v.value=e,s.value=1,c(),o.success(`已切换到概念：${e}`))},{immediate:!1}),(e,t)=>{const m=u("el-button"),h=u("el-option"),p=u("el-select"),k=u("el-form-item"),se=u("el-input"),ie=u("el-checkbox"),ce=u("el-form"),i=u("el-table-column"),ue=u("el-table"),de=u("el-pagination"),pe=u("el-card"),me=we("loading");return b(),E("div",De,[l(pe,{class:"page-header"},{header:n(()=>[g("div",Fe,[t[6]||(t[6]=g("h2",null,"股票列表",-1)),g("div",He,[l(m,{type:"primary",icon:B(ke),onClick:c,loading:S.value},{default:n(()=>[...t[5]||(t[5]=[d(" 刷新数据 ",-1)])]),_:1},8,["icon","loading"])])])]),default:n(()=>[g("div",Ee,[l(ce,{inline:!0,class:"search-form"},{default:n(()=>[l(k,{label:"选择行业"},{default:n(()=>[l(p,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a),placeholder:"请选择行业",style:{width:"200px"},clearable:"",filterable:"",onChange:X},{default:n(()=>[(b(!0),E(W,null,j(A.value,a=>(b(),$(h,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"东财概念"},{default:n(()=>[l(p,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),placeholder:"请选择东财概念",style:{width:"240px"},clearable:"",filterable:"",onChange:Y},{default:n(()=>[(b(!0),E(W,null,j(N.value,a=>(b(),$(h,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"股票代码/名称"},{default:n(()=>[l(se,{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=a=>V.value=a),placeholder:"请输入股票代码或名称",clearable:"",onClear:q},null,8,["modelValue"])]),_:1}),l(k,null,{default:n(()=>[l(m,{type:"primary",icon:B(he),onClick:q},{default:n(()=>[...t[7]||(t[7]=[d("搜索",-1)])]),_:1},8,["icon"]),l(m,{icon:B(ye),onClick:I},{default:n(()=>[...t[8]||(t[8]=[d("重置",-1)])]),_:1},8,["icon"])]),_:1}),l(k,{label:"仅看我的"},{default:n(()=>[l(ie,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=a=>_.value=a),onChange:K},{default:n(()=>[...t[9]||(t[9]=[d("仅看我的（持有/关注）",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),g("div",$e,[be((b(),$(ue,{data:U.value,border:"",stripe:"",style:{width:"100%"},onSortChange:ee,fit:""},{default:n(()=>[l(i,{prop:"code",label:"股票代码","min-width":"100",sortable:"",align:"center","header-align":"center"}),l(i,{prop:"name",label:"股票名称","min-width":"120",sortable:"",align:"center","header-align":"center"}),l(i,{prop:"industry",label:"行业","min-width":"120",align:"center","header-align":"center"}),l(i,{prop:"total_market_cap",label:"总市值","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:n(a=>[d(y(P(a.row.total_market_cap)),1)]),_:1}),l(i,{prop:"pe_ratio",label:"市盈率","min-width":"80",sortable:"",align:"center","header-align":"center"}),l(i,{prop:"pb_ratio",label:"市净率","min-width":"80",sortable:"",align:"center","header-align":"center"}),l(i,{prop:"latest_price",label:"最新价","min-width":"100",sortable:"",align:"center","header-align":"center"}),l(i,{prop:"change_percent",label:"涨跌幅","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:n(a=>[g("span",{class:O(a.row.change_percent>=0?"text-success":"text-danger")},y(a.row.change_percent?a.row.change_percent.toFixed(2)+"%":"-"),3)]),_:1}),l(i,{prop:"change_amount",label:"涨跌额","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:n(a=>[g("span",{class:O(a.row.change_amount>=0?"text-success":"text-danger")},y(a.row.change_amount?a.row.change_amount.toFixed(2):"-"),3)]),_:1}),l(i,{prop:"volume",label:"成交量","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:n(a=>[d(y(re(a.row.volume)),1)]),_:1}),l(i,{prop:"amount",label:"成交额","min-width":"100",sortable:"",align:"center","header-align":"center"},{default:n(a=>[d(y(P(a.row.amount)),1)]),_:1}),l(i,{prop:"turnover_rate",label:"换手率","min-width":"80",sortable:"",align:"center","header-align":"center"},{default:n(a=>[d(y(a.row.turnover_rate?a.row.turnover_rate.toFixed(2)+"%":"-"),1)]),_:1}),l(i,{label:"操作","min-width":"260",fixed:"right",align:"center","header-align":"center"},{default:n(a=>[l(m,{type:"primary",size:"small",onClick:T=>le(a.row.code)},{default:n(()=>[...t[10]||(t[10]=[d(" 股票详情 ",-1)])]),_:2},1032,["onClick"]),l(m,{type:"success",size:"small",onClick:T=>ne(a.row.code)},{default:n(()=>[...t[11]||(t[11]=[d(" 添加关注 ",-1)])]),_:2},1032,["onClick"]),l(m,{type:"warning",size:"small",onClick:T=>oe(a.row.code)},{default:n(()=>[...t[12]||(t[12]=[d(" 添加持有 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,S.value]])]),g("div",Be,[l(de,{"current-page":s.value,"onUpdate:currentPage":t[4]||(t[4]=a=>s.value=a),"page-size":F.value,total:L.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Te=xe(Me,[["__scopeId","data-v-c0f727bd"]]);export{Te as default};
