import{d as Q,r as W,a as v,z as X,y as Z,j as ee,c as m,b as u,g as w,e as l,w as s,i as d,E as _,F as k,A as D,k as B,t as S,P as te,u as ae,o as n,f as g,_ as le}from"./index-DeYthsa7.js";import{g as se,c as oe,r as re}from"./quantBacktestApi-CMzYmd_7.js";import{g as E}from"./individualStockApi-DR8orwDi.js";const ne={class:"backtest-strategy-view"},ue={class:"strategy-config-panel"},de={key:0,class:"strategy-params"},ie={key:0,class:"strategy-description"},ce={class:"description-content"},me={key:0,class:"params-info"},pe=2,ye=Q({__name:"BacktestStrategyView",setup(fe){const F=ae(),I=ee(),t=W({strategyName:"",symbol:"",startDate:"",endDate:"",frequency:"daily",initialCash:1e6,strategyParams:{}}),Y=v([]),h=v([]),c=v(null),P=v(!1),z=v(""),V=v(!1),N=X(()=>!!t.strategyName&&!!t.symbol&&!!t.startDate&&!!t.endDate),O=((o,e)=>{let r;return(...b)=>{clearTimeout(r),r=setTimeout(()=>o.apply(null,b),e)}})(async(o="")=>{try{V.value=!0;const e={page:1,page_size:50,keyword:o.trim()},r=await E(e);h.value=r.data}catch(e){console.error("搜索股票列表失败:",e)}finally{V.value=!1}},300),R=o=>{const e=(o??"").trim();if(z.value=e,e.length===0){V.value=!1,h.value.length===0&&q();return}e.length>=pe?O(e):V.value=!1},M=o=>{const e=Y.value.find(r=>r.name===o);e&&(c.value=e,t.strategyParams={},e.params&&Object.keys(e.params).forEach(r=>{t.strategyParams[r]=e.params[r].default}))},j=async()=>{if(!N.value){_.warning("请填写完整的回测配置");return}P.value=!0;try{const o={strategy_name:t.strategyName,stock_code:t.symbol,start_date:t.startDate,end_date:t.endDate,frequency:t.frequency,initial_cash:t.initialCash,strategy_params:t.strategyParams},e=await oe(o);_.success("回测任务创建成功"),te.confirm("回测任务已创建，是否立即运行？","提示",{confirmButtonText:"立即运行",cancelButtonText:"稍后运行",type:"info"}).then(async()=>{await A(e.task_id),F.push("/backtest-history")}).catch(()=>{})}catch(o){console.error("创建回测任务失败:",o),_.error("创建回测任务失败")}finally{P.value=!1}},A=async o=>{try{await re(o),_.success("回测任务已启动")}catch(e){console.error("运行回测任务失败:",e),_.error("运行回测任务失败")}},H=()=>{t.strategyName="",t.symbol="",t.startDate="",t.endDate="",t.frequency="daily",t.initialCash=1e6,t.strategyParams={},c.value=null},$=async()=>{try{const o=await se();Y.value=o}catch(o){console.error("加载策略列表失败:",o),_.error("加载策略列表失败")}},q=async()=>{try{const e=await E({page:1,page_size:100});h.value=e.data}catch(o){console.error("加载股票列表失败:",o),_.error("加载股票列表失败")}};return Z(async()=>{await Promise.all([$(),q()]);const o=new Date,e=new Date;e.setFullYear(o.getFullYear()-1),t.endDate=o.toISOString().split("T")[0],t.startDate=e.toISOString().split("T")[0];const r=I.query.strategy;r&&(t.strategyName=r,M(r))}),(o,e)=>{const r=d("el-option"),b=d("el-select"),p=d("el-form-item"),y=d("el-col"),C=d("el-row"),L=d("el-date-picker"),U=d("el-input-number"),G=d("el-input"),K=d("el-switch"),T=d("el-button"),J=d("el-form"),x=d("el-card");return n(),m("div",ne,[e[12]||(e[12]=u("div",{class:"page-header"},[u("h1",null,"创建回测任务"),u("p",null,"选择策略并配置参数，创建回测任务")],-1)),u("div",ue,[l(x,null,{header:s(()=>[...e[6]||(e[6]=[u("div",{class:"card-header"},[u("span",null,"策略配置")],-1)])]),default:s(()=>[l(J,{model:t,"label-width":"120px",class:"strategy-form"},{default:s(()=>[l(C,{gutter:20},{default:s(()=>[l(y,{span:12},{default:s(()=>[l(p,{label:"选择策略",required:""},{default:s(()=>[l(b,{modelValue:t.strategyName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.strategyName=a),placeholder:"请选择策略",class:"full-width",onChange:M},{default:s(()=>[(n(!0),m(k,null,D(Y.value,a=>(n(),g(r,{key:a.name,label:a.description,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{span:12},{default:s(()=>[l(p,{label:"股票代码",required:""},{default:s(()=>[l(b,{modelValue:t.symbol,"onUpdate:modelValue":e[1]||(e[1]=a=>t.symbol=a),placeholder:"请选择股票代码",filterable:"",remote:"","remote-method":R,loading:V.value,clearable:"",style:{width:"100%"}},{default:s(()=>[(n(!0),m(k,null,D(h.value,a=>(n(),g(r,{key:a.code,label:`${a.code} - ${a.name}`,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),l(C,{gutter:20},{default:s(()=>[l(y,{span:6},{default:s(()=>[l(p,{label:"开始日期",required:""},{default:s(()=>[l(L,{modelValue:t.startDate,"onUpdate:modelValue":e[2]||(e[2]=a=>t.startDate=a),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:s(()=>[l(p,{label:"结束日期",required:""},{default:s(()=>[l(L,{modelValue:t.endDate,"onUpdate:modelValue":e[3]||(e[3]=a=>t.endDate=a),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:s(()=>[l(p,{label:"数据频率"},{default:s(()=>[l(b,{modelValue:t.frequency,"onUpdate:modelValue":e[4]||(e[4]=a=>t.frequency=a),placeholder:"选择数据频率",class:"full-width"},{default:s(()=>[l(r,{label:"日频",value:"daily"}),l(r,{label:"周频",value:"weekly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{span:6},{default:s(()=>[l(p,{label:"初始资金"},{default:s(()=>[l(U,{modelValue:t.initialCash,"onUpdate:modelValue":e[5]||(e[5]=a=>t.initialCash=a),min:1e4,step:1e4,precision:0,class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),c.value&&c.value.params?(n(),m("div",de,[e[7]||(e[7]=u("h3",null,"策略参数",-1)),l(C,{gutter:20},{default:s(()=>[(n(!0),m(k,null,D(c.value.params,(a,i)=>(n(),g(y,{span:8,key:i},{default:s(()=>[l(p,{label:a.description},{default:s(()=>[a.type==="int"?(n(),g(U,{key:0,modelValue:t.strategyParams[i],"onUpdate:modelValue":f=>t.strategyParams[i]=f,min:1,precision:0,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="string"?(n(),g(G,{key:1,modelValue:t.strategyParams[i],"onUpdate:modelValue":f=>t.strategyParams[i]=f,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="float"?(n(),g(U,{key:2,modelValue:t.strategyParams[i],"onUpdate:modelValue":f=>t.strategyParams[i]=f,precision:2,class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])):a.type==="boolean"?(n(),g(K,{key:3,modelValue:t.strategyParams[i],"onUpdate:modelValue":f=>t.strategyParams[i]=f},null,8,["modelValue","onUpdate:modelValue"])):w("",!0)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})])):w("",!0),l(p,null,{default:s(()=>[l(T,{type:"primary",onClick:j,loading:P.value,disabled:!N.value},{default:s(()=>[...e[8]||(e[8]=[B(" 创建回测任务 ",-1)])]),_:1},8,["loading","disabled"]),l(T,{onClick:H},{default:s(()=>[...e[9]||(e[9]=[B("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),c.value?(n(),m("div",ie,[l(x,null,{header:s(()=>[...e[10]||(e[10]=[u("div",{class:"card-header"},[u("span",null,"策略说明")],-1)])]),default:s(()=>[u("div",ce,[u("h3",null,S(c.value.description),1),c.value.params?(n(),m("div",me,[e[11]||(e[11]=u("h4",null,"参数说明：",-1)),u("ul",null,[(n(!0),m(k,null,D(c.value.params,(a,i)=>(n(),m("li",{key:i},[u("strong",null,S(a.description),1),B(": "+S(a.type)+"类型，默认值: "+S(a.default),1)]))),128))])])):w("",!0)])]),_:1})])):w("",!0)])}}}),he=le(ye,[["__scopeId","data-v-7b7df137"]]);export{he as default};
