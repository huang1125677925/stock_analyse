import{g as D,k as Z}from"./individualStockApi-zHq7wJlW.js";import{d as ee,a as m,z as x,r as te,B as ae,y as le,c as Y,b as h,e as l,w as o,i as d,E as S,k as _,F as N,A as I,f as M,D as se,G as oe,L as ne,o as p,_ as de}from"./index-B1jknyhk.js";const re={class:"stock-volatility-view"},_e={class:"page-header"},ie={class:"header-content"},ce={class:"table-toolbar"},L="stockVolatilitySelectedStocks",ue=ee({__name:"StockVolatilityView",setup(me){const w=m(!1),f=m([]),v=m(!1),y=m([]),c=m({}),g=m("latest"),A=x(()=>g.value==="all"?95:120),s=te({ts_codes:[],start_date:"",end_date:"",sample_n:void 0}),C=t=>{const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${r}`},O=()=>{const t=new Date,e=new Date;e.setDate(t.getDate()-365),s.start_date=C(e),s.end_date=C(t)},U=async t=>{const e=(t||"").trim();if(e){v.value=!0;try{const a=await D({keyword:e,page:1,page_size:20});f.value=a.data||[]}catch(a){S.error(a?.message||"股票列表搜索失败")}finally{v.value=!1}}},$=async()=>{v.value=!0;try{const t=await D({page:1,page_size:50});f.value=t.data||[]}catch(t){S.error(t?.message||"股票列表加载失败")}finally{v.value=!1}},z=async t=>{for(const a of t)if(!c.value[a]){const r=f.value.find(b=>b.code===a);r&&(c.value[a]=r)}const e=t.filter(a=>!c.value[a]);e.length!==0&&await Promise.all(e.map(async a=>{try{const r=(a||"").includes(".")?(a||"").split(".")[0]:a||"",k=(await D({keyword:r,page:1,page_size:5})).data||[],u=k.find(V=>V.code===a)||k[0];u&&(c.value[a]=u)}catch(r){console.warn("补全股票信息失败:",a,r)}}))},q=()=>{const t=s.ts_codes.slice(),e=t.map(a=>c.value[a]).filter(Boolean);try{localStorage.setItem(L,JSON.stringify({ts_codes:t,details:e}))}catch{}};ae(()=>s.ts_codes.slice(),async t=>{await z(t),q()});const F=async()=>{if(!s.ts_codes||s.ts_codes.length<1){S.warning("请至少选择一个股票");return}w.value=!0;try{y.value=await Z({ts_codes:s.ts_codes,start_date:s.start_date||void 0,end_date:s.end_date||void 0,sample_n:s.sample_n}),await z(y.value.map(t=>t.stock_code||t.ts_code).filter(t=>typeof t=="string"))}catch(t){S.error(t?.message||"波动性数据查询失败")}finally{w.value=!1}},G=()=>F(),T=()=>{s.ts_codes=[],y.value=[]},J=t=>{const e=c.value[t]||f.value.find(a=>a.code===t);return e&&e.name||t},R=x(()=>(Array.isArray(y.value)?y.value:[]).map(e=>{const a=e.stock_code||e.ts_code;return{stock_name:a?J(a):"",...e}})),K=x(()=>({period:["start_date","end_date"],extremes:["highest_value","highest_date","lowest_value","lowest_date"],drawdown:["max_drawdown_pct","mdd_start_date","mdd_end_date","mdd_days"],rise:["max_rise_pct","rise_start_date","rise_end_date","rise_days"],latest:["latest_price","latest_date","percentile_between_min_max"],stats:["mean","variance","stddev"],trend:["trend","grid_applicable","sample_used","sample_n"],all:["start_date","end_date","highest_value","highest_date","lowest_value","lowest_date","max_drawdown_pct","mdd_start_date","mdd_end_date","mdd_days","max_rise_pct","rise_start_date","rise_end_date","rise_days","latest_price","latest_date","percentile_between_min_max","mean","variance","stddev","trend","grid_applicable","sample_used","sample_n"]})[g.value]||[]),P={ts_code:"股票代码",stock_code:"股票代码",start_date:"开始日期",end_date:"结束日期",highest_value:"最高值",highest_date:"最高值日期",lowest_value:"最低值",lowest_date:"最低值日期",max_drawdown_pct:"最大回撤(%)",mdd_start_date:"回撤峰值开始",mdd_end_date:"回撤最低结束",mdd_days:"回撤交易日数",max_rise_pct:"最大上涨(%)",rise_start_date:"上涨谷底开始",rise_end_date:"上涨峰值结束",rise_days:"上涨交易日数",latest_price:"最新收盘价",latest_date:"最新价日期",percentile_between_min_max:"最新价区间百分位",mean:"均值",variance:"方差",stddev:"标准差",trend:"趋势",grid_applicable:"网格适配",sample_used:"使用抽样",sample_n:"抽样点数"};return le(async()=>{O(),await $();try{const t=localStorage.getItem(L);if(t){const e=JSON.parse(t);Array.isArray(e.details)&&e.details.forEach(a=>c.value[a.code]=a),Array.isArray(e.ts_codes)&&(s.ts_codes=e.ts_codes)}}catch{}}),(t,e)=>{const a=d("el-button"),r=d("el-space"),b=d("el-option"),k=d("el-select"),u=d("el-form-item"),V=d("el-date-picker"),W=d("el-input-number"),j=d("el-form"),B=d("el-card"),i=d("el-radio-button"),H=d("el-radio-group"),E=d("el-table-column"),Q=d("el-table"),X=oe("loading");return p(),Y("div",re,[h("div",_e,[h("div",ie,[e[7]||(e[7]=h("h2",null,"股票 波动率分析",-1)),l(r,null,{default:o(()=>[l(a,{type:"primary",loading:w.value,onClick:G},{default:o(()=>[...e[5]||(e[5]=[_("查询",-1)])]),_:1},8,["loading"]),l(a,{onClick:T},{default:o(()=>[...e[6]||(e[6]=[_("重置",-1)])]),_:1})]),_:1})])]),l(B,{class:"search-card"},{default:o(()=>[l(j,{model:s,"label-width":"110px","label-position":"left",inline:""},{default:o(()=>[l(u,{label:"股票列表",required:""},{default:o(()=>[l(k,{modelValue:s.ts_codes,"onUpdate:modelValue":e[0]||(e[0]=n=>s.ts_codes=n),multiple:"",placeholder:"搜索并添加 股票（可多选）",filterable:"",remote:"","reserve-keyword":"",clearable:"","remote-method":U,loading:v.value,style:{width:"520px"}},{default:o(()=>[(p(!0),Y(N,null,I(f.value,n=>(p(),M(b,{key:n.code,label:`${n.name||""}（${n.code}）`,value:n.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(u,{label:"开始日期"},{default:o(()=>[l(V,{modelValue:s.start_date,"onUpdate:modelValue":e[1]||(e[1]=n=>s.start_date=n),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(u,{label:"结束日期"},{default:o(()=>[l(V,{modelValue:s.end_date,"onUpdate:modelValue":e[2]||(e[2]=n=>s.end_date=n),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(u,{label:"抽样点数"},{default:o(()=>[l(W,{modelValue:s.sample_n,"onUpdate:modelValue":e[3]||(e[3]=n=>s.sample_n=n),min:0,max:1e3,step:10,"controls-position":"right",placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(B,{class:"table-card"},{default:o(()=>[h("div",ce,[l(H,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=n=>g.value=n),size:"small"},{default:o(()=>[l(i,{label:"latest"},{default:o(()=>[...e[8]||(e[8]=[_("最新价",-1)])]),_:1}),l(i,{label:"extremes"},{default:o(()=>[...e[9]||(e[9]=[_("极值",-1)])]),_:1}),l(i,{label:"drawdown"},{default:o(()=>[...e[10]||(e[10]=[_("最大回撤",-1)])]),_:1}),l(i,{label:"rise"},{default:o(()=>[...e[11]||(e[11]=[_("最大上涨",-1)])]),_:1}),l(i,{label:"stats"},{default:o(()=>[...e[12]||(e[12]=[_("统计量",-1)])]),_:1}),l(i,{label:"trend"},{default:o(()=>[...e[13]||(e[13]=[_("趋势网格",-1)])]),_:1}),l(i,{label:"period"},{default:o(()=>[...e[14]||(e[14]=[_("区间",-1)])]),_:1}),l(i,{label:"all"},{default:o(()=>[...e[15]||(e[15]=[_("全部",-1)])]),_:1})]),_:1},8,["modelValue"])]),se((p(),M(Q,{data:R.value,border:"",style:{width:"100%"},class:ne({"compact-table":g.value==="all"})},{default:o(()=>[l(E,{prop:"stock_name",label:"股票名称","min-width":A.value},null,8,["min-width"]),(p(!0),Y(N,null,I(K.value,n=>(p(),M(E,{key:n,prop:n,label:P[n]||n,"min-width":A.value},null,8,["prop","label","min-width"]))),128))]),_:1},8,["data","class"])),[[X,w.value]])]),_:1})])}}}),ve=de(ue,[["__scopeId","data-v-3404754f"]]);export{ve as default};
