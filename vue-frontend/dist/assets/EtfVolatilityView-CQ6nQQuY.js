import{g as h,d as X}from"./etfApi-BAY2m_w1.js";import{d as ee,a as c,z as x,r as te,B as ae,y as le,c as D,b as V,e as l,w as d,i as n,E,k as r,F as C,A as B,f as Y,D as se,G as oe,L as de,o as u,_ as ne}from"./index-B_RXet-9.js";const re={class:"etf-volatility-view"},_e={class:"page-header"},ie={class:"header-content"},ce={class:"table-toolbar"},z="etfVolatilitySelectedEtfs",ue=ee({__name:"EtfVolatilityView",setup(me){const g=c(!1),y=c([]),m=c(!1),p=c([]),f=c({}),v=c("latest"),M=x(()=>v.value==="all"?95:120),s=te({ts_codes:[],start_date:"",end_date:"",sample_n:void 0}),S=t=>{const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${i}`},N=()=>{const t=new Date,e=new Date;e.setDate(t.getDate()-365),s.start_date=S(e),s.end_date=S(t)},$=async t=>{const e=(t||"").trim();if(e){m.value=!0;try{const a=/^[0-9]{3,6}\.[A-Z]{2,3}$/.test(e),i=await h({ts_code:a?e:void 0,name:a?void 0:e,page:1,page_size:20});y.value=i.data||[]}catch(a){E.error(a?.message||"ETF 基础列表搜索失败")}finally{m.value=!1}}},I=async()=>{m.value=!0;try{const t=await h({page:1,page_size:50});y.value=t.data||[]}catch(t){E.error(t?.message||"ETF 基础列表加载失败")}finally{m.value=!1}},T=async t=>{const e=t.filter(a=>!f.value[a]);for(const a of e)try{const w=((await h({ts_code:a,page:1,page_size:1})).data||[])[0];w&&(f.value[a]=w)}catch{}},O=()=>{const t=s.ts_codes.slice(),e=t.map(a=>f.value[a]).filter(Boolean);try{localStorage.setItem(z,JSON.stringify({ts_codes:t,details:e}))}catch{}};ae(()=>s.ts_codes.slice(),async t=>{await T(t),O()});const U=async()=>{if(!s.ts_codes||s.ts_codes.length<1){E.warning("请至少选择一个ETF");return}g.value=!0;try{p.value=await X({ts_codes:s.ts_codes,start_date:s.start_date||void 0,end_date:s.end_date||void 0,sample_n:s.sample_n}),await T(p.value.map(t=>t.ts_code).filter(t=>typeof t=="string"))}catch(t){E.error(t?.message||"波动性数据查询失败")}finally{g.value=!1}},L=()=>U(),q=()=>{s.ts_codes=[],p.value=[]},G=t=>{const e=f.value[t]||y.value.find(a=>a.ts_code===t);return e&&(e.extname||e.csname||e.cname)||t},J=x(()=>(Array.isArray(p.value)?p.value:[]).map(e=>{const a=e.ts_code;return{etf_name:a?G(a):"",...e}})),R=x(()=>({period:["start_date","end_date"],extremes:["highest_value","highest_date","lowest_value","lowest_date"],drawdown:["max_drawdown_pct","mdd_start_date","mdd_end_date","mdd_days"],rise:["max_rise_pct","rise_start_date","rise_end_date","rise_days"],latest:["latest_price","latest_date","percentile_between_min_max"],stats:["mean","variance","stddev"],trend:["trend","grid_applicable","sample_used","sample_n"],all:["start_date","end_date","highest_value","highest_date","lowest_value","lowest_date","max_drawdown_pct","mdd_start_date","mdd_end_date","mdd_days","max_rise_pct","rise_start_date","rise_end_date","rise_days","latest_price","latest_date","percentile_between_min_max","mean","variance","stddev","trend","grid_applicable","sample_used","sample_n"]})[v.value]||[]),K={ts_code:"ETF代码",start_date:"开始日期",end_date:"结束日期",highest_value:"最高值",highest_date:"最高值日期",lowest_value:"最低值",lowest_date:"最低值日期",max_drawdown_pct:"最大回撤(%)",mdd_start_date:"回撤峰值开始",mdd_end_date:"回撤最低结束",mdd_days:"回撤交易日数",max_rise_pct:"最大上涨(%)",rise_start_date:"上涨谷底开始",rise_end_date:"上涨峰值结束",rise_days:"上涨交易日数",latest_price:"最新收盘价",latest_date:"最新价日期",percentile_between_min_max:"最新价区间百分位",mean:"均值",variance:"方差",stddev:"标准差",trend:"趋势",grid_applicable:"网格适配",sample_used:"使用抽样",sample_n:"抽样点数"};return le(async()=>{N(),await I();try{const t=localStorage.getItem(z);if(t){const e=JSON.parse(t);Array.isArray(e.ts_codes)&&(s.ts_codes=e.ts_codes),Array.isArray(e.details)&&e.details.forEach(a=>f.value[a.ts_code]=a)}}catch{}}),(t,e)=>{const a=n("el-button"),i=n("el-space"),w=n("el-option"),W=n("el-select"),b=n("el-form-item"),k=n("el-date-picker"),Z=n("el-input-number"),j=n("el-form"),F=n("el-card"),_=n("el-radio-button"),H=n("el-radio-group"),A=n("el-table-column"),P=n("el-table"),Q=oe("loading");return u(),D("div",re,[V("div",_e,[V("div",ie,[e[7]||(e[7]=V("h2",null,"ETF 波动性列表",-1)),l(i,null,{default:d(()=>[l(a,{type:"primary",loading:g.value,onClick:L},{default:d(()=>[...e[5]||(e[5]=[r("查询",-1)])]),_:1},8,["loading"]),l(a,{onClick:q},{default:d(()=>[...e[6]||(e[6]=[r("重置",-1)])]),_:1})]),_:1})])]),l(F,{class:"search-card"},{default:d(()=>[l(j,{model:s,"label-width":"110px","label-position":"left",inline:""},{default:d(()=>[l(b,{label:"ETF列表",required:""},{default:d(()=>[l(W,{modelValue:s.ts_codes,"onUpdate:modelValue":e[0]||(e[0]=o=>s.ts_codes=o),multiple:"",placeholder:"搜索并添加 ETF（可多选）",filterable:"",remote:"","reserve-keyword":"",clearable:"","remote-method":$,loading:m.value,style:{width:"520px"}},{default:d(()=>[(u(!0),D(C,null,B(y.value,o=>(u(),Y(w,{key:o.ts_code,label:`${o.extname||o.csname||o.cname||""}（${o.ts_code}）`,value:o.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(b,{label:"开始日期"},{default:d(()=>[l(k,{modelValue:s.start_date,"onUpdate:modelValue":e[1]||(e[1]=o=>s.start_date=o),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(b,{label:"结束日期"},{default:d(()=>[l(k,{modelValue:s.end_date,"onUpdate:modelValue":e[2]||(e[2]=o=>s.end_date=o),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(b,{label:"抽样点数"},{default:d(()=>[l(Z,{modelValue:s.sample_n,"onUpdate:modelValue":e[3]||(e[3]=o=>s.sample_n=o),min:0,max:1e3,step:10,"controls-position":"right",placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(F,{class:"table-card"},{default:d(()=>[V("div",ce,[l(H,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=o=>v.value=o),size:"small"},{default:d(()=>[l(_,{label:"latest"},{default:d(()=>[...e[8]||(e[8]=[r("最新价",-1)])]),_:1}),l(_,{label:"extremes"},{default:d(()=>[...e[9]||(e[9]=[r("极值",-1)])]),_:1}),l(_,{label:"drawdown"},{default:d(()=>[...e[10]||(e[10]=[r("最大回撤",-1)])]),_:1}),l(_,{label:"rise"},{default:d(()=>[...e[11]||(e[11]=[r("最大上涨",-1)])]),_:1}),l(_,{label:"stats"},{default:d(()=>[...e[12]||(e[12]=[r("统计量",-1)])]),_:1}),l(_,{label:"trend"},{default:d(()=>[...e[13]||(e[13]=[r("趋势网格",-1)])]),_:1}),l(_,{label:"period"},{default:d(()=>[...e[14]||(e[14]=[r("区间",-1)])]),_:1}),l(_,{label:"all"},{default:d(()=>[...e[15]||(e[15]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"])]),se((u(),Y(P,{data:J.value,border:"",style:{width:"100%"},class:de({"compact-table":v.value==="all"})},{default:d(()=>[l(A,{prop:"etf_name",label:"ETF名称","min-width":M.value},null,8,["min-width"]),(u(!0),D(C,null,B(R.value,o=>(u(),Y(A,{key:o,prop:o,label:K[o]||o,"min-width":M.value},null,8,["prop","label","min-width"]))),128))]),_:1},8,["data","class"])),[[Q,g.value]])]),_:1})])}}}),ve=ne(ue,[["__scopeId","data-v-0f94896f"]]);export{ve as default};
