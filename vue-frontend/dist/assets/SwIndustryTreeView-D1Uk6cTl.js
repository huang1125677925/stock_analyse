import{x as H,d as J,a as h,z as Q,B as X,c as w,b as d,e as a,w as l,i as _,t as i,k as f,g as O,D as Z,G as ee,f as P,K as F,E as te,o as y,_ as ae}from"./index-Cmt4OYPI.js";import{b as le}from"./industryApi-DtqVxAGn.js";import{S as ne}from"./SwIndustryTrendChart-CzDJrIMr.js";import"./index-ElshY9iF.js";async function W(T){return(await H.get("/django/api/index/sw-index-classify/",{params:T})).data.records}const se={class:"sw-industry-tree-view"},oe={class:"main-container"},re={class:"tree-wrapper"},de={class:"custom-tree-node"},ce={class:"node-label"},ie={class:"node-info"},ue={key:0,class:"detail-content"},_e={class:"tab-content"},pe={class:"detail-title"},fe={key:0,class:"children-section"},ve={class:"section-header"},me={key:1,class:"no-children-tip"},ye={class:"tab-content"},be={key:1,class:"empty-state"},he=J({__name:"SwIndustryTreeView",setup(T){const c=h(null),v=h(null),p=h([]),N=h(!1),k=h(new Map),C=h("basic"),z=Q(()=>p.value.map(t=>{const e=k.value.get(t.index_code);return{...t,pe:e?.pe,pe_percentile:e?.pe_percentile,pb:e?.pb,pb_percentile:e?.pb_percentile,trade_date:e?.trade_date}})),x=(t,e=2)=>t==null?"--":t.toFixed(e),D=t=>t==null?{}:t<20?{color:"#67C23A",fontWeight:"bold"}:t>80?{color:"#F56C6C",fontWeight:"bold"}:{},V=(t,e,n)=>{const u=typeof t?.[n]=="number"?t[n]:Number.POSITIVE_INFINITY,m=typeof e?.[n]=="number"?e[n]:Number.POSITIVE_INFINITY;return u-m},B=(t,e)=>V(t,e,"pe_percentile"),M=(t,e)=>V(t,e,"pb_percentile"),Y=async()=>{if(p.value.length===0){k.value.clear();return}const t=p.value[0].level,e=p.value.map(o=>o.index_code).join(","),n=new Date,u=new Date;u.setFullYear(u.getFullYear()-10);const m=o=>{const b=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),g=String(o.getDate()).padStart(2,"0");return`${b}${s}${g}`};try{N.value=!0;const o=await le({start_date:m(u),end_date:m(n),level:t,index_codes:e}),b=new Map;o.sort((s,g)=>s.trade_date.localeCompare(g.trade_date)),o.forEach(s=>{b.set(s.ts_code,s)}),k.value=b}catch(o){console.error("获取估值数据失败:",o)}finally{N.value=!1}};X(p,()=>{Y()});const R={label:"industry_name",isLeaf:(t,e)=>t.level==="L3"},S=t=>{t&&t.childNodes?p.value=t.childNodes.map(e=>e.data):p.value=[]},$=async(t,e)=>{try{if(t.level===0){e([{industry_name:"申万行业分类",index_code:"0",industry_code:"0",level:"ROOT",parent_code:"",src:"SW2021"}]);return}const n=t.data;if(n.level==="ROOT"&&n.industry_code==="0"){const u=await W({parent_code:"0",src:"SW2021"});e(u),v.value&&v.value.key===t.key&&S(t);return}if(n&&n.industry_code){const u=await W({parent_code:n.industry_code,src:"SW2021"});e(u),v.value&&v.value.key===t.key&&S(t)}else e([])}catch(n){console.error("加载行业数据失败:",n),te.error("加载行业数据失败"),e([])}},j=(t,e)=>{c.value=t,v.value=e,S(e)},A=(t,e)=>{v.value&&v.value.key===e.key&&S(e)},I=t=>{switch(t){case"L1":return"danger";case"L2":return"warning";case"L3":return"success";case"ROOT":return"primary";default:return"info"}};return(t,e)=>{const n=_("el-tag"),u=_("el-tree"),m=_("el-card"),o=_("el-descriptions-item"),b=_("el-descriptions"),s=_("el-table-column"),g=_("el-table"),G=_("el-text"),E=_("el-tab-pane"),K=_("el-tabs"),U=_("el-empty"),q=ee("loading");return y(),w("div",se,[d("div",oe,[a(m,{class:"left-panel"},{header:l(()=>[...e[1]||(e[1]=[d("div",{class:"card-header"},[d("span",null,"申万行业分类 (SW2021)")],-1)])]),default:l(()=>[d("div",re,[a(u,{props:R,load:$,lazy:"","node-key":"index_code","highlight-current":"",onNodeClick:j,onNodeExpand:A},{default:l(({node:r,data:L})=>[d("span",de,[d("span",ce,i(r.label),1),d("span",ie,[a(n,{size:"small",type:I(L.level),effect:"plain"},{default:l(()=>[f(i(L.level),1)]),_:2},1032,["type"])])])]),_:1})])]),_:1}),a(m,{class:"right-panel"},{header:l(()=>[...e[2]||(e[2]=[d("div",{class:"card-header"},[d("span",null,"行业详情信息")],-1)])]),default:l(()=>[c.value?(y(),w("div",ue,[a(K,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=r=>C.value=r),class:"industry-tabs"},{default:l(()=>[a(E,{label:"基本信息",name:"basic"},{default:l(()=>[d("div",_e,[a(b,{column:1,border:""},{default:l(()=>[a(o,{label:"行业名称"},{default:l(()=>[d("span",pe,i(c.value.industry_name),1)]),_:1}),a(o,{label:"行业代码"},{default:l(()=>[a(n,null,{default:l(()=>[f(i(c.value.index_code),1)]),_:1})]),_:1}),a(o,{label:"行业等级"},{default:l(()=>[a(n,{type:I(c.value.level)},{default:l(()=>[f(i(c.value.level),1)]),_:1},8,["type"])]),_:1}),a(o,{label:"父级代码"},{default:l(()=>[f(i(c.value.parent_code||"无"),1)]),_:1}),a(o,{label:"来源标准"},{default:l(()=>[f(i(c.value.src||"SW2021"),1)]),_:1})]),_:1}),p.value.length>0?(y(),w("div",fe,[d("div",ve,[d("span",null,"下级行业列表 ("+i(p.value.length)+")",1)]),Z((y(),P(g,{data:z.value,style:{width:"100%"},height:"300",border:"",stripe:"",size:"small","default-sort":{prop:"pe_percentile",order:"ascending"}},{default:l(()=>[a(s,{prop:"index_code",label:"行业代码",width:"100",fixed:""}),a(s,{prop:"industry_name",label:"行业名称","min-width":"120",fixed:""}),a(s,{prop:"level",label:"等级",width:"80"},{default:l(({row:r})=>[a(n,{size:"small",type:I(r.level)},{default:l(()=>[f(i(r.level),1)]),_:2},1032,["type"])]),_:1}),a(s,{label:"PE(TTM)",align:"center"},{default:l(()=>[a(s,{prop:"pe",label:"数值",width:"80",align:"right"},{default:l(({row:r})=>[f(i(x(r.pe)),1)]),_:1}),a(s,{prop:"pe_percentile",label:"分位(%)",width:"80",align:"right",sortable:"","sort-method":B},{default:l(({row:r})=>[d("span",{style:F(D(r.pe_percentile))},i(x(r.pe_percentile)),5)]),_:1})]),_:1}),a(s,{label:"PB",align:"center"},{default:l(()=>[a(s,{prop:"pb",label:"数值",width:"80",align:"right"},{default:l(({row:r})=>[f(i(x(r.pb)),1)]),_:1}),a(s,{prop:"pb_percentile",label:"分位(%)",width:"80",align:"right",sortable:"","sort-method":M},{default:l(({row:r})=>[d("span",{style:F(D(r.pb_percentile))},i(x(r.pb_percentile)),5)]),_:1})]),_:1}),a(s,{prop:"trade_date",label:"数据日期",width:"90",align:"center"})]),_:1},8,["data"])),[[q,N.value]])])):c.value.level!=="L3"?(y(),w("div",me,[a(G,{type:"info"},{default:l(()=>[...e[3]||(e[3]=[f("暂无已展开的下级行业，请在左侧点击展开",-1)])]),_:1})])):O("",!0)])]),_:1}),a(E,{label:"行业趋势",name:"trend"},{default:l(()=>[d("div",ye,[C.value==="trend"?(y(),P(ne,{key:c.value.index_code,"ts-code":c.value.index_code,"industry-name":c.value.industry_name},null,8,["ts-code","industry-name"])):O("",!0)])]),_:1})]),_:1},8,["modelValue"])])):(y(),w("div",be,[a(U,{description:"请选择左侧行业节点查看详情"})]))]),_:1})])])}}}),Ne=ae(he,[["__scopeId","data-v-ddfd6ceb"]]);export{Ne as default};
