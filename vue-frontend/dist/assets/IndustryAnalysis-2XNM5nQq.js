import{g as se,a as re}from"./industryAnalysisApi-BmV1iody.js";import{i as Q}from"./index-1yOyFXf9.js";import{F as N,f as ie,a as te}from"./industry-fund-flow-DwayN-SW.js";import{d as Y,a as c,z as K,D as B,y as Z,G as le,c as M,e as d,i as L,w as g,H as ue,I as de,b as e,f as G,g as U,t as E,k as j,J as X,E as W,o as I,_ as ee,F as ae,A as ne}from"./index-6CnVgsnb.js";const _e={class:"industry-fund-flow-heatmap"},ce={class:"header-controls"},me={class:"controls"},ve={"element-loading-text":"正在加载数据..."},fe={key:1,class:"stats-container"},pe={class:"card-header"},ye={class:"stats-content"},he={class:"stat-item"},ge={class:"stat-value positive"},we={class:"stat-item"},xe={class:"stat-value negative"},Ne={class:"stat-item"},Ie={class:"stat-value"},Te={class:"stat-item"},be={class:"stat-value positive"},Ae={class:"stat-item"},Oe={class:"stat-value negative"},Le=Y({__name:"IndustryFundFlowHeatmap",props:{industry:{},title:{default:"行业资金流热力图"}},setup(H,{expose:C}){const _=H,f=c();let v=null;const T=c(!1),b=c(!1),A=c("amount"),k=c("20"),u=c("all"),F=c(null),m=c(null),w=K(()=>A.value==="amount"?[{key:N.TOTAL_NET_INFLOW_AMOUNT,name:"全部净流入"},{key:N.MAIN_NET_INFLOW_AMOUNT,name:"主力净流入"},{key:N.SUPER_LARGE_NET_INFLOW_AMOUNT,name:"超大单净流入"},{key:N.LARGE_NET_INFLOW_AMOUNT,name:"大单净流入"},{key:N.MEDIUM_NET_INFLOW_AMOUNT,name:"中单净流入"},{key:N.SMALL_NET_INFLOW_AMOUNT,name:"小单净流入"}]:[{key:N.TOTAL_NET_INFLOW_RATIO,name:"全部净流入占比"},{key:N.MAIN_NET_INFLOW_RATIO,name:"主力净流入占比"},{key:N.SUPER_LARGE_NET_INFLOW_RATIO,name:"超大单净流入占比"},{key:N.LARGE_NET_INFLOW_RATIO,name:"大单净流入占比"},{key:N.MEDIUM_NET_INFLOW_RATIO,name:"中单净流入占比"},{key:N.SMALL_NET_INFLOW_RATIO,name:"小单净流入占比"}]),R=()=>{if(!F.value){m.value=null;return}const a=F.value,t=a.swCodeNames.find(q=>q.indexName===_.industry);if(!t){m.value=null;return}const o=a.congestions[t.indexCode]||a.congestions[t.indexName];if(!o||o.length===0){m.value=null;return}const i=["main_net_inflow_amount","main_net_inflow_ratio","super_large_net_inflow_amount","super_large_net_inflow_ratio","large_net_inflow_amount","large_net_inflow_ratio","medium_net_inflow_amount","medium_net_inflow_ratio","small_net_inflow_amount","small_net_inflow_ratio"];let s=0,x=0,O=0;o.forEach(q=>{i.forEach(n=>{const y=q[n];if(typeof y=="number"&&!isNaN(y)&&isFinite(y)){let l=!0;(u.value==="positive"&&y<=0||u.value==="negative"&&y>=0)&&(l=!1),l&&(O++,y>0?s++:y<0&&x++)}})});const D=O>0?(s/O*100).toFixed(2):"0.00",P=O>0?(x/O*100).toFixed(2):"0.00";m.value={positiveCount:s,negativeCount:x,totalCount:O,positiveRatio:D,negativeRatio:P}},V=async()=>{T.value=!0;try{const a=new Date,t=a.toISOString().split("T")[0],o=k.value==="all"?30:parseInt(k.value),i=new Date(a);i.setDate(a.getDate()-o);const s=i.toISOString().split("T")[0],x=await ie(s,t);x?(F.value=x,await X(),r(),R()):W.error("获取资金流数据失败")}catch(a){console.error("获取资金流数据出错:",a),W.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{T.value=!1}},z=()=>{f.value&&(v=Q(f.value),r())},r=()=>{if(!v||!F.value)return;const a=F.value,t=a.dates,o=a.swCodeNames.find(n=>n.indexName===_.industry);if(!o){W.warning(`未找到行业"${_.industry}"的数据`);return}const i=a.congestions[o.indexCode]||a.congestions[o.indexName];if(!i||i.length===0){W.warning(`行业"${_.industry}"暂无资金流数据`);return}const s=[...w.value].sort((n,y)=>{if(i.length===0)return 0;const l=i[i.length-1];let S,h;return n.key===N.TOTAL_NET_INFLOW_AMOUNT?S=l.super_large_net_inflow_amount+l.large_net_inflow_amount+l.medium_net_inflow_amount+l.small_net_inflow_amount:n.key===N.TOTAL_NET_INFLOW_RATIO?S=l.super_large_net_inflow_ratio+l.large_net_inflow_ratio+l.medium_net_inflow_ratio+l.small_net_inflow_ratio:S=l[n.key],y.key===N.TOTAL_NET_INFLOW_AMOUNT?h=l.super_large_net_inflow_amount+l.large_net_inflow_amount+l.medium_net_inflow_amount+l.small_net_inflow_amount:y.key===N.TOTAL_NET_INFLOW_RATIO?h=l.super_large_net_inflow_ratio+l.large_net_inflow_ratio+l.medium_net_inflow_ratio+l.small_net_inflow_ratio:h=l[y.key],b.value?S-h:h-S}),x=[];let O=1/0,D=-1/0;i.map(n=>{const y=n.main_net_inflow_amount+n.super_large_net_inflow_amount+n.large_net_inflow_amount+n.medium_net_inflow_amount+n.small_net_inflow_amount,l=n.main_net_inflow_ratio+n.super_large_net_inflow_ratio+n.large_net_inflow_ratio+n.medium_net_inflow_ratio+n.small_net_inflow_ratio;return{...n,total_net_inflow_amount:y,total_net_inflow_ratio:l}}).forEach((n,y)=>{s.forEach((l,S)=>{const h=n[l.key];if(typeof h=="number"&&!isNaN(h)&&isFinite(h)){let $=!0;(u.value==="positive"&&h<=0||u.value==="negative"&&h>=0)&&($=!1),$&&(x.push([y,S,h]),O=Math.min(O,h),D=Math.max(D,h))}})}),(O===1/0||D===-1/0)&&(O=0,D=100),v.clear();const q={tooltip:{position:"top",formatter:function(n){const[y,l,S]=n.data,h=t[y],$=s[l],J=te[$.key],oe=J.formatter?J.formatter(S):S.toFixed(2);return`${$.name}<br/>${h}<br/>数值: ${oe}${J.unit}`}},grid:{height:Math.max(300,s.length*40)+"px",top:"2%",left:"5%",right:"10%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:t,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:t,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:s.map(n=>n.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:s.map(n=>n.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"资金类型",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:O,max:D,calculable:!0,orient:"vertical",right:"0%",top:"5%",width:15,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:A.value==="amount"?"资金流入金额":"资金流入占比",type:"heatmap",data:x,label:{show:!0,fontSize:9,formatter:function(n){const[y,l,S]=n.data,h=s[l],$=te[h.key];return $.formatter?$.formatter(S):S.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};X(()=>{if(v&&(v.setOption(q),f.value)){const n=Math.max(400,s.length*50+120);f.value.style.height=n+"px",setTimeout(()=>{v&&v.resize()},0)}})},p=()=>{b.value=!b.value,r()};return B(A,()=>{r()}),B(()=>_.industry,()=>{r(),R()}),B([F,()=>_.industry],()=>{R()}),B(u,()=>{R()}),Z(()=>{z(),V()}),le(()=>{v&&(v.dispose(),v=null)}),C({refreshData:V}),(a,t)=>{const o=L("el-radio-button"),i=L("el-radio-group"),s=L("el-option"),x=L("el-select"),O=L("el-button"),D=L("el-empty"),P=L("el-card"),q=de("loading");return I(),M("div",_e,[d(P,{shadow:"hover"},{header:g(()=>[e("div",ce,[e("h3",null,E(a.title),1),e("div",me,[d(i,{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=n=>A.value=n),onChange:r,size:"small"},{default:g(()=>[d(o,{label:"amount"},{default:g(()=>[...t[3]||(t[3]=[j("资金数量",-1)])]),_:1}),d(o,{label:"ratio"},{default:g(()=>[...t[4]||(t[4]=[j("资金比率",-1)])]),_:1})]),_:1},8,["modelValue"]),d(x,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=n=>k.value=n),onChange:V,placeholder:"选择日期范围",style:{width:"150px","margin-left":"10px"}},{default:g(()=>[d(s,{label:"最近10天",value:"10"}),d(s,{label:"最近15天",value:"15"}),d(s,{label:"最近20天",value:"20"}),d(s,{label:"全部29天",value:"all"})]),_:1},8,["modelValue"]),d(x,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=n=>u.value=n),onChange:r,placeholder:"数值过滤",style:{width:"120px","margin-left":"10px"}},{default:g(()=>[d(s,{label:"全部",value:"all"}),d(s,{label:"仅正值",value:"positive"}),d(s,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),d(O,{onClick:p,type:"primary",style:{"margin-left":"10px"}},{default:g(()=>[...t[5]||(t[5]=[j(" 按最后一列排序 ",-1)])]),_:1})])])]),default:g(()=>[ue((I(),M("div",ve,[e("div",{ref_key:"chartContainer",ref:f,class:"chart-container"},null,512),!T.value&&!F.value?(I(),G(D,{key:0,description:"暂无数据","image-size":200})):U("",!0),!T.value&&F.value&&m.value?(I(),M("div",fe,[d(P,{class:"stats-card",shadow:"hover"},{header:g(()=>[e("div",pe,[e("span",null,"净流入正负比率统计 ("+E(u.value==="all"?"全部数值":u.value==="positive"?"仅正值":"仅负值")+")",1)])]),default:g(()=>[e("div",ye,[e("div",he,[t[6]||(t[6]=e("span",{class:"stat-label"},"正值项数:",-1)),e("span",ge,E(m.value.positiveCount),1)]),e("div",we,[t[7]||(t[7]=e("span",{class:"stat-label"},"负值项数:",-1)),e("span",xe,E(m.value.negativeCount),1)]),e("div",Ne,[t[8]||(t[8]=e("span",{class:"stat-label"},"总项数:",-1)),e("span",Ie,E(m.value.totalCount),1)]),e("div",Te,[t[9]||(t[9]=e("span",{class:"stat-label"},"正值比率:",-1)),e("span",be,E(m.value.positiveRatio)+"%",1)]),e("div",Ae,[t[10]||(t[10]=e("span",{class:"stat-label"},"负值比率:",-1)),e("span",Oe,E(m.value.negativeRatio)+"%",1)])])]),_:1})])):U("",!0)])),[[q,T.value]])]),_:1})])}}}),Ce=ee(Le,[["__scopeId","data-v-10cda965"]]),ke={class:"industry-trend-charts"},Fe={class:"chart-header"},Se={class:"chart-info"},Ee={class:"info-item"},Re={class:"info-item"},De={class:"chart-header"},$e={class:"chart-info"},Me={class:"info-item"},Ve={class:"info-item"},ze={class:"chart-header"},qe={class:"chart-info"},Ue={class:"info-item"},We={class:"info-item"},Ge={key:0,class:"loading-overlay"},Pe=Y({__name:"IndustryTrendCharts",props:{industry:{default:void 0},quarter:{},industryName:{},quarterName:{}},setup(H){const C=H,_=c(!1),f=c(),v=c(),T=c(),b=c(),A=c(),k=c(),u=c([]),F=async()=>{if(C.quarter){_.value=!0;try{const r={report_type:C.quarter};C.industry&&C.industry!=="all"&&(r.industry=C.industry);const p=await se(r);u.value=p.aggregated_reports,await X(),m()}catch(r){console.error("获取行业数据失败:",r),W.error("获取数据失败，请稍后重试")}finally{_.value=!1}}},m=()=>{w(),R(),V()},w=()=>{if(!f.value||u.value.length===0)return;b.value&&b.value.dispose(),b.value=Q(f.value);const r=u.value.map(o=>o.report_date),p=u.value.map(o=>o.total_operating_revenue||0),a=u.value.map(o=>o.total_net_profit||0),t={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["营业收入","净利润"]},xAxis:{type:"category",data:r},yAxis:[{type:"value",name:"营业收入 (万元)",position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"净利润 (万元)",position:"right",axisLabel:{formatter:"{value}"}}],series:[{name:"营业收入",type:"line",yAxisIndex:0,data:p,smooth:!0,itemStyle:{color:"#1890ff"},lineStyle:{color:"#1890ff"}},{name:"净利润",type:"line",yAxisIndex:1,data:a,smooth:!0,itemStyle:{color:"#52c41a"},lineStyle:{color:"#52c41a"}}]};b.value.setOption(t)},R=()=>{if(!v.value||u.value.length===0)return;A.value&&A.value.dispose(),A.value=Q(v.value);const r=u.value.map(i=>i.report_date),p=u.value.map(i=>i.avg_operating_revenue_growth_rate||0),a=u.value.map(i=>i.avg_net_profit_growth_rate||0),t=u.value.map(i=>i.avg_gross_profit_margin||0),o={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(i){let s=i[0].name+"<br/>";return i.forEach(x=>{s+=x.marker+x.seriesName+": "+x.value.toFixed(2)+"%<br/>"}),s}},legend:{data:["营业收入增长率","净利润增长率","毛利率"]},xAxis:{type:"category",data:r},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"营业收入增长率",type:"line",data:p,smooth:!0,itemStyle:{color:"#faad14"},lineStyle:{color:"#faad14"}},{name:"净利润增长率",type:"line",data:a,smooth:!0,itemStyle:{color:"#f5222d"},lineStyle:{color:"#f5222d"}},{name:"毛利率",type:"line",data:t,smooth:!0,itemStyle:{color:"#722ed1"},lineStyle:{color:"#722ed1"}}]};A.value.setOption(o)},V=()=>{if(!T.value||u.value.length===0)return;k.value&&k.value.dispose(),k.value=Q(T.value);const r=u.value.map(o=>o.report_date),p=u.value.map(o=>o.avg_roe||0),a=u.value.map(o=>(o.avg_roe||0)*.8),t={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(o){let i=o[0].name+"<br/>";return o.forEach(s=>{i+=s.marker+s.seriesName+": "+s.value.toFixed(2)+"%<br/>"}),i}},legend:{data:["ROE","ROA"]},xAxis:{type:"category",data:r},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"ROE",type:"line",data:p,smooth:!0,itemStyle:{color:"#13c2c2"},lineStyle:{color:"#13c2c2"}},{name:"ROA",type:"line",data:a,smooth:!0,itemStyle:{color:"#eb2f96"},lineStyle:{color:"#eb2f96"}}]};k.value.setOption(t)},z=()=>{b.value?.resize(),A.value?.resize(),k.value?.resize()};return B([()=>C.industry,()=>C.quarter],()=>{F()},{immediate:!1}),Z(()=>{F(),window.addEventListener("resize",z)}),le(()=>{window.removeEventListener("resize",z),b.value?.dispose(),A.value?.dispose(),k.value?.dispose()}),(r,p)=>{const a=L("el-card"),t=L("el-loading");return I(),M("div",ke,[d(a,{class:"chart-card",shadow:"hover"},{default:g(()=>[e("div",Fe,[p[0]||(p[0]=e("h3",null,"收入利润数据",-1)),e("div",Se,[e("span",Ee,"行业: "+E(r.industryName),1),e("span",Re,"季度: "+E(r.quarterName),1)])]),e("div",{ref_key:"revenueChartRef",ref:f,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),d(a,{class:"chart-card",shadow:"hover"},{default:g(()=>[e("div",De,[p[1]||(p[1]=e("h3",null,"增长率毛利率数据",-1)),e("div",$e,[e("span",Me,"行业: "+E(r.industryName),1),e("span",Ve,"季度: "+E(r.quarterName),1)])]),e("div",{ref_key:"growthChartRef",ref:v,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),d(a,{class:"chart-card",shadow:"hover"},{default:g(()=>[e("div",ze,[p[2]||(p[2]=e("h3",null,"ROA/ROE数据",-1)),e("div",qe,[e("span",Ue,"行业: "+E(r.industryName),1),e("span",We,"季度: "+E(r.quarterName),1)])]),e("div",{ref_key:"roeChartRef",ref:T,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),_.value?(I(),M("div",Ge,[d(t,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):U("",!0)])}}}),Be=ee(Pe,[["__scopeId","data-v-b9e4f51d"]]),He={class:"industry-analysis"},Qe={class:"filter-row"},Je={class:"filter-item"},je={class:"filter-item"},Ke={key:3,class:"loading-overlay"},Xe=Y({__name:"IndustryAnalysis",setup(H){const C=c(!1),_=c(),f=c(""),v=c([]),T=c([{label:"年报",value:"annual"},{label:"中报",value:"semi_annual"},{label:"一季报",value:"q1"},{label:"三季报",value:"q3"},{label:"季报",value:"quarterly"}]),b=K(()=>_.value==="all"?"全部行业":v.value.find(w=>w.name===_.value)?.name||"未知行业"),A=K(()=>T.value.find(w=>w.value===f.value)?.label||"未选择"),k=async()=>{C.value=!0;try{const m=await re();console.log("获取行业列表响应:",m),v.value=m.sectors,console.log("行业列表:",v.value),T.value.length>0&&(f.value=T.value[0].value),W.success("页面初始化完成")}catch(m){console.error("初始化数据失败:",m),W.error("初始化数据失败，请刷新页面重试")}finally{C.value=!1}},u=()=>{console.log("行业已变更为:",_.value)},F=()=>{console.log("季度已变更为:",f.value)};return Z(()=>{k()}),(m,w)=>{const R=L("el-option"),V=L("el-select"),z=L("el-card"),r=L("el-empty"),p=L("el-loading");return I(),M("div",He,[d(z,{class:"filter-panel",shadow:"hover"},{default:g(()=>[e("div",Qe,[e("div",Je,[w[2]||(w[2]=e("label",{class:"filter-label"},"选择行业：",-1)),d(V,{modelValue:_.value,"onUpdate:modelValue":w[0]||(w[0]=a=>_.value=a),placeholder:"请选择行业",style:{width:"200px"},onChange:u},{default:g(()=>[(I(!0),M(ae,null,ne(v.value,a=>(I(),G(R,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",je,[w[3]||(w[3]=e("label",{class:"filter-label"},"选择季度：",-1)),d(V,{modelValue:f.value,"onUpdate:modelValue":w[1]||(w[1]=a=>f.value=a),placeholder:"请选择季度",style:{width:"150px"},onChange:F},{default:g(()=>[(I(!0),M(ae,null,ne(T.value,a=>(I(),G(R,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1}),_.value&&f.value?(I(),G(Be,{key:0,industry:_.value,quarter:f.value,"industry-name":b.value,"quarter-name":A.value},null,8,["industry","quarter","industry-name","quarter-name"])):U("",!0),!_.value||!f.value?(I(),G(r,{key:1,description:"请选择行业和季度查看趋势分析","image-size":200})):U("",!0),_.value&&_.value!=="all"?(I(),G(z,{key:2,class:"fund-flow-panel",shadow:"hover"},{default:g(()=>[d(Ce,{industry:b.value,title:`${b.value} - 资金流热力图`},null,8,["industry","title"])]),_:1})):U("",!0),C.value?(I(),M("div",Ke,[d(p,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):U("",!0)])}}}),at=ee(Xe,[["__scopeId","data-v-1c2929c4"]]);export{at as default};
