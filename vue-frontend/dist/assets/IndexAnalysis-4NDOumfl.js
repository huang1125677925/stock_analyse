import{x as R,d as B,a as b,y as T,Y as X,B as j,c as D,b as m,e as n,i as v,w as x,f as k,k as M,t as N,F as z,A as U,I as J,E as Y,o as h,_ as P,j as K}from"./index-Cmt4OYPI.js";import{i as Q,L as ee}from"./index-ElshY9iF.js";import{f as te}from"./indexBasicApi-BQvVLKXi.js";function oe(y){if(!y)return"";const a=String(y);if(a.length===8&&/^\d{8}$/.test(a)){const d=a.slice(0,4),c=a.slice(4,6),l=a.slice(6,8);return`${d}-${c}-${l}`}return a}async function se(y,a,d){return((await R.get("/django/api/index/index-daily/",{params:{ts_code:y,start_date:a,end_date:d,fields:"trade_date,vol,amount,close"}})).data?.records||[]).map(o=>{const r=o.date??o.trade_date,u=o.volume??o.vol,$=o.amount,g=o.close,i=oe(r),A=Number(u??0),F=$!=null?Number($):void 0,V=g!=null?Number(g):void 0;return{date:i,volume:A,amount:F,close:V}}).filter(o=>!!o.date).sort((o,r)=>o.date.localeCompare(r.date))}async function ne(y,a=30,d){const c=`/django/api/strategy/index-analysis/macd-up-prediction/${y}/`;return(await R.get(c,{params:{token:d}})).data}const ae={class:"index-volume-trend"},le={class:"chart-header"},re={class:"chart-controls"},ie={class:"prediction-section"},ce={class:"prediction-header"},de={class:"prediction-actions"},ue={key:0,class:"prediction-loading"},pe=B({__name:"IndexVolumeTrend",props:{tsCode:{default:"000001.SH"},height:{default:"420px"}},setup(y){J(e=>({b3a198b4:e.height}));const a=y,d=b("1y"),c=b(null);let l=null;const w=b([]),o=b(!1),r=b(30);function u(e){const s=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),C=String(e.getDate()).padStart(2,"0");return`${s}${p}${C}`}function $(){const e=new Date,s=new Date,p=d.value==="1y"?1:d.value==="3y"?3:5;return s.setFullYear(e.getFullYear()-p),{start:u(s),end:u(e)}}async function g(){try{const{start:e,end:s}=$(),p=await se(a.tsCode,e,s);F(p)}catch(e){console.error("加载指数成交量失败:",e),Y.error("加载指数成交量失败")}}async function i(){try{o.value=!0;const e=await ne(a.tsCode,r.value);w.value=Array.isArray(e.list)?e.list:[]}catch(e){console.error("加载上涨预测日期失败:",e),Y.error("加载上涨预测日期失败")}finally{o.value=!1}}function A(e){return e?e.includes("-")?e:e.length===8?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:e:""}function F(e){if(!c.value)return;l||(l=Q(c.value));const s=e.map(t=>t.date),p=e.map(t=>t.volume),C=e.map(t=>t.amount!=null?Number(t.amount):null),S=e.map(t=>t.close!=null?Number(t.close):null),L={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:t=>{const I=t[0]?.dataIndex??0,f=s[I],H=f&&f.length===8?`${f.slice(0,4)}-${f.slice(4,6)}-${f.slice(6,8)}`:f,O=p[I],W=C[I],q=S[I],E=(_,Z="")=>_==null?"-":_.toLocaleString()+Z,G=_=>_==null?"-":_>1e8?(_/1e8).toFixed(2)+"亿":_>1e4?(_/1e4).toFixed(2)+"万":_.toFixed(2);return`
          <div style="font-weight: bold; margin-bottom: 4px;">${H}</div>
          <div style="display: flex; justify-content: space-between; gap: 20px;">
            <span style="color: #67C23A">● 收盘价:</span>
            <span style="font-weight: bold;">${E(q)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 20px;">
            <span style="color: #E6A23C">● 成交量:</span>
            <span style="font-weight: bold;">${E(O," 手")}</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 20px;">
            <span style="color: #409EFF">● 成交额:</span>
            <span style="font-weight: bold;">${G(W)}</span>
          </div>
        `}},legend:{data:["收盘价","成交量","成交额"],top:0},grid:{left:60,right:60,top:40,bottom:60},xAxis:{type:"category",data:s,axisLabel:{rotate:0,formatter:t=>t&&t.length===8?`${t.slice(4,6)}/${t.slice(6,8)}`:t},axisTick:{alignWithLabel:!0}},yAxis:[{type:"value",name:"成交量/额",position:"right",splitLine:{show:!1},axisLabel:{formatter:t=>t>=1e8?(t/1e8).toFixed(0)+"亿":t>=1e4?(t/1e4).toFixed(0)+"万":t+""}},{type:"value",name:"收盘价",position:"left",scale:!0,splitLine:{show:!0,lineStyle:{type:"dashed",color:"#eee"}}}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100,bottom:0}],series:[{name:"成交量",type:"bar",yAxisIndex:0,data:p,itemStyle:{color:"rgba(230, 162, 60, 0.6)"},barMaxWidth:30},{name:"成交额",type:"line",yAxisIndex:0,data:C,smooth:!0,showSymbol:!1,lineStyle:{color:"#409EFF",width:2,type:"dashed"}},{name:"收盘价",type:"line",yAxisIndex:1,data:S,smooth:!0,showSymbol:!1,lineStyle:{color:"#67C23A",width:2},areaStyle:{color:new ee(0,0,0,1,[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.05)"}])}}]};l.setOption(L)}function V(){l?.resize()}return T(()=>{g(),i(),window.addEventListener("resize",V)}),X(()=>{window.removeEventListener("resize",V),l?.dispose(),l=null}),j(()=>a.tsCode,()=>{g(),i()}),(e,s)=>{const p=v("el-option"),C=v("el-select"),S=v("el-tag"),L=v("el-button"),t=v("el-empty"),I=v("el-space");return h(),D("div",ae,[m("div",le,[s[1]||(s[1]=m("h3",null,null,-1)),m("div",re,[n(C,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=f=>d.value=f),placeholder:"时间范围",style:{width:"160px"},onChange:g},{default:x(()=>[n(p,{label:"近一年",value:"1y"}),n(p,{label:"近三年",value:"3y"}),n(p,{label:"近五年",value:"5y"})]),_:1},8,["modelValue"])])]),m("div",{ref_key:"chartRef",ref:c,class:"chart"},null,512),m("div",ie,[m("div",ce,[s[3]||(s[3]=m("h4",null,"指数上涨预测日期（MACD XGBoost）",-1)),m("div",de,[n(S,{type:"info"},{default:x(()=>[M("最近 "+N(r.value)+" 天",1)]),_:1}),n(L,{size:"small",onClick:i,loading:o.value},{default:x(()=>[...s[2]||(s[2]=[M("刷新",-1)])]),_:1},8,["loading"])])]),o.value?(h(),D("div",ue,"正在加载预测数据...")):w.value.length===0?(h(),k(t,{key:1,description:"暂无预测上涨日期"})):(h(),k(I,{key:2,wrap:""},{default:x(()=>[(h(!0),D(z,null,U(w.value,f=>(h(),k(S,{key:f,type:"success"},{default:x(()=>[M(N(A(f)),1)]),_:2},1024))),128))]),_:1}))])])}}}),fe=P(pe,[["__scopeId","data-v-e738d2ae"]]),me={class:"index-analysis"},ye={class:"chart-header"},_e={class:"chart-controls"},ve=B({__name:"IndexAnalysis",setup(y){const a=K(),d=b([]),c=b(a.query.ts_code||"000001.SH"),l=b(a.query.market||"SSE");async function w(){try{const o=await te({market:l.value});d.value=o,o.find(r=>r.ts_code===c.value)||(c.value=o.length?o[0].ts_code:"")}catch(o){console.error("获取指数列表失败:",o),Y.error("获取指数列表失败")}}return T(()=>{w()}),j(l,()=>{w()}),(o,r)=>{const u=v("el-option"),$=v("el-select"),g=v("el-card");return h(),D("div",me,[n(g,{class:"mt-16",shadow:"hover"},{header:x(()=>[m("div",ye,[r[2]||(r[2]=m("h3",null,"指数趋势（成交量/额/收盘价）",-1)),m("div",_e,[n($,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=i=>l.value=i),placeholder:"选择市场",style:{width:"160px","margin-right":"10px"}},{default:x(()=>[n(u,{label:"MSCI指数",value:"MSCI"}),n(u,{label:"中证指数",value:"CSI"}),n(u,{label:"上交所指数",value:"SSE"}),n(u,{label:"深交所指数",value:"SZSE"}),n(u,{label:"中金指数",value:"CICC"}),n(u,{label:"申万指数",value:"SW"}),n(u,{label:"其他指数",value:"OTH"})]),_:1},8,["modelValue"]),n($,{modelValue:c.value,"onUpdate:modelValue":r[1]||(r[1]=i=>c.value=i),placeholder:"选择指数",style:{width:"220px"},filterable:""},{default:x(()=>[(h(!0),D(z,null,U(d.value,i=>(h(),k(u,{key:i.ts_code,label:`${i.name??i.ts_code} (${i.ts_code})`,value:i.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:x(()=>[n(fe,{"ts-code":c.value,height:"420px"},null,8,["ts-code"])]),_:1})])}}}),be=P(ve,[["__scopeId","data-v-47aa5cc9"]]);export{be as default};
