import{g as ee}from"./newsApi-Dv3gtoEk.js";import{H as te}from"./HeatmapChart-Cj6mbeEw.js";import{d as se,a as g,x as A,A as oe,z as le,c as p,e as r,C as ne,w as n,i as f,D as ae,f as O,E as W,b as l,k as h,F as D,y as N,t as v,g as z,o as c,_ as ie}from"./index-BmCUYlLe.js";import"./index-ElshY9iF.js";const re={class:"news-heatmap-view"},ue={class:"query-form"},de={class:"panel-header"},ce={class:"stats"},pe={key:0,class:"content-split"},fe={class:"industry-list-pane"},ve=["onClick","title"],me={class:"name"},_e={class:"heatmap-pane"},ye={class:"heatmap-scroll"},ge={key:0},he={class:"reason-list"},be={class:"reason-index"},we={class:"reason-text"},Ce={key:0,class:"industry-reasons"},xe={class:"date"},ke={class:"reason-list"},Ve={class:"reason-index"},$e={class:"reason-text"},Ae=se({__name:"NewsWordcloud",setup(De){const m=["航空机场","铁路公路","物流行业","水泥建材","工程建设","公用事业","电力行业","交运设备","农牧饲渔","纺织服装","煤炭行业","食品饮料","家用轻工","互联网服务","通信设备","航运港口","房地产开发","塑料制品","家电行业","电网设备","仪器仪表","电子元件","石油行业","化学制药","造纸印刷","化纤行业","证券","保险","银行","装修建材","酿酒行业","有色金属","钢铁行业","航天航空","汽车零部件","商业百货","贸易行业","旅游酒店","文化传媒","化学制品","综合行业","通用设备","玻璃玻纤","装修装饰","工程咨询服务","医疗服务","环保行业","船舶制造","农药兽药","化肥行业","贵金属","包装材料","珠宝首饰","计算机设备","通信服务","软件开发","多元金融","工程机械","教育","专用设备","能源金属","汽车服务","采掘行业","橡胶制品","化学原料","非金属材料","小金属","燃气","汽车整车","电机","光伏设备","风电设备","电池","电源设备","美容护理","半导体","消费电子","光学光电子","电子化学品","中药","医疗器械","医药商业","专业服务","生物制品","房地产服务","游戏"],_=g(20),x=g(!1),d=A(()=>{const o=new Date,e=[];for(let t=_.value-1;t>=0;t--){const s=new Date(o.getTime()-t*24*60*60*1e3);e.push(U(s))}return e}),b=g({}),k=g(!1),w=g(null),E=A(()=>w.value?`${w.value.date} · ${w.value.industry}`:"利好原因"),V=g(!1),L=g("行业利好消息"),S=g([]);function U(o){return o.toISOString().split("T")[0]}function j(){_.value=20,$()}function q(o){if(!o)return{};try{const e=JSON.parse(o),t={};for(const[s,a]of Object.entries(e))m.includes(s)&&(Array.isArray(a)?t[s]=a.map(u=>String(u)).filter(Boolean):typeof a=="string"?t[s]=[a]:a!=null&&(t[s]=[String(a)]));return t}catch(e){return console.warn("AI内容解析失败:",e),{}}}function F(o){const e={};for(const t of d.value){e[t]={};for(const s of m)e[t][s]=[]}for(const t of o){const s=t.publish_date?.slice(0,10);if(!s||!(s in e))continue;const a=q(t.ai_content);for(const[u,y]of Object.entries(a))u in e[s]&&e[s][u].push(...y)}b.value=e}async function $(){x.value=!0;try{const o=Math.min(_.value*20,600),t=(await ee(o,0)).news||[],s=new Set(d.value),a=t.filter(u=>s.has(u.publish_date?.slice(0,10)));F(a)}catch(o){console.error("加载新闻列表失败:",o),W.error("加载新闻列表失败")}finally{x.value=!1}}function B(o){let e=0;for(const t of d.value)(b.value[t]?.[o]||[]).length>0&&e++;return e}function H(o){const e=[];for(const t of d.value){const s=b.value[t]?.[o]||[];s.length>0&&e.push({date:t,reasons:s})}if(e.length===0){W.info(`${o} 近${_.value}天暂无利好消息`);return}S.value=e,L.value=`${o} · 近${_.value}天利好消息`,V.value=!0}function P(o,e){const t=b.value[e]?.[o]||[];t.length!==0&&(w.value={date:e,industry:o,reasons:t},k.value=!0)}const G=A(()=>{const o=[];for(let e=0;e<m.length;e++){const t=m[e];for(let s=0;s<d.value.length;s++){const a=d.value[s],u=b.value[a]?.[t]||[];o.push([s,e,u.length>0?1:0])}}return o}),J=A(()=>({grid:{left:160,right:20,top:40,bottom:40},tooltip:{formatter:o=>{const e=o?.value;if(!Array.isArray(e))return"";const t=Number(e[0]),s=Number(e[1]),a=d.value[t],u=m[s],y=b.value[a]?.[u]||[];return y.length>0?`${u} · ${a}：利好${y.length}条`:`${u} · ${a}：无利好`}},xAxis:{type:"category",position:"top",data:d.value,axisLabel:{color:"#606266"},axisLine:{lineStyle:{color:"#ebeef5"}}},yAxis:{type:"category",data:m,axisLabel:{color:"#606266"},axisLine:{lineStyle:{color:"#ebeef5"}}},visualMap:{show:!1,type:"piecewise",pieces:[{value:0,color:"rgba(0,0,0,0)"},{value:1,color:"rgba(245,108,108,0.18)"}]},series:[{type:"heatmap",data:G.value,label:{show:!0,color:"#f56c6c",fontWeight:600,formatter:o=>o.value?.[2]>0?"利好":""},itemStyle:{borderColor:"#f0f2f5",borderWidth:1},emphasis:{itemStyle:{shadowBlur:8,shadowColor:"rgba(0,0,0,0.2)"}}}]}));function Q(o){const e=o?.value;if(!Array.isArray(e))return;const t=Number(e[0]),s=Number(e[1]),a=d.value[t],u=m[s];P(u,a)}return oe(()=>{$()}),le(_,()=>{$()}),(o,e)=>{const t=f("el-card"),s=f("el-radio-button"),a=f("el-radio-group"),u=f("el-form-item"),y=f("el-button"),K=f("el-form"),R=f("el-tag"),X=f("el-scrollbar"),Y=f("el-empty"),I=f("el-dialog"),Z=ae("loading");return c(),p("div",re,[r(t,{shadow:"hover",class:"page-header"},{default:n(()=>[...e[5]||(e[5]=[l("div",{class:"header-content"},[l("h2",null,"新闻利好行业热力图"),l("p",null,"统计最近若干天 CCTV 新闻的 AI 行业分析，纵轴为行业，横轴为日期；有利好标红，点击显示利好原因。")],-1)])]),_:1}),r(t,{shadow:"hover",class:"query-panel"},{header:n(()=>[...e[6]||(e[6]=[l("div",{class:"panel-header"},[l("span",null,"查询条件")],-1)])]),default:n(()=>[l("div",ue,[r(K,{inline:!0,"label-width":"80px"},{default:n(()=>[r(u,{label:"最近天数"},{default:n(()=>[r(a,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=i=>_.value=i)},{default:n(()=>[r(s,{label:10},{default:n(()=>[...e[7]||(e[7]=[h("10天",-1)])]),_:1}),r(s,{label:20},{default:n(()=>[...e[8]||(e[8]=[h("20天",-1)])]),_:1}),r(s,{label:40},{default:n(()=>[...e[9]||(e[9]=[h("40天",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,null,{default:n(()=>[r(y,{type:"primary",loading:x.value,onClick:$},{default:n(()=>[...e[10]||(e[10]=[h("查询",-1)])]),_:1},8,["loading"]),r(y,{onClick:j},{default:n(()=>[...e[11]||(e[11]=[h("重置",-1)])]),_:1})]),_:1})]),_:1})])]),_:1}),ne((c(),O(t,{shadow:"hover",class:"result-panel"},{header:n(()=>[l("div",de,[e[13]||(e[13]=l("span",null,"行业×日期热力图",-1)),l("div",ce,[l("span",null,"日期范围："+v(d.value[0])+" 至 "+v(d.value[d.value.length-1]),1),e[12]||(e[12]=l("span",{class:"divider"},"|",-1)),l("span",null,"行业数："+v(m.length),1)])])]),default:n(()=>[d.value.length>0?(c(),p("div",pe,[l("div",fe,[e[14]||(e[14]=l("div",{class:"pane-title"},"行业列表",-1)),r(X,{class:"industry-scroll"},{default:n(()=>[(c(),p(D,null,N(m,(i,C)=>l("div",{key:i,class:"industry-item",onClick:T=>H(i),title:`点击查看 ${i} 近${_.value}天的利好消息`},[l("span",me,v(i),1),r(R,{size:"small",type:B(i)>0?"success":"info"},{default:n(()=>[h(v(B(i))+" 天有利好 ",1)]),_:2},1032,["type"])],8,ve)),64))]),_:1})]),l("div",_e,[l("div",ye,[r(te,{option:J.value,onChartClick:Q},null,8,["option"])])])])):(c(),O(Y,{key:1,description:"暂无数据，尝试调整查询条件","image-size":200}))]),_:1})),[[Z,x.value]]),r(I,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=i=>k.value=i),title:E.value,width:"600px"},{footer:n(()=>[r(y,{onClick:e[1]||(e[1]=i=>k.value=!1)},{default:n(()=>[...e[15]||(e[15]=[h("关闭",-1)])]),_:1})]),default:n(()=>[w.value?(c(),p("div",ge,[l("div",he,[(c(!0),p(D,null,N(w.value.reasons,(i,C)=>(c(),p("div",{class:"reason-item",key:C},[l("span",be,v(C+1)+".",1),l("span",we,v(i),1)]))),128))])])):z("",!0)]),_:1},8,["modelValue","title"]),r(I,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=i=>V.value=i),title:L.value,width:"700px"},{footer:n(()=>[r(y,{onClick:e[3]||(e[3]=i=>V.value=!1)},{default:n(()=>[...e[16]||(e[16]=[h("关闭",-1)])]),_:1})]),default:n(()=>[S.value.length>0?(c(),p("div",Ce,[(c(!0),p(D,null,N(S.value,(i,C)=>(c(),p("div",{class:"industry-date-block",key:C},[l("div",xe,v(i.date),1),l("div",ke,[(c(!0),p(D,null,N(i.reasons,(T,M)=>(c(),p("div",{class:"reason-item",key:M},[l("span",Ve,v(M+1)+".",1),l("span",$e,v(T),1)]))),128))])]))),128))])):z("",!0)]),_:1},8,["modelValue","title"])])}}}),Ie=ie(Ae,[["__scopeId","data-v-c05e5dc5"]]);export{Ie as default};
