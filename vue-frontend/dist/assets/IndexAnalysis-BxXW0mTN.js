import{x as Z,d as B,a as v,y as Y,Y as X,B as T,c as I,b as p,e as s,i as m,w as h,f as k,k as A,t as E,F as N,A as j,I as J,E as F,o as _,_ as z,j as K}from"./index-B_RXet-9.js";import{i as Q,L as ee}from"./index-ElshY9iF.js";import{f as te}from"./indexDailyApi-xnRgfUo-.js";import{f as oe}from"./indexBasicApi-_5ssZfLW.js";async function se(S,x=30,f){const i=`/django/api/strategy/index-analysis/macd-up-prediction/${S}/`;return(await Z.get(i,{params:{token:f}})).data}const ne={class:"index-volume-trend"},ae={class:"chart-header"},le={class:"chart-controls"},re={class:"prediction-section"},ie={class:"prediction-header"},ce={class:"prediction-actions"},de={key:0,class:"prediction-loading"},ue=B({__name:"IndexVolumeTrend",props:{tsCode:{default:"000001.SH"},height:{default:"420px"}},setup(S){J(e=>({b3a198b4:e.height}));const x=S,f=v("1y"),i=v(null);let a=null;const g=v([]),l=v(!1),c=v(30);function d(e){const o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),b=String(e.getDate()).padStart(2,"0");return`${o}${r}${b}`}function V(){const e=new Date,o=new Date,r=f.value==="1y"?1:f.value==="3y"?3:5;return o.setFullYear(e.getFullYear()-r),{start:d(o),end:d(e)}}async function C(){try{const{start:e,end:o}=V(),r=await te(x.tsCode,e,o);U(r)}catch(e){console.error("加载指数成交量失败:",e),F.error("加载指数成交量失败")}}async function n(){try{l.value=!0;const e=await se(x.tsCode,c.value);g.value=Array.isArray(e.list)?e.list:[]}catch(e){console.error("加载上涨预测日期失败:",e),F.error("加载上涨预测日期失败")}finally{l.value=!1}}function R(e){return e?e.includes("-")?e:e.length===8?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:e:""}function U(e){if(!i.value)return;a||(a=Q(i.value));const o=e.map(t=>t.date),r=e.map(t=>t.volume),b=e.map(t=>t.amount!=null?Number(t.amount):null),$=e.map(t=>t.close!=null?Number(t.close):null),D={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:t=>{const w=t[0]?.dataIndex??0,u=o[w],P=u&&u.length===8?`${u.slice(0,4)}-${u.slice(4,6)}-${u.slice(6,8)}`:u,H=r[w],W=b[w],q=$[w],M=(y,O="")=>y==null?"-":y.toLocaleString()+O,G=y=>y==null?"-":y>1e8?(y/1e8).toFixed(2)+"亿":y>1e4?(y/1e4).toFixed(2)+"万":y.toFixed(2);return`
          <div style="font-weight: bold; margin-bottom: 4px;">${P}</div>
          <div style="display: flex; justify-content: space-between; gap: 20px;">
            <span style="color: #67C23A">● 收盘价:</span>
            <span style="font-weight: bold;">${M(q)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 20px;">
            <span style="color: #E6A23C">● 成交量:</span>
            <span style="font-weight: bold;">${M(H," 手")}</span>
          </div>
          <div style="display: flex; justify-content: space-between; gap: 20px;">
            <span style="color: #409EFF">● 成交额:</span>
            <span style="font-weight: bold;">${G(W)}</span>
          </div>
        `}},legend:{data:["收盘价","成交量","成交额"],top:0},grid:{left:60,right:60,top:40,bottom:60},xAxis:{type:"category",data:o,axisLabel:{rotate:0,formatter:t=>t&&t.length===8?`${t.slice(4,6)}/${t.slice(6,8)}`:t},axisTick:{alignWithLabel:!0}},yAxis:[{type:"value",name:"成交量/额",position:"right",splitLine:{show:!1},axisLabel:{formatter:t=>t>=1e8?(t/1e8).toFixed(0)+"亿":t>=1e4?(t/1e4).toFixed(0)+"万":t+""}},{type:"value",name:"收盘价",position:"left",scale:!0,splitLine:{show:!0,lineStyle:{type:"dashed",color:"#eee"}}}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100,bottom:0}],series:[{name:"成交量",type:"bar",yAxisIndex:0,data:r,itemStyle:{color:"rgba(230, 162, 60, 0.6)"},barMaxWidth:30},{name:"成交额",type:"line",yAxisIndex:0,data:b,smooth:!0,showSymbol:!1,lineStyle:{color:"#409EFF",width:2,type:"dashed"}},{name:"收盘价",type:"line",yAxisIndex:1,data:$,smooth:!0,showSymbol:!1,lineStyle:{color:"#67C23A",width:2},areaStyle:{color:new ee(0,0,0,1,[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.05)"}])}}]};a.setOption(D)}function L(){a?.resize()}return Y(()=>{C(),n(),window.addEventListener("resize",L)}),X(()=>{window.removeEventListener("resize",L),a?.dispose(),a=null}),T(()=>x.tsCode,()=>{C(),n()}),(e,o)=>{const r=m("el-option"),b=m("el-select"),$=m("el-tag"),D=m("el-button"),t=m("el-empty"),w=m("el-space");return _(),I("div",ne,[p("div",ae,[o[1]||(o[1]=p("h3",null,null,-1)),p("div",le,[s(b,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=u=>f.value=u),placeholder:"时间范围",style:{width:"160px"},onChange:C},{default:h(()=>[s(r,{label:"近一年",value:"1y"}),s(r,{label:"近三年",value:"3y"}),s(r,{label:"近五年",value:"5y"})]),_:1},8,["modelValue"])])]),p("div",{ref_key:"chartRef",ref:i,class:"chart"},null,512),p("div",re,[p("div",ie,[o[3]||(o[3]=p("h4",null,"指数上涨预测日期（MACD XGBoost）",-1)),p("div",ce,[s($,{type:"info"},{default:h(()=>[A("最近 "+E(c.value)+" 天",1)]),_:1}),s(D,{size:"small",onClick:n,loading:l.value},{default:h(()=>[...o[2]||(o[2]=[A("刷新",-1)])]),_:1},8,["loading"])])]),l.value?(_(),I("div",de,"正在加载预测数据...")):g.value.length===0?(_(),k(t,{key:1,description:"暂无预测上涨日期"})):(_(),k(w,{key:2,wrap:""},{default:h(()=>[(_(!0),I(N,null,j(g.value,u=>(_(),k($,{key:u,type:"success"},{default:h(()=>[A(E(R(u)),1)]),_:2},1024))),128))]),_:1}))])])}}}),pe=z(ue,[["__scopeId","data-v-e738d2ae"]]),fe={class:"index-analysis"},ye={class:"chart-header"},me={class:"chart-controls"},_e=B({__name:"IndexAnalysis",setup(S){const x=K(),f=v([]),i=v(x.query.ts_code||"000001.SH"),a=v(x.query.market||"SSE");async function g(){try{const l=await oe({market:a.value});f.value=l,l.find(c=>c.ts_code===i.value)||(i.value=l.length?l[0].ts_code:"")}catch(l){console.error("获取指数列表失败:",l),F.error("获取指数列表失败")}}return Y(()=>{g()}),T(a,()=>{g()}),(l,c)=>{const d=m("el-option"),V=m("el-select"),C=m("el-card");return _(),I("div",fe,[s(C,{class:"mt-16",shadow:"hover"},{header:h(()=>[p("div",ye,[c[2]||(c[2]=p("h3",null,"指数趋势（成交量/额/收盘价）",-1)),p("div",me,[s(V,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=n=>a.value=n),placeholder:"选择市场",style:{width:"160px","margin-right":"10px"}},{default:h(()=>[s(d,{label:"MSCI指数",value:"MSCI"}),s(d,{label:"中证指数",value:"CSI"}),s(d,{label:"上交所指数",value:"SSE"}),s(d,{label:"深交所指数",value:"SZSE"}),s(d,{label:"中金指数",value:"CICC"}),s(d,{label:"申万指数",value:"SW"}),s(d,{label:"其他指数",value:"OTH"})]),_:1},8,["modelValue"]),s(V,{modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=n=>i.value=n),placeholder:"选择指数",style:{width:"220px"},filterable:""},{default:h(()=>[(_(!0),I(N,null,j(f.value,n=>(_(),k(d,{key:n.ts_code,label:`${n.name??n.ts_code} (${n.ts_code})`,value:n.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:h(()=>[s(pe,{"ts-code":i.value,height:"420px"},null,8,["ts-code"])]),_:1})])}}}),be=z(_e,[["__scopeId","data-v-47aa5cc9"]]);export{be as default};
