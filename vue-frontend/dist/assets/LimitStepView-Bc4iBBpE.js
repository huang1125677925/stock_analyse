import{x as W,d as X,a as b,z as C,y as Z,C as ee,f as w,w as i,H as te,i as u,e as o,D as ae,k as V,G as ne,c as v,g as F,b as d,F as L,A as R,t as k,o as r,_ as le}from"./index-yvE1imiI.js";import{i as se}from"./index-ElshY9iF.js";async function oe(Y){return(await W.get("/django/api/tasks/limit-step/",{params:Y})).data}const re={key:1,class:"date-selector"},ie={key:2,class:"ladder-container"},ue={class:"ladder-header"},ce={class:"ladder-content"},de={class:"ladder-label"},me={class:"board-count"},pe={class:"stock-count"},fe={class:"ladder-stocks"},ve={class:"stock-code"},_e=X({__name:"LimitStepView",setup(Y){const _=b(!1),g=b(null),S=b("last7d"),y=b([]),A=b(null);let m=null;const p=b(""),x=C(()=>y.value.length>0),h=C(()=>{const e=new Set(y.value.map(t=>t.trade_date));return Array.from(e).sort().reverse()}),z=C(()=>{if(!p.value)return[];const e=y.value.filter(l=>l.trade_date===p.value),t=new Map;e.forEach(l=>{const n=Number(l.nums);t.has(n)||t.set(n,[]),t.get(n).push(l)});const a=[];return t.forEach((l,n)=>{a.push({nums:n,stocks:l})}),a.sort((l,n)=>n.nums-l.nums)});function T(e){if(!e)return[];if(Array.isArray(e.records)&&e.records.length>0)return e.records;if(Array.isArray(e.items)&&Array.isArray(e.fields)){const t=e.fields;return e.items.map(a=>{const l={};return t.forEach((n,c)=>l[n]=a[c]),l})}return[]}async function B(){_.value=!0;try{const e={};g.value&&(e.start_date=g.value[0],e.end_date=g.value[1]);const t=await oe(e);y.value=T(t),h.value.length>0?p.value=h.value[0]:p.value="",te(()=>{q()})}finally{_.value=!1}}function U(){g.value=null,y.value=[],p.value="",m&&(m.dispose(),m=null)}function D(e){return!e||e.length!==8?e:`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`}function j(e){return e>=5?"danger":e>=3?"warning":e===2?"primary":"info"}function q(){if(!A.value||!x.value)return;m||(m=se(A.value),m.on("click",n=>{if(n.name){const c=h.value.find(f=>f===n.name||D(f)===n.name);c&&(p.value=c)}}));const e=[...h.value].reverse(),t=e.map(n=>{const c=y.value.filter(f=>f.trade_date===n);return Math.max(...c.map(f=>Number(f.nums)))}),a=e.map(n=>y.value.filter(c=>c.trade_date===n).length),l={title:{text:"连板情绪趋势",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["最高连板数","连板家数"],bottom:0},grid:{left:"3%",right:"3%",bottom:"10%",containLabel:!0},xAxis:{type:"category",data:e,axisLabel:{formatter:n=>D(n)}},yAxis:[{type:"value",name:"最高连板数",position:"left",minInterval:1},{type:"value",name:"连板家数",position:"right",minInterval:1}],series:[{name:"最高连板数",type:"line",data:t,yAxisIndex:0,itemStyle:{color:"#d9001b"},smooth:!0},{name:"连板家数",type:"bar",data:a,yAxisIndex:1,itemStyle:{color:"#409EFF",opacity:.6}}]};m.setOption(l)}function E(){m?.resize()}Z(()=>{window.addEventListener("resize",E),N("last7d"),B()}),ee(()=>{window.removeEventListener("resize",E),m?.dispose()});function I(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}${a}${l}`}function N(e){const t=new Date,a=new Date;switch(e){case"last7d":a.setDate(t.getDate()-6);break;case"last1m":a.setMonth(t.getMonth()-1);break;case"last3m":a.setMonth(t.getMonth()-3);break;case"last6m":a.setMonth(t.getMonth()-6);break;case"last1y":a.setFullYear(t.getFullYear()-1);break;case"last3y":a.setFullYear(t.getFullYear()-3);break}g.value=[I(a),I(t)]}function P(e){N(e)}return(e,t)=>{const a=u("el-option"),l=u("el-select"),n=u("el-form-item"),c=u("el-date-picker"),f=u("el-button"),G=u("el-form"),H=u("el-radio-button"),O=u("el-radio-group"),Q=u("el-tag"),$=u("el-empty"),J=u("el-card"),K=ne("loading");return r(),w(J,{class:"page-card"},{header:i(()=>[...t[3]||(t[3]=[d("div",{class:"card-header"},"连板天梯",-1)])]),default:i(()=>[o(G,{inline:!0,class:"query-form"},{default:i(()=>[o(n,{label:"快捷选择"},{default:i(()=>[o(l,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=s=>S.value=s),style:{width:"180px"},onChange:P},{default:i(()=>[o(a,{label:"最近一周",value:"last7d"}),o(a,{label:"最近1月",value:"last1m"}),o(a,{label:"最近三月",value:"last3m"}),o(a,{label:"最近半年",value:"last6m"}),o(a,{label:"最近一年",value:"last1y"}),o(a,{label:"最近三年",value:"last3y"})]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"日期范围"},{default:i(()=>[o(c,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYYMMDD","unlink-panels":""},null,8,["modelValue"])]),_:1}),o(n,null,{default:i(()=>[o(f,{type:"primary",loading:_.value,onClick:B},{default:i(()=>[...t[4]||(t[4]=[V("查询",-1)])]),_:1},8,["loading"]),o(f,{onClick:U},{default:i(()=>[...t[5]||(t[5]=[V("重置",-1)])]),_:1})]),_:1})]),_:1}),ae((r(),v("div",null,[x.value?(r(),v("div",{key:0,class:"chart-container",ref_key:"chartRef",ref:A},null,512)):F("",!0),h.value.length>0?(r(),v("div",re,[t[6]||(t[6]=d("span",{class:"label"},"选择日期查看天梯：",-1)),o(O,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),size:"small"},{default:i(()=>[(r(!0),v(L,null,R(h.value,s=>(r(),w(H,{key:s,label:s,value:s},{default:i(()=>[V(k(D(s)),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])):F("",!0),z.value.length>0?(r(),v("div",ie,[d("div",ue,[d("h3",null,k(D(p.value))+" 连板分布",1)]),d("div",ce,[(r(!0),v(L,null,R(z.value,s=>(r(),v("div",{key:s.nums,class:"ladder-row"},[d("div",de,[d("div",me,k(s.nums)+"板",1),d("div",pe,k(s.stocks.length)+"只",1)]),d("div",fe,[(r(!0),v(L,null,R(s.stocks,M=>(r(),w(Q,{key:M.ts_code,class:"stock-tag",effect:"dark",type:j(s.nums)},{default:i(()=>[V(k(M.name)+" ",1),d("span",ve,"("+k(M.ts_code)+")",1)]),_:2},1032,["type"]))),128))])]))),128))])])):!_.value&&x.value?(r(),w($,{key:3,description:"该日期无连板数据"})):!_.value&&!x.value?(r(),w($,{key:4,description:"暂无数据，请查询"})):F("",!0)])),[[K,_.value]])]),_:1})}}}),he=le(_e,[["__scopeId","data-v-0e216e22"]]);export{he as default};
