import{H as E}from"./HeatmapChart-Cx1J2RJh.js";import{g as x,j as q}from"./individualStockApi-BKOPkXOI.js";import{d as R,a as g,r as T,B as U,z as j,y as H,c as Y,b as w,e as l,w as c,i as f,E as h,k as V,F as J,A as G,f as K,o as k,_ as P}from"./index-B-X9N5Dz.js";import"./index-ElshY9iF.js";const Q={class:"stock-correlation-view"},W={class:"page-header"},X={class:"header-content"},C="stockCorrelationSelectedStocks",Z=R({__name:"StockCorrelationView",setup(ee){const b=g(!1),v=g([]),_=g(!1),S=g(null),y=g({}),o=T({ts_codes:[],start_date:"",end_date:""}),M=e=>{const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${u}`},N=()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-60),o.start_date=M(t),o.end_date=M(e)},A=async e=>{const t=(e||"").trim();if(t){_.value=!0;try{const a=await x({keyword:t,page:1,page_size:20});v.value=a.data||[]}catch(a){h.error(a?.message||"股票列表搜索失败")}finally{_.value=!1}}},z=async()=>{_.value=!0;try{const e=await x({page:1,page_size:50});v.value=e.data||[]}catch(e){h.error(e?.message||"股票列表加载失败")}finally{_.value=!1}},L=async e=>{const t=e.filter(a=>!y.value[a]);for(const a of t)try{const u=(a||"").includes(".")?(a||"").split(".")[0]:a||"",r=((await x({keyword:u,page:1,page_size:1})).data||[])[0];r&&(y.value[a]=r)}catch{}},$=()=>{const e=o.ts_codes.slice(),t=e.map(a=>y.value[a]).filter(Boolean);try{localStorage.setItem(C,JSON.stringify({ts_codes:e,details:t}))}catch{}},D=e=>{const t=y.value[e]||v.value.find(a=>a.code===e);return t&&t.name||e};U(()=>o.ts_codes.slice(),async e=>{await L(e),$()});const B=async()=>{if(!o.ts_codes||o.ts_codes.length<2){h.warning("请至少选择两个股票进行相关性分析");return}b.value=!0;try{S.value=await q({ts_codes:o.ts_codes,start_date:o.start_date||void 0,end_date:o.end_date||void 0})}catch(e){h.error(e?.message||"相关性数据查询失败")}finally{b.value=!1}},I=()=>B(),F=()=>{o.ts_codes=[],S.value=null},O=j(()=>{const e=S.value;if(!e||!e.labels||!e.matrix||e.labels.length===0)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const t=e.labels.map(D),a=e.labels.map(D),u=[];let m=1/0,r=-1/0;for(let s=0;s<a.length;s++){const p=e.matrix[s]||[];for(let i=0;i<t.length;i++){const d=typeof p[i]=="number"?p[i]:NaN;isNaN(d)||(u.push([i,s,+d.toFixed(3)]),m=Math.min(m,d),r=Math.max(r,d))}}return(!isFinite(m)||!isFinite(r))&&(m=-1,r=1),{tooltip:{position:"top",formatter:s=>{const[p,i,d]=s?.data??[],n=t[p]??"";return`${a[i]??""} vs ${n}<br/>相关系数：${d}`}},grid:{left:"8%",right:"8%",top:"8%",bottom:"8%",containLabel:!0},xAxis:{type:"category",data:t,axisLabel:{rotate:45,fontSize:11}},yAxis:{type:"category",data:a,axisLabel:{fontSize:11}},visualMap:{min:Math.min(-1,Math.floor(m*10)/10),max:Math.max(1,Math.ceil(r*10)/10),calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"]},text:["高","低"]},series:[{name:"相关性矩阵",type:"heatmap",data:u,label:{show:!0,fontSize:9,formatter:s=>s?.data?.[2]},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0,0,0,0.5)"}}}]}});return H(async()=>{N(),await z();try{const e=localStorage.getItem(C);if(e){const t=JSON.parse(e);if(Array.isArray(t.ts_codes)&&(o.ts_codes=t.ts_codes),Array.isArray(t.details))for(const a of t.details)y.value[a.code]=a}}catch{}}),(e,t)=>{const a=f("el-button"),u=f("el-space"),m=f("el-option"),r=f("el-select"),s=f("el-form-item"),p=f("el-date-picker"),i=f("el-form"),d=f("el-card");return k(),Y("div",Q,[w("div",W,[w("div",X,[t[5]||(t[5]=w("h2",null,"股票 相关性分析",-1)),l(u,null,{default:c(()=>[l(a,{type:"primary",loading:b.value,onClick:I},{default:c(()=>[...t[3]||(t[3]=[V("查询",-1)])]),_:1},8,["loading"]),l(a,{onClick:F},{default:c(()=>[...t[4]||(t[4]=[V("重置",-1)])]),_:1})]),_:1})])]),l(d,{class:"search-card"},{default:c(()=>[l(i,{model:o,"label-width":"110px","label-position":"left",inline:""},{default:c(()=>[l(s,{label:"股票列表",required:""},{default:c(()=>[l(r,{modelValue:o.ts_codes,"onUpdate:modelValue":t[0]||(t[0]=n=>o.ts_codes=n),multiple:"",placeholder:"搜索并添加 股票（可多选）",filterable:"",remote:"","reserve-keyword":"",clearable:"","remote-method":A,loading:_.value,style:{width:"520px"}},{default:c(()=>[(k(!0),Y(J,null,G(v.value,n=>(k(),K(m,{key:n.code,label:`${n.name||""}（${n.code}）`,value:n.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(s,{label:"开始日期"},{default:c(()=>[l(p,{modelValue:o.start_date,"onUpdate:modelValue":t[1]||(t[1]=n=>o.start_date=n),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(s,{label:"结束日期"},{default:c(()=>[l(p,{modelValue:o.end_date,"onUpdate:modelValue":t[2]||(t[2]=n=>o.end_date=n),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(d,{class:"heatmap-card"},{default:c(()=>[l(E,{option:O.value},null,8,["option"])]),_:1})])}}}),ne=P(Z,[["__scopeId","data-v-6cff46d9"]]);export{ne as default};
