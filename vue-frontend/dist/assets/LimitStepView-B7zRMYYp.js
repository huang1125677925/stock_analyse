import{x as R,d as B,a as d,y as L,f as v,w as n,i as o,e as l,D as j,k as D,G as N,c as $,A as q,F as E,b as T,o as m,_ as U}from"./index-DUOcnsZX.js";async function z(g){return(await R.get("/django/api/tasks/limit-step/",{params:g})).data}const G=B({__name:"LimitStepView",setup(g){const c=d(!1),s=d(null),b=d("last7d"),p=d([]),_=d([]);function V(a){if(!a)return[];if(Array.isArray(a.records)&&a.records.length>0)return a.records;if(Array.isArray(a.items)&&Array.isArray(a.fields)){const e=a.fields;return a.items.map(t=>{const u={};return e.forEach((i,f)=>u[i]=t[f]),u})}return[]}async function y(){c.value=!0;try{const a={};s.value&&(a.start_date=s.value[0],a.end_date=s.value[1]);const e=await z(a),t=V(e);p.value=t,_.value=t.length?Object.keys(t[0]):[]}finally{c.value=!1}}function M(){s.value=null,p.value=[],_.value=[]}function k(a){const e=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0");return`${e}${t}${u}`}function h(a){const e=new Date,t=new Date;switch(a){case"last7d":t.setDate(e.getDate()-6);break;case"last1m":t.setMonth(e.getMonth()-1);break;case"last3m":t.setMonth(e.getMonth()-3);break;case"last6m":t.setMonth(e.getMonth()-6);break;case"last1y":t.setFullYear(e.getFullYear()-1);break;case"last3y":t.setFullYear(e.getFullYear()-3);break}s.value=[k(t),k(e)]}function Y(a){h(a)}return L(()=>{h("last7d"),y()}),(a,e)=>{const t=o("el-option"),u=o("el-select"),i=o("el-form-item"),f=o("el-date-picker"),w=o("el-button"),S=o("el-form"),x=o("el-table-column"),A=o("el-table"),C=o("el-card"),F=N("loading");return m(),v(C,{class:"page-card"},{header:n(()=>[...e[2]||(e[2]=[T("div",{class:"card-header"},"连板天梯",-1)])]),default:n(()=>[l(S,{inline:!0,class:"query-form"},{default:n(()=>[l(i,{label:"快捷选择"},{default:n(()=>[l(u,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),style:{width:"180px"},onChange:Y},{default:n(()=>[l(t,{label:"最近一周",value:"last7d"}),l(t,{label:"最近1月",value:"last1m"}),l(t,{label:"最近三月",value:"last3m"}),l(t,{label:"最近半年",value:"last6m"}),l(t,{label:"最近一年",value:"last1y"}),l(t,{label:"最近三年",value:"last3y"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"日期范围"},{default:n(()=>[l(f,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=r=>s.value=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYYMMDD","unlink-panels":""},null,8,["modelValue"])]),_:1}),l(i,null,{default:n(()=>[l(w,{type:"primary",loading:c.value,onClick:y},{default:n(()=>[...e[3]||(e[3]=[D("查询",-1)])]),_:1},8,["loading"]),l(w,{onClick:M},{default:n(()=>[...e[4]||(e[4]=[D("重置",-1)])]),_:1})]),_:1})]),_:1}),j((m(),v(A,{data:p.value,border:"",stripe:"",style:{width:"100%"}},{default:n(()=>[(m(!0),$(E,null,q(_.value,r=>(m(),v(x,{key:r,prop:r,label:r,"min-width":"120"},null,8,["prop","label"]))),128))]),_:1},8,["data"])),[[F,c.value]])]),_:1})}}}),O=U(G,[["__scopeId","data-v-9f874d13"]]);export{O as default};
