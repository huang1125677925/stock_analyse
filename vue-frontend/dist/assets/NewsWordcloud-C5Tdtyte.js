import{g as te}from"./newsApi-C9D2d4mG.js";import{H as se}from"./HeatmapChart-C7y-qulV.js";import{d as oe,a as g,x,A as le,z as ne,c as f,e as i,C as ae,w as n,i as p,D as re,f as O,E as W,b as l,k as h,F as N,y as S,t as v,g as z,o as d,_ as ie}from"./index-Dg80bSOo.js";import"./index-ElshY9iF.js";const ue={class:"news-heatmap-view"},de={class:"query-form"},ce={class:"panel-header"},fe={class:"stats"},pe={key:0,class:"content-split"},ve={class:"industry-list-pane"},me=["onClick","title"],_e={class:"name"},ye={class:"heatmap-pane"},ge={class:"heatmap-scroll"},he={key:0},be={class:"reason-list"},we={class:"reason-index"},Ce={class:"reason-text"},xe={key:0,class:"industry-reasons"},ke={class:"date"},Ve={class:"reason-list"},$e={class:"reason-index"},Ae={class:"reason-text"},De=oe({__name:"NewsWordcloud",setup(Ne){const m=["航空机场","铁路公路","物流行业","水泥建材","工程建设","公用事业","电力行业","交运设备","农牧饲渔","纺织服装","煤炭行业","食品饮料","家用轻工","互联网服务","通信设备","航运港口","房地产开发","塑料制品","家电行业","电网设备","仪器仪表","电子元件","石油行业","化学制药","造纸印刷","化纤行业","证券","保险","银行","装修建材","酿酒行业","有色金属","钢铁行业","航天航空","汽车零部件","商业百货","贸易行业","旅游酒店","文化传媒","化学制品","综合行业","通用设备","玻璃玻纤","装修装饰","工程咨询服务","医疗服务","环保行业","船舶制造","农药兽药","化肥行业","贵金属","包装材料","珠宝首饰","计算机设备","通信服务","软件开发","多元金融","工程机械","教育","专用设备","能源金属","汽车服务","采掘行业","橡胶制品","化学原料","非金属材料","小金属","燃气","汽车整车","电机","光伏设备","风电设备","电池","电源设备","美容护理","半导体","消费电子","光学光电子","电子化学品","中药","医疗器械","医药商业","专业服务","生物制品","房地产服务","游戏"],_=g(20),k=g(!1),c=x(()=>{const s=new Date,e=[];for(let t=_.value-1;t>=0;t--){const o=new Date(s.getTime()-t*24*60*60*1e3);e.push(U(o))}return e}),b=g({}),V=g(!1),w=g(null),E=x(()=>w.value?`${w.value.date} · ${w.value.industry}`:"利好原因"),$=g(!1),I=g("行业利好消息"),L=g([]);function U(s){return s.toISOString().split("T")[0]}function j(){_.value=20,A()}function q(s){if(!s)return{};try{const e=JSON.parse(s),t={};for(const[o,a]of Object.entries(e))m.includes(o)&&(Array.isArray(a)?t[o]=a.map(u=>String(u)).filter(Boolean):typeof a=="string"?t[o]=[a]:a!=null&&(t[o]=[String(a)]));return t}catch(e){return console.warn("AI内容解析失败:",e),{}}}function F(s){const e={};for(const t of c.value){e[t]={};for(const o of m)e[t][o]=[]}for(const t of s){const o=t.publish_date?.slice(0,10);if(!o||!(o in e))continue;const a=q(t.ai_content);for(const[u,y]of Object.entries(a))u in e[o]&&e[o][u].push(...y)}b.value=e}async function A(){k.value=!0;try{const s=Math.min(_.value*20,600),t=(await te(s,0)).news||[],o=new Set(c.value),a=t.filter(u=>o.has(u.publish_date?.slice(0,10)));F(a)}catch(s){console.error("加载新闻列表失败:",s),W.error("加载新闻列表失败")}finally{k.value=!1}}function D(s){let e=0;for(const t of c.value)(b.value[t]?.[s]||[]).length>0&&e++;return e}const H=x(()=>{const s=[...m];return s.sort((e,t)=>D(t)-D(e)),s});function P(s){const e=[];for(const t of c.value){const o=b.value[t]?.[s]||[];o.length>0&&e.push({date:t,reasons:o})}if(e.length===0){W.info(`${s} 近${_.value}天暂无利好消息`);return}L.value=e,I.value=`${s} · 近${_.value}天利好消息`,$.value=!0}function G(s,e){const t=b.value[e]?.[s]||[];t.length!==0&&(w.value={date:e,industry:s,reasons:t},V.value=!0)}const J=x(()=>{const s=[];for(let e=0;e<m.length;e++){const t=m[e];for(let o=0;o<c.value.length;o++){const a=c.value[o],u=b.value[a]?.[t]||[];s.push([o,e,u.length>0?1:0])}}return s}),Q=x(()=>({grid:{left:160,right:20,top:40,bottom:40},tooltip:{formatter:s=>{const e=s?.value;if(!Array.isArray(e))return"";const t=Number(e[0]),o=Number(e[1]),a=c.value[t],u=m[o],y=b.value[a]?.[u]||[];return y.length>0?`${u} · ${a}：利好${y.length}条`:`${u} · ${a}：无利好`}},xAxis:{type:"category",position:"top",data:c.value,axisLabel:{color:"#606266"},axisLine:{lineStyle:{color:"#ebeef5"}}},yAxis:{type:"category",data:m,axisLabel:{color:"#606266"},axisLine:{lineStyle:{color:"#ebeef5"}}},visualMap:{show:!1,type:"piecewise",pieces:[{value:0,color:"rgba(0,0,0,0)"},{value:1,color:"rgba(245,108,108,0.18)"}]},series:[{type:"heatmap",data:J.value,label:{show:!0,color:"#f56c6c",fontWeight:600,formatter:s=>s.value?.[2]>0?"利好":""},itemStyle:{borderColor:"#f0f2f5",borderWidth:1},emphasis:{itemStyle:{shadowBlur:8,shadowColor:"rgba(0,0,0,0.2)"}}}]}));function K(s){const e=s?.value;if(!Array.isArray(e))return;const t=Number(e[0]),o=Number(e[1]),a=c.value[t],u=m[o];G(u,a)}return le(()=>{A()}),ne(_,()=>{A()}),(s,e)=>{const t=p("el-card"),o=p("el-radio-button"),a=p("el-radio-group"),u=p("el-form-item"),y=p("el-button"),R=p("el-form"),X=p("el-tag"),Y=p("el-scrollbar"),Z=p("el-empty"),B=p("el-dialog"),ee=re("loading");return d(),f("div",ue,[i(t,{shadow:"hover",class:"page-header"},{default:n(()=>[...e[5]||(e[5]=[l("div",{class:"header-content"},[l("h2",null,"新闻利好行业热力图"),l("p",null,"统计最近若干天 CCTV 新闻的 AI 行业分析，纵轴为行业，横轴为日期；有利好标红，点击显示利好原因。")],-1)])]),_:1}),i(t,{shadow:"hover",class:"query-panel"},{header:n(()=>[...e[6]||(e[6]=[l("div",{class:"panel-header"},[l("span",null,"查询条件")],-1)])]),default:n(()=>[l("div",de,[i(R,{inline:!0,"label-width":"80px"},{default:n(()=>[i(u,{label:"最近天数"},{default:n(()=>[i(a,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r)},{default:n(()=>[i(o,{label:10},{default:n(()=>[...e[7]||(e[7]=[h("10天",-1)])]),_:1}),i(o,{label:20},{default:n(()=>[...e[8]||(e[8]=[h("20天",-1)])]),_:1}),i(o,{label:40},{default:n(()=>[...e[9]||(e[9]=[h("40天",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),i(u,null,{default:n(()=>[i(y,{type:"primary",loading:k.value,onClick:A},{default:n(()=>[...e[10]||(e[10]=[h("查询",-1)])]),_:1},8,["loading"]),i(y,{onClick:j},{default:n(()=>[...e[11]||(e[11]=[h("重置",-1)])]),_:1})]),_:1})]),_:1})])]),_:1}),ae((d(),O(t,{shadow:"hover",class:"result-panel"},{header:n(()=>[l("div",ce,[e[13]||(e[13]=l("span",null,"行业×日期热力图",-1)),l("div",fe,[l("span",null,"日期范围："+v(c.value[0])+" 至 "+v(c.value[c.value.length-1]),1),e[12]||(e[12]=l("span",{class:"divider"},"|",-1)),l("span",null,"行业数："+v(m.length),1)])])]),default:n(()=>[c.value.length>0?(d(),f("div",pe,[l("div",ve,[e[14]||(e[14]=l("div",{class:"pane-title"},"行业列表",-1)),i(Y,{class:"industry-scroll"},{default:n(()=>[(d(!0),f(N,null,S(H.value,(r,C)=>(d(),f("div",{key:r,class:"industry-item",onClick:T=>P(r),title:`点击查看 ${r} 近${_.value}天的利好消息`},[l("span",_e,v(r),1),i(X,{size:"small",type:D(r)>0?"success":"info"},{default:n(()=>[h(v(D(r))+" 天有利好 ",1)]),_:2},1032,["type"])],8,me))),128))]),_:1})]),l("div",ye,[l("div",ge,[i(se,{option:Q.value,onChartClick:K},null,8,["option"])])])])):(d(),O(Z,{key:1,description:"暂无数据，尝试调整查询条件","image-size":200}))]),_:1})),[[ee,k.value]]),i(B,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=r=>V.value=r),title:E.value,width:"600px"},{footer:n(()=>[i(y,{onClick:e[1]||(e[1]=r=>V.value=!1)},{default:n(()=>[...e[15]||(e[15]=[h("关闭",-1)])]),_:1})]),default:n(()=>[w.value?(d(),f("div",he,[l("div",be,[(d(!0),f(N,null,S(w.value.reasons,(r,C)=>(d(),f("div",{class:"reason-item",key:C},[l("span",we,v(C+1)+".",1),l("span",Ce,v(r),1)]))),128))])])):z("",!0)]),_:1},8,["modelValue","title"]),i(B,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=r=>$.value=r),title:I.value,width:"700px"},{footer:n(()=>[i(y,{onClick:e[3]||(e[3]=r=>$.value=!1)},{default:n(()=>[...e[16]||(e[16]=[h("关闭",-1)])]),_:1})]),default:n(()=>[L.value.length>0?(d(),f("div",xe,[(d(!0),f(N,null,S(L.value,(r,C)=>(d(),f("div",{class:"industry-date-block",key:C},[l("div",ke,v(r.date),1),l("div",Ve,[(d(!0),f(N,null,S(r.reasons,(T,M)=>(d(),f("div",{class:"reason-item",key:M},[l("span",$e,v(M+1)+".",1),l("span",Ae,v(T),1)]))),128))])]))),128))])):z("",!0)]),_:1},8,["modelValue","title"])])}}}),Te=ie(De,[["__scopeId","data-v-aff35699"]]);export{Te as default};
