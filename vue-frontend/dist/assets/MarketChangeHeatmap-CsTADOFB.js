import{i as $}from"./index-ElshY9iF.js";import{a as J}from"./individualStockApi-jdhBqDfd.js";import{J as P,d as k,a as v,A as N,Y as I,z as T,f as H,w as R,E,i as B,b as t,t as z,o as Y,_ as F,c as q,e as M,k as O}from"./index-FX-vaUBG.js";const j="/django/api/strategy/market-analysis";async function G(h={days:30}){return(await P.get(`${j}/adr/`,{params:h})).data}async function K(h={days:30}){return(await P.get(`${j}/adl/`,{params:h})).data}const Q={class:"header"},X={class:"subtitle"},Z={class:"counts"},tt=k({__name:"AdrTrend",props:{days:{default:30},startDate:{default:void 0},endDate:{default:void 0}},setup(h){const s=h,i=v(null);let l=null;const c=v(0),u=v(0),d=v(0),m=async()=>{try{const r=await G({days:s.days,start_date:s.startDate,end_date:s.endDate}),o=r.daily.map(n=>n.date),a=r.daily.map(n=>n.daily_adr==null?null:Number(n.daily_adr)),[p,g]=r.aggregated.typical_range,V=r.daily.map(n=>Number(n.adv_count)),S=r.daily.map(n=>Number(n.decl_count)),_=r.daily.map(n=>Number(n.flat_count));if(c.value=r.aggregated.adv_sum,u.value=r.aggregated.decl_sum,d.value=r.daily.reduce((n,D)=>n+(D.flat_count||0),0),!i.value)return;l||(l=$(i.value));const C={tooltip:{trigger:"axis",formatter:n=>{const D=n?.[0]?.axisValueLabel||"",w=n.find(b=>b.seriesName==="ADR"),f=n.find(b=>b.seriesName==="上涨家数"),L=n.find(b=>b.seriesName==="下跌家数"),e=n.find(b=>b.seriesName==="平家数"),x=w?`ADR：${w.data==null?"-":Number(w.data).toFixed(4)}`:"",A=f?`上涨家数：${f.data}`:"",W=L?`下跌家数：${L.data}`:"",U=e?`平家数：${e.data}`:"";return[D,x,A,W,U].filter(Boolean).join("<br/>")}},legend:{data:["ADR","上涨家数","下跌家数","平家数","典型区间"],top:8},grid:{left:48,right:24,top:80,bottom:48},xAxis:{type:"category",data:o},yAxis:[{type:"value",name:"ADR",position:"left",min:n=>Math.min(p,Math.floor(n.min*10)/10),max:n=>Math.max(g,Math.ceil(n.max*10)/10)},{type:"value",name:"家数",position:"right"}],series:[{name:"ADR",type:"line",yAxisIndex:0,smooth:!0,showSymbol:!1,data:a,lineStyle:{width:2},itemStyle:{color:"#4a7bd0"},connectNulls:!0,z:3},{name:"上涨家数",type:"bar",yAxisIndex:1,stack:"counts",data:V,itemStyle:{color:"#F56C6C"},barMaxWidth:28,z:2},{name:"下跌家数",type:"bar",yAxisIndex:1,stack:"counts",data:S,itemStyle:{color:"#67C23A"},barMaxWidth:28,z:2},{name:"平家数",type:"bar",yAxisIndex:1,stack:"counts",data:_,itemStyle:{color:"#909399"},barMaxWidth:28,z:2},{name:"典型区间",type:"line",data:[],markArea:{itemStyle:{color:"rgba(255, 193, 7, 0.15)"},data:[[{yAxis:p},{yAxis:g}]]},z:1}]};l.setOption(C),window.addEventListener("resize",y)}catch(r){console.error(r),E.error("获取ADR数据失败，请稍后重试")}},y=()=>l?.resize();return N(m),I(()=>{window.removeEventListener("resize",y),l?.dispose(),l=null}),T(()=>[s.days,s.startDate,s.endDate],()=>{m()}),(r,o)=>{const a=B("el-card");return Y(),H(a,{shadow:"hover",class:"adr-trend"},{default:R(()=>[t("div",Q,[o[0]||(o[0]=t("h2",null,"涨跌家数比（ADR）趋势",-1)),t("span",X,"区间默认最近"+z(r.days)+"个交易日",1)]),t("div",Z,[t("span",null,"上涨："+z(c.value),1),t("span",null,"下跌："+z(u.value),1),t("span",null,"平："+z(d.value),1)]),t("div",{ref_key:"chartRef",ref:i,class:"chart"},null,512)]),_:1})}}}),et=F(tt,[["__scopeId","data-v-d60e2b56"]]),at={class:"header"},nt={class:"subtitle"},st=k({__name:"AdlTrend",props:{days:{default:30},startDate:{default:void 0},endDate:{default:void 0}},setup(h){const s=h,i=v(null);let l=null;const c=async()=>{try{const d=await K({days:s.days,start_date:s.startDate,end_date:s.endDate}),m=d.adl.map(a=>a.date),y=d.adl.map(a=>Number(a.daily_diff)),r=d.adl.map(a=>Number(a.adl_cumulative));if(!i.value)return;l||(l=$(i.value));const o={tooltip:{trigger:"axis"},legend:{data:["每日差值","ADL累计"],top:8},grid:{left:50,right:50,top:70,bottom:40},xAxis:{type:"category",data:m},yAxis:[{type:"value",name:"每日差值",position:"left"},{type:"value",name:"ADL累计",position:"right"}],series:[{name:"每日差值",type:"bar",data:y,itemStyle:{color:"#4a7bd0"}},{name:"ADL累计",type:"line",yAxisIndex:1,smooth:!0,showSymbol:!1,data:r,itemStyle:{color:"#c23531"},lineStyle:{width:2}}]};l.setOption(o),window.addEventListener("resize",u)}catch(d){console.error(d),E.error("获取ADL数据失败，请稍后重试")}},u=()=>l?.resize();return N(c),I(()=>{window.removeEventListener("resize",u),l?.dispose(),l=null}),T(()=>[s.days,s.startDate,s.endDate],()=>{c()}),(d,m)=>{const y=B("el-card");return Y(),H(y,{shadow:"hover",class:"adl-trend"},{default:R(()=>[t("div",at,[m[0]||(m[0]=t("h2",null,"腾落指标（ADL）趋势",-1)),t("span",nt,"区间默认最近"+z(d.days)+"个交易日",1)]),t("div",{ref_key:"chartRef",ref:i,class:"chart"},null,512)]),_:1})}}}),ot=F(st,[["__scopeId","data-v-31337704"]]),rt={class:"market-change-heatmap"},lt=k({name:"MarketChangeHeatmap",__name:"MarketChangeHeatmap",setup(h){const s=v(null),i=v(null),l=v(null);let c=null,u=null,d=null;const m=o=>{const a=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),g=String(o.getDate()).padStart(2,"0");return`${a}${p}${g}`},y=async()=>{try{if(!s.value)return;c=$(s.value);const o=new Date,a=new Date;a.setDate(o.getDate()-365);const p=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,g=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,S=(await J("sh000001",{start_date:m(a),end_date:m(o),adjust:""})).map(e=>[e.date,Number(e.change_percent)]),_=S.map(e=>e[1]).filter(e=>typeof e=="number"&&!Number.isNaN(e)),C=_.length?Math.min(..._):-5,n=_.length?Math.max(..._):5,D={tooltip:{position:"top",formatter:e=>{const x=e.data?.[0],A=e.data?.[1];return`${x}<br/>涨跌幅：${(A??0).toFixed(2)}%`}},visualMap:{type:"piecewise",pieces:[{lt:-1,label:"< -1%",color:"#2c4d8a"},{gte:-1,lt:0,label:"-1% ~ 0%",color:"#4a7bd0"},{gte:0,lt:1,label:"0% ~ 1%",color:"#f57c6e"},{gte:1,label:">= 1%",color:"#c23531"}],orient:"horizontal",left:"center",top:"62%",textStyle:{fontSize:12}},calendar:{range:[p,g],cellSize:18,splitLine:{show:!0,lineStyle:{color:"#ddd",width:1}},yearLabel:{show:!1},dayLabel:{firstDay:1},monthLabel:{nameMap:"cn"}},series:[{type:"heatmap",coordinateSystem:"calendar",data:S,emphasis:{itemStyle:{shadowBlur:8,shadowColor:"rgba(0,0,0,0.3)"}}}]},w={tooltip:{position:"top",formatter:e=>{const x=e.data?.[0],A=e.data?.[1];return`${x}<br/>涨跌幅：${(A??0).toFixed(2)}%`}},visualMap:{type:"continuous",min:Math.floor(C),max:Math.ceil(n),calculable:!0,inRange:{color:["#2c4d8a","#e9e9e9","#c23531"]},orient:"horizontal",left:"center",top:"62%",textStyle:{fontSize:12}},calendar:{range:[p,g],cellSize:18,splitLine:{show:!0,lineStyle:{color:"#ddd",width:1}},yearLabel:{show:!1},dayLabel:{firstDay:1},monthLabel:{nameMap:"cn"}},series:[{type:"heatmap",coordinateSystem:"calendar",data:S}]},f=[{name:"< -1%",color:"#2c4d8a",count:0},{name:"-1% ~ 0%",color:"#4a7bd0",count:0},{name:"0% ~ 1%",color:"#f57c6e",count:0},{name:">= 1%",color:"#c23531",count:0}];for(const e of _)e<-1?f[0].count++:e>=-1&&e<0?f[1].count++:e>=0&&e<1?f[2].count++:e>=1&&f[3].count++;const L={tooltip:{trigger:"item"},legend:{bottom:0},color:f.map(e=>e.color),series:[{name:"区间分布",type:"pie",radius:"60%",center:["50%","45%"],label:{formatter:"{b}: {c} ({d}%)"},data:f.map(e=>({name:e.name,value:e.count}))}]};c.setOption(D),i.value&&(u=$(i.value),u.setOption(w)),l.value&&(d=$(l.value),d.setOption(L)),window.addEventListener("resize",r)}catch(o){console.error(o),E.error("获取大盘历史数据失败，请稍后重试")}},r=()=>{c?.resize(),u?.resize(),d?.resize()};return N(()=>{y()}),I(()=>{window.removeEventListener("resize",r),c?.dispose(),u?.dispose(),d?.dispose(),c=null,u=null,d=null}),(o,a)=>{const p=B("el-card");return Y(),q("div",rt,[M(p,{shadow:"hover"},{default:R(()=>[a[0]||(a[0]=t("div",{class:"header"},[t("h2",null,"大盘涨跌（日历热力图）"),t("span",{class:"subtitle"},"数据来源：上证指数（sh000001）")],-1)),t("div",{ref_key:"chartRef",ref:s,class:"chart"},null,512)]),_:1}),M(p,{shadow:"hover"},{default:R(()=>[a[1]||(a[1]=t("div",{class:"header"},[t("h2",null,"连续色条热力图"),t("span",{class:"subtitle"},"连续视觉映射（visualMap: continuous）")],-1)),t("div",{ref_key:"continuousChartRef",ref:i,class:"chart chart-continuous"},null,512)]),_:1}),M(p,{shadow:"hover"},{default:R(()=>[a[2]||(a[2]=t("div",{class:"header"},[t("h2",null,"区间分布（饼图）"),t("span",{class:"subtitle"},"区间：< -1%、-1% ~ 0%、0% ~ 1%、≥ 1%")],-1)),t("div",{ref_key:"pieChartRef",ref:l,class:"chart chart-pie"},null,512)]),_:1}),a[3]||(a[3]=t("div",{class:"breadth-intro"},[t("p",null,[t("strong",null,"涨跌家数比（ADR）"),O("：一段时间内上涨股票家数之和与下跌股票家数之和的比值，常用参数为 10 日。比值通常在特定区间（如 0.5–1.5）波动，超出则可能预示市场超买或超卖，趋势可能反转。")]),t("p",null,[t("strong",null,"腾落指标（ADL）"),O("：每日上涨家数与下跌家数的差值的累计。从基期（通常为一段行情起点）开始，每天用上涨家数减去下跌家数并持续累加。观察与大盘指数的同步或背离；背离常被视为趋势反转的先行信号。")])],-1)),M(et,{days:30}),M(ot,{days:30})])}}}),ut=F(lt,[["__scopeId","data-v-971b3837"]]);export{ut as default};
