import{x as S,d as I,a as x,y as $,Y as D,B as V,c as C,b as v,e as r,i as g,w as y,I as R,E as k,o as w,_ as Y,F as B,A as F,f as L}from"./index-DeYthsa7.js";import{i as N}from"./index-ElshY9iF.js";function T(i){if(!i)return"";const n=String(i);if(n.length===8&&/^\d{8}$/.test(n)){const s=n.slice(0,4),c=n.slice(4,6),l=n.slice(6,8);return`${s}-${c}-${l}`}return n}async function z(i,n,s){return((await S.get("/django/api/tasks/index-daily/",{params:{ts_code:i,start_date:n,end_date:s,fields:"trade_date,vol,amount,close"}})).data?.records||[]).map(t=>{const a=t.date??t.trade_date,f=t.volume??t.vol,_=t.amount,e=t.close,o=T(a),u=Number(f??0),p=_!=null?Number(_):void 0,h=e!=null?Number(e):void 0;return{date:o,volume:u,amount:p,close:h}}).filter(t=>!!t.date).sort((t,a)=>t.date.localeCompare(a.date))}const U={class:"index-volume-trend"},H={class:"chart-header"},O={class:"chart-controls"},j=I({__name:"IndexVolumeTrend",props:{tsCode:{default:"000001.SH"},height:{default:"420px"}},setup(i){R(e=>({"80d07a6c":e.height}));const n=i,s=x("1y"),c=x(null);let l=null;function d(e){const o=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${o}${u}${p}`}function t(){const e=new Date,o=new Date,u=s.value==="1y"?1:s.value==="3y"?3:5;return o.setFullYear(e.getFullYear()-u),{start:d(o),end:d(e)}}async function a(){try{const{start:e,end:o}=t(),u=await z(n.tsCode,e,o);f(u)}catch(e){console.error("加载指数成交量失败:",e),k.error("加载指数成交量失败")}}function f(e){if(!c.value)return;l||(l=N(c.value));const o=e.map(m=>m.date),u=e.map(m=>m.volume),p=e.map(m=>m.amount!=null?Number(m.amount):null),h=e.map(m=>m.close!=null?Number(m.close):null),E={tooltip:{trigger:"axis",formatter:m=>{const b=m[0]?.dataIndex??0,M=p[b],A=h[b];return`日期: ${o[b]}<br/>成交量: ${u[b]}<br/>成交额: ${M??"-"}<br/>收盘价: ${A??"-"}`}},legend:{data:["成交量","成交额","收盘价"],top:0},grid:{left:50,right:70,top:30,bottom:40},xAxis:{type:"category",data:o,axisLabel:{rotate:45}},yAxis:[{type:"value",name:"成交量/成交额",position:"left"},{type:"value",name:"收盘价",position:"right"}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}],series:[{name:"成交量",type:"bar",data:u,itemStyle:{color:"#E6A23C"}},{name:"成交额",type:"line",yAxisIndex:0,data:p,smooth:!0,lineStyle:{color:"#409EFF"}},{name:"收盘价",type:"line",yAxisIndex:1,data:h,smooth:!0,lineStyle:{color:"#67C23A"}}]};l.setOption(E)}function _(){l?.resize()}return $(()=>{a(),window.addEventListener("resize",_)}),D(()=>{window.removeEventListener("resize",_),l?.dispose(),l=null}),V(()=>n.tsCode,()=>{a()}),(e,o)=>{const u=g("el-option"),p=g("el-select");return w(),C("div",U,[v("div",H,[o[1]||(o[1]=v("h3",null,null,-1)),v("div",O,[r(p,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=h=>s.value=h),placeholder:"时间范围",style:{width:"160px"},onChange:a},{default:y(()=>[r(u,{label:"近一年",value:"1y"}),r(u,{label:"近三年",value:"3y"}),r(u,{label:"近五年",value:"5y"})]),_:1},8,["modelValue"])])]),v("div",{ref_key:"chartRef",ref:c,class:"chart"},null,512)])}}}),Z=Y(j,[["__scopeId","data-v-4c636128"]]);async function W(i={}){return[...(await S.get("/django/api/tasks/index-basic/",{params:{fields:i.fields??"ts_code,name,market,publisher,category",category:i.category,market:i.market,name:i.name,publisher:i.publisher}})).data?.records||[]].sort((c,l)=>{const d=(c.name||"").localeCompare(l.name||"");return d!==0?d:c.ts_code.localeCompare(l.ts_code)})}const q={class:"index-analysis"},G={class:"chart-header"},J={class:"chart-controls"},K=I({__name:"IndexAnalysis",setup(i){const n=x([]),s=x("000001.SH"),c=x("SSE");async function l(){try{const d=await W({market:c.value});n.value=d,d.find(t=>t.ts_code===s.value)||(s.value=d.length?d[0].ts_code:"")}catch(d){console.error("获取指数列表失败:",d),k.error("获取指数列表失败")}}return $(()=>{l()}),V(c,()=>{l()}),(d,t)=>{const a=g("el-option"),f=g("el-select"),_=g("el-card");return w(),C("div",q,[r(_,{class:"mt-16",shadow:"hover"},{header:y(()=>[v("div",G,[t[2]||(t[2]=v("h3",null,"指数趋势（成交量/额/收盘价）",-1)),v("div",J,[r(f,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),placeholder:"选择市场",style:{width:"160px","margin-right":"10px"}},{default:y(()=>[r(a,{label:"MSCI指数",value:"MSCI"}),r(a,{label:"中证指数",value:"CSI"}),r(a,{label:"上交所指数",value:"SSE"}),r(a,{label:"深交所指数",value:"SZSE"}),r(a,{label:"中金指数",value:"CICC"}),r(a,{label:"申万指数",value:"SW"}),r(a,{label:"其他指数",value:"OTH"})]),_:1},8,["modelValue"]),r(f,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),placeholder:"选择指数",style:{width:"220px"},filterable:""},{default:y(()=>[(w(!0),C(B,null,F(n.value,e=>(w(),L(a,{key:e.ts_code,label:`${e.name??e.ts_code} (${e.ts_code})`,value:e.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:y(()=>[r(Z,{"ts-code":s.value,height:"420px"},null,8,["ts-code"])]),_:1})])}}}),X=Y(K,[["__scopeId","data-v-efe65e17"]]);export{X as default};
