import{x as G,d as K,a as g,z as M,B as q,c as I,e as t,i as s,w as l,b as r,f as T,g as O,k as b,t as p,o as v,_ as H,D as ee,G as te,K as R,E as ae}from"./index-DBlIMAuh.js";import{b as le}from"./industryApi-Dj1_omis.js";import{S as ne}from"./SwIndustryTrendChart-CKKhpmZ5.js";import"./index-ElshY9iF.js";async function U(V){return(await G.get("/django/api/index/sw-index-classify/",{params:V})).data.records}const se={class:"sw-industry-members-tab"},oe={class:"form-row"},re={key:2},de={key:0,class:"table-wrapper"},ie={class:"pagination-container"},ce=K({__name:"SwIndustryMembersTab",props:{industryCode:{},indexCode:{},level:{}},setup(V){const n=V,y=g(!1),_=g(""),w=g([]),x=g(1),C=g(20),F=M(()=>w.value.length||0),N=M(()=>{const d=(x.value-1)*C.value,m=d+C.value;return w.value.slice(d,m)});function $(d){C.value=d,x.value=1}function P(d){x.value=d}const W=M(()=>{switch(n.level){case"L1":return"danger";case"L2":return"warning";case"L3":return"success";default:return"info"}});async function E(){if(!(!n.indexCode||!n.level)){y.value=!0,_.value="";try{const d={};n.level==="L1"?d.l1_code=n.indexCode:n.level==="L2"?d.l2_code=n.indexCode:n.level==="L3"&&(d.l3_code=n.indexCode);const h=(await G.get("/django/api/index/sw-industry-members/",{params:d})).data;h&&Array.isArray(h.records)?(w.value=h.records,x.value=1):w.value=[]}catch(d){_.value=d?.message||"请求失败",w.value=[]}finally{y.value=!1}}}return q(()=>[n.industryCode,n.level],()=>{E()},{immediate:!0}),(d,m)=>{const h=s("el-tag"),z=s("el-form-item"),B=s("el-button"),Y=s("el-form"),L=s("el-alert"),a=s("el-skeleton"),e=s("el-table-column"),o=s("el-table"),f=s("el-pagination"),k=s("el-empty"),i=s("el-card");return v(),I("div",se,[t(i,{shadow:"never",class:"members-card"},{header:l(()=>[...m[2]||(m[2]=[r("div",{class:"card-header"},[r("span",null,"指数成分股列表")],-1)])]),default:l(()=>[r("div",oe,[t(Y,{inline:!0},{default:l(()=>[t(z,{label:"指数代码"},{default:l(()=>[t(h,null,{default:l(()=>[b(p(d.indexCode),1)]),_:1})]),_:1}),t(z,{label:"等级"},{default:l(()=>[t(h,{type:W.value},{default:l(()=>[b(p(d.level),1)]),_:1},8,["type"])]),_:1}),t(z,null,{default:l(()=>[t(B,{type:"primary",loading:y.value,onClick:E},{default:l(()=>[...m[3]||(m[3]=[b("刷新",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_.value?(v(),T(L,{key:0,type:"error",closable:!1,title:_.value,class:"mb-12"},null,8,["title"])):O("",!0),y.value&&!_.value?(v(),T(a,{key:1,rows:"6",animated:""})):(v(),I("div",re,[w.value.length?(v(),I("div",de,[t(o,{data:N.value,border:"",height:"520",stripe:"",style:{width:"100%"}},{default:l(()=>[t(e,{prop:"ts_code",label:"股票代码","min-width":"120"}),t(e,{prop:"name",label:"股票名称","min-width":"120"}),t(e,{prop:"in_date",label:"纳入日期","min-width":"110"}),t(e,{prop:"out_date",label:"剔除日期","min-width":"110"}),t(e,{prop:"is_new",label:"最新","min-width":"80"})]),_:1},8,["data"]),r("div",ie,[t(f,{"current-page":x.value,"onUpdate:currentPage":m[0]||(m[0]=S=>x.value=S),"page-size":C.value,"onUpdate:pageSize":m[1]||(m[1]=S=>C.value=S),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:F.value,onSizeChange:$,onCurrentChange:P},null,8,["current-page","page-size","total"])])])):(v(),T(k,{key:1,description:"暂无数据"}))]))]),_:1})])}}}),ue=H(ce,[["__scopeId","data-v-8443373d"]]),_e={class:"sw-industry-tree-view"},pe={class:"main-container"},ve={class:"tree-wrapper"},me={class:"custom-tree-node"},fe={class:"node-label"},ye={class:"node-info"},be={key:0,class:"detail-content"},he={class:"tab-content"},ge={class:"detail-title"},we={key:0,class:"children-section"},xe={class:"section-header"},Ce={key:1,class:"no-children-tip"},Se={class:"tab-content"},ke={class:"tab-content"},Ie={key:1,class:"empty-state"},Ne=K({__name:"SwIndustryTreeView",setup(V){const n=g(null),y=g(null),_=g([]),w=g(!1),x=g(new Map),C=g("basic"),F=M(()=>_.value.map(a=>{const e=x.value.get(a.index_code);return{...a,pe:e?.pe,pe_percentile:e?.pe_percentile,pb:e?.pb,pb_percentile:e?.pb_percentile,trade_date:e?.trade_date}})),N=(a,e=2)=>a==null?"--":a.toFixed(e),$=a=>a==null?{}:a<20?{color:"#67C23A",fontWeight:"bold"}:a>80?{color:"#F56C6C",fontWeight:"bold"}:{},P=(a,e,o)=>{const f=typeof a?.[o]=="number"?a[o]:Number.POSITIVE_INFINITY,k=typeof e?.[o]=="number"?e[o]:Number.POSITIVE_INFINITY;return f-k},W=(a,e)=>P(a,e,"pe_percentile"),E=(a,e)=>P(a,e,"pb_percentile"),d=async()=>{if(_.value.length===0){x.value.clear();return}const a=_.value[0].level,e=_.value.map(i=>i.index_code).join(","),o=new Date,f=new Date;f.setFullYear(f.getFullYear()-10);const k=i=>{const S=i.getFullYear(),c=String(i.getMonth()+1).padStart(2,"0"),D=String(i.getDate()).padStart(2,"0");return`${S}${c}${D}`};try{w.value=!0;const i=await le({start_date:k(f),end_date:k(o),level:a,index_codes:e}),S=new Map;i.sort((c,D)=>c.trade_date.localeCompare(D.trade_date)),i.forEach(c=>{S.set(c.ts_code,c)}),x.value=S}catch(i){console.error("获取估值数据失败:",i)}finally{w.value=!1}};q(_,()=>{d()});const m={label:"industry_name",isLeaf:(a,e)=>a.level==="L3"},h=a=>{a&&a.childNodes?_.value=a.childNodes.map(e=>e.data):_.value=[]},z=async(a,e)=>{try{if(a.level===0){e([{industry_name:"申万行业分类",index_code:"0",industry_code:"0",level:"ROOT",parent_code:"",src:"SW2021"}]);return}const o=a.data;if(o.level==="ROOT"&&o.industry_code==="0"){const f=await U({parent_code:"0",src:"SW2021"});e(f),y.value&&y.value.key===a.key&&h(a);return}if(o&&o.industry_code){const f=await U({parent_code:o.industry_code,src:"SW2021"});e(f),y.value&&y.value.key===a.key&&h(a)}else e([])}catch(o){console.error("加载行业数据失败:",o),ae.error("加载行业数据失败"),e([])}},B=(a,e)=>{n.value=a,y.value=e,h(e)},Y=(a,e)=>{y.value&&y.value.key===e.key&&h(e)},L=a=>{switch(a){case"L1":return"danger";case"L2":return"warning";case"L3":return"success";case"ROOT":return"primary";default:return"info"}};return(a,e)=>{const o=s("el-tag"),f=s("el-tree"),k=s("el-card"),i=s("el-descriptions-item"),S=s("el-descriptions"),c=s("el-table-column"),D=s("el-table"),J=s("el-text"),j=s("el-tab-pane"),Q=s("el-tabs"),X=s("el-empty"),Z=te("loading");return v(),I("div",_e,[r("div",pe,[t(k,{class:"left-panel"},{header:l(()=>[...e[1]||(e[1]=[r("div",{class:"card-header"},[r("span",null,"申万行业分类 (SW2021)")],-1)])]),default:l(()=>[r("div",ve,[t(f,{props:m,load:z,lazy:"","node-key":"index_code","highlight-current":"",onNodeClick:B,onNodeExpand:Y},{default:l(({node:u,data:A})=>[r("span",me,[r("span",fe,p(u.label),1),r("span",ye,[t(o,{size:"small",type:L(A.level),effect:"plain"},{default:l(()=>[b(p(A.level),1)]),_:2},1032,["type"])])])]),_:1})])]),_:1}),t(k,{class:"right-panel"},{header:l(()=>[...e[2]||(e[2]=[r("div",{class:"card-header"},[r("span",null,"行业详情信息")],-1)])]),default:l(()=>[n.value?(v(),I("div",be,[t(Q,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=u=>C.value=u),class:"industry-tabs"},{default:l(()=>[t(j,{label:"基本信息",name:"basic"},{default:l(()=>[r("div",he,[t(S,{column:1,border:""},{default:l(()=>[t(i,{label:"行业名称"},{default:l(()=>[r("span",ge,p(n.value.industry_name),1)]),_:1}),t(i,{label:"行业代码"},{default:l(()=>[t(o,null,{default:l(()=>[b(p(n.value.index_code),1)]),_:1})]),_:1}),t(i,{label:"行业等级"},{default:l(()=>[t(o,{type:L(n.value.level)},{default:l(()=>[b(p(n.value.level),1)]),_:1},8,["type"])]),_:1}),t(i,{label:"父级代码"},{default:l(()=>[b(p(n.value.parent_code||"无"),1)]),_:1}),t(i,{label:"来源标准"},{default:l(()=>[b(p(n.value.src||"SW2021"),1)]),_:1})]),_:1}),_.value.length>0?(v(),I("div",we,[r("div",xe,[r("span",null,"下级行业列表 ("+p(_.value.length)+")",1)]),ee((v(),T(D,{data:F.value,style:{width:"100%"},height:"300",border:"",stripe:"",size:"small","default-sort":{prop:"pe_percentile",order:"ascending"}},{default:l(()=>[t(c,{prop:"index_code",label:"行业代码",width:"100",fixed:""}),t(c,{prop:"industry_name",label:"行业名称","min-width":"120",fixed:""}),t(c,{prop:"level",label:"等级",width:"80"},{default:l(({row:u})=>[t(o,{size:"small",type:L(u.level)},{default:l(()=>[b(p(u.level),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"PE(TTM)",align:"center"},{default:l(()=>[t(c,{prop:"pe",label:"数值",width:"80",align:"right"},{default:l(({row:u})=>[b(p(N(u.pe)),1)]),_:1}),t(c,{prop:"pe_percentile",label:"分位(%)",width:"80",align:"right",sortable:"","sort-method":W},{default:l(({row:u})=>[r("span",{style:R($(u.pe_percentile))},p(N(u.pe_percentile)),5)]),_:1})]),_:1}),t(c,{label:"PB",align:"center"},{default:l(()=>[t(c,{prop:"pb",label:"数值",width:"80",align:"right"},{default:l(({row:u})=>[b(p(N(u.pb)),1)]),_:1}),t(c,{prop:"pb_percentile",label:"分位(%)",width:"80",align:"right",sortable:"","sort-method":E},{default:l(({row:u})=>[r("span",{style:R($(u.pb_percentile))},p(N(u.pb_percentile)),5)]),_:1})]),_:1}),t(c,{prop:"trade_date",label:"数据日期",width:"90",align:"center"})]),_:1},8,["data"])),[[Z,w.value]])])):n.value.level!=="L3"?(v(),I("div",Ce,[t(J,{type:"info"},{default:l(()=>[...e[3]||(e[3]=[b("暂无已展开的下级行业，请在左侧点击展开",-1)])]),_:1})])):O("",!0)])]),_:1}),t(j,{label:"行业趋势",name:"trend"},{default:l(()=>[r("div",Se,[C.value==="trend"?(v(),T(ne,{key:n.value.index_code,"ts-code":n.value.index_code,"industry-name":n.value.industry_name},null,8,["ts-code","industry-name"])):O("",!0)])]),_:1}),t(j,{label:"指数成分股",name:"members"},{default:l(()=>[r("div",ke,[C.value==="members"?(v(),T(ue,{key:`${n.value.industry_code}-${n.value.level}`,"industry-code":n.value.industry_code,"index-code":n.value.index_code,level:n.value.level},null,8,["industry-code","index-code","level"])):O("",!0)])]),_:1})]),_:1},8,["modelValue"])])):(v(),I("div",Ie,[t(X,{description:"请选择左侧行业节点查看详情"})]))]),_:1})])])}}}),Ve=H(Ne,[["__scopeId","data-v-c0eab634"]]);export{Ve as default};
