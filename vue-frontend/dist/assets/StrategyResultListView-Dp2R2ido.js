import{x as Q,d as H,z as T,a as _,B as X,f as K,w as s,i as n,c as $,g as q,b as l,e as a,k as c,t as g,F as Y,A as Z,l as x,M,af as ee,E as L,o as w,_ as J,y as te,O as ae,a9 as se,N as le,D as oe,G as ne,h as re}from"./index-B-X9N5Dz.js";const ie="/django/api/individual_stock/strategy-results",ue=async(z={})=>await Q.get(`${ie}/`,{params:{page:z.page||1,page_size:z.page_size||20,strategy_name:z.strategy_name}}),de={key:0,class:"strategy-detail-content"},ce={class:"strategy-info-section"},pe={class:"strategy-info"},ge={class:"selected-stocks-section"},_e={class:"card-header"},ve={class:"header-actions"},ye={key:0},fe={key:1},me={key:0,class:"pagination-container"},he={class:"dialog-footer"},be=H({__name:"StrategyResultDetailDialog",props:{visible:{type:Boolean,default:!1},strategyResult:{default:null}},emits:["update:visible"],setup(z,{emit:R}){const i=z,S=R,v=T({get:()=>i.visible,set:e=>S("update:visible",e)}),D=T(()=>i.strategyResult?`策略详情 - ${i.strategyResult.strategy_name}`:"策略详情"),h=_(""),y=_(1),C=_(20),p=_([]),E=T(()=>{if(!i.strategyResult?.strategy_result)return[];let e=i.strategyResult.strategy_result;if(h.value){const u=h.value.toLowerCase();e=e.filter(f=>f.stock_code?.toLowerCase().includes(u)||f.stock_name?.toLowerCase().includes(u))}const t=(y.value-1)*C.value,r=t+C.value;return e.slice(t,r)}),U=()=>{if(!i.strategyResult?.strategy_result?.length){p.value=[];return}const e=i.strategyResult.strategy_result[0],t=[];e.stock_code!==void 0&&t.push({prop:"stock_code",label:"股票代码",width:120,align:"center",sortable:!0}),e.stock_name!==void 0&&t.push({prop:"stock_name",label:"股票名称",minWidth:120,showOverflowTooltip:!0,sortable:!0}),e.buy_signal!==void 0&&t.push({prop:"buy_signal",label:"买入信号",minWidth:150,showOverflowTooltip:!0});const r=["stock_code","stock_name","buy_signal"];Object.keys(e).forEach(u=>{if(!r.includes(u)){const f=e[u];t.push({prop:u,label:u,minWidth:120,align:typeof f=="number"?"center":"left",sortable:!0,showOverflowTooltip:!0,type:typeof f=="number"?"number":"string"})}}),p.value=t},F=e=>e==null?"-":typeof e!="number"?String(e):e.toFixed(2),B=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}},I=e=>{C.value=e,y.value=1},O=e=>{y.value=e},N=()=>{if(!i.strategyResult?.strategy_result?.length){L.warning("没有数据可导出");return}try{const e=i.strategyResult.strategy_result,t=p.value.map(k=>k.label).join(","),r=e.map(k=>p.value.map(V=>k[V.prop]||"").join(",")).join(`
`),u=`${t}
${r}`,f=new Blob(["\uFEFF"+u],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),b=URL.createObjectURL(f);m.setAttribute("href",b),m.setAttribute("download",`${i.strategyResult.strategy_name}_选股结果.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),L.success("数据导出成功")}catch(e){console.error("导出数据失败:",e),L.error("导出数据失败")}},j=()=>{v.value=!1,h.value="",y.value=1};return X(()=>i.strategyResult,()=>{i.strategyResult&&(U(),h.value="",y.value=1)},{immediate:!0}),(e,t)=>{const r=n("el-descriptions-item"),u=n("el-tag"),f=n("el-descriptions"),m=n("el-card"),b=n("el-icon"),k=n("el-input"),V=n("el-button"),A=n("el-table-column"),P=n("el-table"),d=n("el-pagination"),W=n("el-dialog");return w(),K(W,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=o=>v.value=o),title:D.value,width:"90%","before-close":j,"destroy-on-close":""},{footer:s(()=>[l("div",he,[a(V,{onClick:j},{default:s(()=>[...t[6]||(t[6]=[c("关闭",-1)])]),_:1})])]),default:s(()=>[e.strategyResult?(w(),$("div",de,[l("div",ce,[a(m,null,{header:s(()=>[...t[4]||(t[4]=[l("div",{class:"card-header"},[l("span",null,"策略基本信息")],-1)])]),default:s(()=>[l("div",pe,[a(f,{column:2,border:""},{default:s(()=>[a(r,{label:"策略ID"},{default:s(()=>[c(g(e.strategyResult.id),1)]),_:1}),a(r,{label:"策略名称"},{default:s(()=>[c(g(e.strategyResult.strategy_name),1)]),_:1}),a(r,{label:"策略描述",span:2},{default:s(()=>[c(g(e.strategyResult.strategy_description),1)]),_:1}),a(r,{label:"选股数量"},{default:s(()=>[a(u,{type:"info"},{default:s(()=>[c(g(e.strategyResult.strategy_result.length),1)]),_:1})]),_:1}),a(r,{label:"创建时间"},{default:s(()=>[c(g(B(e.strategyResult.created_at)),1)]),_:1}),a(r,{label:"更新时间"},{default:s(()=>[c(g(B(e.strategyResult.updated_at)),1)]),_:1})]),_:1})])]),_:1})]),l("div",ge,[a(m,null,{header:s(()=>[l("div",_e,[l("span",null,"选股结果 ("+g(e.strategyResult.strategy_result.length)+" 只股票)",1),l("div",ve,[a(k,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=o=>h.value=o),placeholder:"搜索股票代码或名称",clearable:"",style:{width:"200px","margin-right":"10px"}},{prefix:s(()=>[a(b,null,{default:s(()=>[a(x(M))]),_:1})]),_:1},8,["modelValue"]),a(V,{icon:x(ee),onClick:N},{default:s(()=>[...t[5]||(t[5]=[c(" 导出数据 ",-1)])]),_:1},8,["icon"])])])]),default:s(()=>[a(P,{data:E.value,stripe:"",border:"",style:{width:"100%"},"default-sort":{prop:"stock_code",order:"ascending"},"max-height":"500"},{default:s(()=>[(w(!0),$(Y,null,Z(p.value,o=>(w(),K(A,{key:o.prop,prop:o.prop,label:o.label,width:o.width,"min-width":o.minWidth,align:o.align,sortable:o.sortable,"show-overflow-tooltip":o.showOverflowTooltip},{default:s(({row:G})=>[o.type==="number"?(w(),$("span",ye,g(F(G[o.prop])),1)):(w(),$("span",fe,g(G[o.prop]||"-"),1))]),_:2},1032,["prop","label","width","min-width","align","sortable","show-overflow-tooltip"]))),128))]),_:1},8,["data"]),e.strategyResult.strategy_result.length>10?(w(),$("div",me,[a(d,{"current-page":y.value,"onUpdate:currentPage":t[1]||(t[1]=o=>y.value=o),"page-size":C.value,"onUpdate:pageSize":t[2]||(t[2]=o=>C.value=o),total:e.strategyResult.strategy_result.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:I,onCurrentChange:O},null,8,["current-page","page-size","total"])])):q("",!0)]),_:1})])])):q("",!0)]),_:1},8,["modelValue","title"])}}}),we=J(be,[["__scopeId","data-v-7a9247d5"]]),Ce={class:"strategy-result-list-view"},Re={class:"page-header"},ke={class:"header-content"},ze={class:"action-section"},Se={class:"search-section"},De={class:"search-form"},Ve={class:"table-section"},$e={class:"table-header"},xe={class:"table-info"},Le={class:"pagination-container"},Ue=H({__name:"StrategyResultListView",setup(z){const R=_(!1),i=_([]),S=_(""),v=_(1),D=_(20),h=_(0),y=_(!1),C=_(null),p=async()=>{try{R.value=!0;const e={page:v.value,page_size:D.value,strategy_name:S.value||void 0},t=await ue(e);t.code===200?(i.value=t.data.results,h.value=t.data.total):L.error(t.message||"获取策略结果列表失败")}catch(e){console.error("获取策略结果列表失败:",e),L.error("获取策略结果列表失败，请稍后重试")}finally{R.value=!1}},E=()=>{p()},U=()=>{v.value=1,p()},F=()=>{S.value="",v.value=1,p()},B=e=>{D.value=e,v.value=1,p()},I=e=>{v.value=e,p()},O=e=>{N(e)},N=e=>{C.value=e,y.value=!0},j=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}};return te(()=>{p()}),(e,t)=>{const r=n("el-button"),u=n("el-card"),f=n("el-icon"),m=n("el-input"),b=n("el-table-column"),k=n("el-tag"),V=n("el-table"),A=n("el-pagination"),P=ne("loading");return w(),$("div",Ce,[l("div",Re,[a(u,null,{default:s(()=>[l("div",ke,[t[5]||(t[5]=l("div",{class:"title-section"},[l("h2",null,"策略结果管理"),l("p",null,"查看和管理所有策略选股结果")],-1)),l("div",ze,[a(r,{type:"primary",icon:x(ae),onClick:E,loading:R.value},{default:s(()=>[...t[4]||(t[4]=[c(" 刷新数据 ",-1)])]),_:1},8,["icon","loading"])])])]),_:1})]),l("div",Se,[a(u,null,{default:s(()=>[l("div",De,[a(m,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=d=>S.value=d),placeholder:"请输入策略名称进行搜索",clearable:"",style:{width:"300px","margin-right":"10px"},onKeyup:se(U,["enter"])},{prefix:s(()=>[a(f,null,{default:s(()=>[a(x(M))]),_:1})]),_:1},8,["modelValue"]),a(r,{type:"primary",icon:x(M),onClick:U},{default:s(()=>[...t[6]||(t[6]=[c(" 搜索 ",-1)])]),_:1},8,["icon"]),a(r,{icon:x(le),onClick:F},{default:s(()=>[...t[7]||(t[7]=[c(" 重置 ",-1)])]),_:1},8,["icon"])])]),_:1})]),l("div",Ve,[a(u,null,{default:s(()=>[l("div",$e,[t[8]||(t[8]=l("h3",null,"策略结果列表",-1)),l("div",xe,[l("span",null,"共 "+g(h.value)+" 条记录",1)])]),oe((w(),K(V,{data:i.value,stripe:"",style:{width:"100%"},onRowClick:O,"row-style":"cursor: pointer;"},{default:s(()=>[a(b,{prop:"id",label:"ID",width:"80"}),a(b,{prop:"strategy_name",label:"策略名称","min-width":"200"}),a(b,{prop:"strategy_description",label:"策略描述","min-width":"300","show-overflow-tooltip":""}),a(b,{label:"选股数量",width:"120",align:"center"},{default:s(({row:d})=>[a(k,{type:"info"},{default:s(()=>[c(g(d.strategy_result.length),1)]),_:2},1024)]),_:1}),a(b,{label:"创建时间",width:"180",align:"center"},{default:s(({row:d})=>[c(g(j(d.created_at)),1)]),_:1}),a(b,{label:"操作",width:"120",align:"center"},{default:s(({row:d})=>[a(r,{type:"primary",size:"small",onClick:re(W=>N(d),["stop"])},{default:s(()=>[...t[9]||(t[9]=[c(" 查看详情 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,R.value]]),l("div",Le,[a(A,{"current-page":v.value,"onUpdate:currentPage":t[1]||(t[1]=d=>v.value=d),"page-size":D.value,"onUpdate:pageSize":t[2]||(t[2]=d=>D.value=d),total:h.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:I},null,8,["current-page","page-size","total"])])]),_:1})]),a(we,{visible:y.value,"onUpdate:visible":t[3]||(t[3]=d=>y.value=d),"strategy-result":C.value},null,8,["visible","strategy-result"])])}}}),Ne=J(Ue,[["__scopeId","data-v-6662fff1"]]);export{Ne as default};
