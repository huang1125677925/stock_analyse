import{d as Q,a as f,r as M,y as X,c as b,b as E,e as l,w as o,i as p,E as $,k as z,l as ee,O as ae,F as x,A as w,f as y,D as le,G as te,t as ne,u as oe,o as u,_ as se}from"./index-DBlIMAuh.js";import{g as k}from"./etfApi-Bdw84FII.js";const de={class:"etf-basic-view"},re={class:"page-header"},ie={class:"header-content"},ce={class:"pagination"},ue=Q({__name:"EtfBasicView",setup(pe){const N=oe(),V=f(!1),C=f(!1),F=f([]),s=M({page:1,page_size:20,total:0,pages:0}),t=M({ts_code:"",index_code:"",exchange:"",list_status:"",etf_type:"",mgr_name:"",name:"",list_year:""}),T=f([]),S=f([]),U=f([]),B=f([]),A=f([]),O=f([]),L=async d=>{const a=(d||"").trim();if(a){C.value=!0;try{const c=/^[0-9]{3,6}\.[A-Z]{2,3}$/.test(a),g=await k({ts_code:c?a:void 0,name:c?void 0:a,page:1,page_size:20});O.value=g.data||[]}catch(c){$.error(c?.message||"ETF 基础列表搜索失败")}finally{C.value=!1}}},q=async()=>{try{const d=await k({page:1,page_size:5e3});if(d.data){const a=d.data,c=new Map;a.forEach(n=>{n.index_code&&c.set(n.index_code,n.index_name||"")}),T.value=Array.from(c.entries()).map(([n,i])=>({value:n,label:i?`${n} ${i}`:n}));const g=new Set;a.forEach(n=>{n.exchange&&g.add(n.exchange)}),S.value=Array.from(g).sort();const v=new Set;a.forEach(n=>{n.etf_type&&v.add(n.etf_type)}),U.value=Array.from(v).sort();const r=new Set;a.forEach(n=>{n.mgr_name&&r.add(n.mgr_name)}),B.value=Array.from(r).sort((n,i)=>n.localeCompare(i,"zh-CN"));const _=new Set;a.forEach(n=>{const i=n.list_date||"";i&&i.length>=4&&_.add(i.slice(0,4))}),A.value=Array.from(_).sort((n,i)=>i.localeCompare(n))}}catch(d){console.error("获取筛选选项失败",d)}},h=async()=>{V.value=!0;try{if(!!t.list_year){const c=((await k({ts_code:t.ts_code||void 0,index_code:t.index_code||void 0,exchange:t.exchange||void 0,list_status:t.list_status||void 0,etf_type:t.etf_type||void 0,mgr_name:t.mgr_name||void 0,name:t.name||void 0,page:1,page_size:5e3})).data||[]).filter(n=>{const i=n.list_date||"";return i&&i.startsWith(t.list_year)}),g=c.length,v=Math.ceil(g/s.page_size),r=(s.page-1)*s.page_size,_=r+s.page_size;F.value=c.slice(r,_),s.total=g,s.pages=v,s.page>v&&(s.page=Math.max(1,v))}else{const a=await k({ts_code:t.ts_code||void 0,index_code:t.index_code||void 0,exchange:t.exchange||void 0,list_status:t.list_status||void 0,etf_type:t.etf_type||void 0,mgr_name:t.mgr_name||void 0,name:t.name||void 0,page:s.page,page_size:s.page_size});F.value=a.data||[],s.total=a.total||0,s.pages=a.pages||0}}catch(d){$.error(d?.message||"ETF 基本信息获取失败")}finally{V.value=!1}},P=()=>{s.page=1,h()},Y=()=>{t.ts_code="",t.index_code="",t.exchange="",t.list_status="",t.etf_type="",t.mgr_name="",t.name="",t.list_year="",s.page=1,h()},I=()=>h(),R=d=>{s.page_size=d,s.page=1,h()},j=d=>{s.page=d,h()},G=d=>{d&&N.push({name:"index-analysis",query:{ts_code:d}})};return X(()=>{q(),h()}),(d,a)=>{const c=p("el-button"),g=p("el-icon"),v=p("el-space"),r=p("el-option"),_=p("el-select"),n=p("el-form-item"),i=p("el-input"),W=p("el-form"),D=p("el-card"),m=p("el-table-column"),Z=p("el-link"),H=p("el-table"),J=p("el-pagination"),K=te("loading");return u(),b("div",de,[E("div",re,[E("div",ie,[a[13]||(a[13]=E("h2",null,"ETF 基本信息",-1)),l(v,null,{default:o(()=>[l(c,{type:"primary",loading:V.value,onClick:P},{default:o(()=>[...a[10]||(a[10]=[z("查询",-1)])]),_:1},8,["loading"]),l(c,{onClick:Y},{default:o(()=>[...a[11]||(a[11]=[z("重置",-1)])]),_:1}),l(c,{onClick:I},{default:o(()=>[l(g,null,{default:o(()=>[l(ee(ae))]),_:1}),a[12]||(a[12]=z("刷新",-1))]),_:1})]),_:1})])]),l(D,{class:"search-card"},{default:o(()=>[l(W,{model:t,"label-width":"110px","label-position":"left",inline:""},{default:o(()=>[l(n,{label:"指数代码"},{default:o(()=>[l(_,{modelValue:t.index_code,"onUpdate:modelValue":a[0]||(a[0]=e=>t.index_code=e),placeholder:"选择或搜索指数",clearable:"",filterable:"",style:{width:"200px"}},{default:o(()=>[(u(!0),b(x,null,w(T.value,e=>(u(),y(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"ETF代码"},{default:o(()=>[l(_,{modelValue:t.ts_code,"onUpdate:modelValue":a[1]||(a[1]=e=>t.ts_code=e),placeholder:"选择或搜索 ETF 代码/名称",filterable:"",remote:"","reserve-keyword":"",clearable:"","remote-method":L,loading:C.value,style:{width:"220px"}},{default:o(()=>[(u(!0),b(x,null,w(O.value,e=>(u(),y(r,{key:e.ts_code,label:`${e.extname||e.csname||e.cname||""}（${e.ts_code}）`,value:e.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(n,{label:"交易所"},{default:o(()=>[l(_,{modelValue:t.exchange,"onUpdate:modelValue":a[2]||(a[2]=e=>t.exchange=e),placeholder:"选择交易所",clearable:"",style:{width:"140px"}},{default:o(()=>[(u(!0),b(x,null,w(S.value,e=>(u(),y(r,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"上市状态"},{default:o(()=>[l(_,{modelValue:t.list_status,"onUpdate:modelValue":a[3]||(a[3]=e=>t.list_status=e),placeholder:"全部",clearable:"",style:{width:"160px"}},{default:o(()=>[l(r,{label:"全部",value:""}),l(r,{label:"上市",value:"L"}),l(r,{label:"退市",value:"D"}),l(r,{label:"暂停",value:"P"})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"上市年份"},{default:o(()=>[l(_,{modelValue:t.list_year,"onUpdate:modelValue":a[4]||(a[4]=e=>t.list_year=e),placeholder:"选择年份",clearable:"",style:{width:"120px"}},{default:o(()=>[(u(!0),b(x,null,w(A.value,e=>(u(),y(r,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"ETF类型"},{default:o(()=>[l(_,{modelValue:t.etf_type,"onUpdate:modelValue":a[5]||(a[5]=e=>t.etf_type=e),placeholder:"选择类型",clearable:"",style:{width:"160px"}},{default:o(()=>[(u(!0),b(x,null,w(U.value,e=>(u(),y(r,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"管理人"},{default:o(()=>[l(_,{modelValue:t.mgr_name,"onUpdate:modelValue":a[6]||(a[6]=e=>t.mgr_name=e),placeholder:"选择或搜索管理人",clearable:"",filterable:"",style:{width:"180px"}},{default:o(()=>[(u(!0),b(x,null,w(B.value,e=>(u(),y(r,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"名称关键词"},{default:o(()=>[l(i,{modelValue:t.name,"onUpdate:modelValue":a[7]||(a[7]=e=>t.name=e),placeholder:"支持模糊搜索",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(D,{class:"table-card"},{default:o(()=>[le((u(),y(H,{data:F.value,border:"",style:{width:"100%"}},{default:o(()=>[l(m,{prop:"extname",label:"ETF简称","min-width":"160",align:"center"}),l(m,{prop:"ts_code",label:"ETF代码","min-width":"140",align:"center"}),l(m,{prop:"index_name",label:"跟踪指数","min-width":"160",align:"center"}),l(m,{prop:"index_code",label:"指数代码","min-width":"140",align:"center"},{default:o(({row:e})=>[l(Z,{type:"primary",underline:!1,onClick:_e=>G(e.index_code)},{default:o(()=>[z(ne(e.index_code),1)]),_:2},1032,["onClick"])]),_:1}),l(m,{prop:"exchange",label:"交易所","min-width":"80",align:"center"}),l(m,{prop:"csname",label:"基金简称","min-width":"160",align:"center"}),l(m,{prop:"etf_type",label:"ETF类型","min-width":"120",align:"center"}),l(m,{prop:"mgt_fee",label:"管理费率","min-width":"100",align:"center"}),l(m,{prop:"list_date",label:"上市日期","min-width":"120",align:"center"}),l(m,{prop:"delist_date",label:"退市日期","min-width":"120",align:"center"}),l(m,{prop:"custod_name",label:"托管人","min-width":"180",align:"center"})]),_:1},8,["data"])),[[K,V.value]]),E("div",ce,[l(J,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:s.total,"page-sizes":[10,20,50,100],"page-size":s.page_size,"onUpdate:pageSize":a[8]||(a[8]=e=>s.page_size=e),"current-page":s.page,"onUpdate:currentPage":a[9]||(a[9]=e=>s.page=e),onSizeChange:R,onCurrentChange:j},null,8,["total","page-size","current-page"])])]),_:1})])}}}),fe=se(ue,[["__scopeId","data-v-69a94d8f"]]);export{fe as default};
