import{d as E,a as b,y as B,c as _,e as u,w as p,i as h,x as D,f as L,g as f,b as x,t as g,k as N,o as i,_ as A}from"./index-BiO6gj85.js";const G={class:"sw-index-graph-view"},j={class:"card-header"},z={key:2,class:"table-container"},I={class:"cell-content"},T={class:"index-name"},W={key:0,class:"index-code"},q={key:0,class:"cell-content"},F={class:"index-name"},H={key:0,class:"index-code"},J={key:0,class:"cell-content"},K={class:"index-name"},O={key:0,class:"index-code"},P=E({__name:"SwIndexGraphView",setup(Q){const v=b(!1),m=b(""),k=b([]),r={l1:[],l2:[]},C=async()=>{v.value=!0,m.value="";try{const a=(await D.get("/django/api/index/sw-index-classify/",{params:{src:"SW2021"}})).data?.records||[];S(a)}catch(l){m.value=l.message||"获取数据失败"}finally{v.value=!1}},S=l=>{const a=[],s=new Map,e=new Map;l.forEach(n=>{if(n.level==="L1")a.push(n);else if(n.level==="L2"){const o=n.parent_code;s.has(o)||s.set(o,[]),s.get(o)?.push(n)}else if(n.level==="L3"){const o=n.parent_code;e.has(o)||e.set(o,[]),e.get(o)?.push(n)}});const d=[];a.sort((n,o)=>n.index_code.localeCompare(o.index_code)),a.forEach(n=>{let o=s.get(n.index_code)||[];if(o.length===0&&n.industry_code&&(o=s.get(n.industry_code)||[]),o.length===0){d.push({l1:n,l2:null,l3:null});return}o.sort((c,t)=>c.index_code.localeCompare(t.index_code)),o.forEach(c=>{let t=e.get(c.index_code)||[];if(t.length===0&&c.industry_code&&(t=e.get(c.industry_code)||[]),t.length===0){d.push({l1:n,l2:c,l3:null});return}t.sort((y,V)=>y.index_code.localeCompare(V.index_code)),t.forEach(y=>{d.push({l1:n,l2:c,l3:y})})})}),k.value=d,w(d)},w=l=>{r.l1=new Array(l.length).fill(0),r.l2=new Array(l.length).fill(0);let a=0,s=0;for(let e=0;e<l.length;e++){(e===0||l[e].l1?.index_code!==l[e-1].l1?.index_code)&&(e>0&&(r.l1[a]=e-a),a=e);const d=l[e].l2?.index_code,n=l[e-1]?.l2?.index_code,o=l[e].l1?.index_code,c=l[e-1]?.l1?.index_code;(e===0||d!==n||o!==c)&&(e>0&&(r.l2[s]=e-s),s=e)}r.l1[a]=l.length-a,r.l2[s]=l.length-s},M=({rowIndex:l,columnIndex:a})=>{if(a===0){const s=r.l1[l];return s>0?{rowspan:s,colspan:1}:{rowspan:0,colspan:0}}else if(a===1){const s=r.l2[l];return s>0?{rowspan:s,colspan:1}:{rowspan:0,colspan:0}}};return B(()=>{C()}),(l,a)=>{const s=h("el-button"),e=h("el-alert"),d=h("el-skeleton"),n=h("el-table-column"),o=h("el-table"),c=h("el-card");return i(),_("div",G,[u(c,{shadow:"hover"},{header:p(()=>[x("div",j,[a[1]||(a[1]=x("span",null,"申万指数图谱",-1)),u(s,{type:"primary",loading:v.value,onClick:C,size:"small"},{default:p(()=>[...a[0]||(a[0]=[N("刷新",-1)])]),_:1},8,["loading"])])]),default:p(()=>[m.value?(i(),L(e,{key:0,type:"error",closable:!1,title:m.value,class:"mb-12"},null,8,["title"])):f("",!0),v.value&&!m.value?(i(),L(d,{key:1,rows:"10",animated:""})):(i(),_("div",z,[u(o,{data:k.value,border:"",style:{width:"100%"},"span-method":M,height:"calc(100vh - 200px)"},{default:p(()=>[u(n,{label:"一级行业","min-width":"200",align:"center"},{default:p(({row:t})=>[x("div",I,[x("span",T,g(t.l1?.industry_name),1),t.l1?.index_code?(i(),_("span",W,"("+g(t.l1?.index_code)+")",1)):f("",!0)])]),_:1}),u(n,{label:"二级行业","min-width":"200",align:"center"},{default:p(({row:t})=>[t.l2?(i(),_("div",q,[x("span",F,g(t.l2?.industry_name),1),t.l2?.index_code?(i(),_("span",H,"("+g(t.l2?.index_code)+")",1)):f("",!0)])):f("",!0)]),_:1}),u(n,{label:"三级行业","min-width":"200",align:"center"},{default:p(({row:t})=>[t.l3?(i(),_("div",J,[x("span",K,g(t.l3?.industry_name),1),t.l3?.index_code?(i(),_("span",O,"("+g(t.l3?.index_code)+")",1)):f("",!0)])):f("",!0)]),_:1})]),_:1},8,["data"])]))]),_:1})])}}}),U=A(P,[["__scopeId","data-v-21c2894f"]]);export{U as default};
