import{d as G,a as f,z as V,r as I,y as K,B as R,c as S,b as D,e as a,w as o,i as d,E as v,k,l as Z,O as j,F as H,A as J,f as M,D as P,G as Q,o as h,_ as W}from"./index-BiO6gj85.js";import{g as x,a as X}from"./etfApi-BjvRrRCM.js";import{S as ee}from"./StockKLineChart-BBYps5Xu.js";import"./index-ElshY9iF.js";const te={class:"etf-daily-view"},ae={class:"page-header"},le={class:"header-content"},oe=G({__name:"EtfDailyView",setup(ne){const p=f(!1),u=f([]),i=f([]),_=f(!1),T=V(()=>(u.value||[]).map(t=>({date:t.trade_date,open_price:t.open,close_price:t.close,high_price:t.high,low_price:t.low,volume:t.vol,amount:t.amount}))),C=V(()=>{const t=i.value.find(e=>e.ts_code===l.ts_code);return t&&(t.extname||t.csname||t.cname)||""}),l=I({ts_code:"",start_date:"",end_date:""}),F=async t=>{const e=(t||"").trim();if(e){_.value=!0;try{const n=/^[0-9]{3,6}\.[A-Z]{2,3}$/.test(e),c=await x({ts_code:n?e:void 0,name:n?void 0:e,page:1,page_size:20});i.value=c.data||[]}catch(n){v.error(n?.message||"ETF 基础列表搜索失败")}finally{_.value=!1}}},Y=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${c}`},B=()=>{const t=new Date,e=new Date;e.setDate(t.getDate()-30),l.start_date=Y(e),l.end_date=Y(t)},$=async()=>{_.value=!0;try{let e=1;const n=[];for(;;){const c=await x({page:e,page_size:200}),m=c.data||[];n.push(...m);const w=c.pages||1;if(e>=w||m.length===0)break;e+=1}i.value=n}catch(t){v.error(t?.message||"ETF 基础列表加载失败")}finally{_.value=!1}},g=async()=>{if(!l.ts_code){v.warning("请先选择 TS 代码");return}p.value=!0;try{u.value=await X({ts_code:l.ts_code,start_date:l.start_date||void 0,end_date:l.end_date||void 0})}catch(t){v.error(t?.message||"ETF 日线行情获取失败")}finally{p.value=!1}},z=()=>g(),L=()=>g(),N=()=>{l.start_date="",l.end_date="",u.value=[]};return K(async()=>{B(),await $(),!l.ts_code&&i.value.length>0&&(l.ts_code=i.value[0].ts_code)}),R(()=>l.ts_code,(t,e)=>{t&&t!==e&&g()}),(t,e)=>{const n=d("el-button"),c=d("el-icon"),m=d("el-space"),w=d("el-option"),q=d("el-select"),b=d("el-form-item"),E=d("el-date-picker"),A=d("el-form"),y=d("el-card"),r=d("el-table-column"),O=d("el-table"),U=Q("loading");return h(),S("div",te,[D("div",ae,[D("div",le,[e[6]||(e[6]=D("h2",null,"ETF 日线行情",-1)),a(m,null,{default:o(()=>[a(n,{type:"primary",loading:p.value,onClick:z},{default:o(()=>[...e[3]||(e[3]=[k("查询",-1)])]),_:1},8,["loading"]),a(n,{onClick:N},{default:o(()=>[...e[4]||(e[4]=[k("重置",-1)])]),_:1}),a(n,{onClick:L},{default:o(()=>[a(c,null,{default:o(()=>[a(Z(j))]),_:1}),e[5]||(e[5]=k("刷新",-1))]),_:1})]),_:1})])]),a(y,{class:"search-card"},{default:o(()=>[a(A,{model:l,"label-width":"110px","label-position":"left",inline:""},{default:o(()=>[a(b,{label:"TS代码",required:""},{default:o(()=>[a(q,{modelValue:l.ts_code,"onUpdate:modelValue":e[0]||(e[0]=s=>l.ts_code=s),placeholder:"选择或搜索 TS 代码/名称",filterable:"",remote:"","reserve-keyword":"",clearable:"","remote-method":F,loading:_.value,style:{width:"280px"}},{default:o(()=>[(h(!0),S(H,null,J(i.value,s=>(h(),M(w,{key:s.ts_code,label:`${s.extname||s.csname||s.cname||""}（${s.ts_code}）`,value:s.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(b,{label:"开始日期"},{default:o(()=>[a(E,{modelValue:l.start_date,"onUpdate:modelValue":e[1]||(e[1]=s=>l.start_date=s),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(b,{label:"结束日期"},{default:o(()=>[a(E,{modelValue:l.end_date,"onUpdate:modelValue":e[2]||(e[2]=s=>l.end_date=s),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),a(y,{class:"kline-card"},{default:o(()=>[a(ee,{"stock-code":l.ts_code,"stock-name":C.value,"kline-data":T.value,height:"600px"},null,8,["stock-code","stock-name","kline-data"])]),_:1}),a(y,{class:"table-card"},{default:o(()=>[P((h(),M(O,{data:u.value,border:"",style:{width:"100%"}},{default:o(()=>[a(r,{prop:"trade_date",label:"交易日","min-width":"120"}),a(r,{prop:"open",label:"开盘","min-width":"90"}),a(r,{prop:"high",label:"最高","min-width":"90"}),a(r,{prop:"low",label:"最低","min-width":"90"}),a(r,{prop:"close",label:"收盘","min-width":"90"}),a(r,{prop:"pre_close",label:"昨收","min-width":"90"}),a(r,{prop:"change",label:"涨跌额","min-width":"90"}),a(r,{prop:"pct_chg",label:"涨跌幅(%)","min-width":"110"}),a(r,{prop:"vol",label:"成交量(手)","min-width":"120"}),a(r,{prop:"amount",label:"成交额","min-width":"120"})]),_:1},8,["data"])),[[U,p.value]])]),_:1})])}}}),ie=W(oe,[["__scopeId","data-v-099ebd10"]]);export{ie as default};
