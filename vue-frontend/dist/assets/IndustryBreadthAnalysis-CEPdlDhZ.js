import"./index-ElshY9iF.js";import{H as F}from"./HeatmapChart-BQNzZmvM.js";import{f as H}from"./strategyBreadthApi-aGPSInaH.js";import{d as O,a as h,z as _,B as U,y as z,c as M,e as r,i as y,w as p,b as s,k as S,t as V,f as P,o as x,_ as T}from"./index-DBlIMAuh.js";const Y={class:"industry-breadth-analysis"},j={class:"controls"},q={class:"control-group"},G={class:"control-group"},J={class:"control-group"},K={class:"control-group"},Q={class:"card-header"},X={key:1,class:"empty-tip"},Z=O({__name:"IndustryBreadthAnalysis",props:{industryWhitelist:{default:()=>[]}},emits:["chartReady","chartClick"],setup($,{emit:I}){const f=$,D=I,i=h(!1),g=h(20),b=h(20),v=h(!0);function B(a){const t=a.getFullYear(),o=`${a.getMonth()+1}`.padStart(2,"0"),e=`${a.getDate()}`.padStart(2,"0");return`${t}-${o}-${e}`}function W(a){const t=new Date,o=new Date;return o.setDate(t.getDate()-a),[B(o),B(t)]}const c=h([]),R=()=>{v.value=!v.value},m=_(()=>{let a=Array.from(new Set(c.value.map(t=>t.sector_name)));if(f.industryWhitelist&&f.industryWhitelist.length>0&&(a=a.filter(t=>f.industryWhitelist.includes(t))),v.value&&d.value.length>0){const t=d.value[d.value.length-1],o=new Map;c.value.forEach(e=>{if(e.date===t&&a.includes(e.sector_name)){const n=typeof e.breadth_ratio=="number"?e.breadth_ratio:Number(e.breadth_ratio);o.set(e.sector_name,Number.isNaN(n)?0:n)}}),a.sort((e,n)=>{const l=o.get(e)||0,u=o.get(n)||0;return l-u||0})}return a}),d=_(()=>Array.from(new Set(c.value.map(t=>t.date))).sort()),N=_(()=>{const a=new Map(d.value.map((e,n)=>[e,n])),t=new Map(m.value.map((e,n)=>[e,n])),o=[];return c.value.forEach(e=>{const n=a.get(e.date),l=t.get(e.sector_name);if(n!==void 0&&l!==void 0){const u=typeof e.breadth_ratio=="number"?e.breadth_ratio:Number(e.breadth_ratio);o.push([n,l,Number.isNaN(u)?0:u])}}),o}),k=_(()=>d.value.length===0||m.value.length===0||N.value.length===0?null:{animation:!1,tooltip:{position:"top",formatter:a=>{const[t,o,e]=a?.data??[],n=typeof t=="number"?d.value[t]:"",l=typeof o=="number"?m.value[o]:"";return`${n}<br/>${l}<br/>宽度比例: ${(Number(e)*100).toFixed(2)}%`}},grid:{left:140,right:80,top:80,bottom:20},xAxis:{type:"category",data:d.value,position:"top",axisLabel:{rotate:0,hideOverlap:!0,interval:"auto"}},yAxis:{type:"category",data:m.value},visualMap:{min:0,max:1,calculable:!0,orient:"vertical",right:10,top:40,bottom:40,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}},series:[{type:"heatmap",data:N.value,itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{itemStyle:{shadowBlur:5,shadowColor:"rgba(0, 0, 0, 0.3)"}}}]}),w=async()=>{i.value=!0;try{const[a,t]=W(g.value),o=await H(a,t,b.value);c.value=o.data??[]}catch(a){console.error("获取行业MA宽度数据失败:",a)}finally{i.value=!1}},A=()=>{w()},L=a=>D("chartReady",a),E=a=>{const[t,o,e]=a?.data??[],n={date:typeof t=="number"?d.value[t]:"",industry:typeof o=="number"?m.value[o]:"",value:typeof e=="number"?e:0};D("chartClick",n)};return U(()=>f.industryWhitelist,()=>{},{deep:!0}),z(()=>{w()}),(a,t)=>{const o=y("el-option"),e=y("el-select"),n=y("el-input-number"),l=y("el-button"),u=y("el-card");return x(),M("div",Y,[r(u,{class:"control-card",shadow:"hover"},{default:p(()=>[s("div",j,[s("div",q,[t[2]||(t[2]=s("span",{class:"control-label"},"时间范围：",-1)),r(e,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=C=>g.value=C),placeholder:"选择最近天数",disabled:i.value,onChange:A,style:{width:"160px"}},{default:p(()=>[r(o,{label:"最近20天",value:20}),r(o,{label:"最近30天",value:30}),r(o,{label:"最近40天",value:40})]),_:1},8,["modelValue","disabled"])]),s("div",G,[t[3]||(t[3]=s("span",{class:"control-label"},"MA窗口：",-1)),r(n,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=C=>b.value=C),min:5,max:120,step:5,disabled:i.value,onChange:A},null,8,["modelValue","disabled"])]),s("div",J,[r(l,{type:"primary",loading:i.value,onClick:w},{default:p(()=>[...t[4]||(t[4]=[S("刷新",-1)])]),_:1},8,["loading"])]),s("div",K,[r(l,{type:"default",disabled:i.value||!c.value.length,onClick:R,icon:v.value?"SortDown":"Sort"},{default:p(()=>[S(V(v.value?"取消排序":"按最后一列排序"),1)]),_:1},8,["disabled","icon"])])])]),_:1}),r(u,{class:"chart-card",shadow:"hover"},{header:p(()=>[s("div",Q,[s("span",null,"行业宽度热力图（MA "+V(b.value)+"）",1),t[5]||(t[5]=s("span",{class:"tips"},"数据来源：行业MA宽度接口",-1))])]),default:p(()=>[k.value?(x(),P(F,{key:0,option:k.value,onChartReady:L,onChartClick:E},null,8,["option"])):(x(),M("div",X,"暂无数据"))]),_:1})])}}}),nt=T(Z,[["__scopeId","data-v-a964d011"]]);export{nt as I};
