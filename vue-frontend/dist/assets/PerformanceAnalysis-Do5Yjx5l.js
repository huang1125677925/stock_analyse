import{x as O,d as b,f as S,w as P,c as T,F as $,A as z,i as E,l as G,o as C,_ as I,e as v,z as V,a as w,y as M,b as L,k as B,u as D,E as A}from"./index-yvE1imiI.js";import"./index-ElshY9iF.js";import{H as U}from"./HeatmapChart-C7ZeCmg2.js";const W="/django/api/stock";async function H(e,o,a,r){try{const s={};return o&&(s.report_type=o),(await O.get(`${W}/industry/heatmap-data/`,{params:s})).data}catch(s){throw console.error("获取行业热力图数据失败:",s),s}}var F=(e=>(e.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",e.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",e.TOTAL_OPERATING_REVENUE="total_operating_revenue",e.TOTAL_NET_PROFIT="total_net_profit",e.EARNINGS_PER_SHARE="avg_earnings_per_share",e.ROE="avg_roe",e.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",e.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",e.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",e))(F||{});const k={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:e=>e.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:e=>e.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:e=>(e/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:e=>(e/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:e=>e.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:e=>e.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:e=>e.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:e=>e.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:e=>e.toFixed(2)}},q=b({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(e){return(o,a)=>{const r=E("el-option"),s=E("el-select");return C(),S(s,{"model-value":o.modelValue,"onUpdate:modelValue":a[0]||(a[0]=i=>o.$emit("update:modelValue",i)),onChange:a[1]||(a[1]=i=>o.$emit("change",i)),placeholder:"选择指标",style:{width:"180px"}},{default:P(()=>[(C(!0),T($,null,z(G(k),(i,y)=>(C(),S(r,{key:y,label:i.name,value:y},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),K=I(q,[["__scopeId","data-v-26626d73"]]),j=b({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(e){return(o,a)=>{const r=E("el-option"),s=E("el-select");return C(),S(s,{"model-value":o.modelValue,"onUpdate:modelValue":a[0]||(a[0]=i=>o.$emit("update:modelValue",i)),onChange:a[1]||(a[1]=i=>o.$emit("change",i)),placeholder:"选择报告类型",style:{width:"120px"}},{default:P(()=>[v(r,{label:"年报",value:"annual"}),v(r,{label:"中报",value:"semi_annual"}),v(r,{label:"一季报",value:"q1"}),v(r,{label:"三季报",value:"q3"}),v(r,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),J=I(j,[["__scopeId","data-v-38f9ba58"]]),Q=b({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chart-ready","chart-click"],setup(e,{emit:o}){const a=e,r=o,s=V(()=>{if(!a.data)return[];const{swCodeNames:l,congestions:m}=a.data;let d=l;return a.searchKeyword?.trim()&&(d=l.filter(_=>_.indexName.toLowerCase().includes(a.searchKeyword.toLowerCase()))),[...d].sort((_,p)=>{const c=m[_.indexCode]||m[_.indexName],t=m[p.indexCode]||m[p.indexName];if(!c||!t||c.length===0||t.length===0)return 0;const n=c[c.length-1][a.selectedMetric],u=t[t.length-1][a.selectedMetric];return a.sortAscending?n-u:u-n})}),i=V(()=>{if(!a.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:l,congestions:m}=a.data,d=s.value,_=[];let p=1/0,c=-1/0;d.forEach((n,u)=>{const f=m[n.indexCode]||m[n.indexName];f&&f.forEach((h,x)=>{const g=h[a.selectedMetric];typeof g=="number"&&!isNaN(g)&&isFinite(g)&&(_.push([x,u,g]),p=Math.min(p,g),c=Math.max(c,g))})}),(p===1/0||c===-1/0)&&(p=0,c=100);const t=k[a.selectedMetric];return{tooltip:{position:"top",formatter:function(n){const[u,f,h]=n.data,x=l[u],g=d[f].indexName,N=t.formatter?t.formatter(h):h.toFixed(2);return`${g}<br/>${x}<br/>${t.name}: ${N}${t.unit}`}},grid:{height:Math.max(400,d.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:l,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:l,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:d.map(n=>n.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:d.map(n=>n.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:p,max:c,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:t.name,type:"heatmap",data:_,label:{show:!0,fontSize:9,formatter:function(n){const u=n.data[2];return t.formatter?t.formatter(u):u.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),y=l=>{r("chart-ready",l)},R=l=>{const m=l?.data,[d,_,p]=m??[],c=typeof _=="number"?s.value[_]:void 0,t=typeof d=="number"?a.data?.dates[d]:void 0;r("chart-click",{industry:c,date:t,value:p,metric:a.selectedMetric,rawParams:l})};return(l,m)=>(C(),S(U,{option:i.value,onChartReady:y,onChartClick:R},null,8,["option"]))}}),X=I(Q,[["__scopeId","data-v-c7e44af1"]]),Y={class:"performance-analysis"},Z={class:"controls"},ee={class:"chart-container"},te=b({__name:"PerformanceAnalysis",props:{industryWhitelist:{default:()=>[]}},setup(e){const o=e,a=D(),r=w(F.OPERATING_REVENUE_GROWTH),s=w("annual"),i=w(!0),y=w(!1),R=w(null),l=V(()=>{const t=R.value;if(!t)return null;if(!o.industryWhitelist||o.industryWhitelist.length===0)return t;const n=new Set(o.industryWhitelist.map(h=>h.trim().toLowerCase())),u=t.swCodeNames.filter(h=>n.has(h.indexName.trim().toLowerCase())),f={};return u.forEach(h=>{const x=h.indexCode,g=h.indexName,N=t.congestions[x]||t.congestions[g];N&&(f[x]=N)}),{dates:t.dates,swCodeNames:u,congestions:f}}),m=async()=>{y.value=!0;try{const t=await H(void 0,s.value,void 0,void 0);t?R.value=t:A.error("获取行业业绩数据失败")}catch(t){console.error("获取业绩数据出错:",t),A.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{y.value=!1}},d=()=>{m()},_=()=>{i.value=!i.value},p=t=>{},c=t=>{console.log("Performance chart clicked payload:",t);const n=t?.industry?.indexName||t?.industry?.indexCode;n&&(a.push({path:"/stock-list",query:{industry:n}}),A.success(`正在跳转到 ${n} 的股票列表`))};return M(()=>{m()}),(t,n)=>{const u=E("el-button");return C(),T("div",Y,[L("div",Z,[v(K,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=f=>r.value=f),onChange:d,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(J,{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=f=>s.value=f),onChange:d,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(u,{onClick:_,type:"primary"},{default:P(()=>[...n[2]||(n[2]=[B("按最后一列排序",-1)])]),_:1})]),L("div",ee,[v(X,{data:l.value,"selected-metric":r.value,"sort-ascending":i.value,onChartReady:p,onChartClick:c},null,8,["data","selected-metric","sort-ascending"])])])}}}),re=I(te,[["__scopeId","data-v-a8d2dea3"]]);export{re as P};
