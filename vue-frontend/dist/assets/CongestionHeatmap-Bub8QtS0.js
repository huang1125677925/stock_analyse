import{x as j,d as R,f as E,w as A,c as I,F as P,e as v,i as F,o as S,_ as $,a as k,z as L,D as W,y as O,G as J,W as ne,J as B,b,k as Q,E as z,A as K,l as X,H as oe,X as se,t as N,g as le,V as re}from"./index-C4VTeMOf.js";import{i as Y}from"./index-1yOyFXf9.js";import{a as Z,F as ie,f as ce}from"./industry-fund-flow-CZyDapJc.js";import{a as de}from"./industryApi-aCJmI_vF.js";const ue="/django/api/strategy";async function me(c,d){try{return(await j.get(`${ue}/industry-turnover-percentile/`,{params:{start_date:c,end_date:d}})).data}catch(e){throw console.error("获取行业换手率分位数数据失败:",e),e}}const pe=R({__name:"DateRangeSelector",props:{modelValue:{},weekFlag:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(c){return(d,e)=>{const t=F("el-option"),i=F("el-select");return S(),E(i,{"model-value":d.modelValue,"onUpdate:modelValue":e[0]||(e[0]=u=>d.$emit("update:modelValue",u)),onChange:e[1]||(e[1]=u=>d.$emit("change",u)),placeholder:"选择日期范围",style:{width:"150px"}},{default:A(()=>[d.weekFlag?(S(),I(P,{key:1},[v(t,{label:"最近5周",value:"5"}),v(t,{label:"最近10周",value:"10"}),v(t,{label:"最近20周",value:"20"})],64)):(S(),I(P,{key:0},[v(t,{label:"最近5天",value:"5"}),v(t,{label:"最近10天",value:"10"}),v(t,{label:"最近15天",value:"15"}),v(t,{label:"最近20天",value:"20"}),v(t,{label:"全部29天",value:"all"})],64))]),_:1},8,["model-value"])}}}),ee=$(pe,[["__scopeId","data-v-678a0eb8"]]),fe=R({__name:"HeatmapChart",props:{option:{},height:{},autoResize:{type:Boolean,default:!0}},emits:["chartReady","chartClick"],setup(c,{expose:d,emit:e}){const t=c,i=e,u=k();let m=null;const x=L(()=>{if(t.height)return t.height;const r=t.option?.yAxis;if(r&&Array.isArray(r)&&r[0]?.data){const n=r[0].data.length;return Math.max(500,n*22+120)}else if(r&&r.data){const n=r.data.length;return Math.max(500,n*22+120)}return 500}),h=()=>{u.value&&(m=Y(u.value),m.on("click",r=>{i("chartClick",r)}),i("chartReady",m),y())},y=()=>{!m||!t.option||B(()=>{m&&(m.clear(),m.setOption(t.option),setTimeout(()=>{m&&m.resize()},0))})};W(()=>t.option,y,{deep:!0}),W(x,()=>{B(()=>{m&&m.resize()})});const _=()=>{m&&t.autoResize&&m.resize()};return O(()=>{h(),t.autoResize&&window.addEventListener("resize",_)}),J(()=>{m&&(m.dispose(),m=null),t.autoResize&&window.removeEventListener("resize",_)}),d({getChart:()=>m,resize:()=>{m&&m.resize()},clear:()=>{m&&m.clear()}}),(r,n)=>(S(),I("div",{ref_key:"chartContainer",ref:u,class:"heatmap-chart",style:ne({height:x.value+"px"})},null,4))}}),q=$(fe,[["__scopeId","data-v-b4aa47f4"]]),_e=R({__name:"TurnoverHeatmap",props:{industries:{},dates:{},searchKeyword:{default:""},sortMetric:{default:"amount"},sortAscending:{type:Boolean,default:!1}},emits:["chartReady","chartClick"],setup(c,{emit:d}){const e=c,t=d,i=L(()=>{let _=e.industries;return e.searchKeyword?.trim()&&(_=e.industries.filter(r=>r.name.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[..._].sort((r,n)=>{if(r.data.length===0||n.data.length===0)return 0;const l=r.data[r.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"],a=n.data[n.data.length-1][e.sortMetric==="turnover"?"turnoverRateFQuantile":"amountCongestionQuantile"];return e.sortAscending?l-a:a-l})}),u=L(()=>e.searchKeyword?.trim()?x():m()),m=()=>{const _=[];i.value.forEach((n,l)=>{n.data.forEach((a,s)=>{const f=e.sortMetric==="turnover"?a.turnoverRateFQuantile:a.amountCongestionQuantile;typeof f=="number"&&!isNaN(f)&&isFinite(f)&&_.push([s,l,f])})});const r=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{tooltip:{position:"top",formatter:function(n){const[l,a,s]=n.data,f=e.dates[l];return`${i.value[a].name}<br/>${f}<br/>${r}: ${s}`}},grid:{height:Math.max(400,i.value.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:e.dates.map(n=>n.substring(5)),splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:e.dates.map(n=>n.substring(5)),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:i.value.map(n=>n.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:i.value.map(n=>n.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:0,max:100,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:r,type:"heatmap",data:_,label:{show:!0,fontSize:9,formatter:function(n){return n.data[2]}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},x=()=>{const _=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#EA7CCC","#2f4554","#61a0a8","#d48265","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],r=a=>{let s=0;for(let f=0;f<a.length;f++)s=s*31+a.charCodeAt(f)>>>0;return _[s%_.length]},n=i.value.map(a=>{const s=r(a.name);return{name:a.name,type:"line",data:a.data.map(f=>e.sortMetric==="turnover"?f.turnoverRateFQuantile:f.amountCongestionQuantile),smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:s},itemStyle:{color:s}}}),l=e.sortMetric==="turnover"?"等权换手率分位数":"成交金额占比分位数";return{title:{text:`${e.searchKeyword} - ${l}趋势`,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:i.value.map(a=>a.name),top:"8%",type:"scroll"},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.dates.map(a=>a.substring(5)),axisLabel:{rotate:45}},yAxis:{type:"value",name:l,nameLocation:"middle",nameGap:50},series:n}},h=_=>{t("chartReady",_)},y=_=>{t("chartClick",_)};return(_,r)=>(S(),E(q,{option:u.value,onChartReady:h,onChartClick:y},null,8,["option"]))}}),he=$(_e,[["__scopeId","data-v-f7491ec8"]]),ve={class:"turnover-analysis"},ge={class:"controls"},ye={class:"chart-container"},be=R({__name:"TurnoverAnalysis",setup(c){const d=k("amount"),e=k("20"),t=k(!0),i=k(!1),u=k([]),m=k([]),x=async()=>{i.value=!0;try{const n=new Date,l=n.toISOString().split("T")[0],a=e.value==="all"?30:parseInt(e.value),s=new Date(n);s.setDate(n.getDate()-a);const f=s.toISOString().split("T")[0],V=await me(f,l);if(V){const C=V.data;if(!Array.isArray(C))throw console.error("API返回的数据不是数组:",C),new Error("API返回的数据格式不正确");const p=[...new Set(C.map(g=>g.date))].sort();m.value=p;const o=new Map;C.forEach(g=>{o.has(g.sector_code)||o.set(g.sector_code,{name:g.sector_name,data:[]});const T=o.get(g.sector_code),U=p.indexOf(g.date);for(;T.data.length<p.length;)T.data.push({turnoverRateFQuantile:0,amountCongestionQuantile:0});T.data[U]={turnoverRateFQuantile:g.turnover_ratio_percentile,amountCongestionQuantile:g.turnover_ratio_percentile}}),u.value=Array.from(o.values())}else z.error("获取数据失败")}catch(n){console.error("获取数据出错:",n),z.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{i.value=!1}},h=()=>{x()},y=()=>{t.value=!t.value},_=n=>{},r=n=>{console.log("Chart clicked:",n)};return O(()=>{x()}),(n,l)=>{const a=F("el-button");return S(),I("div",ve,[b("div",ge,[v(ee,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=s=>e.value=s),onChange:h,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(a,{onClick:y,type:"primary"},{default:A(()=>[...l[1]||(l[1]=[Q("按最后一列排序",-1)])]),_:1})]),b("div",ye,[v(he,{industries:u.value,dates:m.value,"sort-metric":d.value,"sort-ascending":t.value,onChartReady:_,onChartClick:r},null,8,["industries","dates","sort-metric","sort-ascending"])])])}}}),xe=$(be,[["__scopeId","data-v-65392abb"]]),Ce="/django/api/stock";async function we(c,d,e,t){try{const i={};return d&&(i.report_type=d),(await j.get(`${Ce}/industry/heatmap-data/`,{params:i})).data}catch(i){throw console.error("获取行业热力图数据失败:",i),i}}var te=(c=>(c.OPERATING_REVENUE_GROWTH="avg_operating_revenue_growth_rate",c.NET_PROFIT_GROWTH="avg_net_profit_growth_rate",c.TOTAL_OPERATING_REVENUE="total_operating_revenue",c.TOTAL_NET_PROFIT="total_net_profit",c.EARNINGS_PER_SHARE="avg_earnings_per_share",c.ROE="avg_roe",c.GROSS_PROFIT_MARGIN="avg_gross_profit_margin",c.NET_ASSETS_PER_SHARE="avg_net_assets_per_share",c.OPERATING_CASH_FLOW_PER_SHARE="avg_operating_cash_flow_per_share",c))(te||{});const ae={avg_operating_revenue_growth_rate:{name:"营业收入增长率",unit:"%",description:"平均营业收入增长率",formatter:c=>c.toFixed(2)},avg_net_profit_growth_rate:{name:"净利润增长率",unit:"%",description:"平均净利润增长率",formatter:c=>c.toFixed(2)},total_operating_revenue:{name:"总营业收入",unit:"亿元",description:"总营业收入",formatter:c=>(c/1e8).toFixed(2)},total_net_profit:{name:"总净利润",unit:"亿元",description:"总净利润",formatter:c=>(c/1e8).toFixed(2)},avg_earnings_per_share:{name:"每股收益",unit:"元",description:"平均每股收益",formatter:c=>c.toFixed(2)},avg_roe:{name:"净资产收益率",unit:"%",description:"平均净资产收益率",formatter:c=>c.toFixed(2)},avg_gross_profit_margin:{name:"毛利率",unit:"%",description:"平均毛利率",formatter:c=>c.toFixed(2)},avg_net_assets_per_share:{name:"每股净资产",unit:"元",description:"平均每股净资产",formatter:c=>c.toFixed(2)},avg_operating_cash_flow_per_share:{name:"每股经营现金流",unit:"元",description:"平均每股经营现金流",formatter:c=>c.toFixed(2)}},Se=R({__name:"MetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(d,e)=>{const t=F("el-option"),i=F("el-select");return S(),E(i,{"model-value":d.modelValue,"onUpdate:modelValue":e[0]||(e[0]=u=>d.$emit("update:modelValue",u)),onChange:e[1]||(e[1]=u=>d.$emit("change",u)),placeholder:"选择指标",style:{width:"180px"}},{default:A(()=>[(S(!0),I(P,null,K(X(ae),(u,m)=>(S(),E(t,{key:m,label:u.name,value:m},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),ke=$(Se,[["__scopeId","data-v-26626d73"]]),Ve=R({__name:"ReportTypeSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(d,e)=>{const t=F("el-option"),i=F("el-select");return S(),E(i,{"model-value":d.modelValue,"onUpdate:modelValue":e[0]||(e[0]=u=>d.$emit("update:modelValue",u)),onChange:e[1]||(e[1]=u=>d.$emit("change",u)),placeholder:"选择报告类型",style:{width:"120px"}},{default:A(()=>[v(t,{label:"年报",value:"annual"}),v(t,{label:"中报",value:"semi_annual"}),v(t,{label:"一季报",value:"q1"}),v(t,{label:"三季报",value:"q3"}),v(t,{label:"季报",value:"quarterly"})]),_:1},8,["model-value"])}}}),Ie=$(Ve,[["__scopeId","data-v-38f9ba58"]]),Fe=R({__name:"PerformanceHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1}},emits:["chartReady","chartClick"],setup(c,{emit:d}){const e=c,t=d,i=L(()=>{if(!e.data)return[];const{swCodeNames:h,congestions:y}=e.data;let _=h;return e.searchKeyword?.trim()&&(_=h.filter(r=>r.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[..._].sort((r,n)=>{const l=y[r.indexCode]||y[r.indexName],a=y[n.indexCode]||y[n.indexName];if(!l||!a||l.length===0||a.length===0)return 0;const s=l[l.length-1][e.selectedMetric],f=a[a.length-1][e.selectedMetric];return e.sortAscending?s-f:f-s})}),u=L(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:h,congestions:y}=e.data,_=i.value,r=[];let n=1/0,l=-1/0;_.forEach((s,f)=>{const V=y[s.indexCode]||y[s.indexName];V&&V.forEach((C,p)=>{const o=C[e.selectedMetric];typeof o=="number"&&!isNaN(o)&&isFinite(o)&&(r.push([p,f,o]),n=Math.min(n,o),l=Math.max(l,o))})}),(n===1/0||l===-1/0)&&(n=0,l=100);const a=ae[e.selectedMetric];return{tooltip:{position:"top",formatter:function(s){const[f,V,C]=s.data,p=h[f],o=_[V].indexName,g=a.formatter?a.formatter(C):C.toFixed(2);return`${o}<br/>${p}<br/>${a.name}: ${g}${a.unit}`}},grid:{height:Math.max(400,_.length*20)+"px",top:"2%",left:"15%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:h,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:h,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"报告期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:_.map(s=>s.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:_.map(s=>s.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:n,max:l,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a.name,type:"heatmap",data:r,label:{show:!0,fontSize:9,formatter:function(s){const f=s.data[2];return a.formatter?a.formatter(f):f.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),m=h=>{t("chartReady",h)},x=h=>{t("chartClick",h)};return(h,y)=>(S(),E(q,{option:u.value,onChartReady:m,onChartClick:x},null,8,["option"]))}}),Ae=$(Fe,[["__scopeId","data-v-a3df8f81"]]),Re={class:"performance-analysis"},$e={class:"controls"},Le={class:"chart-container"},De=R({__name:"PerformanceAnalysis",setup(c){const d=k(te.OPERATING_REVENUE_GROWTH),e=k("annual"),t=k(!0),i=k(!1),u=k(null),m=async()=>{i.value=!0;try{const r=await we(void 0,e.value,void 0,void 0);r?u.value=r:z.error("获取行业业绩数据失败")}catch(r){console.error("获取业绩数据出错:",r),z.error("获取业绩数据出错，请检查网络连接或API服务是否可用")}finally{i.value=!1}},x=()=>{m()},h=()=>{t.value=!t.value},y=r=>{},_=r=>{console.log("Performance chart clicked:",r)};return O(()=>{m()}),(r,n)=>{const l=F("el-button");return S(),I("div",Re,[b("div",$e,[v(ke,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=a=>d.value=a),onChange:x,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(Ie,{modelValue:e.value,"onUpdate:modelValue":n[1]||(n[1]=a=>e.value=a),onChange:x,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(l,{onClick:h,type:"primary"},{default:A(()=>[...n[2]||(n[2]=[Q("按最后一列排序",-1)])]),_:1})]),b("div",Le,[v(Ae,{data:u.value,"selected-metric":d.value,"sort-ascending":t.value,onChartReady:y,onChartClick:_},null,8,["data","selected-metric","sort-ascending"])])])}}}),Ee=$(De,[["__scopeId","data-v-5daf1c05"]]),Te=R({__name:"FundFlowMetricSelector",props:{modelValue:{}},emits:["update:modelValue","change"],setup(c){return(d,e)=>{const t=F("el-option"),i=F("el-select");return S(),E(i,{"model-value":d.modelValue,"onUpdate:modelValue":e[0]||(e[0]=u=>d.$emit("update:modelValue",u)),onChange:e[1]||(e[1]=u=>d.$emit("change",u)),placeholder:"选择资金流指标",style:{width:"180px"}},{default:A(()=>[(S(!0),I(P,null,K(X(Z),(u,m)=>(S(),E(t,{key:m,label:u.name,value:m},null,8,["label","value"]))),128))]),_:1},8,["model-value"])}}}),Ne=$(Te,[["__scopeId","data-v-0473adf8"]]),ze=R({__name:"FundFlowHeatmap",props:{data:{},selectedMetric:{},searchKeyword:{default:""},sortAscending:{type:Boolean,default:!1},valueFilter:{default:"all"}},emits:["chartReady","chartClick"],setup(c,{emit:d}){const e=c,t=d,i=L(()=>{if(!e.data)return[];const{swCodeNames:h,congestions:y}=e.data;let _=h;return e.searchKeyword?.trim()&&(_=h.filter(r=>r.indexName.toLowerCase().includes(e.searchKeyword.toLowerCase()))),[..._].sort((r,n)=>{const l=y[r.indexCode]||y[r.indexName],a=y[n.indexCode]||y[n.indexName];if(!l||!a||l.length===0||a.length===0)return 0;const s=l[l.length-1][e.selectedMetric],f=a[a.length-1][e.selectedMetric];return e.sortAscending?s-f:f-s})}),u=L(()=>{if(!e.data)return{title:{text:"暂无数据",left:"center",top:"center",textStyle:{fontSize:16,color:"#999"}}};const{dates:h,congestions:y}=e.data,_=i.value,r=[];let n=1/0,l=-1/0;_.forEach((s,f)=>{const V=y[s.indexCode]||y[s.indexName];V&&V.forEach((C,p)=>{const o=C[e.selectedMetric];if(typeof o=="number"&&!isNaN(o)&&isFinite(o)){let g=!0;(e.valueFilter==="positive"&&o<=0||e.valueFilter==="negative"&&o>=0)&&(g=!1),g&&(r.push([p,f,o]),n=Math.min(n,o),l=Math.max(l,o))}})}),(n===1/0||l===-1/0)&&(n=0,l=100);const a=Z[e.selectedMetric];return{tooltip:{position:"top",formatter:function(s){const[f,V,C]=s.data,p=h[f],o=_[V].indexName,g=a.formatter?a.formatter(C):C.toFixed(2);return`${o}<br/>${p}<br/>${a.name}: ${g}${a.unit}`}},grid:{height:Math.max(400,_.length*20)+"px",top:"2%",left:"2%",right:"16%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:h,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:h,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:_.map(s=>s.indexName),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:_.map(s=>s.indexName),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"行业",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:n,max:l,calculable:!0,orient:"vertical",right:"2%",top:"5%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:a.name,type:"heatmap",data:r,label:{show:!0,fontSize:9,formatter:function(s){const f=s.data[2];return a.formatter?a.formatter(f):f.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}),m=h=>{t("chartReady",h)},x=h=>{t("chartClick",h)};return(h,y)=>(S(),E(q,{option:u.value,onChartReady:m,onChartClick:x},null,8,["option"]))}}),Me=$(ze,[["__scopeId","data-v-772aad27"]]),Pe={class:"fund-flow-analysis"},Oe={class:"controls"},Ue={class:"chart-container"},Be=R({__name:"FundFlowAnalysis",setup(c){const d=k(ie.MAIN_NET_INFLOW_AMOUNT),e=k("5"),t=k(!1),i=k("all"),u=k(!0),m=k(!1),x=k(null),h=async()=>{m.value=!0;try{const l=new Date,a=l.toISOString().split("T")[0];let s;t.value?s=(e.value==="all"?5:parseInt(e.value))*7:s=e.value==="all"?30:parseInt(e.value);const f=new Date(l);f.setDate(l.getDate()-s);const V=f.toISOString().split("T")[0],C=await ce(V,a,t.value);C?x.value=C:z.error("获取行业资金流数据失败")}catch(l){console.error("获取资金流数据出错:",l),z.error("获取资金流数据出错，请检查网络连接或API服务是否可用")}finally{m.value=!1}},y=()=>{h()};W(t,l=>{e.value="5",y()});const _=()=>{u.value=!u.value},r=l=>{},n=l=>{console.log("Fund flow chart clicked:",l)};return O(()=>{h()}),(l,a)=>{const s=F("el-option"),f=F("el-select"),V=F("el-button");return S(),I("div",Pe,[b("div",Oe,[v(f,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=C=>t.value=C),onChange:y,placeholder:"数据周期",style:{width:"120px","margin-right":"10px"}},{default:A(()=>[v(s,{label:"按天",value:!1}),v(s,{label:"按周",value:!0})]),_:1},8,["modelValue"]),v(Ne,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=C=>d.value=C),onChange:y,style:{"margin-right":"10px"}},null,8,["modelValue"]),v(ee,{modelValue:e.value,"onUpdate:modelValue":a[2]||(a[2]=C=>e.value=C),"week-flag":t.value,onChange:y},null,8,["modelValue","week-flag"]),v(f,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=C=>i.value=C),onChange:y,placeholder:"数值过滤",style:{width:"120px","margin-right":"10px"}},{default:A(()=>[v(s,{label:"全部",value:"all"}),v(s,{label:"仅正值",value:"positive"}),v(s,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),v(V,{onClick:_,type:"primary"},{default:A(()=>[...a[4]||(a[4]=[Q("按最后一列排序",-1)])]),_:1})]),b("div",Ue,[v(Me,{data:x.value,"selected-metric":d.value,"sort-ascending":u.value,"value-filter":i.value,onChartReady:r,onChartClick:n},null,8,["data","selected-metric","sort-ascending","value-filter"])])])}}}),He=$(Be,[["__scopeId","data-v-ca2f7c07"]]),Ge={class:"industry-treemap"},We={class:"control-panel"},Qe={class:"metric-selector"},Ke=["value"],qe={class:"refresh-controls"},je=["disabled"],Je={key:0},Xe={key:1},Ye={key:0,class:"update-time"},Ze={key:0,class:"loading-container"},et={key:1,class:"error-container"},tt={class:"error-message"},at={key:2,class:"treemap-container"},nt={class:"chart-info"},ot={class:"statistics"},st={class:"stats-grid"},lt={class:"stat-item"},rt={class:"stat-value"},it={class:"stat-item"},ct={class:"stat-value"},dt={class:"stat-item"},ut={class:"stat-value"},mt={class:"stat-item"},pt={class:"stat-value"},ft=R({__name:"IndustryTreemap",setup(c){const d=k(!1),e=k(null),t=k([]),i=k("total_market_cap_sum"),u=k(null),m=k();let x=null;const h=[{key:"total_market_cap_sum",label:"总市值",unit:"元",isPercent:!1},{key:"circulating_market_cap_sum",label:"流通市值",unit:"元",isPercent:!1},{key:"avg_change_percent",label:"平均涨跌幅",unit:"%",isPercent:!0},{key:"total_volume",label:"总成交量",unit:"手",isPercent:!1},{key:"total_amount",label:"总成交额",unit:"元",isPercent:!1},{key:"avg_turnover_rate",label:"平均换手率",unit:"%",isPercent:!0},{key:"avg_pe_ratio",label:"平均市盈率",unit:"",isPercent:!1},{key:"avg_pb_ratio",label:"平均市净率",unit:"",isPercent:!1},{key:"stock_count",label:"股票数量",unit:"只",isPercent:!1},{key:"avg_change_60d",label:"60日平均涨跌幅",unit:"%",isPercent:!0},{key:"avg_change_ytd",label:"年初至今平均涨跌幅",unit:"%",isPercent:!0}],y=L(()=>h.find(o=>o.key===i.value)?.label||""),_=L(()=>t.value?.length||0),r=L(()=>!t.value||t.value.length===0?0:Math.max(...t.value.map(p=>p[i.value]))),n=L(()=>!t.value||t.value.length===0?0:Math.min(...t.value.map(p=>p[i.value])));async function l(){try{d.value=!0,e.value=null,console.log("开始加载行业数据...");const p=await de();console.log("API响应数据:",p),t.value=p.industries||[],console.log("设置industryData:",t.value),console.log("数据条数:",t.value?.length||0),u.value=new Date}catch(p){e.value=p instanceof Error?p.message:"加载数据失败",console.error("Failed to load industry data:",p)}finally{d.value=!1,await B(),console.log("DOM更新完成，开始更新树图"),s()}}async function a(){await l()}function s(){if(console.log("updateTreemap被调用"),console.log("treemapChart.value:",m.value),console.log("industryData.value:",t.value),console.log("industryData长度:",t.value?.length||0),!m.value){console.error("treemapChart容器未找到");return}if(!t.value||t.value.length===0){console.error("industryData为空或未定义");return}x||(console.log("初始化ECharts实例"),x=Y(m.value));const p=h.find(w=>w.key===i.value);console.log("当前选择的指标:",p);const o=t.value.map(w=>{const D=w[i.value],M=typeof D=="number"?D:Number(D),H=Number.isNaN(M)?0:M,G=typeof w.stock_count=="number"&&w.stock_count>0?w.stock_count:1;return{industry:w.industry,originalValue:H,stockCount:G}});console.log("baseData处理结果:",o.slice(0,3));let g=o.map(w=>({name:w.industry,value:Math.abs(w.originalValue),originalValue:w.originalValue,itemStyle:{color:f(w.originalValue,p?.isPercent||!1)}}));console.log("初始treemapData:",g.slice(0,3));const T=g.reduce((w,D)=>w+D.value,0);if(console.log("总面积:",T),T<=0&&(console.log("所有值为0，使用股票数量作为回退"),g=o.map(w=>({name:w.industry,value:w.stockCount,originalValue:w.originalValue,itemStyle:{color:f(w.originalValue,p?.isPercent||!1)}}))),g=g.filter(w=>w.value>0),console.log("过滤后的treemapData长度:",g.length),console.log("最终treemapData:",g.slice(0,3)),g.length===0){console.error("treemapData为空，无法渲染图表");return}const U={title:{text:`行业${y.value}分布`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:w=>{const D=w.data,M=g.reduce((H,G)=>H+G.value,0);return`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 4px;">${D.name}</div>
            <div>${y.value}: ${V(D.originalValue)}</div>
            <div>占比: ${M>0?(D.value/M*100).toFixed(2):"0.00"}%</div>
          </div>
        `}},series:[{type:"treemap",data:g,roam:!1,nodeClick:!1,breadcrumb:{show:!1},label:{show:!0,formatter:w=>`${w.name}
${V(w.data.originalValue)}`,fontSize:12,color:"#fff",fontWeight:"bold"},itemStyle:{borderColor:"#fff",borderWidth:2,gapWidth:2},emphasis:{itemStyle:{borderColor:"#333",borderWidth:3},label:{fontSize:14}}}]};console.log("设置ECharts选项:",U),x.setOption(U),console.log("ECharts选项设置完成")}function f(p,o){if(o)return p>0?"#52c41a":p<0?"#ff4d4f":"#d9d9d9";{const g=["#1890ff","#13c2c2","#52c41a","#faad14","#f759ab","#722ed1","#fa541c","#eb2f96"],T=Math.abs(p.toString().charCodeAt(0))%g.length;return g[T]}}function V(p){const o=h.find(g=>g.key===i.value);return o?.isPercent?`${p.toFixed(2)}%`:o?.unit==="元"?p>=1e12?`${(p/1e12).toFixed(2)}万亿`:p>=1e8?`${(p/1e8).toFixed(2)}亿`:p>=1e4?`${(p/1e4).toFixed(2)}万`:p.toFixed(2):p>=1e8?`${(p/1e8).toFixed(2)}亿`:p>=1e4?`${(p/1e4).toFixed(2)}万`:p.toFixed(2)+(o?.unit||"")}function C(p){return p.toLocaleString("zh-CN")}return O(async()=>{await l(),window.addEventListener("resize",()=>{x&&x.resize()})}),J(()=>{x&&(x.dispose(),x=null),window.removeEventListener("resize",()=>{x&&x.resize()})}),(p,o)=>(S(),I("div",Ge,[b("div",We,[b("div",Qe,[o[1]||(o[1]=b("label",{for:"metric-select"},"选择指标：",-1)),oe(b("select",{id:"metric-select","onUpdate:modelValue":o[0]||(o[0]=g=>i.value=g),onChange:s,class:"metric-select"},[(S(),I(P,null,K(h,g=>b("option",{key:g.key,value:g.key},N(g.label),9,Ke)),64))],544),[[se,i.value]])]),b("div",qe,[b("button",{onClick:a,disabled:d.value,class:"refresh-btn"},[d.value?(S(),I("span",Je,"刷新中...")):(S(),I("span",Xe,"刷新数据"))],8,je),u.value?(S(),I("span",Ye," 最后更新："+N(C(u.value)),1)):le("",!0)])]),d.value?(S(),I("div",Ze,[...o[2]||(o[2]=[b("div",{class:"loading-spinner"},null,-1),b("p",null,"正在加载行业数据...",-1)])])):e.value?(S(),I("div",et,[b("div",tt,[o[3]||(o[3]=b("h3",null,"数据加载失败",-1)),b("p",null,N(e.value),1),b("button",{onClick:a,class:"retry-btn"},"重试")])])):(S(),I("div",at,[b("div",{ref_key:"treemapChart",ref:m,class:"treemap-chart"},null,512),b("div",nt,[o[9]||(o[9]=re('<div class="legend" data-v-60ed27e1><h4 data-v-60ed27e1>图例说明</h4><div class="legend-items" data-v-60ed27e1><div class="legend-item positive" data-v-60ed27e1><span class="color-box positive" data-v-60ed27e1></span><span data-v-60ed27e1>正值/上涨</span></div><div class="legend-item negative" data-v-60ed27e1><span class="color-box negative" data-v-60ed27e1></span><span data-v-60ed27e1>负值/下跌</span></div><div class="legend-item neutral" data-v-60ed27e1><span class="color-box neutral" data-v-60ed27e1></span><span data-v-60ed27e1>中性/无变化</span></div></div></div>',1)),b("div",ot,[o[8]||(o[8]=b("h4",null,"统计信息",-1)),b("div",st,[b("div",lt,[o[4]||(o[4]=b("span",{class:"stat-label"},"行业总数：",-1)),b("span",rt,N(_.value),1)]),b("div",it,[o[5]||(o[5]=b("span",{class:"stat-label"},"当前指标：",-1)),b("span",ct,N(y.value),1)]),b("div",dt,[o[6]||(o[6]=b("span",{class:"stat-label"},"最大值：",-1)),b("span",ut,N(V(r.value)),1)]),b("div",mt,[o[7]||(o[7]=b("span",{class:"stat-label"},"最小值：",-1)),b("span",pt,N(V(n.value)),1)])])])])]))]))}}),_t=$(ft,[["__scopeId","data-v-60ed27e1"]]),ht={class:"congestion-heatmap"},vt=R({__name:"CongestionHeatmap",setup(c){const d=k("turnover"),e=async t=>{d.value=t,await B(),window.dispatchEvent(new Event("resize"))};return(t,i)=>{const u=F("el-tab-pane"),m=F("el-tabs"),x=F("el-card");return S(),I("div",ht,[v(x,null,{default:A(()=>[v(m,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=h=>d.value=h),onTabChange:e},{default:A(()=>[v(u,{label:"成交金额占比分位数",name:"turnover"},{default:A(()=>[v(xe)]),_:1}),v(u,{label:"行业业绩指标",name:"performance"},{default:A(()=>[v(Ee)]),_:1}),v(u,{label:"行业资金流",name:"fundflow"},{default:A(()=>[v(He)]),_:1}),v(u,{label:"行业矩形树图",name:"treemap"},{default:A(()=>[v(_t)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Ct=$(vt,[["__scopeId","data-v-96bfaee7"]]);export{Ct as default};
