import{x as B,d as R,a as h,y as F,Y as H,B as L,c as k,b as _,e as s,i as v,w as y,f as V,k as Y,t as N,F as T,A as z,I as O,E,o as f,_ as U}from"./index-B1jknyhk.js";import{i as P}from"./index-ElshY9iF.js";function Z(i){if(!i)return"";const a=String(i);if(a.length===8&&/^\d{8}$/.test(a)){const n=a.slice(0,4),l=a.slice(4,6),r=a.slice(6,8);return`${n}-${l}-${r}`}return a}async function G(i,a,n){return((await B.get("/django/api/tasks/index-daily/",{params:{ts_code:i,start_date:a,end_date:n,fields:"trade_date,vol,amount,close"}})).data?.records||[]).map(t=>{const u=t.date??t.trade_date,g=t.volume??t.vol,x=t.amount,c=t.close,$=Z(u),S=Number(g??0),A=x!=null?Number(x):void 0,D=c!=null?Number(c):void 0;return{date:$,volume:S,amount:A,close:D}}).filter(t=>!!t.date).sort((t,u)=>t.date.localeCompare(u.date))}async function W(i,a=30,n){const l=`/django/api/strategy/index-analysis/macd-up-prediction/${i}/`;return(await B.get(l,{params:{token:n}})).data}const X={class:"index-volume-trend"},q={class:"chart-header"},J={class:"chart-controls"},K={class:"prediction-section"},Q={class:"prediction-header"},ee={class:"prediction-actions"},te={key:0,class:"prediction-loading"},oe=R({__name:"IndexVolumeTrend",props:{tsCode:{default:"000001.SH"},height:{default:"420px"}},setup(i){O(e=>({"5553ac43":e.height}));const a=i,n=h("1y"),l=h(null);let r=null;const d=h([]),t=h(!1),u=h(30);function g(e){const o=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0"),b=String(e.getDate()).padStart(2,"0");return`${o}${m}${b}`}function x(){const e=new Date,o=new Date,m=n.value==="1y"?1:n.value==="3y"?3:5;return o.setFullYear(e.getFullYear()-m),{start:g(o),end:g(e)}}async function c(){try{const{start:e,end:o}=x(),m=await G(a.tsCode,e,o);A(m)}catch(e){console.error("加载指数成交量失败:",e),E.error("加载指数成交量失败")}}async function $(){try{t.value=!0;const e=await W(a.tsCode,u.value);d.value=Array.isArray(e.list)?e.list:[]}catch(e){console.error("加载上涨预测日期失败:",e),E.error("加载上涨预测日期失败")}finally{t.value=!1}}function S(e){return e?e.includes("-")?e:e.length===8?`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`:e:""}function A(e){if(!l.value)return;r||(r=P(l.value));const o=e.map(p=>p.date),m=e.map(p=>p.volume),b=e.map(p=>p.amount!=null?Number(p.amount):null),I=e.map(p=>p.close!=null?Number(p.close):null),M={tooltip:{trigger:"axis",formatter:p=>{const w=p[0]?.dataIndex??0,C=b[w],j=I[w];return`日期: ${o[w]}<br/>成交量: ${m[w]}<br/>成交额: ${C??"-"}<br/>收盘价: ${j??"-"}`}},legend:{data:["成交量","成交额","收盘价"],top:0},grid:{left:50,right:70,top:30,bottom:40},xAxis:{type:"category",data:o,axisLabel:{rotate:45}},yAxis:[{type:"value",name:"成交量/成交额",position:"left"},{type:"value",name:"收盘价",position:"right"}],dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}],series:[{name:"成交量",type:"bar",data:m,itemStyle:{color:"#E6A23C"}},{name:"成交额",type:"line",yAxisIndex:0,data:b,smooth:!0,lineStyle:{color:"#409EFF"}},{name:"收盘价",type:"line",yAxisIndex:1,data:I,smooth:!0,lineStyle:{color:"#67C23A"}}]};r.setOption(M)}function D(){r?.resize()}return F(()=>{c(),$(),window.addEventListener("resize",D)}),H(()=>{window.removeEventListener("resize",D),r?.dispose(),r=null}),L(()=>a.tsCode,()=>{c(),$()}),(e,o)=>{const m=v("el-option"),b=v("el-select"),I=v("el-tag"),M=v("el-button"),p=v("el-empty"),w=v("el-space");return f(),k("div",X,[_("div",q,[o[1]||(o[1]=_("h3",null,null,-1)),_("div",J,[s(b,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=C=>n.value=C),placeholder:"时间范围",style:{width:"160px"},onChange:c},{default:y(()=>[s(m,{label:"近一年",value:"1y"}),s(m,{label:"近三年",value:"3y"}),s(m,{label:"近五年",value:"5y"})]),_:1},8,["modelValue"])])]),_("div",{ref_key:"chartRef",ref:l,class:"chart"},null,512),_("div",K,[_("div",Q,[o[3]||(o[3]=_("h4",null,"指数上涨预测日期（MACD XGBoost）",-1)),_("div",ee,[s(I,{type:"info"},{default:y(()=>[Y("最近 "+N(u.value)+" 天",1)]),_:1}),s(M,{size:"small",onClick:$,loading:t.value},{default:y(()=>[...o[2]||(o[2]=[Y("刷新",-1)])]),_:1},8,["loading"])])]),t.value?(f(),k("div",te,"正在加载预测数据...")):d.value.length===0?(f(),V(p,{key:1,description:"暂无预测上涨日期"})):(f(),V(w,{key:2,wrap:""},{default:y(()=>[(f(!0),k(T,null,z(d.value,C=>(f(),V(I,{key:C,type:"success"},{default:y(()=>[Y(N(S(C)),1)]),_:2},1024))),128))]),_:1}))])])}}}),ae=U(oe,[["__scopeId","data-v-a898bed1"]]);async function ne(i={}){return[...(await B.get("/django/api/tasks/index-basic/",{params:{fields:i.fields??"ts_code,name,market,publisher,category",category:i.category,market:i.market,name:i.name,publisher:i.publisher}})).data?.records||[]].sort((l,r)=>{const d=(l.name||"").localeCompare(r.name||"");return d!==0?d:l.ts_code.localeCompare(r.ts_code)})}const se={class:"index-analysis"},le={class:"chart-header"},re={class:"chart-controls"},ce=R({__name:"IndexAnalysis",setup(i){const a=h([]),n=h("000001.SH"),l=h("SSE");async function r(){try{const d=await ne({market:l.value});a.value=d,d.find(t=>t.ts_code===n.value)||(n.value=d.length?d[0].ts_code:"")}catch(d){console.error("获取指数列表失败:",d),E.error("获取指数列表失败")}}return F(()=>{r()}),L(l,()=>{r()}),(d,t)=>{const u=v("el-option"),g=v("el-select"),x=v("el-card");return f(),k("div",se,[s(x,{class:"mt-16",shadow:"hover"},{header:y(()=>[_("div",le,[t[2]||(t[2]=_("h3",null,"指数趋势（成交量/额/收盘价）",-1)),_("div",re,[s(g,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=c=>l.value=c),placeholder:"选择市场",style:{width:"160px","margin-right":"10px"}},{default:y(()=>[s(u,{label:"MSCI指数",value:"MSCI"}),s(u,{label:"中证指数",value:"CSI"}),s(u,{label:"上交所指数",value:"SSE"}),s(u,{label:"深交所指数",value:"SZSE"}),s(u,{label:"中金指数",value:"CICC"}),s(u,{label:"申万指数",value:"SW"}),s(u,{label:"其他指数",value:"OTH"})]),_:1},8,["modelValue"]),s(g,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=c=>n.value=c),placeholder:"选择指数",style:{width:"220px"},filterable:""},{default:y(()=>[(f(!0),k(T,null,z(a.value,c=>(f(),V(u,{key:c.ts_code,label:`${c.name??c.ts_code} (${c.ts_code})`,value:c.ts_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:y(()=>[s(ae,{"ts-code":n.value,height:"420px"},null,8,["ts-code"])]),_:1})])}}}),ue=U(ce,[["__scopeId","data-v-efe65e17"]]);export{ue as default};
