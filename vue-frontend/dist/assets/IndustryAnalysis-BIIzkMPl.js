import{x as oe,d as Y,a as _,z as K,D as H,y as Z,G as le,c as M,e as d,i as k,w as g,H as ie,I as ue,b as e,f as G,g as W,t as F,k as J,J as X,E as P,o as T,_ as ee,F as te,A as ae}from"./index-CMCs1k_N.js";import{i as Q}from"./index-1yOyFXf9.js";import{F as I,f as de,a as ne}from"./industry-fund-flow-Hap3LZ-B.js";const se="/django/api/stock",ce=async(z,N)=>{const c={};return(await oe.get(`${se}/industry-sectors/`,{params:c})).data},_e=async(z={})=>(await oe.get(`${se}/industry/performance-reports/`,{params:z})).data,me={class:"industry-fund-flow-heatmap"},fe={class:"header-controls"},ve={class:"controls"},pe={"element-loading-text":"正在加载数据..."},ye={key:1,class:"stats-container"},he={class:"card-header"},ge={class:"stats-content"},we={class:"stat-item"},xe={class:"stat-value positive"},Ie={class:"stat-item"},Ne={class:"stat-value negative"},Te={class:"stat-item"},be={class:"stat-value"},Ae={class:"stat-item"},Le={class:"stat-value positive"},Oe={class:"stat-item"},ke={class:"stat-value negative"},Ce=Y({__name:"IndustryFundFlowHeatmap",props:{industry:{},title:{default:"行业资金流热力图"}},setup(z,{expose:N}){const c=z,f=_();let v=null;const b=_(!1),A=_(!1),L=_("amount"),C=_("20"),u=_("all"),S=_(null),m=_(null),w=K(()=>L.value==="amount"?[{key:I.TOTAL_NET_INFLOW_AMOUNT,name:"全部净流入"},{key:I.MAIN_NET_INFLOW_AMOUNT,name:"主力净流入"},{key:I.SUPER_LARGE_NET_INFLOW_AMOUNT,name:"超大单净流入"},{key:I.LARGE_NET_INFLOW_AMOUNT,name:"大单净流入"},{key:I.MEDIUM_NET_INFLOW_AMOUNT,name:"中单净流入"},{key:I.SMALL_NET_INFLOW_AMOUNT,name:"小单净流入"}]:[{key:I.TOTAL_NET_INFLOW_RATIO,name:"全部净流入占比"},{key:I.MAIN_NET_INFLOW_RATIO,name:"主力净流入占比"},{key:I.SUPER_LARGE_NET_INFLOW_RATIO,name:"超大单净流入占比"},{key:I.LARGE_NET_INFLOW_RATIO,name:"大单净流入占比"},{key:I.MEDIUM_NET_INFLOW_RATIO,name:"中单净流入占比"},{key:I.SMALL_NET_INFLOW_RATIO,name:"小单净流入占比"}]),R=()=>{if(!S.value){m.value=null;return}const a=S.value,t=a.swCodeNames.find(q=>q.indexName===c.industry);if(!t){m.value=null;return}const l=a.congestions[t.indexCode]||a.congestions[t.indexName];if(!l||l.length===0){m.value=null;return}const i=["main_net_inflow_amount","main_net_inflow_ratio","super_large_net_inflow_amount","super_large_net_inflow_ratio","large_net_inflow_amount","large_net_inflow_ratio","medium_net_inflow_amount","medium_net_inflow_ratio","small_net_inflow_amount","small_net_inflow_ratio"];let s=0,x=0,O=0;l.forEach(q=>{i.forEach(n=>{const y=q[n];if(typeof y=="number"&&!isNaN(y)&&isFinite(y)){let o=!0;(u.value==="positive"&&y<=0||u.value==="negative"&&y>=0)&&(o=!1),o&&(O++,y>0?s++:y<0&&x++)}})});const D=O>0?(s/O*100).toFixed(2):"0.00",B=O>0?(x/O*100).toFixed(2):"0.00";m.value={positiveCount:s,negativeCount:x,totalCount:O,positiveRatio:D,negativeRatio:B}},V=async()=>{b.value=!0;try{const a=new Date,t=a.toISOString().split("T")[0],l=C.value==="all"?30:parseInt(C.value),i=new Date(a);i.setDate(a.getDate()-l);const s=i.toISOString().split("T")[0],x=await de(s,t);x?(S.value=x,await X(),r(),R()):P.error("获取资金流数据失败")}catch(a){console.error("获取资金流数据出错:",a),P.error("获取数据出错，请检查网络连接或API服务是否可用")}finally{b.value=!1}},U=()=>{f.value&&(v=Q(f.value),r())},r=()=>{if(!v||!S.value)return;const a=S.value,t=a.dates,l=a.swCodeNames.find(n=>n.indexName===c.industry);if(!l){P.warning(`未找到行业"${c.industry}"的数据`);return}const i=a.congestions[l.indexCode]||a.congestions[l.indexName];if(!i||i.length===0){P.warning(`行业"${c.industry}"暂无资金流数据`);return}const s=[...w.value].sort((n,y)=>{if(i.length===0)return 0;const o=i[i.length-1];let E,h;return n.key===I.TOTAL_NET_INFLOW_AMOUNT?E=o.super_large_net_inflow_amount+o.large_net_inflow_amount+o.medium_net_inflow_amount+o.small_net_inflow_amount:n.key===I.TOTAL_NET_INFLOW_RATIO?E=o.super_large_net_inflow_ratio+o.large_net_inflow_ratio+o.medium_net_inflow_ratio+o.small_net_inflow_ratio:E=o[n.key],y.key===I.TOTAL_NET_INFLOW_AMOUNT?h=o.super_large_net_inflow_amount+o.large_net_inflow_amount+o.medium_net_inflow_amount+o.small_net_inflow_amount:y.key===I.TOTAL_NET_INFLOW_RATIO?h=o.super_large_net_inflow_ratio+o.large_net_inflow_ratio+o.medium_net_inflow_ratio+o.small_net_inflow_ratio:h=o[y.key],A.value?E-h:h-E}),x=[];let O=1/0,D=-1/0;i.map(n=>{const y=n.main_net_inflow_amount+n.super_large_net_inflow_amount+n.large_net_inflow_amount+n.medium_net_inflow_amount+n.small_net_inflow_amount,o=n.main_net_inflow_ratio+n.super_large_net_inflow_ratio+n.large_net_inflow_ratio+n.medium_net_inflow_ratio+n.small_net_inflow_ratio;return{...n,total_net_inflow_amount:y,total_net_inflow_ratio:o}}).forEach((n,y)=>{s.forEach((o,E)=>{const h=n[o.key];if(typeof h=="number"&&!isNaN(h)&&isFinite(h)){let $=!0;(u.value==="positive"&&h<=0||u.value==="negative"&&h>=0)&&($=!1),$&&(x.push([y,E,h]),O=Math.min(O,h),D=Math.max(D,h))}})}),(O===1/0||D===-1/0)&&(O=0,D=100),v.clear();const q={tooltip:{position:"top",formatter:function(n){const[y,o,E]=n.data,h=t[y],$=s[o],j=ne[$.key],re=j.formatter?j.formatter(E):E.toFixed(2);return`${$.name}<br/>${h}<br/>数值: ${re}${j.unit}`}},grid:{height:Math.max(300,s.length*40)+"px",top:"2%",left:"5%",right:"10%",bottom:"2%",containLabel:!0},xAxis:[{type:"category",data:t,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:10}},{type:"category",position:"top",data:t,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{rotate:45,fontSize:10,margin:6},name:"日期",nameLocation:"end",nameTextStyle:{fontSize:12}}],yAxis:[{type:"category",data:s.map(n=>n.name),splitArea:{show:!0},axisLabel:{fontSize:11}},{type:"category",position:"right",data:s.map(n=>n.name),axisTick:{show:!1},axisLine:{show:!1},axisLabel:{fontSize:11},name:"资金类型",nameLocation:"end",nameTextStyle:{fontSize:12}}],visualMap:{min:O,max:D,calculable:!0,orient:"vertical",right:"0%",top:"5%",width:15,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]},text:["高","低"],textStyle:{fontSize:12}},series:[{name:L.value==="amount"?"资金流入金额":"资金流入占比",type:"heatmap",data:x,label:{show:!0,fontSize:9,formatter:function(n){const[y,o,E]=n.data,h=s[o],$=ne[h.key];return $.formatter?$.formatter(E):E.toFixed(1)}},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};X(()=>{if(v&&(v.setOption(q),f.value)){const n=Math.max(400,s.length*50+120);f.value.style.height=n+"px",setTimeout(()=>{v&&v.resize()},0)}})},p=()=>{A.value=!A.value,r()};return H(L,()=>{r()}),H(()=>c.industry,()=>{r(),R()}),H([S,()=>c.industry],()=>{R()}),H(u,()=>{R()}),Z(()=>{U(),V()}),le(()=>{v&&(v.dispose(),v=null)}),N({refreshData:V}),(a,t)=>{const l=k("el-radio-button"),i=k("el-radio-group"),s=k("el-option"),x=k("el-select"),O=k("el-button"),D=k("el-empty"),B=k("el-card"),q=ue("loading");return T(),M("div",me,[d(B,{shadow:"hover"},{header:g(()=>[e("div",fe,[e("h3",null,F(a.title),1),e("div",ve,[d(i,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=n=>L.value=n),onChange:r,size:"small"},{default:g(()=>[d(l,{label:"amount"},{default:g(()=>[...t[3]||(t[3]=[J("资金数量",-1)])]),_:1}),d(l,{label:"ratio"},{default:g(()=>[...t[4]||(t[4]=[J("资金比率",-1)])]),_:1})]),_:1},8,["modelValue"]),d(x,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),onChange:V,placeholder:"选择日期范围",style:{width:"150px","margin-left":"10px"}},{default:g(()=>[d(s,{label:"最近10天",value:"10"}),d(s,{label:"最近15天",value:"15"}),d(s,{label:"最近20天",value:"20"}),d(s,{label:"全部29天",value:"all"})]),_:1},8,["modelValue"]),d(x,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=n=>u.value=n),onChange:r,placeholder:"数值过滤",style:{width:"120px","margin-left":"10px"}},{default:g(()=>[d(s,{label:"全部",value:"all"}),d(s,{label:"仅正值",value:"positive"}),d(s,{label:"仅负值",value:"negative"})]),_:1},8,["modelValue"]),d(O,{onClick:p,type:"primary",style:{"margin-left":"10px"}},{default:g(()=>[...t[5]||(t[5]=[J(" 按最后一列排序 ",-1)])]),_:1})])])]),default:g(()=>[ie((T(),M("div",pe,[e("div",{ref_key:"chartContainer",ref:f,class:"chart-container"},null,512),!b.value&&!S.value?(T(),G(D,{key:0,description:"暂无数据","image-size":200})):W("",!0),!b.value&&S.value&&m.value?(T(),M("div",ye,[d(B,{class:"stats-card",shadow:"hover"},{header:g(()=>[e("div",he,[e("span",null,"净流入正负比率统计 ("+F(u.value==="all"?"全部数值":u.value==="positive"?"仅正值":"仅负值")+")",1)])]),default:g(()=>[e("div",ge,[e("div",we,[t[6]||(t[6]=e("span",{class:"stat-label"},"正值项数:",-1)),e("span",xe,F(m.value.positiveCount),1)]),e("div",Ie,[t[7]||(t[7]=e("span",{class:"stat-label"},"负值项数:",-1)),e("span",Ne,F(m.value.negativeCount),1)]),e("div",Te,[t[8]||(t[8]=e("span",{class:"stat-label"},"总项数:",-1)),e("span",be,F(m.value.totalCount),1)]),e("div",Ae,[t[9]||(t[9]=e("span",{class:"stat-label"},"正值比率:",-1)),e("span",Le,F(m.value.positiveRatio)+"%",1)]),e("div",Oe,[t[10]||(t[10]=e("span",{class:"stat-label"},"负值比率:",-1)),e("span",ke,F(m.value.negativeRatio)+"%",1)])])]),_:1})])):W("",!0)])),[[q,b.value]])]),_:1})])}}}),Se=ee(Ce,[["__scopeId","data-v-10cda965"]]),Ee={class:"industry-trend-charts"},Fe={class:"chart-header"},Re={class:"chart-info"},De={class:"info-item"},$e={class:"info-item"},Me={class:"chart-header"},Ve={class:"chart-info"},ze={class:"info-item"},Ue={class:"info-item"},qe={class:"chart-header"},We={class:"chart-info"},Pe={class:"info-item"},Ge={class:"info-item"},Be={key:0,class:"loading-overlay"},He=Y({__name:"IndustryTrendCharts",props:{industry:{default:void 0},quarter:{},industryName:{},quarterName:{}},setup(z){const N=z,c=_(!1),f=_(),v=_(),b=_(),A=_(),L=_(),C=_(),u=_([]),S=async()=>{if(N.quarter){c.value=!0;try{const r={report_type:N.quarter};N.industry&&N.industry!=="all"&&(r.industry=N.industry);const p=await _e(r);u.value=p.aggregated_reports,await X(),m()}catch(r){console.error("获取行业数据失败:",r),P.error("获取数据失败，请稍后重试")}finally{c.value=!1}}},m=()=>{w(),R(),V()},w=()=>{if(!f.value||u.value.length===0)return;A.value&&A.value.dispose(),A.value=Q(f.value);const r=u.value.map(l=>l.report_date),p=u.value.map(l=>l.total_operating_revenue||0),a=u.value.map(l=>l.total_net_profit||0),t={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["营业收入","净利润"]},xAxis:{type:"category",data:r},yAxis:[{type:"value",name:"营业收入 (万元)",position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"净利润 (万元)",position:"right",axisLabel:{formatter:"{value}"}}],series:[{name:"营业收入",type:"line",yAxisIndex:0,data:p,smooth:!0,itemStyle:{color:"#1890ff"},lineStyle:{color:"#1890ff"}},{name:"净利润",type:"line",yAxisIndex:1,data:a,smooth:!0,itemStyle:{color:"#52c41a"},lineStyle:{color:"#52c41a"}}]};A.value.setOption(t)},R=()=>{if(!v.value||u.value.length===0)return;L.value&&L.value.dispose(),L.value=Q(v.value);const r=u.value.map(i=>i.report_date),p=u.value.map(i=>i.avg_operating_revenue_growth_rate||0),a=u.value.map(i=>i.avg_net_profit_growth_rate||0),t=u.value.map(i=>i.avg_gross_profit_margin||0),l={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(i){let s=i[0].name+"<br/>";return i.forEach(x=>{s+=x.marker+x.seriesName+": "+x.value.toFixed(2)+"%<br/>"}),s}},legend:{data:["营业收入增长率","净利润增长率","毛利率"]},xAxis:{type:"category",data:r},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"营业收入增长率",type:"line",data:p,smooth:!0,itemStyle:{color:"#faad14"},lineStyle:{color:"#faad14"}},{name:"净利润增长率",type:"line",data:a,smooth:!0,itemStyle:{color:"#f5222d"},lineStyle:{color:"#f5222d"}},{name:"毛利率",type:"line",data:t,smooth:!0,itemStyle:{color:"#722ed1"},lineStyle:{color:"#722ed1"}}]};L.value.setOption(l)},V=()=>{if(!b.value||u.value.length===0)return;C.value&&C.value.dispose(),C.value=Q(b.value);const r=u.value.map(l=>l.report_date),p=u.value.map(l=>l.avg_roe||0),a=u.value.map(l=>(l.avg_roe||0)*.8),t={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(l){let i=l[0].name+"<br/>";return l.forEach(s=>{i+=s.marker+s.seriesName+": "+s.value.toFixed(2)+"%<br/>"}),i}},legend:{data:["ROE","ROA"]},xAxis:{type:"category",data:r},yAxis:{type:"value",name:"百分比 (%)",axisLabel:{formatter:"{value}%"}},series:[{name:"ROE",type:"line",data:p,smooth:!0,itemStyle:{color:"#13c2c2"},lineStyle:{color:"#13c2c2"}},{name:"ROA",type:"line",data:a,smooth:!0,itemStyle:{color:"#eb2f96"},lineStyle:{color:"#eb2f96"}}]};C.value.setOption(t)},U=()=>{A.value?.resize(),L.value?.resize(),C.value?.resize()};return H([()=>N.industry,()=>N.quarter],()=>{S()},{immediate:!1}),Z(()=>{S(),window.addEventListener("resize",U)}),le(()=>{window.removeEventListener("resize",U),A.value?.dispose(),L.value?.dispose(),C.value?.dispose()}),(r,p)=>{const a=k("el-card"),t=k("el-loading");return T(),M("div",Ee,[d(a,{class:"chart-card",shadow:"hover"},{default:g(()=>[e("div",Fe,[p[0]||(p[0]=e("h3",null,"收入利润数据",-1)),e("div",Re,[e("span",De,"行业: "+F(r.industryName),1),e("span",$e,"季度: "+F(r.quarterName),1)])]),e("div",{ref_key:"revenueChartRef",ref:f,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),d(a,{class:"chart-card",shadow:"hover"},{default:g(()=>[e("div",Me,[p[1]||(p[1]=e("h3",null,"增长率毛利率数据",-1)),e("div",Ve,[e("span",ze,"行业: "+F(r.industryName),1),e("span",Ue,"季度: "+F(r.quarterName),1)])]),e("div",{ref_key:"growthChartRef",ref:v,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),d(a,{class:"chart-card",shadow:"hover"},{default:g(()=>[e("div",qe,[p[2]||(p[2]=e("h3",null,"ROA/ROE数据",-1)),e("div",We,[e("span",Pe,"行业: "+F(r.industryName),1),e("span",Ge,"季度: "+F(r.quarterName),1)])]),e("div",{ref_key:"roeChartRef",ref:b,class:"chart",style:{width:"100%",height:"400px"}},null,512)]),_:1}),c.value?(T(),M("div",Be,[d(t,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):W("",!0)])}}}),Qe=ee(He,[["__scopeId","data-v-b9e4f51d"]]),je={class:"industry-analysis"},Je={class:"filter-row"},Ke={class:"filter-item"},Xe={class:"filter-item"},Ye={key:3,class:"loading-overlay"},Ze=Y({__name:"IndustryAnalysis",setup(z){const N=_(!1),c=_(),f=_(""),v=_([]),b=_([{label:"年报",value:"annual"},{label:"中报",value:"semi_annual"},{label:"一季报",value:"q1"},{label:"三季报",value:"q3"},{label:"季报",value:"quarterly"}]),A=K(()=>c.value==="all"?"全部行业":v.value.find(w=>w.name===c.value)?.name||"未知行业"),L=K(()=>b.value.find(w=>w.value===f.value)?.label||"未选择"),C=async()=>{N.value=!0;try{const m=await ce();console.log("获取行业列表响应:",m),v.value=m.sectors,console.log("行业列表:",v.value),b.value.length>0&&(f.value=b.value[0].value),P.success("页面初始化完成")}catch(m){console.error("初始化数据失败:",m),P.error("初始化数据失败，请刷新页面重试")}finally{N.value=!1}},u=()=>{console.log("行业已变更为:",c.value)},S=()=>{console.log("季度已变更为:",f.value)};return Z(()=>{C()}),(m,w)=>{const R=k("el-option"),V=k("el-select"),U=k("el-card"),r=k("el-empty"),p=k("el-loading");return T(),M("div",je,[d(U,{class:"filter-panel",shadow:"hover"},{default:g(()=>[e("div",Je,[e("div",Ke,[w[2]||(w[2]=e("label",{class:"filter-label"},"选择行业：",-1)),d(V,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=a=>c.value=a),placeholder:"请选择行业",style:{width:"200px"},onChange:u},{default:g(()=>[(T(!0),M(te,null,ae(v.value,a=>(T(),G(R,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",Xe,[w[3]||(w[3]=e("label",{class:"filter-label"},"选择季度：",-1)),d(V,{modelValue:f.value,"onUpdate:modelValue":w[1]||(w[1]=a=>f.value=a),placeholder:"请选择季度",style:{width:"150px"},onChange:S},{default:g(()=>[(T(!0),M(te,null,ae(b.value,a=>(T(),G(R,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1}),c.value&&f.value?(T(),G(Qe,{key:0,industry:c.value,quarter:f.value,"industry-name":A.value,"quarter-name":L.value},null,8,["industry","quarter","industry-name","quarter-name"])):W("",!0),!c.value||!f.value?(T(),G(r,{key:1,description:"请选择行业和季度查看趋势分析","image-size":200})):W("",!0),c.value&&c.value!=="all"?(T(),G(U,{key:2,class:"fund-flow-panel",shadow:"hover"},{default:g(()=>[d(Se,{industry:A.value,title:`${A.value} - 资金流热力图`},null,8,["industry","title"])]),_:1})):W("",!0),N.value?(T(),M("div",Ye,[d(p,{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):W("",!0)])}}}),nt=ee(Ze,[["__scopeId","data-v-1c2929c4"]]);export{nt as default};
